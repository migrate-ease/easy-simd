/* SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * Copyright:
 *   2020      Evan Nemerson <evan@nemerson.com>
 *   2020      Himanshi Mathur <himanshi18037@iiitd.ac.in>
 *   2020      Hidayat Khan <huk2209@gmail.com>
 */

#define EASYSIMD_TEST_X86_AVX512_INSN alignr

#include <test/x86/avx512/test-avx512.h>
#include <easysimd/x86/avx512/alignr.h>

static int
test_easysimd_mm512_alignr_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int64_t a[8];
    int64_t b[8];
    int64_t r[8];
  } test_vec[8] = {
    { { -INT64_C( 3202631178486711734), -INT64_C( 6119467795381748010), -INT64_C( 2876160444281856974),  INT64_C( 5514518117597297881),
         INT64_C(  772415941779602683),  INT64_C(  381819515831028523), -INT64_C( 8898097277151291302), -INT64_C( 2979748136944772521) },
      { -INT64_C( 7185085899783650294), -INT64_C( 8226518288692300547),  INT64_C( 5661512872039570273), -INT64_C( 5708790098248083435),
        -INT64_C( 1108385841909104495), -INT64_C( 4130479926455182356), -INT64_C( 5389009261838473742), -INT64_C( 4858421736772346308) },
      { -INT64_C( 4130479926455182356), -INT64_C( 5389009261838473742), -INT64_C( 4858421736772346308), -INT64_C( 3202631178486711734),
        -INT64_C( 6119467795381748010), -INT64_C( 2876160444281856974),  INT64_C( 5514518117597297881),  INT64_C(  772415941779602683) } },
    { { -INT64_C( 6426815086052015381),  INT64_C( 1757374889297612857), -INT64_C( 2905605041563814312), -INT64_C( 6269769630999752171),
         INT64_C( 5922046702697037007), -INT64_C( 4601179737930271258),  INT64_C( 8357666459231987338), -INT64_C( 3306293022530750793) },
      { -INT64_C( 2244890506131954580), -INT64_C( 6437595376468047744),  INT64_C( 9153785902656086583), -INT64_C( 2858641805250675842),
        -INT64_C( 4931943816751042636), -INT64_C( 4269045707615994881), -INT64_C( 3245299466066359121), -INT64_C( 5881234943898293988) },
      { -INT64_C( 4269045707615994881), -INT64_C( 3245299466066359121), -INT64_C( 5881234943898293988), -INT64_C( 6426815086052015381),
         INT64_C( 1757374889297612857), -INT64_C( 2905605041563814312), -INT64_C( 6269769630999752171),  INT64_C( 5922046702697037007) } },
    { { -INT64_C(  698924397915947177), -INT64_C( 1317352098663108506), -INT64_C( 8249087698071711649), -INT64_C( 2887801868370126524),
        -INT64_C( 7267766133646079690),  INT64_C( 7480836356240716966), -INT64_C( 3146713695965792683),  INT64_C( 1716434279016327801) },
      { -INT64_C( 7703011409344054712),  INT64_C( 4758699440292341660),  INT64_C( 4532413175970735489),  INT64_C( 4665457598751307975),
         INT64_C(  560652434532009026),  INT64_C(  985643508170441086), -INT64_C( 2675978121267726630),  INT64_C( 6932238422853686781) },
      {  INT64_C(  985643508170441086), -INT64_C( 2675978121267726630),  INT64_C( 6932238422853686781), -INT64_C(  698924397915947177),
        -INT64_C( 1317352098663108506), -INT64_C( 8249087698071711649), -INT64_C( 2887801868370126524), -INT64_C( 7267766133646079690) } },
    { {  INT64_C( 5096203171853955654), -INT64_C(  850231343014910822),  INT64_C( 5981749344956797461),  INT64_C( 1009787942635865734),
        -INT64_C( 8539536349596773010), -INT64_C( 6635240897813401636),  INT64_C( 8421679551189122357),  INT64_C( 1309451983351457622) },
      {  INT64_C( 4623445727472380849), -INT64_C(  997792794100180490),  INT64_C( 1873883118226568350), -INT64_C( 1928556365228795515),
         INT64_C( 4824673844784891215), -INT64_C( 1641300057115972984), -INT64_C( 7295701565276047646), -INT64_C( 6077045448256522097) },
      { -INT64_C( 1641300057115972984), -INT64_C( 7295701565276047646), -INT64_C( 6077045448256522097),  INT64_C( 5096203171853955654),
        -INT64_C(  850231343014910822),  INT64_C( 5981749344956797461),  INT64_C( 1009787942635865734), -INT64_C( 8539536349596773010) } },
    { {  INT64_C( 7355596307863383941), -INT64_C( 6146880465372652931),  INT64_C( 3263157674443810714), -INT64_C( 7993719960558826488),
         INT64_C( 4543699652467388361),  INT64_C( 4090598450235226705),  INT64_C( 3290776890325275872),  INT64_C(   61539898969201725) },
      {  INT64_C(  293496709687229457), -INT64_C( 5456425597643449745), -INT64_C( 7257307403254616586), -INT64_C( 8236874275707626887),
         INT64_C( 8985089234161391610), -INT64_C( 6478761557956571251), -INT64_C( 6920332617543759619), -INT64_C( 7787005675744273692) },
      { -INT64_C( 6478761557956571251), -INT64_C( 6920332617543759619), -INT64_C( 7787005675744273692),  INT64_C( 7355596307863383941),
        -INT64_C( 6146880465372652931),  INT64_C( 3263157674443810714), -INT64_C( 7993719960558826488),  INT64_C( 4543699652467388361) } },
    { {  INT64_C( 5755867240499007319),  INT64_C( 4042199719394503361), -INT64_C( 3975118387623503601),  INT64_C( 8903641910945064036),
        -INT64_C( 8973211416905396122), -INT64_C(   28132171533965014),  INT64_C( 2202834965110272230),  INT64_C( 4165174150196607790) },
      { -INT64_C( 7583259763612210052), -INT64_C( 6128669270751922430),  INT64_C( 6890232764595185607), -INT64_C( 2103885372354020415),
         INT64_C(  733773415359524396), -INT64_C( 8788511067602081638),  INT64_C( 5018883017025223958),  INT64_C(  336546047182067810) },
      { -INT64_C( 8788511067602081638),  INT64_C( 5018883017025223958),  INT64_C(  336546047182067810),  INT64_C( 5755867240499007319),
         INT64_C( 4042199719394503361), -INT64_C( 3975118387623503601),  INT64_C( 8903641910945064036), -INT64_C( 8973211416905396122) } },
    { {  INT64_C( 5325447941058251988), -INT64_C( 1641368740406237966),  INT64_C( 5329402024644591660),  INT64_C( 5191450201995464239),
         INT64_C( 7169744287169881992),  INT64_C(  264673166705895408), -INT64_C( 2180119685168374642),  INT64_C( 1455774891132899190) },
      {  INT64_C( 6084306351659178138),  INT64_C( 6975728182961341684), -INT64_C( 6830954399820053857), -INT64_C( 6267957280716940445),
         INT64_C( 1210945054545628950),  INT64_C( 5177918737690125736), -INT64_C( 6343376956245298901),  INT64_C( 6314216285674046183) },
      {  INT64_C( 5177918737690125736), -INT64_C( 6343376956245298901),  INT64_C( 6314216285674046183),  INT64_C( 5325447941058251988),
        -INT64_C( 1641368740406237966),  INT64_C( 5329402024644591660),  INT64_C( 5191450201995464239),  INT64_C( 7169744287169881992) } },
    { {  INT64_C( 2383988019411703273), -INT64_C( 4218051397383556986), -INT64_C( 4461639122202980567),  INT64_C( 3399471450224700309),
         INT64_C( 2758536823477436334), -INT64_C( 8747456821870664390),  INT64_C( 6734861425878218201),  INT64_C( 3974532816862130356) },
      { -INT64_C( 2222906129864827552),  INT64_C( 2192778329763248779),  INT64_C( 2173631592739856901),  INT64_C( 2178124554626948474),
        -INT64_C( 3880338994711586659),  INT64_C( 3540428729990962366), -INT64_C( 5112666122419702397),  INT64_C(  172252121297331335) },
      {  INT64_C( 3540428729990962366), -INT64_C( 5112666122419702397),  INT64_C(  172252121297331335),  INT64_C( 2383988019411703273),
        -INT64_C( 4218051397383556986), -INT64_C( 4461639122202980567),  INT64_C( 3399471450224700309),  INT64_C( 2758536823477436334) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i r = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_alignr_epi64(a, b, 5);
    } EASYSIMD_TEST_PERF_END("_mm512_alignr_epi64");
    easysimd_assert_m512i_i64(r, ==, ret);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i64x8();
    easysimd__m512i b = easysimd_test_x86_random_i64x8();
    easysimd__m512i r = easysimd_mm512_alignr_epi64(a, b, 5);

    easysimd_test_x86_write_i64x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

EASYSIMD_TEST_FUNC_LIST_BEGIN
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_alignr_epi64)
EASYSIMD_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>


