#define EASYSIMD_TEST_X86_AVX512_INSN dpbf16

#include <test/x86/avx512/test-avx512.h>
#include <easysimd/x86/avx512/dpbf16.h>

static int
test_easysimd_mm_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[4];
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(     0.93), EASYSIMD_FLOAT32_C(   -30.68), EASYSIMD_FLOAT32_C(     7.59), EASYSIMD_FLOAT32_C(     4.46) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -27.99),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    45.72) },
      { EASYSIMD_FLOAT32_C(    -2.47),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     0.29) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(    44.06), EASYSIMD_FLOAT32_C(    39.39), EASYSIMD_FLOAT32_C(   -16.35), EASYSIMD_FLOAT32_C(   -41.96) },
      { EASYSIMD_FLOAT32_C(    25.67), EASYSIMD_FLOAT32_C(   -10.76), EASYSIMD_FLOAT32_C(   -35.31), EASYSIMD_FLOAT32_C(   -34.29) },
      { EASYSIMD_FLOAT32_C(    24.99), EASYSIMD_FLOAT32_C(   -33.35), EASYSIMD_FLOAT32_C(   -42.40), EASYSIMD_FLOAT32_C(    38.29) },
      {     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(7416054272.00), EASYSIMD_FLOAT32_C(  1472.96), EASYSIMD_FLOAT32_C( -1352.02) } },
    { { EASYSIMD_FLOAT32_C(   -14.13), EASYSIMD_FLOAT32_C(   -21.45), EASYSIMD_FLOAT32_C(    47.00), EASYSIMD_FLOAT32_C(    49.00) },
      { EASYSIMD_FLOAT32_C(    49.48), EASYSIMD_FLOAT32_C(   -43.57), EASYSIMD_FLOAT32_C(    -3.78), EASYSIMD_FLOAT32_C(    46.59) },
      { EASYSIMD_FLOAT32_C(     5.84), EASYSIMD_FLOAT32_C(   -44.27), EASYSIMD_FLOAT32_C(    -9.99), EASYSIMD_FLOAT32_C(    26.51) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  1903.43),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  1281.25) } },
    { { EASYSIMD_FLOAT32_C(   -18.95), EASYSIMD_FLOAT32_C(    24.25), EASYSIMD_FLOAT32_C(    11.61), EASYSIMD_FLOAT32_C(   -10.02) },
      { EASYSIMD_FLOAT32_C(    36.90), EASYSIMD_FLOAT32_C(   -27.07), EASYSIMD_FLOAT32_C(    38.86), EASYSIMD_FLOAT32_C(   -40.80) },
      { EASYSIMD_FLOAT32_C(    18.20), EASYSIMD_FLOAT32_C(   -38.04), EASYSIMD_FLOAT32_C(   -18.22), EASYSIMD_FLOAT32_C(   -33.36) },
      { EASYSIMD_FLOAT32_C(   647.14), EASYSIMD_FLOAT32_C(  1050.25), EASYSIMD_FLOAT32_C(-29032169801320738206934261301248.00), EASYSIMD_FLOAT32_C(16922581844619299913728.00) } },
    { { EASYSIMD_FLOAT32_C(    47.73), EASYSIMD_FLOAT32_C(   -29.20), EASYSIMD_FLOAT32_C(   -45.25), EASYSIMD_FLOAT32_C(   -23.06) },
      { EASYSIMD_FLOAT32_C(   -16.02), EASYSIMD_FLOAT32_C(    43.85), EASYSIMD_FLOAT32_C(   -37.64), EASYSIMD_FLOAT32_C(    31.51) },
      { EASYSIMD_FLOAT32_C(   -46.48), EASYSIMD_FLOAT32_C(    24.74), EASYSIMD_FLOAT32_C(   -18.20), EASYSIMD_FLOAT32_C(    29.19) },
      { EASYSIMD_FLOAT32_C(-8782671249408.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   634.44), EASYSIMD_FLOAT32_C(   894.38) } },
    { { EASYSIMD_FLOAT32_C(   -30.00), EASYSIMD_FLOAT32_C(    -3.97), EASYSIMD_FLOAT32_C(    -6.96), EASYSIMD_FLOAT32_C(    -7.87) },
      { EASYSIMD_FLOAT32_C(   -36.02), EASYSIMD_FLOAT32_C(    -3.52), EASYSIMD_FLOAT32_C(    44.90), EASYSIMD_FLOAT32_C(    38.96) },
      { EASYSIMD_FLOAT32_C(    13.13), EASYSIMD_FLOAT32_C(   -47.50), EASYSIMD_FLOAT32_C(    27.25), EASYSIMD_FLOAT32_C(    12.61) },
      { EASYSIMD_FLOAT32_C(  -502.50), EASYSIMD_FLOAT32_C(   163.02), EASYSIMD_FLOAT32_C(  1212.48), EASYSIMD_FLOAT32_C(10848881231265792.00) } },
    { { EASYSIMD_FLOAT32_C(    26.18), EASYSIMD_FLOAT32_C(    18.34), EASYSIMD_FLOAT32_C(   -17.54), EASYSIMD_FLOAT32_C(   -31.71) },
      { EASYSIMD_FLOAT32_C(   -41.07), EASYSIMD_FLOAT32_C(   -26.52), EASYSIMD_FLOAT32_C(     9.19), EASYSIMD_FLOAT32_C(    14.77) },
      { EASYSIMD_FLOAT32_C(   -20.79), EASYSIMD_FLOAT32_C(    49.20), EASYSIMD_FLOAT32_C(    -8.72), EASYSIMD_FLOAT32_C(   -33.90) },
      { EASYSIMD_FLOAT32_C(11287586370748416.00), EASYSIMD_FLOAT32_C( -1280.16), EASYSIMD_FLOAT32_C(   -97.36), EASYSIMD_FLOAT32_C(  -529.52) } },
    { { EASYSIMD_FLOAT32_C(   -24.57), EASYSIMD_FLOAT32_C(   -10.57), EASYSIMD_FLOAT32_C(    44.37), EASYSIMD_FLOAT32_C(    26.36) },
      { EASYSIMD_FLOAT32_C(   -27.87), EASYSIMD_FLOAT32_C(   -19.86), EASYSIMD_FLOAT32_C(   -24.70), EASYSIMD_FLOAT32_C(    40.33) },
      { EASYSIMD_FLOAT32_C(    -7.89), EASYSIMD_FLOAT32_C(     7.09), EASYSIMD_FLOAT32_C(   -43.03), EASYSIMD_FLOAT32_C(    26.08) },
      {     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  1103.24), EASYSIMD_FLOAT32_C(  1072.86) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 tmp;

    easysimd__m128 src = easysimd_mm_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m128 r = easysimd_mm_dpbf16_ps(src, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128 src = easysimd_test_x86_random_f32x4(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__m128bh a = HEDLEY_REINTERPRET_CAST(easysimd__m128bh, easysimd_test_x86_random_extract_f32x4(i, 2, 0, values));
    easysimd__m128bh b = HEDLEY_REINTERPRET_CAST(easysimd__m128bh, easysimd_test_x86_random_extract_f32x4(i, 2, 1, values));
    easysimd__m128 r = easysimd_mm_dpbf16_ps(src, a, b);

    easysimd_test_x86_write_f32x4(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x4(2, HEDLEY_REINTERPRET_CAST(easysimd__m128, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, HEDLEY_REINTERPRET_CAST(easysimd__m128, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_mask_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[4];
    const easysimd__mmask8 k;
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(    35.52), EASYSIMD_FLOAT32_C(   -15.16), EASYSIMD_FLOAT32_C(    12.96), EASYSIMD_FLOAT32_C(   -37.51) },
      UINT8_C( 28),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    37.95),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -46.79) },
      { EASYSIMD_FLOAT32_C(    12.78),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -34.41) },
      { EASYSIMD_FLOAT32_C(    35.52), EASYSIMD_FLOAT32_C(   -15.16),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  1563.68) } },
    { { EASYSIMD_FLOAT32_C(    19.58), EASYSIMD_FLOAT32_C(    34.74), EASYSIMD_FLOAT32_C(    11.92), EASYSIMD_FLOAT32_C(   -27.97) },
      UINT8_C( 43),
      { EASYSIMD_FLOAT32_C(    -4.73), EASYSIMD_FLOAT32_C(   -44.27), EASYSIMD_FLOAT32_C(    -4.16), EASYSIMD_FLOAT32_C(     5.47) },
      { EASYSIMD_FLOAT32_C(    12.69), EASYSIMD_FLOAT32_C(    46.62), EASYSIMD_FLOAT32_C(    24.70), EASYSIMD_FLOAT32_C(   -22.72) },
      { EASYSIMD_FLOAT32_C(   -40.29), EASYSIMD_FLOAT32_C(7402289152.00), EASYSIMD_FLOAT32_C(    11.92), EASYSIMD_FLOAT32_C(  -151.70) } },
    { { EASYSIMD_FLOAT32_C(    -8.98), EASYSIMD_FLOAT32_C(    21.11), EASYSIMD_FLOAT32_C(   -35.13), EASYSIMD_FLOAT32_C(    -2.61) },
      UINT8_C( 44),
      { EASYSIMD_FLOAT32_C(   -47.49), EASYSIMD_FLOAT32_C(   -43.31), EASYSIMD_FLOAT32_C(    48.10), EASYSIMD_FLOAT32_C(    48.31) },
      { EASYSIMD_FLOAT32_C(   -33.22), EASYSIMD_FLOAT32_C(   -45.96), EASYSIMD_FLOAT32_C(    12.04), EASYSIMD_FLOAT32_C(    -9.66) },
      { EASYSIMD_FLOAT32_C(    -8.98), EASYSIMD_FLOAT32_C(    21.11), EASYSIMD_FLOAT32_C(-6329059.00), EASYSIMD_FLOAT32_C(  -467.02) } },
    { { EASYSIMD_FLOAT32_C(    14.51), EASYSIMD_FLOAT32_C(   -11.26), EASYSIMD_FLOAT32_C(    13.15), EASYSIMD_FLOAT32_C(    34.22) },
      UINT8_C( 70),
      { EASYSIMD_FLOAT32_C(   -33.59), EASYSIMD_FLOAT32_C(     2.45), EASYSIMD_FLOAT32_C(   -22.28), EASYSIMD_FLOAT32_C(    29.10) },
      { EASYSIMD_FLOAT32_C(    -0.93), EASYSIMD_FLOAT32_C(   -47.58), EASYSIMD_FLOAT32_C(   -43.63), EASYSIMD_FLOAT32_C(     1.58) },
      { EASYSIMD_FLOAT32_C(    14.51), EASYSIMD_FLOAT32_C(-13617759373261537280.00), EASYSIMD_FLOAT32_C(   981.03), EASYSIMD_FLOAT32_C(    34.22) } },
    { { EASYSIMD_FLOAT32_C(   -14.91), EASYSIMD_FLOAT32_C(    19.73), EASYSIMD_FLOAT32_C(   -18.66), EASYSIMD_FLOAT32_C(    48.05) },
      UINT8_C(227),
      { EASYSIMD_FLOAT32_C(   -40.90), EASYSIMD_FLOAT32_C(   -45.52), EASYSIMD_FLOAT32_C(    -0.11), EASYSIMD_FLOAT32_C(   -24.11) },
      { EASYSIMD_FLOAT32_C(   -41.49), EASYSIMD_FLOAT32_C(   -38.07), EASYSIMD_FLOAT32_C(    16.22), EASYSIMD_FLOAT32_C(    -7.83) },
      { EASYSIMD_FLOAT32_C(7872185856.00), EASYSIMD_FLOAT32_C(  1748.73), EASYSIMD_FLOAT32_C(   -18.66), EASYSIMD_FLOAT32_C(    48.05) } },
    { { EASYSIMD_FLOAT32_C(    26.85), EASYSIMD_FLOAT32_C(    17.63), EASYSIMD_FLOAT32_C(    16.96), EASYSIMD_FLOAT32_C(   -11.23) },
      UINT8_C( 73),
      { EASYSIMD_FLOAT32_C(    20.34), EASYSIMD_FLOAT32_C(   -46.62), EASYSIMD_FLOAT32_C(    11.95), EASYSIMD_FLOAT32_C(    33.90) },
      { EASYSIMD_FLOAT32_C(    -6.32), EASYSIMD_FLOAT32_C(   -30.29), EASYSIMD_FLOAT32_C(     7.76), EASYSIMD_FLOAT32_C(    21.94) },
      { EASYSIMD_FLOAT32_C(  -100.98), EASYSIMD_FLOAT32_C(    17.63), EASYSIMD_FLOAT32_C(    16.96), EASYSIMD_FLOAT32_C(   727.05) } },
    { { EASYSIMD_FLOAT32_C(   -36.14), EASYSIMD_FLOAT32_C(    33.15), EASYSIMD_FLOAT32_C(   -46.67), EASYSIMD_FLOAT32_C(    30.56) },
      UINT8_C( 43),
      { EASYSIMD_FLOAT32_C(    16.14), EASYSIMD_FLOAT32_C(     2.20), EASYSIMD_FLOAT32_C(    42.34), EASYSIMD_FLOAT32_C(    45.79) },
      { EASYSIMD_FLOAT32_C(    17.91), EASYSIMD_FLOAT32_C(    39.28), EASYSIMD_FLOAT32_C(   -38.32), EASYSIMD_FLOAT32_C(    -5.20) },
      { EASYSIMD_FLOAT32_C(   252.09), EASYSIMD_FLOAT32_C(   119.01), EASYSIMD_FLOAT32_C(   -46.67), EASYSIMD_FLOAT32_C(7416053760.00) } },
    { { EASYSIMD_FLOAT32_C(    42.26), EASYSIMD_FLOAT32_C(    -4.90), EASYSIMD_FLOAT32_C(   -10.91), EASYSIMD_FLOAT32_C(   -34.04) },
      UINT8_C(193),
      { EASYSIMD_FLOAT32_C(     0.12), EASYSIMD_FLOAT32_C(    29.82), EASYSIMD_FLOAT32_C(   -42.37), EASYSIMD_FLOAT32_C(    31.08) },
      { EASYSIMD_FLOAT32_C(   -47.45), EASYSIMD_FLOAT32_C(   -18.97), EASYSIMD_FLOAT32_C(   -46.05), EASYSIMD_FLOAT32_C(     7.17) },
      { EASYSIMD_FLOAT32_C(7684751360.00), EASYSIMD_FLOAT32_C(    -4.90), EASYSIMD_FLOAT32_C(   -10.91), EASYSIMD_FLOAT32_C(   -34.04) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 tmp;

    easysimd__m128 src = easysimd_mm_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m128 r = easysimd_mm_mask_dpbf16_ps(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128 src = easysimd_test_x86_random_f32x4(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128bh a = HEDLEY_REINTERPRET_CAST(easysimd__m128bh, easysimd_test_x86_random_extract_f32x4(i, 2, 0, values));
    easysimd__m128bh b = HEDLEY_REINTERPRET_CAST(easysimd__m128bh, easysimd_test_x86_random_extract_f32x4(i, 2, 1, values));
    easysimd__m128 r = easysimd_mm_mask_dpbf16_ps(src, k, a, b);

    easysimd_test_x86_write_f32x4(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, HEDLEY_REINTERPRET_CAST(easysimd__m128, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, HEDLEY_REINTERPRET_CAST(easysimd__m128, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float32 src[4];
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { UINT8_C(199),
      { EASYSIMD_FLOAT32_C(   -22.83), EASYSIMD_FLOAT32_C(    28.42), EASYSIMD_FLOAT32_C(    20.82), EASYSIMD_FLOAT32_C(   -21.24) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    29.78),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    44.29) },
      { EASYSIMD_FLOAT32_C(   -22.83),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    29.04) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(235),
      { EASYSIMD_FLOAT32_C(   -21.64), EASYSIMD_FLOAT32_C(    48.49), EASYSIMD_FLOAT32_C(    -5.03), EASYSIMD_FLOAT32_C(   -23.56) },
      { EASYSIMD_FLOAT32_C(     6.04), EASYSIMD_FLOAT32_C(    18.13), EASYSIMD_FLOAT32_C(   -10.58), EASYSIMD_FLOAT32_C(    -9.46) },
      { EASYSIMD_FLOAT32_C(    34.22), EASYSIMD_FLOAT32_C(    -8.03), EASYSIMD_FLOAT32_C(    45.38), EASYSIMD_FLOAT32_C(   -46.31) },
      { EASYSIMD_FLOAT32_C(-20542294200482956679577600.00), EASYSIMD_FLOAT32_C(  5219.12), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(11195502271922176.00) } },
    { UINT8_C(228),
      { EASYSIMD_FLOAT32_C(    39.92), EASYSIMD_FLOAT32_C(   -30.09), EASYSIMD_FLOAT32_C(   -39.94), EASYSIMD_FLOAT32_C(    -8.65) },
      { EASYSIMD_FLOAT32_C(   -43.52), EASYSIMD_FLOAT32_C(   -15.88), EASYSIMD_FLOAT32_C(    16.84), EASYSIMD_FLOAT32_C(    40.69) },
      { EASYSIMD_FLOAT32_C(   -19.38), EASYSIMD_FLOAT32_C(   -48.07), EASYSIMD_FLOAT32_C(    10.42), EASYSIMD_FLOAT32_C(    11.96) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   133.84), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(254),
      { EASYSIMD_FLOAT32_C(   -15.47), EASYSIMD_FLOAT32_C(    33.47), EASYSIMD_FLOAT32_C(   -44.29), EASYSIMD_FLOAT32_C(    10.93) },
      { EASYSIMD_FLOAT32_C(    49.98), EASYSIMD_FLOAT32_C(    -7.35), EASYSIMD_FLOAT32_C(   -11.19), EASYSIMD_FLOAT32_C(    17.61) },
      { EASYSIMD_FLOAT32_C(   -40.39), EASYSIMD_FLOAT32_C(    27.57), EASYSIMD_FLOAT32_C(     7.27), EASYSIMD_FLOAT32_C(    39.03) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -168.48), EASYSIMD_FLOAT32_C(  -125.40), EASYSIMD_FLOAT32_C(   688.94) } },
    { UINT8_C( 48),
      { EASYSIMD_FLOAT32_C(    36.02), EASYSIMD_FLOAT32_C(   -28.60), EASYSIMD_FLOAT32_C(   -17.43), EASYSIMD_FLOAT32_C(   -20.14) },
      { EASYSIMD_FLOAT32_C(    19.73), EASYSIMD_FLOAT32_C(   -47.02), EASYSIMD_FLOAT32_C(    48.09), EASYSIMD_FLOAT32_C(     3.94) },
      { EASYSIMD_FLOAT32_C(    -5.05), EASYSIMD_FLOAT32_C(    43.47), EASYSIMD_FLOAT32_C(     7.63), EASYSIMD_FLOAT32_C(     1.43) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(  9),
      { EASYSIMD_FLOAT32_C(   -48.11), EASYSIMD_FLOAT32_C(     7.03), EASYSIMD_FLOAT32_C(    43.72), EASYSIMD_FLOAT32_C(    22.70) },
      { EASYSIMD_FLOAT32_C(   -22.41), EASYSIMD_FLOAT32_C(   -25.53), EASYSIMD_FLOAT32_C(    -7.88), EASYSIMD_FLOAT32_C(     8.21) },
      { EASYSIMD_FLOAT32_C(   -23.60), EASYSIMD_FLOAT32_C(   -47.46), EASYSIMD_FLOAT32_C(   -29.83), EASYSIMD_FLOAT32_C(   -23.62) },
      { EASYSIMD_FLOAT32_C(-9575092715520.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF } },
    { UINT8_C(102),
      { EASYSIMD_FLOAT32_C(   -14.30), EASYSIMD_FLOAT32_C(   -48.94), EASYSIMD_FLOAT32_C(    34.28), EASYSIMD_FLOAT32_C(    30.67) },
      { EASYSIMD_FLOAT32_C(    -4.80), EASYSIMD_FLOAT32_C(     8.97), EASYSIMD_FLOAT32_C(    43.99), EASYSIMD_FLOAT32_C(     4.81) },
      { EASYSIMD_FLOAT32_C(   -13.46), EASYSIMD_FLOAT32_C(     1.27), EASYSIMD_FLOAT32_C(    -6.16), EASYSIMD_FLOAT32_C(    43.90) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -37.63), EASYSIMD_FLOAT32_C(-9631464161280.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C( 73),
      { EASYSIMD_FLOAT32_C(   -30.20), EASYSIMD_FLOAT32_C(   -38.70), EASYSIMD_FLOAT32_C(    -2.33), EASYSIMD_FLOAT32_C(   -12.17) },
      { EASYSIMD_FLOAT32_C(    -8.28), EASYSIMD_FLOAT32_C(   -37.76), EASYSIMD_FLOAT32_C(     7.19), EASYSIMD_FLOAT32_C(     5.90) },
      { EASYSIMD_FLOAT32_C(    37.14), EASYSIMD_FLOAT32_C(   -26.21), EASYSIMD_FLOAT32_C(   -32.69), EASYSIMD_FLOAT32_C(   -28.12) },
      { EASYSIMD_FLOAT32_C(-6336335.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 tmp;

    easysimd__m128 src = easysimd_mm_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m128 r = easysimd_mm_maskz_dpbf16_ps(test_vec[i].k, src, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128 src = easysimd_test_x86_random_f32x4(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__m128bh a = HEDLEY_REINTERPRET_CAST(easysimd__m128bh, easysimd_test_x86_random_extract_f32x4(i, 2, 0, values));
    easysimd__m128bh b = HEDLEY_REINTERPRET_CAST(easysimd__m128bh, easysimd_test_x86_random_extract_f32x4(i, 2, 1, values));
    easysimd__m128 r = easysimd_mm_maskz_dpbf16_ps(k, src, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x4(2, src, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, HEDLEY_REINTERPRET_CAST(easysimd__m128, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, HEDLEY_REINTERPRET_CAST(easysimd__m128, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[8];
    const easysimd_float32 a[8];
    const easysimd_float32 b[8];
    const easysimd_float32 r[8];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(   -43.55), EASYSIMD_FLOAT32_C(   -40.45), EASYSIMD_FLOAT32_C(    32.76), EASYSIMD_FLOAT32_C(   -28.04),
        EASYSIMD_FLOAT32_C(   -49.60), EASYSIMD_FLOAT32_C(    -3.34), EASYSIMD_FLOAT32_C(   -24.54), EASYSIMD_FLOAT32_C(    -4.35) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    21.20),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -15.30),
        EASYSIMD_FLOAT32_C(   -19.91), EASYSIMD_FLOAT32_C(   -23.31), EASYSIMD_FLOAT32_C(     4.99), EASYSIMD_FLOAT32_C(   -16.82) },
      { EASYSIMD_FLOAT32_C(   -40.48),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -43.54),
        EASYSIMD_FLOAT32_C(    42.85), EASYSIMD_FLOAT32_C(   -44.25), EASYSIMD_FLOAT32_C(   -25.14), EASYSIMD_FLOAT32_C(    17.55) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   635.34),
        EASYSIMD_FLOAT32_C(24190605650488729785870581760.00), EASYSIMD_FLOAT32_C(  1025.47), EASYSIMD_FLOAT32_C(  -149.38), EASYSIMD_FLOAT32_C(  -297.48) } },
    { { EASYSIMD_FLOAT32_C(    44.44), EASYSIMD_FLOAT32_C(    41.32), EASYSIMD_FLOAT32_C(    38.89), EASYSIMD_FLOAT32_C(   -14.30),
        EASYSIMD_FLOAT32_C(     3.18), EASYSIMD_FLOAT32_C(    24.09), EASYSIMD_FLOAT32_C(    48.74), EASYSIMD_FLOAT32_C(     0.39) },
      { EASYSIMD_FLOAT32_C(     9.27), EASYSIMD_FLOAT32_C(   -49.63), EASYSIMD_FLOAT32_C(   -31.31), EASYSIMD_FLOAT32_C(   -44.30),
        EASYSIMD_FLOAT32_C(    32.50), EASYSIMD_FLOAT32_C(   -18.32), EASYSIMD_FLOAT32_C(    39.56), EASYSIMD_FLOAT32_C(   -42.25) },
      { EASYSIMD_FLOAT32_C(     8.28), EASYSIMD_FLOAT32_C(    23.80), EASYSIMD_FLOAT32_C(    48.27), EASYSIMD_FLOAT32_C(    -1.67),
        EASYSIMD_FLOAT32_C(   -22.88), EASYSIMD_FLOAT32_C(    19.98), EASYSIMD_FLOAT32_C(    27.98), EASYSIMD_FLOAT32_C(    29.46) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C( -1134.31), EASYSIMD_FLOAT32_C(7402289664.00), EASYSIMD_FLOAT32_C(    59.33),
        EASYSIMD_FLOAT32_C(  -740.26), EASYSIMD_FLOAT32_C(  -338.63), EASYSIMD_FLOAT32_C(-8927626395648.00), EASYSIMD_FLOAT32_C( -1240.70) } },
    { { EASYSIMD_FLOAT32_C(   -22.28), EASYSIMD_FLOAT32_C(    -6.46), EASYSIMD_FLOAT32_C(   -38.16), EASYSIMD_FLOAT32_C(    34.00),
        EASYSIMD_FLOAT32_C(    38.34), EASYSIMD_FLOAT32_C(    -9.77), EASYSIMD_FLOAT32_C(    25.42), EASYSIMD_FLOAT32_C(    49.76) },
      { EASYSIMD_FLOAT32_C(    -8.82), EASYSIMD_FLOAT32_C(    26.07), EASYSIMD_FLOAT32_C(   -35.84), EASYSIMD_FLOAT32_C(    21.26),
        EASYSIMD_FLOAT32_C(   -47.24), EASYSIMD_FLOAT32_C(    19.15), EASYSIMD_FLOAT32_C(   -45.56), EASYSIMD_FLOAT32_C(   -37.72) },
      { EASYSIMD_FLOAT32_C(    -0.79), EASYSIMD_FLOAT32_C(    18.63), EASYSIMD_FLOAT32_C(   -31.27), EASYSIMD_FLOAT32_C(    -7.94),
        EASYSIMD_FLOAT32_C(    24.38), EASYSIMD_FLOAT32_C(    -6.40), EASYSIMD_FLOAT32_C(   -40.39), EASYSIMD_FLOAT32_C(   -16.36) },
      { EASYSIMD_FLOAT32_C(   -15.33), EASYSIMD_FLOAT32_C(   477.79), EASYSIMD_FLOAT32_C(  6275.78), EASYSIMD_FLOAT32_C(  -134.67),
        EASYSIMD_FLOAT32_C( -1111.78), EASYSIMD_FLOAT32_C(  -136.17), EASYSIMD_FLOAT32_C(  1856.80),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(    15.37), EASYSIMD_FLOAT32_C(   -45.56), EASYSIMD_FLOAT32_C(   -27.67), EASYSIMD_FLOAT32_C(    46.56),
        EASYSIMD_FLOAT32_C(   -35.28), EASYSIMD_FLOAT32_C(    26.70), EASYSIMD_FLOAT32_C(     7.23), EASYSIMD_FLOAT32_C(   -28.83) },
      { EASYSIMD_FLOAT32_C(    -6.04), EASYSIMD_FLOAT32_C(   -21.70), EASYSIMD_FLOAT32_C(   -10.66), EASYSIMD_FLOAT32_C(   -23.53),
        EASYSIMD_FLOAT32_C(     9.98), EASYSIMD_FLOAT32_C(   -21.10), EASYSIMD_FLOAT32_C(   -15.78), EASYSIMD_FLOAT32_C(   -31.74) },
      { EASYSIMD_FLOAT32_C(   -47.30), EASYSIMD_FLOAT32_C(   -17.51), EASYSIMD_FLOAT32_C(    16.59), EASYSIMD_FLOAT32_C(   -20.18),
        EASYSIMD_FLOAT32_C(   -47.53), EASYSIMD_FLOAT32_C(    -5.44), EASYSIMD_FLOAT32_C(   -40.72), EASYSIMD_FLOAT32_C(    -6.35) },
      { EASYSIMD_FLOAT32_C(   300.35), EASYSIMD_FLOAT32_C(   332.88), EASYSIMD_FLOAT32_C(  -202.98), EASYSIMD_FLOAT32_C(23890792047224301750543450112.00),
        EASYSIMD_FLOAT32_C(  -507.31), EASYSIMD_FLOAT32_C(   140.89),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-13402149541101174784.00) } },
    { { EASYSIMD_FLOAT32_C(    36.26), EASYSIMD_FLOAT32_C(   -10.01), EASYSIMD_FLOAT32_C(    -6.87), EASYSIMD_FLOAT32_C(    36.66),
        EASYSIMD_FLOAT32_C(    36.66), EASYSIMD_FLOAT32_C(    18.59), EASYSIMD_FLOAT32_C(   -17.70), EASYSIMD_FLOAT32_C(    31.10) },
      { EASYSIMD_FLOAT32_C(   -29.37), EASYSIMD_FLOAT32_C(   -26.55), EASYSIMD_FLOAT32_C(   -35.09), EASYSIMD_FLOAT32_C(   -26.61),
        EASYSIMD_FLOAT32_C(    42.60), EASYSIMD_FLOAT32_C(   -30.65), EASYSIMD_FLOAT32_C(   -14.33), EASYSIMD_FLOAT32_C(    -8.19) },
      { EASYSIMD_FLOAT32_C(    37.98), EASYSIMD_FLOAT32_C(     4.40), EASYSIMD_FLOAT32_C(    33.88), EASYSIMD_FLOAT32_C(    12.36),
        EASYSIMD_FLOAT32_C(    48.00), EASYSIMD_FLOAT32_C(    43.48), EASYSIMD_FLOAT32_C(    46.00), EASYSIMD_FLOAT32_C(    -8.04) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-29184436426152839980746853580800.00), EASYSIMD_FLOAT32_C( -1188.12), EASYSIMD_FLOAT32_C(16486777515877911756800.00),
        EASYSIMD_FLOAT32_C(  2076.66), EASYSIMD_FLOAT32_C(-13402149541101174784.00), EASYSIMD_FLOAT32_C(  -676.08), EASYSIMD_FLOAT32_C(    96.60) } },
    { { EASYSIMD_FLOAT32_C(     9.08), EASYSIMD_FLOAT32_C(    25.33), EASYSIMD_FLOAT32_C(   -42.99), EASYSIMD_FLOAT32_C(    -2.58),
        EASYSIMD_FLOAT32_C(   -34.44), EASYSIMD_FLOAT32_C(    32.43), EASYSIMD_FLOAT32_C(    -2.82), EASYSIMD_FLOAT32_C(    30.93) },
      { EASYSIMD_FLOAT32_C(   -20.51), EASYSIMD_FLOAT32_C(    46.17), EASYSIMD_FLOAT32_C(     5.18), EASYSIMD_FLOAT32_C(   -27.91),
        EASYSIMD_FLOAT32_C(   -34.48), EASYSIMD_FLOAT32_C(    40.85), EASYSIMD_FLOAT32_C(    13.90), EASYSIMD_FLOAT32_C(   -46.50) },
      { EASYSIMD_FLOAT32_C(    -4.75), EASYSIMD_FLOAT32_C(    -2.22), EASYSIMD_FLOAT32_C(    15.86), EASYSIMD_FLOAT32_C(    -6.76),
        EASYSIMD_FLOAT32_C(    -8.74), EASYSIMD_FLOAT32_C(    11.86), EASYSIMD_FLOAT32_C(    35.20), EASYSIMD_FLOAT32_C(    13.04) },
      { EASYSIMD_FLOAT32_C(   106.46), EASYSIMD_FLOAT32_C(   -76.73), EASYSIMD_FLOAT32_C(  5150.79), EASYSIMD_FLOAT32_C(11287586370748416.00),
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-19414829202697828884807680.00), EASYSIMD_FLOAT32_C(-29184436426152839980746853580800.00), EASYSIMD_FLOAT32_C(  -573.57) } },
    { { EASYSIMD_FLOAT32_C(   -22.82), EASYSIMD_FLOAT32_C(   -13.42), EASYSIMD_FLOAT32_C(   -38.50), EASYSIMD_FLOAT32_C(    -3.20),
        EASYSIMD_FLOAT32_C(    -8.82), EASYSIMD_FLOAT32_C(    17.53), EASYSIMD_FLOAT32_C(    49.52), EASYSIMD_FLOAT32_C(     1.94) },
      { EASYSIMD_FLOAT32_C(   -41.60), EASYSIMD_FLOAT32_C(     7.42), EASYSIMD_FLOAT32_C(    27.15), EASYSIMD_FLOAT32_C(    16.02),
        EASYSIMD_FLOAT32_C(    22.15), EASYSIMD_FLOAT32_C(    38.29), EASYSIMD_FLOAT32_C(   -13.83), EASYSIMD_FLOAT32_C(    45.19) },
      { EASYSIMD_FLOAT32_C(    47.35), EASYSIMD_FLOAT32_C(   -42.76), EASYSIMD_FLOAT32_C(    48.65), EASYSIMD_FLOAT32_C(    -6.98),
        EASYSIMD_FLOAT32_C(   -44.00), EASYSIMD_FLOAT32_C(    41.52), EASYSIMD_FLOAT32_C(   -16.70), EASYSIMD_FLOAT32_C(   -45.18) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -330.03), EASYSIMD_FLOAT32_C(  1277.06), EASYSIMD_FLOAT32_C(  5082.05),
        EASYSIMD_FLOAT32_C(  -982.32), EASYSIMD_FLOAT32_C(  1604.91), EASYSIMD_FLOAT32_C(   279.15), EASYSIMD_FLOAT32_C( -2023.06) } },
    { { EASYSIMD_FLOAT32_C(    45.15), EASYSIMD_FLOAT32_C(     7.49), EASYSIMD_FLOAT32_C(     7.14), EASYSIMD_FLOAT32_C(   -19.46),
        EASYSIMD_FLOAT32_C(   -34.09), EASYSIMD_FLOAT32_C(     4.14), EASYSIMD_FLOAT32_C(    30.94), EASYSIMD_FLOAT32_C(    23.42) },
      { EASYSIMD_FLOAT32_C(     5.07), EASYSIMD_FLOAT32_C(    37.87), EASYSIMD_FLOAT32_C(   -32.67), EASYSIMD_FLOAT32_C(   -13.70),
        EASYSIMD_FLOAT32_C(   -39.25), EASYSIMD_FLOAT32_C(    41.58), EASYSIMD_FLOAT32_C(     0.04), EASYSIMD_FLOAT32_C(    43.83) },
      { EASYSIMD_FLOAT32_C(     1.07), EASYSIMD_FLOAT32_C(   -28.76), EASYSIMD_FLOAT32_C(    33.36), EASYSIMD_FLOAT32_C(    39.77),
        EASYSIMD_FLOAT32_C(    47.18), EASYSIMD_FLOAT32_C(    25.69), EASYSIMD_FLOAT32_C(   -20.99), EASYSIMD_FLOAT32_C(   -44.42) },
      { EASYSIMD_FLOAT32_C(-29088496073108223009442171453440.00), EASYSIMD_FLOAT32_C(7402290176.00), EASYSIMD_FLOAT32_C(-13663921269442084864.00), EASYSIMD_FLOAT32_C(  -563.54),
        EASYSIMD_FLOAT32_C( -1878.84), EASYSIMD_FLOAT32_C(  1067.58),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C( -1916.78) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256 tmp;

    easysimd__m256 src = easysimd_mm256_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm256_loadu_ps(test_vec[i].a);
    easysimd__m256bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm256_loadu_ps(test_vec[i].b);
    easysimd__m256bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m256 r = easysimd_mm256_dpbf16_ps(src, a, b);
    easysimd_test_x86_assert_equal_f32x8(r, easysimd_mm256_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m256)];
  easysimd_test_x86_random_f32x8_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m256 src = easysimd_test_x86_random_f32x8(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__m256bh a = HEDLEY_REINTERPRET_CAST(easysimd__m256bh, easysimd_test_x86_random_extract_f32x8(i, 2, 0, values));
    easysimd__m256bh b = HEDLEY_REINTERPRET_CAST(easysimd__m256bh, easysimd_test_x86_random_extract_f32x8(i, 2, 1, values));
    easysimd__m256 r = easysimd_mm256_dpbf16_ps(src, a, b);

    easysimd_test_x86_write_f32x8(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x8(2, HEDLEY_REINTERPRET_CAST(easysimd__m256, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, HEDLEY_REINTERPRET_CAST(easysimd__m256, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_mask_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[8];
    const easysimd__mmask8 k;
    const easysimd_float32 a[8];
    const easysimd_float32 b[8];
    const easysimd_float32 r[8];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(    18.56), EASYSIMD_FLOAT32_C(    -7.58), EASYSIMD_FLOAT32_C(   -43.70), EASYSIMD_FLOAT32_C(   -16.96),
        EASYSIMD_FLOAT32_C(   -40.14), EASYSIMD_FLOAT32_C(     4.59), EASYSIMD_FLOAT32_C(     1.18), EASYSIMD_FLOAT32_C(     0.97) },
      UINT8_C(211),
      { EASYSIMD_FLOAT32_C(   -47.64), EASYSIMD_FLOAT32_C(    17.81), EASYSIMD_FLOAT32_C(    46.74), EASYSIMD_FLOAT32_C(    24.20),
        EASYSIMD_FLOAT32_C(     9.47), EASYSIMD_FLOAT32_C(   -29.52), EASYSIMD_FLOAT32_C(   -32.75), EASYSIMD_FLOAT32_C(   -45.08) },
      { EASYSIMD_FLOAT32_C(   -42.94), EASYSIMD_FLOAT32_C(    34.02), EASYSIMD_FLOAT32_C(   -28.54), EASYSIMD_FLOAT32_C(     7.11),
        EASYSIMD_FLOAT32_C(    31.91), EASYSIMD_FLOAT32_C(   -43.84), EASYSIMD_FLOAT32_C(   -31.77), EASYSIMD_FLOAT32_C(    27.44) },
      { EASYSIMD_FLOAT32_C(  2049.19), EASYSIMD_FLOAT32_C(7402291712.00), EASYSIMD_FLOAT32_C(   -43.70), EASYSIMD_FLOAT32_C(   -16.96),
        EASYSIMD_FLOAT32_C(   260.68), EASYSIMD_FLOAT32_C(     4.59), EASYSIMD_FLOAT32_C(  1040.99), EASYSIMD_FLOAT32_C( -1230.91) } },
    { { EASYSIMD_FLOAT32_C(    44.89), EASYSIMD_FLOAT32_C(   -35.37), EASYSIMD_FLOAT32_C(   -40.40), EASYSIMD_FLOAT32_C(   -29.91),
        EASYSIMD_FLOAT32_C(    21.16), EASYSIMD_FLOAT32_C(   -40.49), EASYSIMD_FLOAT32_C(    14.61), EASYSIMD_FLOAT32_C(    47.05) },
      UINT8_C(101),
      { EASYSIMD_FLOAT32_C(    36.93), EASYSIMD_FLOAT32_C(    13.07), EASYSIMD_FLOAT32_C(   -44.42), EASYSIMD_FLOAT32_C(    44.87),
        EASYSIMD_FLOAT32_C(   -20.91), EASYSIMD_FLOAT32_C(   -49.83), EASYSIMD_FLOAT32_C(     7.11), EASYSIMD_FLOAT32_C(     2.98) },
      { EASYSIMD_FLOAT32_C(    18.08), EASYSIMD_FLOAT32_C(   -24.95), EASYSIMD_FLOAT32_C(    -9.92), EASYSIMD_FLOAT32_C(    12.44),
        EASYSIMD_FLOAT32_C(    28.10), EASYSIMD_FLOAT32_C(   -33.34), EASYSIMD_FLOAT32_C(    -6.24), EASYSIMD_FLOAT32_C(    30.46) },
      { EASYSIMD_FLOAT32_C(   706.39), EASYSIMD_FLOAT32_C(   -35.37), EASYSIMD_FLOAT32_C(   396.57), EASYSIMD_FLOAT32_C(   -29.91),
        EASYSIMD_FLOAT32_C(    21.16), EASYSIMD_FLOAT32_C(24108398694754935001990561792.00), EASYSIMD_FLOAT32_C(   -29.50), EASYSIMD_FLOAT32_C(    47.05) } },
    { { EASYSIMD_FLOAT32_C(    -6.28), EASYSIMD_FLOAT32_C(     5.72), EASYSIMD_FLOAT32_C(   -34.13), EASYSIMD_FLOAT32_C(    28.30),
        EASYSIMD_FLOAT32_C(   -44.56), EASYSIMD_FLOAT32_C(    14.29), EASYSIMD_FLOAT32_C(    39.35), EASYSIMD_FLOAT32_C(    11.62) },
      UINT8_C(117),
      { EASYSIMD_FLOAT32_C(    34.48), EASYSIMD_FLOAT32_C(    -9.50), EASYSIMD_FLOAT32_C(     4.65), EASYSIMD_FLOAT32_C(    -6.05),
        EASYSIMD_FLOAT32_C(    10.98), EASYSIMD_FLOAT32_C(    21.90), EASYSIMD_FLOAT32_C(    -1.13), EASYSIMD_FLOAT32_C(    18.04) },
      { EASYSIMD_FLOAT32_C(     5.92), EASYSIMD_FLOAT32_C(    20.32), EASYSIMD_FLOAT32_C(   -24.85), EASYSIMD_FLOAT32_C(   -12.17),
        EASYSIMD_FLOAT32_C(    26.48), EASYSIMD_FLOAT32_C(    -6.62), EASYSIMD_FLOAT32_C(   -34.72), EASYSIMD_FLOAT32_C(    13.42) },
      {     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     5.72), EASYSIMD_FLOAT32_C(11551744039321600.00), EASYSIMD_FLOAT32_C(    28.30),
        EASYSIMD_FLOAT32_C(  5349.92), EASYSIMD_FLOAT32_C(-6323841.50), EASYSIMD_FLOAT32_C(  5453.16), EASYSIMD_FLOAT32_C(    11.62) } },
    { { EASYSIMD_FLOAT32_C(    16.02), EASYSIMD_FLOAT32_C(    14.71), EASYSIMD_FLOAT32_C(    31.29), EASYSIMD_FLOAT32_C(     9.84),
        EASYSIMD_FLOAT32_C(   -16.73), EASYSIMD_FLOAT32_C(   -26.29), EASYSIMD_FLOAT32_C(    16.15), EASYSIMD_FLOAT32_C(    16.31) },
      UINT8_C(236),
      { EASYSIMD_FLOAT32_C(   -43.56), EASYSIMD_FLOAT32_C(   -29.14), EASYSIMD_FLOAT32_C(     8.29), EASYSIMD_FLOAT32_C(   -14.47),
        EASYSIMD_FLOAT32_C(   -28.97), EASYSIMD_FLOAT32_C(   -34.60), EASYSIMD_FLOAT32_C(    38.51), EASYSIMD_FLOAT32_C(    39.12) },
      { EASYSIMD_FLOAT32_C(    -9.55), EASYSIMD_FLOAT32_C(   -21.41), EASYSIMD_FLOAT32_C(     1.56), EASYSIMD_FLOAT32_C(   -31.45),
        EASYSIMD_FLOAT32_C(    -4.75), EASYSIMD_FLOAT32_C(    45.32), EASYSIMD_FLOAT32_C(    49.01), EASYSIMD_FLOAT32_C(   -20.27) },
      { EASYSIMD_FLOAT32_C(    16.02), EASYSIMD_FLOAT32_C(    14.71), EASYSIMD_FLOAT32_C(    44.12), EASYSIMD_FLOAT32_C(   462.82),
        EASYSIMD_FLOAT32_C(   -16.73), EASYSIMD_FLOAT32_C(24190605650488729785870581760.00), EASYSIMD_FLOAT32_C(  1902.65), EASYSIMD_FLOAT32_C(15953551319997245030400.00) } },
    { { EASYSIMD_FLOAT32_C(   -29.26), EASYSIMD_FLOAT32_C(   -32.51), EASYSIMD_FLOAT32_C(    34.54), EASYSIMD_FLOAT32_C(   -29.58),
        EASYSIMD_FLOAT32_C(   -37.63), EASYSIMD_FLOAT32_C(    49.17), EASYSIMD_FLOAT32_C(   -19.98), EASYSIMD_FLOAT32_C(   -17.54) },
      UINT8_C(127),
      { EASYSIMD_FLOAT32_C(   -14.19), EASYSIMD_FLOAT32_C(     3.66), EASYSIMD_FLOAT32_C(    23.68), EASYSIMD_FLOAT32_C(    46.80),
        EASYSIMD_FLOAT32_C(   -24.43), EASYSIMD_FLOAT32_C(   -27.45), EASYSIMD_FLOAT32_C(    14.84), EASYSIMD_FLOAT32_C(    31.49) },
      { EASYSIMD_FLOAT32_C(    42.87), EASYSIMD_FLOAT32_C(    39.99), EASYSIMD_FLOAT32_C(   -30.68), EASYSIMD_FLOAT32_C(    19.36),
        EASYSIMD_FLOAT32_C(   -16.64), EASYSIMD_FLOAT32_C(   -15.40), EASYSIMD_FLOAT32_C(   -17.23), EASYSIMD_FLOAT32_C(   -10.19) },
      { EASYSIMD_FLOAT32_C(  4679.85), EASYSIMD_FLOAT32_C(-29088496073108223009442171453440.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-9609989324800.00),
        EASYSIMD_FLOAT32_C(7910457856.00), EASYSIMD_FLOAT32_C(   465.74),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   -17.54) } },
    { { EASYSIMD_FLOAT32_C(    12.48), EASYSIMD_FLOAT32_C(   -41.56), EASYSIMD_FLOAT32_C(    40.16), EASYSIMD_FLOAT32_C(   -10.95),
        EASYSIMD_FLOAT32_C(    24.46), EASYSIMD_FLOAT32_C(     4.87), EASYSIMD_FLOAT32_C(   -29.66), EASYSIMD_FLOAT32_C(   -15.69) },
      UINT8_C(174),
      { EASYSIMD_FLOAT32_C(   -31.86), EASYSIMD_FLOAT32_C(    -8.89), EASYSIMD_FLOAT32_C(    -4.91), EASYSIMD_FLOAT32_C(    -6.29),
        EASYSIMD_FLOAT32_C(    13.66), EASYSIMD_FLOAT32_C(   -40.08), EASYSIMD_FLOAT32_C(   -24.80), EASYSIMD_FLOAT32_C(     6.53) },
      { EASYSIMD_FLOAT32_C(    49.91), EASYSIMD_FLOAT32_C(    -5.48), EASYSIMD_FLOAT32_C(   -24.11), EASYSIMD_FLOAT32_C(   -16.73),
        EASYSIMD_FLOAT32_C(    29.12), EASYSIMD_FLOAT32_C(     8.66), EASYSIMD_FLOAT32_C(    23.08), EASYSIMD_FLOAT32_C(   -15.43) },
      { EASYSIMD_FLOAT32_C(    12.48), EASYSIMD_FLOAT32_C(11195502271922176.00), EASYSIMD_FLOAT32_C(   153.42), EASYSIMD_FLOAT32_C(-13517554281552543744.00),
        EASYSIMD_FLOAT32_C(    24.46), EASYSIMD_FLOAT32_C(  -340.13), EASYSIMD_FLOAT32_C(   -29.66),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   -40.43), EASYSIMD_FLOAT32_C(    13.45), EASYSIMD_FLOAT32_C(   -42.45), EASYSIMD_FLOAT32_C(    -7.68),
        EASYSIMD_FLOAT32_C(    33.78), EASYSIMD_FLOAT32_C(     9.61), EASYSIMD_FLOAT32_C(   -47.80), EASYSIMD_FLOAT32_C(   -14.17) },
      UINT8_C(221),
      { EASYSIMD_FLOAT32_C(   -45.55), EASYSIMD_FLOAT32_C(    47.06), EASYSIMD_FLOAT32_C(    12.77), EASYSIMD_FLOAT32_C(   -28.83),
        EASYSIMD_FLOAT32_C(    37.41), EASYSIMD_FLOAT32_C(    -3.34), EASYSIMD_FLOAT32_C(   -32.47), EASYSIMD_FLOAT32_C(    49.71) },
      { EASYSIMD_FLOAT32_C(   -45.42), EASYSIMD_FLOAT32_C(    34.06), EASYSIMD_FLOAT32_C(   -16.73), EASYSIMD_FLOAT32_C(     2.63),
        EASYSIMD_FLOAT32_C(    -3.83), EASYSIMD_FLOAT32_C(   -12.76), EASYSIMD_FLOAT32_C(    -9.10), EASYSIMD_FLOAT32_C(   -30.91) },
      { EASYSIMD_FLOAT32_C(  2018.44), EASYSIMD_FLOAT32_C(    13.45), EASYSIMD_FLOAT32_C(-19224753951762325664956416.00), EASYSIMD_FLOAT32_C(   -83.15),
        EASYSIMD_FLOAT32_C(  -108.82), EASYSIMD_FLOAT32_C(     9.61), EASYSIMD_FLOAT32_C(   244.47), EASYSIMD_FLOAT32_C(-13517554281552543744.00) } },
    { { EASYSIMD_FLOAT32_C(    23.26), EASYSIMD_FLOAT32_C(     2.87), EASYSIMD_FLOAT32_C(   -48.26), EASYSIMD_FLOAT32_C(   -48.30),
        EASYSIMD_FLOAT32_C(    22.16), EASYSIMD_FLOAT32_C(    35.34), EASYSIMD_FLOAT32_C(   -43.42), EASYSIMD_FLOAT32_C(    32.62) },
      UINT8_C(169),
      { EASYSIMD_FLOAT32_C(    38.93), EASYSIMD_FLOAT32_C(    24.44), EASYSIMD_FLOAT32_C(    42.37), EASYSIMD_FLOAT32_C(     0.39),
        EASYSIMD_FLOAT32_C(   -32.05), EASYSIMD_FLOAT32_C(   -40.71), EASYSIMD_FLOAT32_C(   -42.65), EASYSIMD_FLOAT32_C(   -23.47) },
      { EASYSIMD_FLOAT32_C(    11.99), EASYSIMD_FLOAT32_C(   -48.15), EASYSIMD_FLOAT32_C(   -28.11), EASYSIMD_FLOAT32_C(    46.40),
        EASYSIMD_FLOAT32_C(    33.97), EASYSIMD_FLOAT32_C(    -2.45), EASYSIMD_FLOAT32_C(    -2.21), EASYSIMD_FLOAT32_C(    38.42) },
      { EASYSIMD_FLOAT32_C(7596933632.00), EASYSIMD_FLOAT32_C(     2.87), EASYSIMD_FLOAT32_C(   -48.26), EASYSIMD_FLOAT32_C(   -30.32),
        EASYSIMD_FLOAT32_C(    22.16), EASYSIMD_FLOAT32_C(16308074682663850475520.00), EASYSIMD_FLOAT32_C(   -43.42), EASYSIMD_FLOAT32_C(  -861.47) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256 tmp;

    easysimd__m256 src = easysimd_mm256_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm256_loadu_ps(test_vec[i].a);
    easysimd__m256bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm256_loadu_ps(test_vec[i].b);
    easysimd__m256bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m256 r = easysimd_mm256_mask_dpbf16_ps(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x8(r, easysimd_mm256_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m256)];
  easysimd_test_x86_random_f32x8_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m256 src = easysimd_test_x86_random_f32x8(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256bh a = HEDLEY_REINTERPRET_CAST(easysimd__m256bh, easysimd_test_x86_random_extract_f32x8(i, 2, 0, values));
    easysimd__m256bh b = HEDLEY_REINTERPRET_CAST(easysimd__m256bh, easysimd_test_x86_random_extract_f32x8(i, 2, 1, values));
    easysimd__m256 r = easysimd_mm256_mask_dpbf16_ps(src, k, a, b);

    easysimd_test_x86_write_f32x8(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, HEDLEY_REINTERPRET_CAST(easysimd__m256, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, HEDLEY_REINTERPRET_CAST(easysimd__m256, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float32 src[8];
    const easysimd_float32 a[8];
    const easysimd_float32 b[8];
    const easysimd_float32 r[8];
  } test_vec[] = {
    { UINT8_C(205),
      { EASYSIMD_FLOAT32_C(   -36.42), EASYSIMD_FLOAT32_C(   -49.03), EASYSIMD_FLOAT32_C(   -38.95), EASYSIMD_FLOAT32_C(    12.54),
        EASYSIMD_FLOAT32_C(   -41.04), EASYSIMD_FLOAT32_C(    38.86), EASYSIMD_FLOAT32_C(    -1.22), EASYSIMD_FLOAT32_C(   -10.59) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -49.55),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    27.62),
        EASYSIMD_FLOAT32_C(   -28.81), EASYSIMD_FLOAT32_C(    21.94), EASYSIMD_FLOAT32_C(    12.16), EASYSIMD_FLOAT32_C(    -8.39) },
      { EASYSIMD_FLOAT32_C(    34.31),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -33.23),
        EASYSIMD_FLOAT32_C(   -18.34), EASYSIMD_FLOAT32_C(   -38.83), EASYSIMD_FLOAT32_C(   -36.16), EASYSIMD_FLOAT32_C(    49.05) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     0.00),            EASYSIMD_MATH_NANF,      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -437.72), EASYSIMD_FLOAT32_C(  -420.96) } },
    { UINT8_C(205),
      { EASYSIMD_FLOAT32_C(    47.49), EASYSIMD_FLOAT32_C(    31.73), EASYSIMD_FLOAT32_C(    37.79), EASYSIMD_FLOAT32_C(    38.51),
        EASYSIMD_FLOAT32_C(    -2.46), EASYSIMD_FLOAT32_C(    11.57), EASYSIMD_FLOAT32_C(    25.38), EASYSIMD_FLOAT32_C(    49.11) },
      { EASYSIMD_FLOAT32_C(    43.49), EASYSIMD_FLOAT32_C(     4.63), EASYSIMD_FLOAT32_C(   -27.84), EASYSIMD_FLOAT32_C(    41.68),
        EASYSIMD_FLOAT32_C(    23.72), EASYSIMD_FLOAT32_C(     0.70), EASYSIMD_FLOAT32_C(     4.16), EASYSIMD_FLOAT32_C(    32.17) },
      { EASYSIMD_FLOAT32_C(    -9.14), EASYSIMD_FLOAT32_C(    43.22), EASYSIMD_FLOAT32_C(     6.63), EASYSIMD_FLOAT32_C(    45.73),
        EASYSIMD_FLOAT32_C(   -36.44), EASYSIMD_FLOAT32_C(    40.93), EASYSIMD_FLOAT32_C(    33.88), EASYSIMD_FLOAT32_C(     7.61) },
      { EASYSIMD_FLOAT32_C(-29088496073108223009442171453440.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -146.05), EASYSIMD_FLOAT32_C(16100548811834618019840.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   165.65), EASYSIMD_FLOAT32_C(   292.11) } },
    { UINT8_C(227),
      { EASYSIMD_FLOAT32_C(    43.82), EASYSIMD_FLOAT32_C(   -10.38), EASYSIMD_FLOAT32_C(    28.47), EASYSIMD_FLOAT32_C(   -13.83),
        EASYSIMD_FLOAT32_C(    17.93), EASYSIMD_FLOAT32_C(    24.26), EASYSIMD_FLOAT32_C(    35.71), EASYSIMD_FLOAT32_C(    16.82) },
      { EASYSIMD_FLOAT32_C(    41.39), EASYSIMD_FLOAT32_C(   -11.67), EASYSIMD_FLOAT32_C(   -14.77), EASYSIMD_FLOAT32_C(   -37.42),
        EASYSIMD_FLOAT32_C(   -39.73), EASYSIMD_FLOAT32_C(    47.39), EASYSIMD_FLOAT32_C(     4.19), EASYSIMD_FLOAT32_C(    44.58) },
      { EASYSIMD_FLOAT32_C(     8.72), EASYSIMD_FLOAT32_C(   -24.17), EASYSIMD_FLOAT32_C(   -38.65), EASYSIMD_FLOAT32_C(    40.38),
        EASYSIMD_FLOAT32_C(   -13.00), EASYSIMD_FLOAT32_C(   -24.81), EASYSIMD_FLOAT32_C(    39.44), EASYSIMD_FLOAT32_C(   -19.51) },
      { EASYSIMD_FLOAT32_C(   402.18), EASYSIMD_FLOAT32_C(-9526774333440.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-6337145.00), EASYSIMD_FLOAT32_C(   200.07), EASYSIMD_FLOAT32_C(  -850.93) } },
    { UINT8_C( 43),
      { EASYSIMD_FLOAT32_C(   -32.90), EASYSIMD_FLOAT32_C(     7.38), EASYSIMD_FLOAT32_C(   -28.27), EASYSIMD_FLOAT32_C(   -32.39),
        EASYSIMD_FLOAT32_C(    20.96), EASYSIMD_FLOAT32_C(   -27.31), EASYSIMD_FLOAT32_C(   -21.35), EASYSIMD_FLOAT32_C(   -16.50) },
      { EASYSIMD_FLOAT32_C(    29.83), EASYSIMD_FLOAT32_C(   -38.41), EASYSIMD_FLOAT32_C(   -27.83), EASYSIMD_FLOAT32_C(     3.55),
        EASYSIMD_FLOAT32_C(    12.29), EASYSIMD_FLOAT32_C(    26.34), EASYSIMD_FLOAT32_C(   -14.28), EASYSIMD_FLOAT32_C(   -46.85) },
      { EASYSIMD_FLOAT32_C(    19.55), EASYSIMD_FLOAT32_C(    42.34), EASYSIMD_FLOAT32_C(    48.89), EASYSIMD_FLOAT32_C(    33.11),
        EASYSIMD_FLOAT32_C(    33.28), EASYSIMD_FLOAT32_C(    32.76), EASYSIMD_FLOAT32_C(    -9.28), EASYSIMD_FLOAT32_C(    24.67) },
      { EASYSIMD_FLOAT32_C(-6329053.00), EASYSIMD_FLOAT32_C( -1613.12), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(16922581844619299913728.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   832.38), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(241),
      { EASYSIMD_FLOAT32_C(   -32.49), EASYSIMD_FLOAT32_C(    32.27), EASYSIMD_FLOAT32_C(    21.07), EASYSIMD_FLOAT32_C(    38.46),
        EASYSIMD_FLOAT32_C(    29.77), EASYSIMD_FLOAT32_C(     2.80), EASYSIMD_FLOAT32_C(    26.25), EASYSIMD_FLOAT32_C(    18.28) },
      { EASYSIMD_FLOAT32_C(   -28.91), EASYSIMD_FLOAT32_C(    25.95), EASYSIMD_FLOAT32_C(    37.25), EASYSIMD_FLOAT32_C(   -18.64),
        EASYSIMD_FLOAT32_C(    23.34), EASYSIMD_FLOAT32_C(    -8.56), EASYSIMD_FLOAT32_C(   -24.07), EASYSIMD_FLOAT32_C(   -17.94) },
      { EASYSIMD_FLOAT32_C(    17.27), EASYSIMD_FLOAT32_C(   -12.72), EASYSIMD_FLOAT32_C(   -27.55), EASYSIMD_FLOAT32_C(   -45.73),
        EASYSIMD_FLOAT32_C(    12.48), EASYSIMD_FLOAT32_C(   -38.12), EASYSIMD_FLOAT32_C(   -15.24), EASYSIMD_FLOAT32_C(    -7.70) },
      { EASYSIMD_FLOAT32_C(  -530.58), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(   318.94),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   390.75), EASYSIMD_FLOAT32_C(   155.69) } },
    { UINT8_C( 27),
      { EASYSIMD_FLOAT32_C(   -12.18), EASYSIMD_FLOAT32_C(    -6.34), EASYSIMD_FLOAT32_C(    49.45), EASYSIMD_FLOAT32_C(   -43.57),
        EASYSIMD_FLOAT32_C(   -12.52), EASYSIMD_FLOAT32_C(   -10.93), EASYSIMD_FLOAT32_C(    34.90), EASYSIMD_FLOAT32_C(    23.65) },
      { EASYSIMD_FLOAT32_C(   -26.52), EASYSIMD_FLOAT32_C(     6.93), EASYSIMD_FLOAT32_C(    45.85), EASYSIMD_FLOAT32_C(    35.77),
        EASYSIMD_FLOAT32_C(   -16.73), EASYSIMD_FLOAT32_C(   -18.43), EASYSIMD_FLOAT32_C(    38.93), EASYSIMD_FLOAT32_C(   -47.18) },
      { EASYSIMD_FLOAT32_C(   -26.09), EASYSIMD_FLOAT32_C(    37.81), EASYSIMD_FLOAT32_C(    35.93), EASYSIMD_FLOAT32_C(   -42.81),
        EASYSIMD_FLOAT32_C(    20.58), EASYSIMD_FLOAT32_C(   -23.35), EASYSIMD_FLOAT32_C(    31.86), EASYSIMD_FLOAT32_C(    41.67) },
      { EASYSIMD_FLOAT32_C(   676.82), EASYSIMD_FLOAT32_C(   250.16), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C( -1571.88),
        EASYSIMD_FLOAT32_C(  -353.33), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(141),
      { EASYSIMD_FLOAT32_C(     9.16), EASYSIMD_FLOAT32_C(     9.35), EASYSIMD_FLOAT32_C(    23.82), EASYSIMD_FLOAT32_C(     5.86),
        EASYSIMD_FLOAT32_C(    26.46), EASYSIMD_FLOAT32_C(   -18.80), EASYSIMD_FLOAT32_C(    27.59), EASYSIMD_FLOAT32_C(    44.06) },
      { EASYSIMD_FLOAT32_C(   -47.40), EASYSIMD_FLOAT32_C(    19.10), EASYSIMD_FLOAT32_C(   -26.98), EASYSIMD_FLOAT32_C(    25.94),
        EASYSIMD_FLOAT32_C(   -39.45), EASYSIMD_FLOAT32_C(    -1.04), EASYSIMD_FLOAT32_C(   -42.00), EASYSIMD_FLOAT32_C(    27.82) },
      { EASYSIMD_FLOAT32_C(    36.24), EASYSIMD_FLOAT32_C(   -19.56), EASYSIMD_FLOAT32_C(    32.09), EASYSIMD_FLOAT32_C(    -1.28),
        EASYSIMD_FLOAT32_C(    -7.67), EASYSIMD_FLOAT32_C(   -33.16), EASYSIMD_FLOAT32_C(    41.02), EASYSIMD_FLOAT32_C(    15.80) },
      { EASYSIMD_FLOAT32_C(7872182784.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-28871237596213638771197375152128.00), EASYSIMD_FLOAT32_C(   -27.09),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   481.12) } },
    { UINT8_C(160),
      { EASYSIMD_FLOAT32_C(   -49.72), EASYSIMD_FLOAT32_C(   -27.29), EASYSIMD_FLOAT32_C(   -14.35), EASYSIMD_FLOAT32_C(   -18.06),
        EASYSIMD_FLOAT32_C(    -9.77), EASYSIMD_FLOAT32_C(   -32.07), EASYSIMD_FLOAT32_C(   -47.00), EASYSIMD_FLOAT32_C(   -21.31) },
      { EASYSIMD_FLOAT32_C(    23.78), EASYSIMD_FLOAT32_C(    36.87), EASYSIMD_FLOAT32_C(     1.58), EASYSIMD_FLOAT32_C(   -42.96),
        EASYSIMD_FLOAT32_C(   -31.56), EASYSIMD_FLOAT32_C(    -9.50), EASYSIMD_FLOAT32_C(   -40.14), EASYSIMD_FLOAT32_C(    -7.65) },
      { EASYSIMD_FLOAT32_C(   -21.68), EASYSIMD_FLOAT32_C(    45.79), EASYSIMD_FLOAT32_C(    -0.46), EASYSIMD_FLOAT32_C(    48.89),
        EASYSIMD_FLOAT32_C(   -27.56), EASYSIMD_FLOAT32_C(   -18.60), EASYSIMD_FLOAT32_C(    40.56), EASYSIMD_FLOAT32_C(   -24.97) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   143.68), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(7684751360.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256 tmp;

    easysimd__m256 src = easysimd_mm256_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm256_loadu_ps(test_vec[i].a);
    easysimd__m256bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm256_loadu_ps(test_vec[i].b);
    easysimd__m256bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m256 r = easysimd_mm256_maskz_dpbf16_ps(test_vec[i].k, src, a, b);
    easysimd_test_x86_assert_equal_f32x8(r, easysimd_mm256_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m256)];
  easysimd_test_x86_random_f32x8_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256 src = easysimd_test_x86_random_f32x8(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__m256bh a = HEDLEY_REINTERPRET_CAST(easysimd__m256bh, easysimd_test_x86_random_extract_f32x8(i, 2, 0, values));
    easysimd__m256bh b = HEDLEY_REINTERPRET_CAST(easysimd__m256bh, easysimd_test_x86_random_extract_f32x8(i, 2, 1, values));
    easysimd__m256 r = easysimd_mm256_maskz_dpbf16_ps(k, src, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x8(2, src, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, HEDLEY_REINTERPRET_CAST(easysimd__m256, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, HEDLEY_REINTERPRET_CAST(easysimd__m256, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[16];
    const easysimd_float32 a[16];
    const easysimd_float32 b[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(    41.97), EASYSIMD_FLOAT32_C(   -38.86), EASYSIMD_FLOAT32_C(   -41.42), EASYSIMD_FLOAT32_C(   -36.59),
        EASYSIMD_FLOAT32_C(    47.47), EASYSIMD_FLOAT32_C(    -3.68), EASYSIMD_FLOAT32_C(    -9.99), EASYSIMD_FLOAT32_C(   -18.40),
        EASYSIMD_FLOAT32_C(   -21.35), EASYSIMD_FLOAT32_C(    30.30), EASYSIMD_FLOAT32_C(   -49.63), EASYSIMD_FLOAT32_C(   -44.49),
        EASYSIMD_FLOAT32_C(   -34.55), EASYSIMD_FLOAT32_C(    -9.63), EASYSIMD_FLOAT32_C(   -35.72), EASYSIMD_FLOAT32_C(    22.88) },
      { EASYSIMD_FLOAT32_C(     8.67), EASYSIMD_FLOAT32_C(   -39.77), EASYSIMD_FLOAT32_C(   -35.49), EASYSIMD_FLOAT32_C(    29.91),
        EASYSIMD_FLOAT32_C(    12.76), EASYSIMD_FLOAT32_C(   -46.50), EASYSIMD_FLOAT32_C(    17.78), EASYSIMD_FLOAT32_C(    -8.78),
        EASYSIMD_FLOAT32_C(    44.43), EASYSIMD_FLOAT32_C(     0.75), EASYSIMD_FLOAT32_C(    43.12), EASYSIMD_FLOAT32_C(   -47.50),
        EASYSIMD_FLOAT32_C(   -40.81), EASYSIMD_FLOAT32_C(   -14.02), EASYSIMD_FLOAT32_C(    25.88), EASYSIMD_FLOAT32_C(   -39.29) },
      { EASYSIMD_FLOAT32_C(   -14.95), EASYSIMD_FLOAT32_C(    15.90), EASYSIMD_FLOAT32_C(     7.59), EASYSIMD_FLOAT32_C(    49.63),
        EASYSIMD_FLOAT32_C(    44.94), EASYSIMD_FLOAT32_C(   -38.85), EASYSIMD_FLOAT32_C(    15.18), EASYSIMD_FLOAT32_C(   -31.16),
        EASYSIMD_FLOAT32_C(    20.37), EASYSIMD_FLOAT32_C(   -36.88), EASYSIMD_FLOAT32_C(   -42.11), EASYSIMD_FLOAT32_C(    -2.01),
        EASYSIMD_FLOAT32_C(    13.69), EASYSIMD_FLOAT32_C(   -29.98), EASYSIMD_FLOAT32_C(    16.64), EASYSIMD_FLOAT32_C(   -27.64) },
      { EASYSIMD_FLOAT32_C(   -86.87), EASYSIMD_FLOAT32_C(  -669.89),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  1442.22),
        EASYSIMD_FLOAT32_C(   618.03), EASYSIMD_FLOAT32_C(  1798.19), EASYSIMD_FLOAT32_C(-13567093877453619200.00),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(24752756156609532352108953600.00), EASYSIMD_FLOAT32_C(     2.74),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    50.51),
        EASYSIMD_FLOAT32_C(  -592.32), EASYSIMD_FLOAT32_C(-19224753951762325664956416.00), EASYSIMD_FLOAT32_C(   394.45), EASYSIMD_FLOAT32_C(  1107.16) } },
    { { EASYSIMD_FLOAT32_C(    -1.09), EASYSIMD_FLOAT32_C(    36.02), EASYSIMD_FLOAT32_C(    -0.23), EASYSIMD_FLOAT32_C(   -34.19),
        EASYSIMD_FLOAT32_C(   -12.87), EASYSIMD_FLOAT32_C(    -0.27), EASYSIMD_FLOAT32_C(   -16.32), EASYSIMD_FLOAT32_C(    37.17),
        EASYSIMD_FLOAT32_C(   -18.77), EASYSIMD_FLOAT32_C(   -40.08), EASYSIMD_FLOAT32_C(   -48.98), EASYSIMD_FLOAT32_C(    15.57),
        EASYSIMD_FLOAT32_C(    48.78), EASYSIMD_FLOAT32_C(    14.92), EASYSIMD_FLOAT32_C(    17.72), EASYSIMD_FLOAT32_C(    40.75) },
      { EASYSIMD_FLOAT32_C(   -19.75), EASYSIMD_FLOAT32_C(    31.16), EASYSIMD_FLOAT32_C(   -47.73), EASYSIMD_FLOAT32_C(    43.01),
        EASYSIMD_FLOAT32_C(    34.66), EASYSIMD_FLOAT32_C(    20.05), EASYSIMD_FLOAT32_C(   -15.77), EASYSIMD_FLOAT32_C(    29.09),
        EASYSIMD_FLOAT32_C(   -29.21), EASYSIMD_FLOAT32_C(   -22.64), EASYSIMD_FLOAT32_C(    31.59), EASYSIMD_FLOAT32_C(   -20.02),
        EASYSIMD_FLOAT32_C(    13.33), EASYSIMD_FLOAT32_C(     7.48), EASYSIMD_FLOAT32_C(    -9.32), EASYSIMD_FLOAT32_C(    48.38) },
      { EASYSIMD_FLOAT32_C(   -26.62), EASYSIMD_FLOAT32_C(    48.27), EASYSIMD_FLOAT32_C(    48.01), EASYSIMD_FLOAT32_C(   -31.68),
        EASYSIMD_FLOAT32_C(   -40.58), EASYSIMD_FLOAT32_C(    13.19), EASYSIMD_FLOAT32_C(   -12.84), EASYSIMD_FLOAT32_C(    29.79),
        EASYSIMD_FLOAT32_C(    26.31), EASYSIMD_FLOAT32_C(    -4.95), EASYSIMD_FLOAT32_C(   -22.22), EASYSIMD_FLOAT32_C(   -10.01),
        EASYSIMD_FLOAT32_C(    15.07), EASYSIMD_FLOAT32_C(    44.42), EASYSIMD_FLOAT32_C(    12.35), EASYSIMD_FLOAT32_C(    45.32) },
      { EASYSIMD_FLOAT32_C(   522.28), EASYSIMD_FLOAT32_C(  1537.80), EASYSIMD_FLOAT32_C( -2280.23), EASYSIMD_FLOAT32_C( -1394.06),
        EASYSIMD_FLOAT32_C( -1410.12), EASYSIMD_FLOAT32_C(   263.48),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-6342780.00),
        EASYSIMD_FLOAT32_C(-19656850484944898202009600.00), EASYSIMD_FLOAT32_C(  5361.63), EASYSIMD_FLOAT32_C(  -745.91), EASYSIMD_FLOAT32_C(   215.57),
        EASYSIMD_FLOAT32_C(   249.30), EASYSIMD_FLOAT32_C(-6402726.50), EASYSIMD_FLOAT32_C(   -96.94), EASYSIMD_FLOAT32_C(  2224.06) } },
    { { EASYSIMD_FLOAT32_C(     7.08), EASYSIMD_FLOAT32_C(    12.56), EASYSIMD_FLOAT32_C(   -39.41), EASYSIMD_FLOAT32_C(    44.22),
        EASYSIMD_FLOAT32_C(   -37.70), EASYSIMD_FLOAT32_C(    -5.72), EASYSIMD_FLOAT32_C(    31.38), EASYSIMD_FLOAT32_C(    -6.47),
        EASYSIMD_FLOAT32_C(     4.20), EASYSIMD_FLOAT32_C(    32.40), EASYSIMD_FLOAT32_C(   -40.91), EASYSIMD_FLOAT32_C(     2.97),
        EASYSIMD_FLOAT32_C(    -2.68), EASYSIMD_FLOAT32_C(    26.81), EASYSIMD_FLOAT32_C(    -6.28), EASYSIMD_FLOAT32_C(   -26.62) },
      { EASYSIMD_FLOAT32_C(   -33.90), EASYSIMD_FLOAT32_C(     1.00), EASYSIMD_FLOAT32_C(    21.61), EASYSIMD_FLOAT32_C(     0.77),
        EASYSIMD_FLOAT32_C(    23.57), EASYSIMD_FLOAT32_C(   -39.07), EASYSIMD_FLOAT32_C(   -43.76), EASYSIMD_FLOAT32_C(   -26.51),
        EASYSIMD_FLOAT32_C(   -18.15), EASYSIMD_FLOAT32_C(    41.68), EASYSIMD_FLOAT32_C(   -13.26), EASYSIMD_FLOAT32_C(   -39.76),
        EASYSIMD_FLOAT32_C(   -32.20), EASYSIMD_FLOAT32_C(    -1.63), EASYSIMD_FLOAT32_C(   -37.99), EASYSIMD_FLOAT32_C(    -7.81) },
      { EASYSIMD_FLOAT32_C(     8.01), EASYSIMD_FLOAT32_C(   -17.91), EASYSIMD_FLOAT32_C(    26.00), EASYSIMD_FLOAT32_C(   -19.17),
        EASYSIMD_FLOAT32_C(    39.34), EASYSIMD_FLOAT32_C(    39.60), EASYSIMD_FLOAT32_C(    29.96), EASYSIMD_FLOAT32_C(    41.63),
        EASYSIMD_FLOAT32_C(   -19.02), EASYSIMD_FLOAT32_C(    19.08), EASYSIMD_FLOAT32_C(     8.99), EASYSIMD_FLOAT32_C(    16.77),
        EASYSIMD_FLOAT32_C(   -29.44), EASYSIMD_FLOAT32_C(   -28.33), EASYSIMD_FLOAT32_C(    28.15), EASYSIMD_FLOAT32_C(   -13.33) },
      { EASYSIMD_FLOAT32_C(  -262.92), EASYSIMD_FLOAT32_C(    -5.31), EASYSIMD_FLOAT32_C(   519.59), EASYSIMD_FLOAT32_C(    29.51),
        EASYSIMD_FLOAT32_C(   884.67), EASYSIMD_FLOAT32_C(24190605650488729785870581760.00), EASYSIMD_FLOAT32_C( -1275.65), EASYSIMD_FLOAT32_C( -1106.22),
        EASYSIMD_FLOAT32_C(   348.58), EASYSIMD_FLOAT32_C(   820.90), EASYSIMD_FLOAT32_C(  -163.48), EASYSIMD_FLOAT32_C(  -662.84),
        EASYSIMD_FLOAT32_C(   937.32), EASYSIMD_FLOAT32_C(    72.72), EASYSIMD_FLOAT32_C(-20604275260570620773007360.00), EASYSIMD_FLOAT32_C(-28648408389142270321715532791808.00) } },
    { { EASYSIMD_FLOAT32_C(    33.44), EASYSIMD_FLOAT32_C(   -10.21), EASYSIMD_FLOAT32_C(   -15.86), EASYSIMD_FLOAT32_C(   -37.42),
        EASYSIMD_FLOAT32_C(    28.00), EASYSIMD_FLOAT32_C(     8.77), EASYSIMD_FLOAT32_C(    37.55), EASYSIMD_FLOAT32_C(    33.34),
        EASYSIMD_FLOAT32_C(    34.72), EASYSIMD_FLOAT32_C(   -23.27), EASYSIMD_FLOAT32_C(   -19.02), EASYSIMD_FLOAT32_C(     8.46),
        EASYSIMD_FLOAT32_C(   -25.71), EASYSIMD_FLOAT32_C(   -26.35), EASYSIMD_FLOAT32_C(    19.60), EASYSIMD_FLOAT32_C(   -30.08) },
      { EASYSIMD_FLOAT32_C(    39.20), EASYSIMD_FLOAT32_C(    19.88), EASYSIMD_FLOAT32_C(   -22.23), EASYSIMD_FLOAT32_C(    47.46),
        EASYSIMD_FLOAT32_C(    11.67), EASYSIMD_FLOAT32_C(     2.95), EASYSIMD_FLOAT32_C(    40.85), EASYSIMD_FLOAT32_C(    11.67),
        EASYSIMD_FLOAT32_C(     0.70), EASYSIMD_FLOAT32_C(    22.19), EASYSIMD_FLOAT32_C(   -12.27), EASYSIMD_FLOAT32_C(    11.51),
        EASYSIMD_FLOAT32_C(     8.97), EASYSIMD_FLOAT32_C(    23.23), EASYSIMD_FLOAT32_C(    -7.88), EASYSIMD_FLOAT32_C(   -34.64) },
      { EASYSIMD_FLOAT32_C(    10.67), EASYSIMD_FLOAT32_C(   -29.05), EASYSIMD_FLOAT32_C(    27.29), EASYSIMD_FLOAT32_C(   -46.63),
        EASYSIMD_FLOAT32_C(    42.01), EASYSIMD_FLOAT32_C(    34.91), EASYSIMD_FLOAT32_C(    -1.83), EASYSIMD_FLOAT32_C(   -25.06),
        EASYSIMD_FLOAT32_C(   -29.09), EASYSIMD_FLOAT32_C(     4.55), EASYSIMD_FLOAT32_C(    11.42), EASYSIMD_FLOAT32_C(    -4.96),
        EASYSIMD_FLOAT32_C(    33.46), EASYSIMD_FLOAT32_C(   -49.89), EASYSIMD_FLOAT32_C(   -20.56), EASYSIMD_FLOAT32_C(    22.66) },
      { EASYSIMD_FLOAT32_C(  5829.06), EASYSIMD_FLOAT32_C(  -586.59), EASYSIMD_FLOAT32_C(-19224753951762325664956416.00), EASYSIMD_FLOAT32_C( -2234.54),
        EASYSIMD_FLOAT32_C(   516.25), EASYSIMD_FLOAT32_C(   110.85), EASYSIMD_FLOAT32_C(15976609750089381969920.00), EASYSIMD_FLOAT32_C(-29246333428117108994491809792000.00),
        EASYSIMD_FLOAT32_C(    14.44), EASYSIMD_FLOAT32_C(    76.98), EASYSIMD_FLOAT32_C(-6343838.50), EASYSIMD_FLOAT32_C(   -48.32),
        EASYSIMD_FLOAT32_C(   271.46), EASYSIMD_FLOAT32_C( -1176.82), EASYSIMD_FLOAT32_C(15953551319997245030400.00), EASYSIMD_FLOAT32_C(  -810.64) } },
    { { EASYSIMD_FLOAT32_C(    47.78), EASYSIMD_FLOAT32_C(   -14.98), EASYSIMD_FLOAT32_C(    24.74), EASYSIMD_FLOAT32_C(   -20.51),
        EASYSIMD_FLOAT32_C(   -30.09), EASYSIMD_FLOAT32_C(   -31.49), EASYSIMD_FLOAT32_C(     1.18), EASYSIMD_FLOAT32_C(   -29.49),
        EASYSIMD_FLOAT32_C(    -4.16), EASYSIMD_FLOAT32_C(    17.13), EASYSIMD_FLOAT32_C(   -48.68), EASYSIMD_FLOAT32_C(    14.20),
        EASYSIMD_FLOAT32_C(    -7.69), EASYSIMD_FLOAT32_C(    -2.21), EASYSIMD_FLOAT32_C(     8.38), EASYSIMD_FLOAT32_C(    -4.96) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    38.87),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -14.71),
        EASYSIMD_FLOAT32_C(    25.30), EASYSIMD_FLOAT32_C(    23.30), EASYSIMD_FLOAT32_C(    48.57), EASYSIMD_FLOAT32_C(   -16.56),
        EASYSIMD_FLOAT32_C(   -48.68), EASYSIMD_FLOAT32_C(    37.76), EASYSIMD_FLOAT32_C(   -23.07), EASYSIMD_FLOAT32_C(   -34.00),
        EASYSIMD_FLOAT32_C(    42.06), EASYSIMD_FLOAT32_C(    15.66), EASYSIMD_FLOAT32_C(   -29.79), EASYSIMD_FLOAT32_C(    -0.28) },
      { EASYSIMD_FLOAT32_C(   -35.32),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    -3.33),
        EASYSIMD_FLOAT32_C(   -40.88), EASYSIMD_FLOAT32_C(    21.71), EASYSIMD_FLOAT32_C(    21.76), EASYSIMD_FLOAT32_C(   -39.21),
        EASYSIMD_FLOAT32_C(    15.54), EASYSIMD_FLOAT32_C(   -45.76), EASYSIMD_FLOAT32_C(    -6.44), EASYSIMD_FLOAT32_C(    25.68),
        EASYSIMD_FLOAT32_C(    -7.50), EASYSIMD_FLOAT32_C(   -37.38), EASYSIMD_FLOAT32_C(    22.01), EASYSIMD_FLOAT32_C(    27.09) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    28.38),
        EASYSIMD_FLOAT32_C( -1059.03), EASYSIMD_FLOAT32_C(-9137542922240.00), EASYSIMD_FLOAT32_C(  1056.06),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(  -755.91), EASYSIMD_FLOAT32_C( -1709.93), EASYSIMD_FLOAT32_C(    99.38), EASYSIMD_FLOAT32_C(  -857.05),
        EASYSIMD_FLOAT32_C(  -322.69), EASYSIMD_FLOAT32_C(  -584.24), EASYSIMD_FLOAT32_C(  -646.12), EASYSIMD_FLOAT32_C(-9526774333440.00) } },
    { { EASYSIMD_FLOAT32_C(   -12.61), EASYSIMD_FLOAT32_C(    48.07), EASYSIMD_FLOAT32_C(    41.82), EASYSIMD_FLOAT32_C(    22.53),
        EASYSIMD_FLOAT32_C(    23.86), EASYSIMD_FLOAT32_C(     3.71), EASYSIMD_FLOAT32_C(   -32.99), EASYSIMD_FLOAT32_C(   -28.61),
        EASYSIMD_FLOAT32_C(    35.21), EASYSIMD_FLOAT32_C(   -15.22), EASYSIMD_FLOAT32_C(   -44.26), EASYSIMD_FLOAT32_C(   -36.49),
        EASYSIMD_FLOAT32_C(     9.76), EASYSIMD_FLOAT32_C(    -0.81), EASYSIMD_FLOAT32_C(   -14.11), EASYSIMD_FLOAT32_C(     7.54) },
      { EASYSIMD_FLOAT32_C(   -48.52), EASYSIMD_FLOAT32_C(     7.00), EASYSIMD_FLOAT32_C(   -37.62), EASYSIMD_FLOAT32_C(    26.79),
        EASYSIMD_FLOAT32_C(   -19.70), EASYSIMD_FLOAT32_C(   -39.05), EASYSIMD_FLOAT32_C(   -39.77), EASYSIMD_FLOAT32_C(   -18.37),
        EASYSIMD_FLOAT32_C(    48.71), EASYSIMD_FLOAT32_C(   -12.84), EASYSIMD_FLOAT32_C(    -2.38), EASYSIMD_FLOAT32_C(    40.77),
        EASYSIMD_FLOAT32_C(   -47.18), EASYSIMD_FLOAT32_C(    17.83), EASYSIMD_FLOAT32_C(    -9.51), EASYSIMD_FLOAT32_C(   -32.51) },
      { EASYSIMD_FLOAT32_C(    33.39), EASYSIMD_FLOAT32_C(     6.73), EASYSIMD_FLOAT32_C(    14.17), EASYSIMD_FLOAT32_C(    42.51),
        EASYSIMD_FLOAT32_C(   -21.56), EASYSIMD_FLOAT32_C(   -14.07), EASYSIMD_FLOAT32_C(   -46.70), EASYSIMD_FLOAT32_C(    43.98),
        EASYSIMD_FLOAT32_C(    -9.83), EASYSIMD_FLOAT32_C(    -3.14), EASYSIMD_FLOAT32_C(    19.66), EASYSIMD_FLOAT32_C(    32.67),
        EASYSIMD_FLOAT32_C(     9.47), EASYSIMD_FLOAT32_C(    -8.33), EASYSIMD_FLOAT32_C(     9.76), EASYSIMD_FLOAT32_C(    10.96) },
      { EASYSIMD_FLOAT32_C( -1625.23), EASYSIMD_FLOAT32_C(    95.10), EASYSIMD_FLOAT32_C(-29246333428117108994491809792000.00), EASYSIMD_FLOAT32_C(  1159.41),
        EASYSIMD_FLOAT32_C(-9301288550400.00), EASYSIMD_FLOAT32_C(   552.15), EASYSIMD_FLOAT32_C(  1815.39),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(-13517554281552543744.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(11287586370748416.00), EASYSIMD_FLOAT32_C(  1287.89),
        EASYSIMD_FLOAT32_C(  -433.80), EASYSIMD_FLOAT32_C(  -148.36), EASYSIMD_FLOAT32_C(  -106.74), EASYSIMD_FLOAT32_C(  -347.93) } },
    { { EASYSIMD_FLOAT32_C(    34.21), EASYSIMD_FLOAT32_C(   -39.37), EASYSIMD_FLOAT32_C(    37.03), EASYSIMD_FLOAT32_C(   -45.88),
        EASYSIMD_FLOAT32_C(   -20.86), EASYSIMD_FLOAT32_C(   -11.79), EASYSIMD_FLOAT32_C(   -25.37), EASYSIMD_FLOAT32_C(    24.97),
        EASYSIMD_FLOAT32_C(   -44.66), EASYSIMD_FLOAT32_C(   -24.05), EASYSIMD_FLOAT32_C(   -10.82), EASYSIMD_FLOAT32_C(    -2.36),
        EASYSIMD_FLOAT32_C(    23.74), EASYSIMD_FLOAT32_C(    47.56), EASYSIMD_FLOAT32_C(    42.68), EASYSIMD_FLOAT32_C(   -38.86) },
      { EASYSIMD_FLOAT32_C(    48.67), EASYSIMD_FLOAT32_C(    22.14), EASYSIMD_FLOAT32_C(   -12.26), EASYSIMD_FLOAT32_C(   -21.03),
        EASYSIMD_FLOAT32_C(    33.10), EASYSIMD_FLOAT32_C(    -2.02), EASYSIMD_FLOAT32_C(    10.60), EASYSIMD_FLOAT32_C(    31.81),
        EASYSIMD_FLOAT32_C(    35.13), EASYSIMD_FLOAT32_C(   -41.78), EASYSIMD_FLOAT32_C(    22.57), EASYSIMD_FLOAT32_C(    37.95),
        EASYSIMD_FLOAT32_C(    26.05), EASYSIMD_FLOAT32_C(   -36.94), EASYSIMD_FLOAT32_C(   -44.56), EASYSIMD_FLOAT32_C(     9.44) },
      { EASYSIMD_FLOAT32_C(    19.79), EASYSIMD_FLOAT32_C(    19.61), EASYSIMD_FLOAT32_C(     1.95), EASYSIMD_FLOAT32_C(    48.23),
        EASYSIMD_FLOAT32_C(   -44.47), EASYSIMD_FLOAT32_C(     5.25), EASYSIMD_FLOAT32_C(    42.22), EASYSIMD_FLOAT32_C(    -4.30),
        EASYSIMD_FLOAT32_C(   -47.90), EASYSIMD_FLOAT32_C(    11.88), EASYSIMD_FLOAT32_C(   -21.63), EASYSIMD_FLOAT32_C(    11.58),
        EASYSIMD_FLOAT32_C(   -46.45), EASYSIMD_FLOAT32_C(    38.13), EASYSIMD_FLOAT32_C(   -27.46), EASYSIMD_FLOAT32_C(   -47.78) },
      { EASYSIMD_FLOAT32_C(   987.82), EASYSIMD_FLOAT32_C(   387.58), EASYSIMD_FLOAT32_C(    13.20), EASYSIMD_FLOAT32_C(-18920751609427592254324736.00),
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   -22.37), EASYSIMD_FLOAT32_C(   418.26), EASYSIMD_FLOAT32_C(-9301288550400.00),
        EASYSIMD_FLOAT32_C( -1715.91), EASYSIMD_FLOAT32_C(  -519.83), EASYSIMD_FLOAT32_C(  -497.38), EASYSIMD_FLOAT32_C(-9575092715520.00),
        EASYSIMD_FLOAT32_C(-29184436426152839980746853580800.00), EASYSIMD_FLOAT32_C( -1348.94), EASYSIMD_FLOAT32_C(  1260.87), EASYSIMD_FLOAT32_C(  -489.50) } },
    { { EASYSIMD_FLOAT32_C(    -4.61), EASYSIMD_FLOAT32_C(   -16.28), EASYSIMD_FLOAT32_C(    26.39), EASYSIMD_FLOAT32_C(    31.57),
        EASYSIMD_FLOAT32_C(   -49.66), EASYSIMD_FLOAT32_C(    35.65), EASYSIMD_FLOAT32_C(    -5.68), EASYSIMD_FLOAT32_C(    36.04),
        EASYSIMD_FLOAT32_C(    38.28), EASYSIMD_FLOAT32_C(    33.58), EASYSIMD_FLOAT32_C(   -47.25), EASYSIMD_FLOAT32_C(   -41.42),
        EASYSIMD_FLOAT32_C(    31.48), EASYSIMD_FLOAT32_C(    14.13), EASYSIMD_FLOAT32_C(   -30.37), EASYSIMD_FLOAT32_C(   -16.33) },
      { EASYSIMD_FLOAT32_C(    36.78), EASYSIMD_FLOAT32_C(     0.05), EASYSIMD_FLOAT32_C(    34.84), EASYSIMD_FLOAT32_C(     0.85),
        EASYSIMD_FLOAT32_C(    31.25), EASYSIMD_FLOAT32_C(    40.74), EASYSIMD_FLOAT32_C(   -43.51), EASYSIMD_FLOAT32_C(    30.98),
        EASYSIMD_FLOAT32_C(    32.98), EASYSIMD_FLOAT32_C(    12.30), EASYSIMD_FLOAT32_C(    -8.80), EASYSIMD_FLOAT32_C(    41.55),
        EASYSIMD_FLOAT32_C(    36.55), EASYSIMD_FLOAT32_C(    44.43), EASYSIMD_FLOAT32_C(    28.62), EASYSIMD_FLOAT32_C(    -4.36) },
      { EASYSIMD_FLOAT32_C(   -10.90), EASYSIMD_FLOAT32_C(     4.49), EASYSIMD_FLOAT32_C(   -47.86), EASYSIMD_FLOAT32_C(    -4.83),
        EASYSIMD_FLOAT32_C(   -35.34), EASYSIMD_FLOAT32_C(    22.79), EASYSIMD_FLOAT32_C(    48.03), EASYSIMD_FLOAT32_C(   -14.61),
        EASYSIMD_FLOAT32_C(   -27.07), EASYSIMD_FLOAT32_C(   -47.18), EASYSIMD_FLOAT32_C(   -32.37), EASYSIMD_FLOAT32_C(    -2.50),
        EASYSIMD_FLOAT32_C(   -38.85), EASYSIMD_FLOAT32_C(    32.18), EASYSIMD_FLOAT32_C(   -33.16), EASYSIMD_FLOAT32_C(    47.93) },
      { EASYSIMD_FLOAT32_C(  4885.73), EASYSIMD_FLOAT32_C(   -16.05),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    27.49),
        EASYSIMD_FLOAT32_C( -1151.22),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C( -2093.68), EASYSIMD_FLOAT32_C(10848881231265792.00),
        EASYSIMD_FLOAT32_C(  -845.97), EASYSIMD_FLOAT32_C(  4839.08),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -145.17),
        EASYSIMD_FLOAT32_C(11316723428884480.00), EASYSIMD_FLOAT32_C(  1430.13), EASYSIMD_FLOAT32_C(11524256248627200.00), EASYSIMD_FLOAT32_C(  -223.74) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 tmp;

    easysimd__m512 src = easysimd_mm512_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd__m512bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm512_loadu_ps(test_vec[i].b);
    easysimd__m512bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m512 r = easysimd_mm512_dpbf16_ps(src, a, b);
    easysimd_test_x86_assert_equal_f32x16(r, easysimd_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m512)];
  easysimd_test_x86_random_f32x16_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m512 src = easysimd_test_x86_random_f32x16(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__m512bh a = HEDLEY_REINTERPRET_CAST(easysimd__m512bh, easysimd_test_x86_random_extract_f32x16(i, 2, 0, values));
    easysimd__m512bh b = HEDLEY_REINTERPRET_CAST(easysimd__m512bh, easysimd_test_x86_random_extract_f32x16(i, 2, 1, values));
    easysimd__m512 r = easysimd_mm512_dpbf16_ps(src, a, b);

    easysimd_test_x86_write_f32x16(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x16(2, HEDLEY_REINTERPRET_CAST(easysimd__m512, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, HEDLEY_REINTERPRET_CAST(easysimd__m512, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_mask_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[16];
    const easysimd__mmask16 k;
    const easysimd_float32 a[16];
    const easysimd_float32 b[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(    40.11), EASYSIMD_FLOAT32_C(   -19.39), EASYSIMD_FLOAT32_C(   -41.56), EASYSIMD_FLOAT32_C(    18.94),
        EASYSIMD_FLOAT32_C(    20.21), EASYSIMD_FLOAT32_C(    -9.24), EASYSIMD_FLOAT32_C(     9.43), EASYSIMD_FLOAT32_C(    17.33),
        EASYSIMD_FLOAT32_C(   -18.76), EASYSIMD_FLOAT32_C(   -10.09), EASYSIMD_FLOAT32_C(    -2.32), EASYSIMD_FLOAT32_C(   -49.26),
        EASYSIMD_FLOAT32_C(    -0.93), EASYSIMD_FLOAT32_C(   -20.05), EASYSIMD_FLOAT32_C(     5.19), EASYSIMD_FLOAT32_C(   -13.89) },
      UINT16_C( 7338),
      { EASYSIMD_FLOAT32_C(    -5.06), EASYSIMD_FLOAT32_C(    20.43), EASYSIMD_FLOAT32_C(    19.29), EASYSIMD_FLOAT32_C(    14.81),
        EASYSIMD_FLOAT32_C(   -19.15), EASYSIMD_FLOAT32_C(    10.65), EASYSIMD_FLOAT32_C(    30.77), EASYSIMD_FLOAT32_C(    19.33),
        EASYSIMD_FLOAT32_C(   -37.44), EASYSIMD_FLOAT32_C(    16.33), EASYSIMD_FLOAT32_C(   -10.19), EASYSIMD_FLOAT32_C(    15.64),
        EASYSIMD_FLOAT32_C(    -1.91), EASYSIMD_FLOAT32_C(    -5.87), EASYSIMD_FLOAT32_C(     7.39), EASYSIMD_FLOAT32_C(   -21.61) },
      { EASYSIMD_FLOAT32_C(    26.17), EASYSIMD_FLOAT32_C(   -22.61), EASYSIMD_FLOAT32_C(   -13.44), EASYSIMD_FLOAT32_C(    -3.70),
        EASYSIMD_FLOAT32_C(   -27.26), EASYSIMD_FLOAT32_C(    35.68), EASYSIMD_FLOAT32_C(   -28.70), EASYSIMD_FLOAT32_C(    -6.05),
        EASYSIMD_FLOAT32_C(    -6.33), EASYSIMD_FLOAT32_C(   -12.83), EASYSIMD_FLOAT32_C(   -10.27), EASYSIMD_FLOAT32_C(    40.33),
        EASYSIMD_FLOAT32_C(    11.67), EASYSIMD_FLOAT32_C(   -32.45), EASYSIMD_FLOAT32_C(   -38.41), EASYSIMD_FLOAT32_C(   -43.39) },
      { EASYSIMD_FLOAT32_C(    40.11),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   -41.56),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(    20.21), EASYSIMD_FLOAT32_C(-13595241375124684800.00), EASYSIMD_FLOAT32_C(     9.43), EASYSIMD_FLOAT32_C(   -98.77),
        EASYSIMD_FLOAT32_C(   -18.76), EASYSIMD_FLOAT32_C(   -10.09), EASYSIMD_FLOAT32_C(   102.10), EASYSIMD_FLOAT32_C(7454851584.00),
        EASYSIMD_FLOAT32_C(-29246333428117108994491809792000.00), EASYSIMD_FLOAT32_C(   -20.05), EASYSIMD_FLOAT32_C(     5.19), EASYSIMD_FLOAT32_C(   -13.89) } },
    { { EASYSIMD_FLOAT32_C(   -10.57), EASYSIMD_FLOAT32_C(   -31.39), EASYSIMD_FLOAT32_C(    40.10), EASYSIMD_FLOAT32_C(    31.66),
        EASYSIMD_FLOAT32_C(    46.17), EASYSIMD_FLOAT32_C(   -12.96), EASYSIMD_FLOAT32_C(   -49.84), EASYSIMD_FLOAT32_C(    38.30),
        EASYSIMD_FLOAT32_C(    25.29), EASYSIMD_FLOAT32_C(   -49.07), EASYSIMD_FLOAT32_C(     4.13), EASYSIMD_FLOAT32_C(     6.28),
        EASYSIMD_FLOAT32_C(    14.00), EASYSIMD_FLOAT32_C(    -5.76), EASYSIMD_FLOAT32_C(    36.89), EASYSIMD_FLOAT32_C(    22.45) },
      UINT16_C( 9033),
      { EASYSIMD_FLOAT32_C(    37.99), EASYSIMD_FLOAT32_C(    30.89), EASYSIMD_FLOAT32_C(    21.42), EASYSIMD_FLOAT32_C(   -31.16),
        EASYSIMD_FLOAT32_C(    -8.46), EASYSIMD_FLOAT32_C(     2.19), EASYSIMD_FLOAT32_C(    38.17), EASYSIMD_FLOAT32_C(     4.10),
        EASYSIMD_FLOAT32_C(   -31.49), EASYSIMD_FLOAT32_C(   -22.02), EASYSIMD_FLOAT32_C(   -30.26), EASYSIMD_FLOAT32_C(    16.60),
        EASYSIMD_FLOAT32_C(    22.11), EASYSIMD_FLOAT32_C(    27.13), EASYSIMD_FLOAT32_C(    44.99), EASYSIMD_FLOAT32_C(    -1.71) },
      { EASYSIMD_FLOAT32_C(   -45.48), EASYSIMD_FLOAT32_C(   -18.45), EASYSIMD_FLOAT32_C(    44.59), EASYSIMD_FLOAT32_C(   -22.74),
        EASYSIMD_FLOAT32_C(   -32.76), EASYSIMD_FLOAT32_C(   -34.11), EASYSIMD_FLOAT32_C(    21.21), EASYSIMD_FLOAT32_C(    10.91),
        EASYSIMD_FLOAT32_C(     3.06), EASYSIMD_FLOAT32_C(   -39.06), EASYSIMD_FLOAT32_C(     1.24), EASYSIMD_FLOAT32_C(   -35.27),
        EASYSIMD_FLOAT32_C(   -21.51), EASYSIMD_FLOAT32_C(    12.83), EASYSIMD_FLOAT32_C(   -28.66), EASYSIMD_FLOAT32_C(   -33.52) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   -31.39), EASYSIMD_FLOAT32_C(    40.10), EASYSIMD_FLOAT32_C(-28648408389142270321715532791808.00),
        EASYSIMD_FLOAT32_C(    46.17), EASYSIMD_FLOAT32_C(   -12.96), EASYSIMD_FLOAT32_C(   752.91), EASYSIMD_FLOAT32_C(    38.30),
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   808.93), EASYSIMD_FLOAT32_C(     4.13), EASYSIMD_FLOAT32_C(     6.28),
        EASYSIMD_FLOAT32_C(    14.00), EASYSIMD_FLOAT32_C(   341.78), EASYSIMD_FLOAT32_C(    36.89), EASYSIMD_FLOAT32_C(    22.45) } },
    { { EASYSIMD_FLOAT32_C(   -36.79), EASYSIMD_FLOAT32_C(    22.61), EASYSIMD_FLOAT32_C(   -25.57), EASYSIMD_FLOAT32_C(    -5.55),
        EASYSIMD_FLOAT32_C(   -37.48), EASYSIMD_FLOAT32_C(    22.10), EASYSIMD_FLOAT32_C(    -4.80), EASYSIMD_FLOAT32_C(    11.58),
        EASYSIMD_FLOAT32_C(   -47.95), EASYSIMD_FLOAT32_C(   -49.61), EASYSIMD_FLOAT32_C(    47.70), EASYSIMD_FLOAT32_C(   -36.16),
        EASYSIMD_FLOAT32_C(   -13.89), EASYSIMD_FLOAT32_C(   -12.88), EASYSIMD_FLOAT32_C(   -17.54), EASYSIMD_FLOAT32_C(   -23.79) },
      UINT16_C(11160),
      { EASYSIMD_FLOAT32_C(    -6.28), EASYSIMD_FLOAT32_C(    42.76), EASYSIMD_FLOAT32_C(   -14.68), EASYSIMD_FLOAT32_C(    35.25),
        EASYSIMD_FLOAT32_C(    -5.05), EASYSIMD_FLOAT32_C(   -26.51), EASYSIMD_FLOAT32_C(   -10.65), EASYSIMD_FLOAT32_C(    13.46),
        EASYSIMD_FLOAT32_C(     1.47), EASYSIMD_FLOAT32_C(     9.09), EASYSIMD_FLOAT32_C(   -19.94), EASYSIMD_FLOAT32_C(   -26.41),
        EASYSIMD_FLOAT32_C(   -13.78), EASYSIMD_FLOAT32_C(   -24.94), EASYSIMD_FLOAT32_C(    21.87), EASYSIMD_FLOAT32_C(    -9.27) },
      { EASYSIMD_FLOAT32_C(     6.61), EASYSIMD_FLOAT32_C(    16.46), EASYSIMD_FLOAT32_C(    17.99), EASYSIMD_FLOAT32_C(    23.85),
        EASYSIMD_FLOAT32_C(    32.34), EASYSIMD_FLOAT32_C(   -10.80), EASYSIMD_FLOAT32_C(   -15.25), EASYSIMD_FLOAT32_C(   -14.60),
        EASYSIMD_FLOAT32_C(     0.14), EASYSIMD_FLOAT32_C(    35.99), EASYSIMD_FLOAT32_C(     0.13), EASYSIMD_FLOAT32_C(    28.63),
        EASYSIMD_FLOAT32_C(    -1.18), EASYSIMD_FLOAT32_C(    21.47), EASYSIMD_FLOAT32_C(    45.11), EASYSIMD_FLOAT32_C(    42.54) },
      { EASYSIMD_FLOAT32_C(   -36.79), EASYSIMD_FLOAT32_C(    22.61), EASYSIMD_FLOAT32_C(   -25.57), EASYSIMD_FLOAT32_C(   831.64),
        EASYSIMD_FLOAT32_C(  -199.74), EASYSIMD_FLOAT32_C(    22.10), EASYSIMD_FLOAT32_C(    -4.80), EASYSIMD_FLOAT32_C(  -184.10),
        EASYSIMD_FLOAT32_C(  5149.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    47.70), EASYSIMD_FLOAT32_C(  -791.14),
        EASYSIMD_FLOAT32_C(   -13.89), EASYSIMD_FLOAT32_C(  -544.58), EASYSIMD_FLOAT32_C(   -17.54), EASYSIMD_FLOAT32_C(   -23.79) } },
    { { EASYSIMD_FLOAT32_C(    13.26), EASYSIMD_FLOAT32_C(   -31.06), EASYSIMD_FLOAT32_C(   -33.07), EASYSIMD_FLOAT32_C(   -11.46),
        EASYSIMD_FLOAT32_C(   -30.13), EASYSIMD_FLOAT32_C(    21.06), EASYSIMD_FLOAT32_C(    44.83), EASYSIMD_FLOAT32_C(    33.87),
        EASYSIMD_FLOAT32_C(   -34.71), EASYSIMD_FLOAT32_C(    31.72), EASYSIMD_FLOAT32_C(     6.32), EASYSIMD_FLOAT32_C(   -21.53),
        EASYSIMD_FLOAT32_C(   -11.18), EASYSIMD_FLOAT32_C(    19.53), EASYSIMD_FLOAT32_C(   -48.93), EASYSIMD_FLOAT32_C(    13.24) },
      UINT16_C(26206),
      { EASYSIMD_FLOAT32_C(    14.23), EASYSIMD_FLOAT32_C(   -19.56), EASYSIMD_FLOAT32_C(    27.79), EASYSIMD_FLOAT32_C(   -40.83),
        EASYSIMD_FLOAT32_C(     3.93), EASYSIMD_FLOAT32_C(   -32.85), EASYSIMD_FLOAT32_C(    22.63), EASYSIMD_FLOAT32_C(   -44.60),
        EASYSIMD_FLOAT32_C(    26.24), EASYSIMD_FLOAT32_C(   -47.30), EASYSIMD_FLOAT32_C(   -21.01), EASYSIMD_FLOAT32_C(   -37.55),
        EASYSIMD_FLOAT32_C(   -22.25), EASYSIMD_FLOAT32_C(   -49.14), EASYSIMD_FLOAT32_C(     3.19), EASYSIMD_FLOAT32_C(    34.36) },
      { EASYSIMD_FLOAT32_C(    17.32), EASYSIMD_FLOAT32_C(   -28.82), EASYSIMD_FLOAT32_C(     8.21), EASYSIMD_FLOAT32_C(    -0.34),
        EASYSIMD_FLOAT32_C(    10.38), EASYSIMD_FLOAT32_C(    42.96), EASYSIMD_FLOAT32_C(    35.06), EASYSIMD_FLOAT32_C(   -39.48),
        EASYSIMD_FLOAT32_C(    28.96), EASYSIMD_FLOAT32_C(   -14.80), EASYSIMD_FLOAT32_C(    39.16), EASYSIMD_FLOAT32_C(   -22.22),
        EASYSIMD_FLOAT32_C(   -43.33), EASYSIMD_FLOAT32_C(    34.27), EASYSIMD_FLOAT32_C(   -29.68), EASYSIMD_FLOAT32_C(    20.89) },
      { EASYSIMD_FLOAT32_C(    13.26), EASYSIMD_FLOAT32_C(-6335470.50), EASYSIMD_FLOAT32_C(24108398694754935001990561792.00), EASYSIMD_FLOAT32_C(     2.39),
        EASYSIMD_FLOAT32_C(    10.56), EASYSIMD_FLOAT32_C(    21.06), EASYSIMD_FLOAT32_C(   836.71), EASYSIMD_FLOAT32_C(    33.87),
        EASYSIMD_FLOAT32_C(   -34.71), EASYSIMD_FLOAT32_C(   724.18), EASYSIMD_FLOAT32_C(  -812.68), EASYSIMD_FLOAT32_C(   -21.53),
        EASYSIMD_FLOAT32_C(   -11.18), EASYSIMD_FLOAT32_C( -1658.72), EASYSIMD_FLOAT32_C(11089674277748736.00), EASYSIMD_FLOAT32_C(    13.24) } },
    { { EASYSIMD_FLOAT32_C(   -21.50), EASYSIMD_FLOAT32_C(    26.01), EASYSIMD_FLOAT32_C(     2.52), EASYSIMD_FLOAT32_C(    14.53),
        EASYSIMD_FLOAT32_C(     5.83), EASYSIMD_FLOAT32_C(    -0.53), EASYSIMD_FLOAT32_C(    -0.31), EASYSIMD_FLOAT32_C(   -33.80),
        EASYSIMD_FLOAT32_C(    49.44), EASYSIMD_FLOAT32_C(   -46.69), EASYSIMD_FLOAT32_C(    26.48), EASYSIMD_FLOAT32_C(    41.39),
        EASYSIMD_FLOAT32_C(   -27.71), EASYSIMD_FLOAT32_C(    40.91), EASYSIMD_FLOAT32_C(    22.97), EASYSIMD_FLOAT32_C(   -19.66) },
      UINT16_C(60104),
      { EASYSIMD_FLOAT32_C(    -8.80), EASYSIMD_FLOAT32_C(    34.46), EASYSIMD_FLOAT32_C(   -32.34), EASYSIMD_FLOAT32_C(    -1.16),
        EASYSIMD_FLOAT32_C(   -16.24), EASYSIMD_FLOAT32_C(    -0.79), EASYSIMD_FLOAT32_C(   -44.42), EASYSIMD_FLOAT32_C(    16.14),
        EASYSIMD_FLOAT32_C(     8.49), EASYSIMD_FLOAT32_C(    27.24), EASYSIMD_FLOAT32_C(    -1.50), EASYSIMD_FLOAT32_C(     8.20),
        EASYSIMD_FLOAT32_C(    46.23), EASYSIMD_FLOAT32_C(   -42.70), EASYSIMD_FLOAT32_C(   -45.39), EASYSIMD_FLOAT32_C(    15.20) },
      { EASYSIMD_FLOAT32_C(    -4.01), EASYSIMD_FLOAT32_C(     2.49), EASYSIMD_FLOAT32_C(   -12.27), EASYSIMD_FLOAT32_C(    19.13),
        EASYSIMD_FLOAT32_C(    44.86), EASYSIMD_FLOAT32_C(   -28.34), EASYSIMD_FLOAT32_C(    36.06), EASYSIMD_FLOAT32_C(    -9.95),
        EASYSIMD_FLOAT32_C(   -14.84), EASYSIMD_FLOAT32_C(    27.43), EASYSIMD_FLOAT32_C(    15.88), EASYSIMD_FLOAT32_C(    -0.30),
        EASYSIMD_FLOAT32_C(   -12.65), EASYSIMD_FLOAT32_C(   -20.84), EASYSIMD_FLOAT32_C(    28.69), EASYSIMD_FLOAT32_C(    28.55) },
      { EASYSIMD_FLOAT32_C(   -21.50), EASYSIMD_FLOAT32_C(    26.01), EASYSIMD_FLOAT32_C(     2.52), EASYSIMD_FLOAT32_C(  5308.04),
        EASYSIMD_FLOAT32_C(     5.83), EASYSIMD_FLOAT32_C(    -0.53), EASYSIMD_FLOAT32_C( -1593.31), EASYSIMD_FLOAT32_C(  -194.04),
        EASYSIMD_FLOAT32_C(    49.44),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    26.48), EASYSIMD_FLOAT32_C(    38.94),
        EASYSIMD_FLOAT32_C(   -27.71), EASYSIMD_FLOAT32_C(  6304.04), EASYSIMD_FLOAT32_C( -1272.31), EASYSIMD_FLOAT32_C(11316723428884480.00) } },
    { { EASYSIMD_FLOAT32_C(    -9.07), EASYSIMD_FLOAT32_C(   -12.26), EASYSIMD_FLOAT32_C(    49.25), EASYSIMD_FLOAT32_C(    17.59),
        EASYSIMD_FLOAT32_C(   -14.60), EASYSIMD_FLOAT32_C(    -0.42), EASYSIMD_FLOAT32_C(    -2.31), EASYSIMD_FLOAT32_C(    44.74),
        EASYSIMD_FLOAT32_C(     9.36), EASYSIMD_FLOAT32_C(   -21.73), EASYSIMD_FLOAT32_C(    24.43), EASYSIMD_FLOAT32_C(   -14.16),
        EASYSIMD_FLOAT32_C(   -28.77), EASYSIMD_FLOAT32_C(   -47.07), EASYSIMD_FLOAT32_C(   -38.14), EASYSIMD_FLOAT32_C(    23.76) },
      UINT16_C(  444),
      { EASYSIMD_FLOAT32_C(   -36.38), EASYSIMD_FLOAT32_C(    46.34), EASYSIMD_FLOAT32_C(   -22.61), EASYSIMD_FLOAT32_C(    -2.62),
        EASYSIMD_FLOAT32_C(    -4.44), EASYSIMD_FLOAT32_C(   -17.04), EASYSIMD_FLOAT32_C(   -36.48), EASYSIMD_FLOAT32_C(   -45.96),
        EASYSIMD_FLOAT32_C(   -39.80), EASYSIMD_FLOAT32_C(    12.02), EASYSIMD_FLOAT32_C(    12.25), EASYSIMD_FLOAT32_C(   -43.57),
        EASYSIMD_FLOAT32_C(    19.32), EASYSIMD_FLOAT32_C(    16.85), EASYSIMD_FLOAT32_C(    21.63), EASYSIMD_FLOAT32_C(   -34.69) },
      { EASYSIMD_FLOAT32_C(   -30.66), EASYSIMD_FLOAT32_C(   -40.63), EASYSIMD_FLOAT32_C(    34.45), EASYSIMD_FLOAT32_C(   -35.80),
        EASYSIMD_FLOAT32_C(   -18.97), EASYSIMD_FLOAT32_C(    20.51), EASYSIMD_FLOAT32_C(     4.25), EASYSIMD_FLOAT32_C(    16.18),
        EASYSIMD_FLOAT32_C(    -2.06), EASYSIMD_FLOAT32_C(   -29.87), EASYSIMD_FLOAT32_C(   -34.11), EASYSIMD_FLOAT32_C(    35.29),
        EASYSIMD_FLOAT32_C(    -0.71), EASYSIMD_FLOAT32_C(    44.57), EASYSIMD_FLOAT32_C(    13.84), EASYSIMD_FLOAT32_C(    12.91) },
      { EASYSIMD_FLOAT32_C(    -9.07), EASYSIMD_FLOAT32_C(   -12.26), EASYSIMD_FLOAT32_C(24782979302099898081476608000.00), EASYSIMD_FLOAT32_C(   110.88),
        EASYSIMD_FLOAT32_C(    69.16), EASYSIMD_FLOAT32_C(  -348.92), EASYSIMD_FLOAT32_C(    -2.31),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(-6323621.00), EASYSIMD_FLOAT32_C(   -21.73), EASYSIMD_FLOAT32_C(    24.43), EASYSIMD_FLOAT32_C(   -14.16),
        EASYSIMD_FLOAT32_C(   -28.77), EASYSIMD_FLOAT32_C(   -47.07), EASYSIMD_FLOAT32_C(   -38.14), EASYSIMD_FLOAT32_C(    23.76) } },
    { { EASYSIMD_FLOAT32_C(   -26.77), EASYSIMD_FLOAT32_C(   -32.86), EASYSIMD_FLOAT32_C(    33.88), EASYSIMD_FLOAT32_C(   -27.33),
        EASYSIMD_FLOAT32_C(   -29.55), EASYSIMD_FLOAT32_C(    10.36), EASYSIMD_FLOAT32_C(   -35.94), EASYSIMD_FLOAT32_C(    -7.26),
        EASYSIMD_FLOAT32_C(     1.27), EASYSIMD_FLOAT32_C(    37.03), EASYSIMD_FLOAT32_C(    23.08), EASYSIMD_FLOAT32_C(    44.54),
        EASYSIMD_FLOAT32_C(   -48.66), EASYSIMD_FLOAT32_C(   -35.98), EASYSIMD_FLOAT32_C(   -17.71), EASYSIMD_FLOAT32_C(   -49.41) },
      UINT16_C(17433),
      { EASYSIMD_FLOAT32_C(    40.92), EASYSIMD_FLOAT32_C(    41.23), EASYSIMD_FLOAT32_C(   -39.71), EASYSIMD_FLOAT32_C(   -13.53),
        EASYSIMD_FLOAT32_C(   -25.81), EASYSIMD_FLOAT32_C(   -26.19), EASYSIMD_FLOAT32_C(    -9.48), EASYSIMD_FLOAT32_C(   -15.60),
        EASYSIMD_FLOAT32_C(    35.83), EASYSIMD_FLOAT32_C(   -47.23), EASYSIMD_FLOAT32_C(    -9.17), EASYSIMD_FLOAT32_C(     5.15),
        EASYSIMD_FLOAT32_C(    19.62), EASYSIMD_FLOAT32_C(   -37.54), EASYSIMD_FLOAT32_C(    20.46), EASYSIMD_FLOAT32_C(    38.96) },
      { EASYSIMD_FLOAT32_C(   -28.17), EASYSIMD_FLOAT32_C(     4.91), EASYSIMD_FLOAT32_C(   -46.84), EASYSIMD_FLOAT32_C(     2.86),
        EASYSIMD_FLOAT32_C(   -24.58), EASYSIMD_FLOAT32_C(     7.42), EASYSIMD_FLOAT32_C(   -30.96), EASYSIMD_FLOAT32_C(    23.36),
        EASYSIMD_FLOAT32_C(    27.55), EASYSIMD_FLOAT32_C(   -15.07), EASYSIMD_FLOAT32_C(     8.65), EASYSIMD_FLOAT32_C(   -23.16),
        EASYSIMD_FLOAT32_C(   -20.50), EASYSIMD_FLOAT32_C(   -27.51), EASYSIMD_FLOAT32_C(    39.75), EASYSIMD_FLOAT32_C(   -29.58) },
      { EASYSIMD_FLOAT32_C(-6404245.00), EASYSIMD_FLOAT32_C(   -32.86), EASYSIMD_FLOAT32_C(    33.88), EASYSIMD_FLOAT32_C(  5249.69),
        EASYSIMD_FLOAT32_C(-13616351998377984000.00), EASYSIMD_FLOAT32_C(    10.36), EASYSIMD_FLOAT32_C(   -35.94), EASYSIMD_FLOAT32_C(    -7.26),
        EASYSIMD_FLOAT32_C(     1.27), EASYSIMD_FLOAT32_C(    37.03), EASYSIMD_FLOAT32_C(-13595241375124684800.00), EASYSIMD_FLOAT32_C(    44.54),
        EASYSIMD_FLOAT32_C(   -48.66), EASYSIMD_FLOAT32_C(   -35.98), EASYSIMD_FLOAT32_C(   792.20), EASYSIMD_FLOAT32_C(   -49.41) } },
    { { EASYSIMD_FLOAT32_C(     0.17), EASYSIMD_FLOAT32_C(   -20.71), EASYSIMD_FLOAT32_C(    12.43), EASYSIMD_FLOAT32_C(   -40.47),
        EASYSIMD_FLOAT32_C(     7.56), EASYSIMD_FLOAT32_C(   -13.14), EASYSIMD_FLOAT32_C(    -4.63), EASYSIMD_FLOAT32_C(    28.80),
        EASYSIMD_FLOAT32_C(   -10.21), EASYSIMD_FLOAT32_C(     7.23), EASYSIMD_FLOAT32_C(     2.56), EASYSIMD_FLOAT32_C(   -42.75),
        EASYSIMD_FLOAT32_C(   -25.09), EASYSIMD_FLOAT32_C(    25.79), EASYSIMD_FLOAT32_C(   -25.61), EASYSIMD_FLOAT32_C(   -41.21) },
      UINT16_C(18347),
      { EASYSIMD_FLOAT32_C(   -36.28), EASYSIMD_FLOAT32_C(   -49.96), EASYSIMD_FLOAT32_C(     6.89), EASYSIMD_FLOAT32_C(   -12.08),
        EASYSIMD_FLOAT32_C(   -26.15), EASYSIMD_FLOAT32_C(    47.41), EASYSIMD_FLOAT32_C(    22.32), EASYSIMD_FLOAT32_C(   -40.32),
        EASYSIMD_FLOAT32_C(   -49.82), EASYSIMD_FLOAT32_C(   -36.85), EASYSIMD_FLOAT32_C(    14.83), EASYSIMD_FLOAT32_C(    19.80),
        EASYSIMD_FLOAT32_C(   -24.39), EASYSIMD_FLOAT32_C(   -14.70), EASYSIMD_FLOAT32_C(     8.75), EASYSIMD_FLOAT32_C(    -2.56) },
      { EASYSIMD_FLOAT32_C(    40.20), EASYSIMD_FLOAT32_C(    11.92), EASYSIMD_FLOAT32_C(   -49.71), EASYSIMD_FLOAT32_C(   -34.38),
        EASYSIMD_FLOAT32_C(   -30.67), EASYSIMD_FLOAT32_C(   -30.67), EASYSIMD_FLOAT32_C(    38.98), EASYSIMD_FLOAT32_C(    46.88),
        EASYSIMD_FLOAT32_C(     4.26), EASYSIMD_FLOAT32_C(    -2.37), EASYSIMD_FLOAT32_C(   -26.28), EASYSIMD_FLOAT32_C(    33.77),
        EASYSIMD_FLOAT32_C(    20.13), EASYSIMD_FLOAT32_C(   -36.53), EASYSIMD_FLOAT32_C(   -45.81), EASYSIMD_FLOAT32_C(    33.85) },
      { EASYSIMD_FLOAT32_C( -1449.83), EASYSIMD_FLOAT32_C(7596932608.00), EASYSIMD_FLOAT32_C(    12.43), EASYSIMD_FLOAT32_C(   372.67),
        EASYSIMD_FLOAT32_C(     7.56), EASYSIMD_FLOAT32_C( -1464.61), EASYSIMD_FLOAT32_C(    -4.63), EASYSIMD_FLOAT32_C( -1852.89),
        EASYSIMD_FLOAT32_C(11287586370748416.00), EASYSIMD_FLOAT32_C(-9137542922240.00), EASYSIMD_FLOAT32_C(  4855.48), EASYSIMD_FLOAT32_C(   -42.75),
        EASYSIMD_FLOAT32_C(   -25.09), EASYSIMD_FLOAT32_C(    25.79), EASYSIMD_FLOAT32_C(  -425.92), EASYSIMD_FLOAT32_C(   -41.21) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 tmp;

    easysimd__m512 src = easysimd_mm512_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd__m512bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm512_loadu_ps(test_vec[i].b);
    easysimd__m512bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m512 r = easysimd_mm512_mask_dpbf16_ps(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x16(r, easysimd_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m512)];
  easysimd_test_x86_random_f32x16_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m512 src = easysimd_test_x86_random_f32x16(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512bh a = HEDLEY_REINTERPRET_CAST(easysimd__m512bh, easysimd_test_x86_random_extract_f32x16(i, 2, 0, values));
    easysimd__m512bh b = HEDLEY_REINTERPRET_CAST(easysimd__m512bh, easysimd_test_x86_random_extract_f32x16(i, 2, 1, values));
    easysimd__m512 r = easysimd_mm512_mask_dpbf16_ps(src, k, a, b);

    easysimd_test_x86_write_f32x16(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, HEDLEY_REINTERPRET_CAST(easysimd__m512, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, HEDLEY_REINTERPRET_CAST(easysimd__m512, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_dpbf16_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask16 k;
    const easysimd_float32 src[16];
    const easysimd_float32 a[16];
    const easysimd_float32 b[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { UINT16_C(25102),
      { EASYSIMD_FLOAT32_C(     1.43), EASYSIMD_FLOAT32_C(   -30.81), EASYSIMD_FLOAT32_C(    21.01), EASYSIMD_FLOAT32_C(   -45.33),
        EASYSIMD_FLOAT32_C(     6.52), EASYSIMD_FLOAT32_C(   -38.24), EASYSIMD_FLOAT32_C(     4.09), EASYSIMD_FLOAT32_C(     7.77),
        EASYSIMD_FLOAT32_C(   -44.96), EASYSIMD_FLOAT32_C(   -14.41), EASYSIMD_FLOAT32_C(    35.98), EASYSIMD_FLOAT32_C(   -36.04),
        EASYSIMD_FLOAT32_C(    23.66), EASYSIMD_FLOAT32_C(    23.77), EASYSIMD_FLOAT32_C(   -21.27), EASYSIMD_FLOAT32_C(   -28.54) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -23.70),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -33.23),
        EASYSIMD_FLOAT32_C(   -40.00), EASYSIMD_FLOAT32_C(   -22.41), EASYSIMD_FLOAT32_C(    -4.46), EASYSIMD_FLOAT32_C(   -27.67),
        EASYSIMD_FLOAT32_C(   -37.26), EASYSIMD_FLOAT32_C(    43.25), EASYSIMD_FLOAT32_C(     1.58), EASYSIMD_FLOAT32_C(   -13.57),
        EASYSIMD_FLOAT32_C(    10.83), EASYSIMD_FLOAT32_C(     1.90), EASYSIMD_FLOAT32_C(     4.95), EASYSIMD_FLOAT32_C(   -37.73) },
      { EASYSIMD_FLOAT32_C(    17.51),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -38.41),
        EASYSIMD_FLOAT32_C(    44.24), EASYSIMD_FLOAT32_C(    47.32), EASYSIMD_FLOAT32_C(     6.73), EASYSIMD_FLOAT32_C(    46.54),
        EASYSIMD_FLOAT32_C(    38.59), EASYSIMD_FLOAT32_C(   -34.53), EASYSIMD_FLOAT32_C(   -15.81), EASYSIMD_FLOAT32_C(   -10.96),
        EASYSIMD_FLOAT32_C(    -0.62), EASYSIMD_FLOAT32_C(   -40.76), EASYSIMD_FLOAT32_C(    -0.94), EASYSIMD_FLOAT32_C(     6.16) },
      { EASYSIMD_FLOAT32_C(     0.00),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(7496008704.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C( -1506.54), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -53.59), EASYSIMD_FLOAT32_C(-6329626.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(44252),
      { EASYSIMD_FLOAT32_C(   -42.44), EASYSIMD_FLOAT32_C(    34.94), EASYSIMD_FLOAT32_C(    47.47), EASYSIMD_FLOAT32_C(   -32.52),
        EASYSIMD_FLOAT32_C(    35.59), EASYSIMD_FLOAT32_C(   -27.88), EASYSIMD_FLOAT32_C(   -38.76), EASYSIMD_FLOAT32_C(    47.61),
        EASYSIMD_FLOAT32_C(   -19.62), EASYSIMD_FLOAT32_C(    46.39), EASYSIMD_FLOAT32_C(   -10.80), EASYSIMD_FLOAT32_C(   -11.07),
        EASYSIMD_FLOAT32_C(    37.92), EASYSIMD_FLOAT32_C(    40.62), EASYSIMD_FLOAT32_C(     8.12), EASYSIMD_FLOAT32_C(     8.93) },
      { EASYSIMD_FLOAT32_C(   -14.47), EASYSIMD_FLOAT32_C(     4.76), EASYSIMD_FLOAT32_C(    22.93), EASYSIMD_FLOAT32_C(    -4.47),
        EASYSIMD_FLOAT32_C(    32.35), EASYSIMD_FLOAT32_C(   -31.52), EASYSIMD_FLOAT32_C(    17.86), EASYSIMD_FLOAT32_C(    45.08),
        EASYSIMD_FLOAT32_C(   -38.27), EASYSIMD_FLOAT32_C(   -30.56), EASYSIMD_FLOAT32_C(   -18.49), EASYSIMD_FLOAT32_C(    22.55),
        EASYSIMD_FLOAT32_C(    21.34), EASYSIMD_FLOAT32_C(    36.46), EASYSIMD_FLOAT32_C(    34.83), EASYSIMD_FLOAT32_C(   -11.15) },
      { EASYSIMD_FLOAT32_C(    -8.35), EASYSIMD_FLOAT32_C(   -45.14), EASYSIMD_FLOAT32_C(     0.43), EASYSIMD_FLOAT32_C(   -14.11),
        EASYSIMD_FLOAT32_C(   -47.81), EASYSIMD_FLOAT32_C(   -42.83), EASYSIMD_FLOAT32_C(   -17.58), EASYSIMD_FLOAT32_C(    40.78),
        EASYSIMD_FLOAT32_C(   -27.36), EASYSIMD_FLOAT32_C(    16.61), EASYSIMD_FLOAT32_C(   -20.18), EASYSIMD_FLOAT32_C(    22.02),
        EASYSIMD_FLOAT32_C(    25.85), EASYSIMD_FLOAT32_C(    28.88), EASYSIMD_FLOAT32_C(   -21.82), EASYSIMD_FLOAT32_C(   -38.62) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(11089674277748736.00), EASYSIMD_FLOAT32_C(    30.32),
        EASYSIMD_FLOAT32_C(15976609750089381969920.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  5025.62), EASYSIMD_FLOAT32_C(  1881.36),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(7416054272.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  1087.34), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT16_C(34951),
      { EASYSIMD_FLOAT32_C(    20.69), EASYSIMD_FLOAT32_C(    -0.61), EASYSIMD_FLOAT32_C(    22.41), EASYSIMD_FLOAT32_C(    25.74),
        EASYSIMD_FLOAT32_C(    34.98), EASYSIMD_FLOAT32_C(     8.39), EASYSIMD_FLOAT32_C(    39.69), EASYSIMD_FLOAT32_C(     8.64),
        EASYSIMD_FLOAT32_C(   -17.84), EASYSIMD_FLOAT32_C(   -31.58), EASYSIMD_FLOAT32_C(    30.10), EASYSIMD_FLOAT32_C(   -45.00),
        EASYSIMD_FLOAT32_C(     6.77), EASYSIMD_FLOAT32_C(    37.66), EASYSIMD_FLOAT32_C(    39.95), EASYSIMD_FLOAT32_C(     4.24) },
      { EASYSIMD_FLOAT32_C(   -16.36), EASYSIMD_FLOAT32_C(   -48.88), EASYSIMD_FLOAT32_C(     6.91), EASYSIMD_FLOAT32_C(   -34.01),
        EASYSIMD_FLOAT32_C(   -30.41), EASYSIMD_FLOAT32_C(   -25.24), EASYSIMD_FLOAT32_C(   -38.93), EASYSIMD_FLOAT32_C(   -18.68),
        EASYSIMD_FLOAT32_C(    -5.80), EASYSIMD_FLOAT32_C(    -7.41), EASYSIMD_FLOAT32_C(   -46.13), EASYSIMD_FLOAT32_C(   -34.46),
        EASYSIMD_FLOAT32_C(   -20.95), EASYSIMD_FLOAT32_C(    38.70), EASYSIMD_FLOAT32_C(     4.39), EASYSIMD_FLOAT32_C(    20.69) },
      { EASYSIMD_FLOAT32_C(    43.56), EASYSIMD_FLOAT32_C(   -45.18), EASYSIMD_FLOAT32_C(   -43.42), EASYSIMD_FLOAT32_C(    45.75),
        EASYSIMD_FLOAT32_C(   -38.01), EASYSIMD_FLOAT32_C(   -10.99), EASYSIMD_FLOAT32_C(    36.53), EASYSIMD_FLOAT32_C(   -15.37),
        EASYSIMD_FLOAT32_C(   -44.38), EASYSIMD_FLOAT32_C(   -33.64), EASYSIMD_FLOAT32_C(   -43.35), EASYSIMD_FLOAT32_C(    31.46),
        EASYSIMD_FLOAT32_C(    45.24), EASYSIMD_FLOAT32_C(   -15.17), EASYSIMD_FLOAT32_C(    42.84), EASYSIMD_FLOAT32_C(   -21.12) },
      { EASYSIMD_FLOAT32_C(-13567093877453619200.00), EASYSIMD_FLOAT32_C(  2193.14), EASYSIMD_FLOAT32_C(  -276.29), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  3986.41),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -428.88) } },
    { UINT16_C(61694),
      { EASYSIMD_FLOAT32_C(    26.35), EASYSIMD_FLOAT32_C(   -33.63), EASYSIMD_FLOAT32_C(    23.15), EASYSIMD_FLOAT32_C(   -43.27),
        EASYSIMD_FLOAT32_C(   -37.24), EASYSIMD_FLOAT32_C(   -37.65), EASYSIMD_FLOAT32_C(    -4.34), EASYSIMD_FLOAT32_C(   -49.32),
        EASYSIMD_FLOAT32_C(   -47.03), EASYSIMD_FLOAT32_C(   -46.22), EASYSIMD_FLOAT32_C(     9.61), EASYSIMD_FLOAT32_C(    48.27),
        EASYSIMD_FLOAT32_C(   -31.58), EASYSIMD_FLOAT32_C(   -19.69), EASYSIMD_FLOAT32_C(    -2.34), EASYSIMD_FLOAT32_C(    40.84) },
      { EASYSIMD_FLOAT32_C(   -14.05), EASYSIMD_FLOAT32_C(    -0.25), EASYSIMD_FLOAT32_C(    -5.13), EASYSIMD_FLOAT32_C(     5.54),
        EASYSIMD_FLOAT32_C(    24.51), EASYSIMD_FLOAT32_C(     5.94), EASYSIMD_FLOAT32_C(    36.86), EASYSIMD_FLOAT32_C(   -31.28),
        EASYSIMD_FLOAT32_C(    48.52), EASYSIMD_FLOAT32_C(    40.73), EASYSIMD_FLOAT32_C(   -15.74), EASYSIMD_FLOAT32_C(   -22.43),
        EASYSIMD_FLOAT32_C(    29.44), EASYSIMD_FLOAT32_C(    38.65), EASYSIMD_FLOAT32_C(    48.26), EASYSIMD_FLOAT32_C(    23.00) },
      { EASYSIMD_FLOAT32_C(    43.47), EASYSIMD_FLOAT32_C(   -45.15), EASYSIMD_FLOAT32_C(    18.75), EASYSIMD_FLOAT32_C(   -44.54),
        EASYSIMD_FLOAT32_C(    -6.15), EASYSIMD_FLOAT32_C(     5.29), EASYSIMD_FLOAT32_C(    -9.91), EASYSIMD_FLOAT32_C(    -0.53),
        EASYSIMD_FLOAT32_C(    21.64), EASYSIMD_FLOAT32_C(    -3.27), EASYSIMD_FLOAT32_C(   -19.07), EASYSIMD_FLOAT32_C(    16.88),
        EASYSIMD_FLOAT32_C(    31.57), EASYSIMD_FLOAT32_C(   -26.23), EASYSIMD_FLOAT32_C(    45.76), EASYSIMD_FLOAT32_C(   -32.49) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -22.38), EASYSIMD_FLOAT32_C(   -72.94), EASYSIMD_FLOAT32_C(  -289.41),
        EASYSIMD_FLOAT32_C(  -187.30), EASYSIMD_FLOAT32_C(    -6.29), EASYSIMD_FLOAT32_C(  -371.65), EASYSIMD_FLOAT32_C(   -32.84),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(   893.73), EASYSIMD_FLOAT32_C( -1025.50), EASYSIMD_FLOAT32_C(  2205.10), EASYSIMD_FLOAT32_C(  -700.91) } },
    { UINT16_C( 6707),
      { EASYSIMD_FLOAT32_C(    -0.77), EASYSIMD_FLOAT32_C(    45.73), EASYSIMD_FLOAT32_C(    41.28), EASYSIMD_FLOAT32_C(    31.39),
        EASYSIMD_FLOAT32_C(   -35.85), EASYSIMD_FLOAT32_C(    21.38), EASYSIMD_FLOAT32_C(    36.39), EASYSIMD_FLOAT32_C(    20.92),
        EASYSIMD_FLOAT32_C(     9.04), EASYSIMD_FLOAT32_C(    26.34), EASYSIMD_FLOAT32_C(   -24.84), EASYSIMD_FLOAT32_C(    14.18),
        EASYSIMD_FLOAT32_C(     1.88), EASYSIMD_FLOAT32_C(   -48.49), EASYSIMD_FLOAT32_C(    30.55), EASYSIMD_FLOAT32_C(   -24.97) },
      { EASYSIMD_FLOAT32_C(    23.52), EASYSIMD_FLOAT32_C(    -9.37), EASYSIMD_FLOAT32_C(    23.05), EASYSIMD_FLOAT32_C(    -1.96),
        EASYSIMD_FLOAT32_C(    46.56), EASYSIMD_FLOAT32_C(     9.91), EASYSIMD_FLOAT32_C(    16.75), EASYSIMD_FLOAT32_C(    45.08),
        EASYSIMD_FLOAT32_C(     0.65), EASYSIMD_FLOAT32_C(   -48.99), EASYSIMD_FLOAT32_C(   -27.35), EASYSIMD_FLOAT32_C(   -19.92),
        EASYSIMD_FLOAT32_C(    39.66), EASYSIMD_FLOAT32_C(   -29.08), EASYSIMD_FLOAT32_C(   -46.92), EASYSIMD_FLOAT32_C(    33.13) },
      { EASYSIMD_FLOAT32_C(   -24.24), EASYSIMD_FLOAT32_C(    21.84), EASYSIMD_FLOAT32_C(    38.59), EASYSIMD_FLOAT32_C(    19.62),
        EASYSIMD_FLOAT32_C(   -22.88), EASYSIMD_FLOAT32_C(   -21.33), EASYSIMD_FLOAT32_C(   -30.91), EASYSIMD_FLOAT32_C(    48.77),
        EASYSIMD_FLOAT32_C(    25.40), EASYSIMD_FLOAT32_C(     0.02), EASYSIMD_FLOAT32_C(    15.65), EASYSIMD_FLOAT32_C(     6.97),
        EASYSIMD_FLOAT32_C(    23.79), EASYSIMD_FLOAT32_C(    11.41), EASYSIMD_FLOAT32_C(    24.48), EASYSIMD_FLOAT32_C(    -2.69) },
      { EASYSIMD_FLOAT32_C(-8782671249408.00), EASYSIMD_FLOAT32_C(16100548811834618019840.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C( -1099.54), EASYSIMD_FLOAT32_C(  -188.46), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -124.32),
        EASYSIMD_FLOAT32_C(   940.01), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(38880),
      { EASYSIMD_FLOAT32_C(   -12.62), EASYSIMD_FLOAT32_C(     3.90), EASYSIMD_FLOAT32_C(    43.99), EASYSIMD_FLOAT32_C(    -9.65),
        EASYSIMD_FLOAT32_C(     7.69), EASYSIMD_FLOAT32_C(     3.60), EASYSIMD_FLOAT32_C(   -11.38), EASYSIMD_FLOAT32_C(    26.11),
        EASYSIMD_FLOAT32_C(    33.91), EASYSIMD_FLOAT32_C(    36.28), EASYSIMD_FLOAT32_C(    16.95), EASYSIMD_FLOAT32_C(    39.95),
        EASYSIMD_FLOAT32_C(   -31.09), EASYSIMD_FLOAT32_C(   -33.82), EASYSIMD_FLOAT32_C(    35.68), EASYSIMD_FLOAT32_C(   -39.81) },
      { EASYSIMD_FLOAT32_C(   -47.97), EASYSIMD_FLOAT32_C(    -2.47), EASYSIMD_FLOAT32_C(    45.35), EASYSIMD_FLOAT32_C(    48.59),
        EASYSIMD_FLOAT32_C(   -42.55), EASYSIMD_FLOAT32_C(    12.10), EASYSIMD_FLOAT32_C(    43.68), EASYSIMD_FLOAT32_C(     8.09),
        EASYSIMD_FLOAT32_C(    13.12), EASYSIMD_FLOAT32_C(   -33.67), EASYSIMD_FLOAT32_C(    38.18), EASYSIMD_FLOAT32_C(     2.78),
        EASYSIMD_FLOAT32_C(   -12.75), EASYSIMD_FLOAT32_C(    41.26), EASYSIMD_FLOAT32_C(   -14.10), EASYSIMD_FLOAT32_C(    13.01) },
      { EASYSIMD_FLOAT32_C(    13.10), EASYSIMD_FLOAT32_C(   -25.51), EASYSIMD_FLOAT32_C(   -17.37), EASYSIMD_FLOAT32_C(    40.23),
        EASYSIMD_FLOAT32_C(     3.16), EASYSIMD_FLOAT32_C(     1.71), EASYSIMD_FLOAT32_C(    38.99), EASYSIMD_FLOAT32_C(   -21.44),
        EASYSIMD_FLOAT32_C(   -48.27), EASYSIMD_FLOAT32_C(     4.64), EASYSIMD_FLOAT32_C(    35.53), EASYSIMD_FLOAT32_C(    25.52),
        EASYSIMD_FLOAT32_C(   -33.95), EASYSIMD_FLOAT32_C(    10.01), EASYSIMD_FLOAT32_C(   -27.17), EASYSIMD_FLOAT32_C(   -31.92) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    24.15), EASYSIMD_FLOAT32_C(24752756156609532352108953600.00), EASYSIMD_FLOAT32_C(  -146.23),
        EASYSIMD_FLOAT32_C(  -600.43), EASYSIMD_FLOAT32_C(-19656850484944898202009600.00), EASYSIMD_FLOAT32_C(  1365.95), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(   399.22), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  4742.56) } },
    { UINT16_C(   71),
      { EASYSIMD_FLOAT32_C(    31.57), EASYSIMD_FLOAT32_C(    33.96), EASYSIMD_FLOAT32_C(    20.76), EASYSIMD_FLOAT32_C(    -9.39),
        EASYSIMD_FLOAT32_C(    10.30), EASYSIMD_FLOAT32_C(    45.92), EASYSIMD_FLOAT32_C(   -45.22), EASYSIMD_FLOAT32_C(   -37.82),
        EASYSIMD_FLOAT32_C(    47.43), EASYSIMD_FLOAT32_C(    35.33), EASYSIMD_FLOAT32_C(   -12.79), EASYSIMD_FLOAT32_C(   -44.33),
        EASYSIMD_FLOAT32_C(    28.64), EASYSIMD_FLOAT32_C(    24.59), EASYSIMD_FLOAT32_C(     9.58), EASYSIMD_FLOAT32_C(    22.63) },
      { EASYSIMD_FLOAT32_C(   -42.45), EASYSIMD_FLOAT32_C(   -31.82), EASYSIMD_FLOAT32_C(   -33.33), EASYSIMD_FLOAT32_C(   -35.00),
        EASYSIMD_FLOAT32_C(    30.28), EASYSIMD_FLOAT32_C(   -39.65), EASYSIMD_FLOAT32_C(    23.09), EASYSIMD_FLOAT32_C(    -6.60),
        EASYSIMD_FLOAT32_C(   -23.32), EASYSIMD_FLOAT32_C(    11.27), EASYSIMD_FLOAT32_C(    46.18), EASYSIMD_FLOAT32_C(    13.93),
        EASYSIMD_FLOAT32_C(     2.53), EASYSIMD_FLOAT32_C(   -17.92), EASYSIMD_FLOAT32_C(   -23.05), EASYSIMD_FLOAT32_C(   -34.37) },
      { EASYSIMD_FLOAT32_C(     6.57), EASYSIMD_FLOAT32_C(     9.58), EASYSIMD_FLOAT32_C(   -44.14), EASYSIMD_FLOAT32_C(   -40.27),
        EASYSIMD_FLOAT32_C(   -38.71), EASYSIMD_FLOAT32_C(    44.85), EASYSIMD_FLOAT32_C(   -11.71), EASYSIMD_FLOAT32_C(   -36.98),
        EASYSIMD_FLOAT32_C(    -0.51), EASYSIMD_FLOAT32_C(   -26.17), EASYSIMD_FLOAT32_C(    38.55), EASYSIMD_FLOAT32_C(    15.54),
        EASYSIMD_FLOAT32_C(    33.84), EASYSIMD_FLOAT32_C(   -38.62), EASYSIMD_FLOAT32_C(    33.61), EASYSIMD_FLOAT32_C(    41.39) },
      { EASYSIMD_FLOAT32_C(-6324086.00), EASYSIMD_FLOAT32_C(  -269.65), EASYSIMD_FLOAT32_C(  1483.76), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-9526774333440.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(59587),
      { EASYSIMD_FLOAT32_C(   -45.42), EASYSIMD_FLOAT32_C(    42.16), EASYSIMD_FLOAT32_C(     5.68), EASYSIMD_FLOAT32_C(    -0.26),
        EASYSIMD_FLOAT32_C(   -46.36), EASYSIMD_FLOAT32_C(   -11.42), EASYSIMD_FLOAT32_C(   -15.73), EASYSIMD_FLOAT32_C(    11.63),
        EASYSIMD_FLOAT32_C(    -5.26), EASYSIMD_FLOAT32_C(    -0.56), EASYSIMD_FLOAT32_C(   -49.45), EASYSIMD_FLOAT32_C(    24.59),
        EASYSIMD_FLOAT32_C(   -19.00), EASYSIMD_FLOAT32_C(   -26.80), EASYSIMD_FLOAT32_C(    24.80), EASYSIMD_FLOAT32_C(    -0.28) },
      { EASYSIMD_FLOAT32_C(    -6.13), EASYSIMD_FLOAT32_C(   -49.62), EASYSIMD_FLOAT32_C(   -41.61), EASYSIMD_FLOAT32_C(   -31.99),
        EASYSIMD_FLOAT32_C(   -37.47), EASYSIMD_FLOAT32_C(   -37.25), EASYSIMD_FLOAT32_C(   -45.75), EASYSIMD_FLOAT32_C(    31.81),
        EASYSIMD_FLOAT32_C(   -17.76), EASYSIMD_FLOAT32_C(   -41.55), EASYSIMD_FLOAT32_C(   -13.04), EASYSIMD_FLOAT32_C(   -42.15),
        EASYSIMD_FLOAT32_C(   -45.33), EASYSIMD_FLOAT32_C(    21.28), EASYSIMD_FLOAT32_C(   -37.89), EASYSIMD_FLOAT32_C(   -14.13) },
      { EASYSIMD_FLOAT32_C(   -30.66), EASYSIMD_FLOAT32_C(   -21.01), EASYSIMD_FLOAT32_C(    -0.44), EASYSIMD_FLOAT32_C(   -30.95),
        EASYSIMD_FLOAT32_C(    40.55), EASYSIMD_FLOAT32_C(    15.98), EASYSIMD_FLOAT32_C(   -42.19), EASYSIMD_FLOAT32_C(   -49.08),
        EASYSIMD_FLOAT32_C(    -4.67), EASYSIMD_FLOAT32_C(   -36.17), EASYSIMD_FLOAT32_C(    15.56), EASYSIMD_FLOAT32_C(    -8.78),
        EASYSIMD_FLOAT32_C(   -46.32), EASYSIMD_FLOAT32_C(   -45.14), EASYSIMD_FLOAT32_C(    -7.85), EASYSIMD_FLOAT32_C(    -2.45) },
      { EASYSIMD_FLOAT32_C(   142.16), EASYSIMD_FLOAT32_C(7402292224.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  1905.77),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-9301288550400.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -983.05), EASYSIMD_FLOAT32_C(   320.90), EASYSIMD_FLOAT32_C(    34.15) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 tmp;

    easysimd__m512 src = easysimd_mm512_loadu_ps(test_vec[i].src);

    tmp = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd__m512bh a;
    easysimd_memcpy(&a, &tmp, sizeof(tmp));

    tmp = easysimd_mm512_loadu_ps(test_vec[i].b);
    easysimd__m512bh b;
    easysimd_memcpy(&b, &tmp, sizeof(tmp));

    easysimd__m512 r = easysimd_mm512_maskz_dpbf16_ps(test_vec[i].k, src, a, b);
    easysimd_test_x86_assert_equal_f32x16(r, easysimd_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m512)];
  easysimd_test_x86_random_f32x16_full(8, 2, values, -50.0f, 50.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512 src = easysimd_test_x86_random_f32x16(EASYSIMD_FLOAT32_C(-50.0), EASYSIMD_FLOAT32_C(50.0));
    easysimd__m512bh a = HEDLEY_REINTERPRET_CAST(easysimd__m512bh, easysimd_test_x86_random_extract_f32x16(i, 2, 0, values));
    easysimd__m512bh b = HEDLEY_REINTERPRET_CAST(easysimd__m512bh, easysimd_test_x86_random_extract_f32x16(i, 2, 1, values));
    easysimd__m512 r = easysimd_mm512_maskz_dpbf16_ps(k, src, a, b);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x16(2, src, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, HEDLEY_REINTERPRET_CAST(easysimd__m512, a), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, HEDLEY_REINTERPRET_CAST(easysimd__m512, b), EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

EASYSIMD_TEST_FUNC_LIST_BEGIN
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_mask_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_mask_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_mask_dpbf16_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_dpbf16_ps)
EASYSIMD_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
