#define EASYSIMD_TEST_X86_AVX512_INSN scalef

#include <test/x86/avx512/test-avx512.h>
#include <easysimd/x86/avx512/scalef.h>

static int
test_easysimd_mm_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -574.44),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   524.22) },
      { EASYSIMD_FLOAT32_C(   500.85),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   876.76) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   919.28), EASYSIMD_FLOAT32_C(  -131.68), EASYSIMD_FLOAT32_C(  -977.50), EASYSIMD_FLOAT32_C(  -661.80) },
      { EASYSIMD_FLOAT32_C(   737.41), EASYSIMD_FLOAT32_C(  -540.20), EASYSIMD_FLOAT32_C(   308.25), EASYSIMD_FLOAT32_C(   444.32) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(     0.37), EASYSIMD_FLOAT32_C(   498.31), EASYSIMD_FLOAT32_C(    33.05), EASYSIMD_FLOAT32_C(  -256.10) },
      { EASYSIMD_FLOAT32_C(  -472.78), EASYSIMD_FLOAT32_C(  -591.57), EASYSIMD_FLOAT32_C(    -2.46), EASYSIMD_FLOAT32_C(  -254.61) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     4.13), EASYSIMD_FLOAT32_C(    -0.00) } },
    { { EASYSIMD_FLOAT32_C(   931.71), EASYSIMD_FLOAT32_C(  -418.21), EASYSIMD_FLOAT32_C(   348.08), EASYSIMD_FLOAT32_C(   395.26) },
      { EASYSIMD_FLOAT32_C(  -506.53), EASYSIMD_FLOAT32_C(    75.82), EASYSIMD_FLOAT32_C(   809.38), EASYSIMD_FLOAT32_C(   887.05) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-15799526771589293308641280.00),      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   501.38), EASYSIMD_FLOAT32_C(   -77.34), EASYSIMD_FLOAT32_C(   411.27), EASYSIMD_FLOAT32_C(     2.23) },
      { EASYSIMD_FLOAT32_C(   996.51), EASYSIMD_FLOAT32_C(   522.28), EASYSIMD_FLOAT32_C(  -121.01), EASYSIMD_FLOAT32_C(   915.79) },
      {      EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(  -609.41), EASYSIMD_FLOAT32_C(   -98.51), EASYSIMD_FLOAT32_C(  -746.01), EASYSIMD_FLOAT32_C(  -872.00) },
      { EASYSIMD_FLOAT32_C(   361.29), EASYSIMD_FLOAT32_C(   562.24), EASYSIMD_FLOAT32_C(   572.32), EASYSIMD_FLOAT32_C(  -638.34) },
      {     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00) } },
    { { EASYSIMD_FLOAT32_C(    60.55), EASYSIMD_FLOAT32_C(  -394.64), EASYSIMD_FLOAT32_C(   105.57), EASYSIMD_FLOAT32_C(   587.77) },
      { EASYSIMD_FLOAT32_C(    13.80), EASYSIMD_FLOAT32_C(  -896.90), EASYSIMD_FLOAT32_C(  -666.83), EASYSIMD_FLOAT32_C(   -54.49) },
      { EASYSIMD_FLOAT32_C(496025.59), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(  -315.11), EASYSIMD_FLOAT32_C(   681.24), EASYSIMD_FLOAT32_C(  -659.23), EASYSIMD_FLOAT32_C(   178.37) },
      { EASYSIMD_FLOAT32_C(  -242.94), EASYSIMD_FLOAT32_C(  -849.85), EASYSIMD_FLOAT32_C(    65.41), EASYSIMD_FLOAT32_C(  -741.55) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-24321293470847155044352.00), EASYSIMD_FLOAT32_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 a = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128 b = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128 r = easysimd_mm_scalef_ps(a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128 a = easysimd_test_x86_random_extract_f32x4(i, 2, 0, values);
    easysimd__m128 b = easysimd_test_x86_random_extract_f32x4(i, 2, 1, values);
    easysimd__m128 r = easysimd_mm_scalef_ps(a, b);

    easysimd_test_x86_write_f32x4(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_mask_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[4];
    const easysimd__mmask8 k;
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(   510.80), EASYSIMD_FLOAT32_C(    70.72), EASYSIMD_FLOAT32_C(  -240.36), EASYSIMD_FLOAT32_C(   667.59) },
      UINT8_C(167),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   120.08),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   803.63) },
      { EASYSIMD_FLOAT32_C(  -971.21),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -397.24) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   667.59) } },
    { { EASYSIMD_FLOAT32_C(  -527.36), EASYSIMD_FLOAT32_C(   207.05), EASYSIMD_FLOAT32_C(   888.57), EASYSIMD_FLOAT32_C(   676.31) },
      UINT8_C(209),
      { EASYSIMD_FLOAT32_C(   382.67), EASYSIMD_FLOAT32_C(  -251.21), EASYSIMD_FLOAT32_C(   490.66), EASYSIMD_FLOAT32_C(   276.18) },
      { EASYSIMD_FLOAT32_C(  -493.35), EASYSIMD_FLOAT32_C(   664.91), EASYSIMD_FLOAT32_C(  -894.03), EASYSIMD_FLOAT32_C(  -245.08) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   207.05), EASYSIMD_FLOAT32_C(   888.57), EASYSIMD_FLOAT32_C(   676.31) } },
    { { EASYSIMD_FLOAT32_C(   178.54), EASYSIMD_FLOAT32_C(  -455.11), EASYSIMD_FLOAT32_C(   -55.71), EASYSIMD_FLOAT32_C(   223.43) },
      UINT8_C(149),
      { EASYSIMD_FLOAT32_C(   651.73), EASYSIMD_FLOAT32_C(   452.73), EASYSIMD_FLOAT32_C(   119.59), EASYSIMD_FLOAT32_C(  -408.37) },
      { EASYSIMD_FLOAT32_C(   720.80), EASYSIMD_FLOAT32_C(   390.12), EASYSIMD_FLOAT32_C(   263.08), EASYSIMD_FLOAT32_C(   973.63) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -455.11),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   223.43) } },
    { { EASYSIMD_FLOAT32_C(   318.63), EASYSIMD_FLOAT32_C(  -612.09), EASYSIMD_FLOAT32_C(  -822.85), EASYSIMD_FLOAT32_C(   413.77) },
      UINT8_C( 59),
      { EASYSIMD_FLOAT32_C(  -230.03), EASYSIMD_FLOAT32_C(  -651.76), EASYSIMD_FLOAT32_C(  -462.21), EASYSIMD_FLOAT32_C(   420.82) },
      { EASYSIMD_FLOAT32_C(   320.60), EASYSIMD_FLOAT32_C(   961.38), EASYSIMD_FLOAT32_C(  -871.21), EASYSIMD_FLOAT32_C(   611.61) },
      {     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -822.85),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(  -447.83), EASYSIMD_FLOAT32_C(   482.54), EASYSIMD_FLOAT32_C(  -732.93), EASYSIMD_FLOAT32_C(   275.44) },
      UINT8_C(204),
      { EASYSIMD_FLOAT32_C(    81.46), EASYSIMD_FLOAT32_C(  -363.38), EASYSIMD_FLOAT32_C(   415.25), EASYSIMD_FLOAT32_C(   110.24) },
      { EASYSIMD_FLOAT32_C(  -843.21), EASYSIMD_FLOAT32_C(  -965.47), EASYSIMD_FLOAT32_C(   713.00), EASYSIMD_FLOAT32_C(   539.46) },
      { EASYSIMD_FLOAT32_C(  -447.83), EASYSIMD_FLOAT32_C(   482.54),      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(    12.45), EASYSIMD_FLOAT32_C(   319.29), EASYSIMD_FLOAT32_C(  -342.96), EASYSIMD_FLOAT32_C(   886.63) },
      UINT8_C( 98),
      { EASYSIMD_FLOAT32_C(  -216.68), EASYSIMD_FLOAT32_C(   203.67), EASYSIMD_FLOAT32_C(  -184.36), EASYSIMD_FLOAT32_C(   289.97) },
      { EASYSIMD_FLOAT32_C(  -131.42), EASYSIMD_FLOAT32_C(   -78.39), EASYSIMD_FLOAT32_C(  -955.11), EASYSIMD_FLOAT32_C(  -479.68) },
      { EASYSIMD_FLOAT32_C(    12.45), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -342.96), EASYSIMD_FLOAT32_C(   886.63) } },
    { { EASYSIMD_FLOAT32_C(  -693.57), EASYSIMD_FLOAT32_C(   397.43), EASYSIMD_FLOAT32_C(  -954.51), EASYSIMD_FLOAT32_C(    66.07) },
      UINT8_C(115),
      { EASYSIMD_FLOAT32_C(  -625.66), EASYSIMD_FLOAT32_C(   164.48), EASYSIMD_FLOAT32_C(   111.94), EASYSIMD_FLOAT32_C(  -904.86) },
      { EASYSIMD_FLOAT32_C(  -445.41), EASYSIMD_FLOAT32_C(  -624.98), EASYSIMD_FLOAT32_C(  -931.23), EASYSIMD_FLOAT32_C(   324.57) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -954.51), EASYSIMD_FLOAT32_C(    66.07) } },
    { { EASYSIMD_FLOAT32_C(   150.74), EASYSIMD_FLOAT32_C(   538.71), EASYSIMD_FLOAT32_C(  -727.93), EASYSIMD_FLOAT32_C(    39.30) },
      UINT8_C(225),
      { EASYSIMD_FLOAT32_C(  -276.74), EASYSIMD_FLOAT32_C(  -393.44), EASYSIMD_FLOAT32_C(  -254.61), EASYSIMD_FLOAT32_C(  -956.14) },
      { EASYSIMD_FLOAT32_C(  -432.06), EASYSIMD_FLOAT32_C(  -125.82), EASYSIMD_FLOAT32_C(   655.47), EASYSIMD_FLOAT32_C(   649.39) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   538.71), EASYSIMD_FLOAT32_C(  -727.93), EASYSIMD_FLOAT32_C(    39.30) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 src = easysimd_mm_loadu_ps(test_vec[i].src);
    easysimd__m128 a = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128 b = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128 r = easysimd_mm_mask_scalef_ps(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128 src = easysimd_test_x86_random_f32x4(EASYSIMD_FLOAT32_C(-1000.0), EASYSIMD_FLOAT32_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128 a = easysimd_test_x86_random_extract_f32x4(i, 2, 0, values);
    easysimd__m128 b = easysimd_test_x86_random_extract_f32x4(i, 2, 1, values);
    easysimd__m128 r = easysimd_mm_mask_scalef_ps(src, k, a, b);

    easysimd_test_x86_write_f32x4(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { UINT8_C(  8),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -782.16),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   239.05) },
      { EASYSIMD_FLOAT32_C(   441.27),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   829.17) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT8_C(212),
      { EASYSIMD_FLOAT32_C(     2.27), EASYSIMD_FLOAT32_C(   971.45), EASYSIMD_FLOAT32_C(  -228.33), EASYSIMD_FLOAT32_C(   554.45) },
      { EASYSIMD_FLOAT32_C(   453.99), EASYSIMD_FLOAT32_C(    38.74), EASYSIMD_FLOAT32_C(  -170.12), EASYSIMD_FLOAT32_C(   543.09) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(142),
      { EASYSIMD_FLOAT32_C(  -948.81), EASYSIMD_FLOAT32_C(  -850.82), EASYSIMD_FLOAT32_C(  -799.87), EASYSIMD_FLOAT32_C(   937.82) },
      { EASYSIMD_FLOAT32_C(   123.94), EASYSIMD_FLOAT32_C(  -493.44), EASYSIMD_FLOAT32_C(   335.26), EASYSIMD_FLOAT32_C(   169.43) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF } },
    { UINT8_C( 34),
      { EASYSIMD_FLOAT32_C(   572.63), EASYSIMD_FLOAT32_C(  -599.72), EASYSIMD_FLOAT32_C(  -679.83), EASYSIMD_FLOAT32_C(   111.33) },
      { EASYSIMD_FLOAT32_C(  -327.65), EASYSIMD_FLOAT32_C(   359.47), EASYSIMD_FLOAT32_C(  -673.65), EASYSIMD_FLOAT32_C(   -32.89) },
      { EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(185),
      { EASYSIMD_FLOAT32_C(   577.31), EASYSIMD_FLOAT32_C(  -913.73), EASYSIMD_FLOAT32_C(  -793.84), EASYSIMD_FLOAT32_C(    18.58) },
      { EASYSIMD_FLOAT32_C(   -88.61), EASYSIMD_FLOAT32_C(  -236.15), EASYSIMD_FLOAT32_C(  -152.25), EASYSIMD_FLOAT32_C(   913.66) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT8_C(110),
      { EASYSIMD_FLOAT32_C(  -264.70), EASYSIMD_FLOAT32_C(   619.42), EASYSIMD_FLOAT32_C(   468.11), EASYSIMD_FLOAT32_C(  -810.71) },
      { EASYSIMD_FLOAT32_C(  -341.84), EASYSIMD_FLOAT32_C(  -702.01), EASYSIMD_FLOAT32_C(   732.39), EASYSIMD_FLOAT32_C(  -290.65) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00) } },
    { UINT8_C( 76),
      { EASYSIMD_FLOAT32_C(  -552.83), EASYSIMD_FLOAT32_C(   932.51), EASYSIMD_FLOAT32_C(  -352.83), EASYSIMD_FLOAT32_C(   571.11) },
      { EASYSIMD_FLOAT32_C(  -560.93), EASYSIMD_FLOAT32_C(   982.43), EASYSIMD_FLOAT32_C(  -259.45), EASYSIMD_FLOAT32_C(  -988.30) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(172),
      { EASYSIMD_FLOAT32_C(  -617.29), EASYSIMD_FLOAT32_C(    60.71), EASYSIMD_FLOAT32_C(   123.03), EASYSIMD_FLOAT32_C(    55.06) },
      { EASYSIMD_FLOAT32_C(  -579.82), EASYSIMD_FLOAT32_C(   449.39), EASYSIMD_FLOAT32_C(  -977.83), EASYSIMD_FLOAT32_C(   997.49) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 a = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128 b = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128 r = easysimd_mm_maskz_scalef_ps(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128 a = easysimd_test_x86_random_extract_f32x4(i, 2, 0, values);
    easysimd__m128 b = easysimd_test_x86_random_extract_f32x4(i, 2, 1, values);
    easysimd__m128 r = easysimd_mm_maskz_scalef_ps(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 a[8];
    const easysimd_float32 b[8];
    const easysimd_float32 r[8];
  } test_vec[] = {
    { {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    39.06),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   879.22),
        EASYSIMD_FLOAT32_C(   799.85), EASYSIMD_FLOAT32_C(    98.16), EASYSIMD_FLOAT32_C(   360.53), EASYSIMD_FLOAT32_C(   817.25) },
      { EASYSIMD_FLOAT32_C(   981.76),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -177.33),
        EASYSIMD_FLOAT32_C(  -885.94), EASYSIMD_FLOAT32_C(   138.17), EASYSIMD_FLOAT32_C(   764.91), EASYSIMD_FLOAT32_C(  -195.41) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(   860.80), EASYSIMD_FLOAT32_C(  -750.11), EASYSIMD_FLOAT32_C(  -210.97), EASYSIMD_FLOAT32_C(   614.29),
        EASYSIMD_FLOAT32_C(   913.44), EASYSIMD_FLOAT32_C(   400.13), EASYSIMD_FLOAT32_C(   801.72), EASYSIMD_FLOAT32_C(   828.58) },
      { EASYSIMD_FLOAT32_C(  -995.54), EASYSIMD_FLOAT32_C(   953.74), EASYSIMD_FLOAT32_C(   674.22), EASYSIMD_FLOAT32_C(   219.06),
        EASYSIMD_FLOAT32_C(   633.43), EASYSIMD_FLOAT32_C(  -596.99), EASYSIMD_FLOAT32_C(  -149.83), EASYSIMD_FLOAT32_C(  -755.25) },
      { EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(   442.07), EASYSIMD_FLOAT32_C(   493.98), EASYSIMD_FLOAT32_C(  -876.03), EASYSIMD_FLOAT32_C(   241.92),
        EASYSIMD_FLOAT32_C(  -407.86), EASYSIMD_FLOAT32_C(   484.50), EASYSIMD_FLOAT32_C(    59.17), EASYSIMD_FLOAT32_C(  -426.10) },
      { EASYSIMD_FLOAT32_C(  -934.67), EASYSIMD_FLOAT32_C(   908.49), EASYSIMD_FLOAT32_C(   396.57), EASYSIMD_FLOAT32_C(  -820.61),
        EASYSIMD_FLOAT32_C(    46.66), EASYSIMD_FLOAT32_C(   161.48), EASYSIMD_FLOAT32_C(   -16.02), EASYSIMD_FLOAT32_C(   -92.54) },
      { EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(-28700594969509888.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00) } },
    { { EASYSIMD_FLOAT32_C(   411.36), EASYSIMD_FLOAT32_C(   773.01), EASYSIMD_FLOAT32_C(  -478.24), EASYSIMD_FLOAT32_C(   324.81),
        EASYSIMD_FLOAT32_C(   173.14), EASYSIMD_FLOAT32_C(  -676.52), EASYSIMD_FLOAT32_C(   153.39), EASYSIMD_FLOAT32_C(   177.60) },
      { EASYSIMD_FLOAT32_C(  -722.78), EASYSIMD_FLOAT32_C(  -172.39), EASYSIMD_FLOAT32_C(  -603.34), EASYSIMD_FLOAT32_C(   910.65),
        EASYSIMD_FLOAT32_C(   230.62), EASYSIMD_FLOAT32_C(   246.83), EASYSIMD_FLOAT32_C(  -844.60), EASYSIMD_FLOAT32_C(  -327.31) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(  -259.19), EASYSIMD_FLOAT32_C(  -720.63), EASYSIMD_FLOAT32_C(   914.61), EASYSIMD_FLOAT32_C(   332.96),
        EASYSIMD_FLOAT32_C(   763.88), EASYSIMD_FLOAT32_C(   -26.22), EASYSIMD_FLOAT32_C(   906.86), EASYSIMD_FLOAT32_C(   829.21) },
      { EASYSIMD_FLOAT32_C(  -117.73), EASYSIMD_FLOAT32_C(   303.42), EASYSIMD_FLOAT32_C(  -991.40), EASYSIMD_FLOAT32_C(   928.93),
        EASYSIMD_FLOAT32_C(  -535.10), EASYSIMD_FLOAT32_C(    -7.42), EASYSIMD_FLOAT32_C(  -163.61), EASYSIMD_FLOAT32_C(   876.26) },
      { EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.10), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(  -234.41), EASYSIMD_FLOAT32_C(   358.15), EASYSIMD_FLOAT32_C(   201.07), EASYSIMD_FLOAT32_C(   938.74),
        EASYSIMD_FLOAT32_C(   681.63), EASYSIMD_FLOAT32_C(  -645.54), EASYSIMD_FLOAT32_C(   116.33), EASYSIMD_FLOAT32_C(   958.85) },
      { EASYSIMD_FLOAT32_C(   182.07), EASYSIMD_FLOAT32_C(   513.00), EASYSIMD_FLOAT32_C(   869.50), EASYSIMD_FLOAT32_C(  -587.31),
        EASYSIMD_FLOAT32_C(  -240.17), EASYSIMD_FLOAT32_C(  -975.09), EASYSIMD_FLOAT32_C(    85.37), EASYSIMD_FLOAT32_C(   500.64) },
      {     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(4500298969900131223638900736.00),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(  -695.72), EASYSIMD_FLOAT32_C(    -0.02), EASYSIMD_FLOAT32_C(  -166.40), EASYSIMD_FLOAT32_C(  -931.84),
        EASYSIMD_FLOAT32_C(   973.75), EASYSIMD_FLOAT32_C(  -259.54), EASYSIMD_FLOAT32_C(   897.36), EASYSIMD_FLOAT32_C(  -143.98) },
      { EASYSIMD_FLOAT32_C(  -956.12), EASYSIMD_FLOAT32_C(   905.96), EASYSIMD_FLOAT32_C(  -215.05), EASYSIMD_FLOAT32_C(  -491.22),
        EASYSIMD_FLOAT32_C(  -101.46), EASYSIMD_FLOAT32_C(   621.35), EASYSIMD_FLOAT32_C(  -614.96), EASYSIMD_FLOAT32_C(   664.13) },
      { EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   -20.50), EASYSIMD_FLOAT32_C(   586.11), EASYSIMD_FLOAT32_C(   602.87), EASYSIMD_FLOAT32_C(  -338.88),
        EASYSIMD_FLOAT32_C(   940.58), EASYSIMD_FLOAT32_C(  -280.80), EASYSIMD_FLOAT32_C(  -380.03), EASYSIMD_FLOAT32_C(   122.65) },
      { EASYSIMD_FLOAT32_C(  -767.80), EASYSIMD_FLOAT32_C(  -510.52), EASYSIMD_FLOAT32_C(   535.33), EASYSIMD_FLOAT32_C(    -7.97),
        EASYSIMD_FLOAT32_C(  -485.61), EASYSIMD_FLOAT32_C(  -379.29), EASYSIMD_FLOAT32_C(  -507.33), EASYSIMD_FLOAT32_C(  -181.33) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -1.32),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256 a = easysimd_mm256_loadu_ps(test_vec[i].a);
    easysimd__m256 b = easysimd_mm256_loadu_ps(test_vec[i].b);
    easysimd__m256 r = easysimd_mm256_scalef_ps(a, b);
    easysimd_test_x86_assert_equal_f32x8(r, easysimd_mm256_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x8_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m256 a = easysimd_test_x86_random_extract_f32x8(i, 2, 0, values);
    easysimd__m256 b = easysimd_test_x86_random_extract_f32x8(i, 2, 1, values);
    easysimd__m256 r = easysimd_mm256_scalef_ps(a, b);

    easysimd_test_x86_write_f32x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_mask_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[8];
    const easysimd__mmask8 k;
    const easysimd_float32 a[8];
    const easysimd_float32 b[8];
    const easysimd_float32 r[8];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(   867.27), EASYSIMD_FLOAT32_C(  -634.46), EASYSIMD_FLOAT32_C(  -222.00), EASYSIMD_FLOAT32_C(  -962.68),
        EASYSIMD_FLOAT32_C(   917.78), EASYSIMD_FLOAT32_C(  -612.70), EASYSIMD_FLOAT32_C(  -579.88), EASYSIMD_FLOAT32_C(  -888.92) },
      UINT8_C(242),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -925.31),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -690.77),
        EASYSIMD_FLOAT32_C(   675.94), EASYSIMD_FLOAT32_C(  -374.50), EASYSIMD_FLOAT32_C(  -487.76), EASYSIMD_FLOAT32_C(  -756.43) },
      { EASYSIMD_FLOAT32_C(  -175.93),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -48.52),
        EASYSIMD_FLOAT32_C(    96.45), EASYSIMD_FLOAT32_C(   957.68), EASYSIMD_FLOAT32_C(   588.59), EASYSIMD_FLOAT32_C(  -197.83) },
      { EASYSIMD_FLOAT32_C(   867.27),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -222.00), EASYSIMD_FLOAT32_C(  -962.68),
        EASYSIMD_FLOAT32_C(53553484363319967491320765743104.00),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00) } },
    { { EASYSIMD_FLOAT32_C(   383.03), EASYSIMD_FLOAT32_C(  -868.75), EASYSIMD_FLOAT32_C(  -330.42), EASYSIMD_FLOAT32_C(   976.95),
        EASYSIMD_FLOAT32_C(   757.69), EASYSIMD_FLOAT32_C(  -838.96), EASYSIMD_FLOAT32_C(  -959.76), EASYSIMD_FLOAT32_C(  -432.14) },
      UINT8_C( 26),
      { EASYSIMD_FLOAT32_C(  -316.46), EASYSIMD_FLOAT32_C(  -406.44), EASYSIMD_FLOAT32_C(  -251.32), EASYSIMD_FLOAT32_C(  -212.53),
        EASYSIMD_FLOAT32_C(   798.11), EASYSIMD_FLOAT32_C(  -886.02), EASYSIMD_FLOAT32_C(  -585.83), EASYSIMD_FLOAT32_C(  -936.92) },
      { EASYSIMD_FLOAT32_C(   885.55), EASYSIMD_FLOAT32_C(   273.13), EASYSIMD_FLOAT32_C(   426.36), EASYSIMD_FLOAT32_C(   195.17),
        EASYSIMD_FLOAT32_C(  -463.04), EASYSIMD_FLOAT32_C(   229.16), EASYSIMD_FLOAT32_C(  -598.06), EASYSIMD_FLOAT32_C(  -962.03) },
      { EASYSIMD_FLOAT32_C(   383.03),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -330.42),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -838.96), EASYSIMD_FLOAT32_C(  -959.76), EASYSIMD_FLOAT32_C(  -432.14) } },
    { { EASYSIMD_FLOAT32_C(   825.42), EASYSIMD_FLOAT32_C(  -797.66), EASYSIMD_FLOAT32_C(   103.98), EASYSIMD_FLOAT32_C(  -141.83),
        EASYSIMD_FLOAT32_C(   728.06), EASYSIMD_FLOAT32_C(   316.86), EASYSIMD_FLOAT32_C(   201.08), EASYSIMD_FLOAT32_C(   441.10) },
      UINT8_C(185),
      { EASYSIMD_FLOAT32_C(   303.85), EASYSIMD_FLOAT32_C(   196.18), EASYSIMD_FLOAT32_C(  -652.80), EASYSIMD_FLOAT32_C(   -20.21),
        EASYSIMD_FLOAT32_C(   821.68), EASYSIMD_FLOAT32_C(  -140.56), EASYSIMD_FLOAT32_C(   223.36), EASYSIMD_FLOAT32_C(  -354.25) },
      { EASYSIMD_FLOAT32_C(   136.29), EASYSIMD_FLOAT32_C(  -590.33), EASYSIMD_FLOAT32_C(   597.23), EASYSIMD_FLOAT32_C(  -767.26),
        EASYSIMD_FLOAT32_C(  -632.64), EASYSIMD_FLOAT32_C(   185.82), EASYSIMD_FLOAT32_C(    34.90), EASYSIMD_FLOAT32_C(    50.90) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -797.66), EASYSIMD_FLOAT32_C(   103.98), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   201.08), EASYSIMD_FLOAT32_C(-398850041998999552.00) } },
    { { EASYSIMD_FLOAT32_C(   -45.25), EASYSIMD_FLOAT32_C(   -58.61), EASYSIMD_FLOAT32_C(   -79.21), EASYSIMD_FLOAT32_C(  -433.04),
        EASYSIMD_FLOAT32_C(  -191.34), EASYSIMD_FLOAT32_C(   286.33), EASYSIMD_FLOAT32_C(   344.96), EASYSIMD_FLOAT32_C(  -154.03) },
      UINT8_C( 54),
      { EASYSIMD_FLOAT32_C(   779.38), EASYSIMD_FLOAT32_C(   783.58), EASYSIMD_FLOAT32_C(   838.36), EASYSIMD_FLOAT32_C(   577.49),
        EASYSIMD_FLOAT32_C(   897.56), EASYSIMD_FLOAT32_C(  -747.47), EASYSIMD_FLOAT32_C(   640.57), EASYSIMD_FLOAT32_C(   783.11) },
      { EASYSIMD_FLOAT32_C(   525.66), EASYSIMD_FLOAT32_C(    66.92), EASYSIMD_FLOAT32_C(   -21.72), EASYSIMD_FLOAT32_C(  -937.39),
        EASYSIMD_FLOAT32_C(  -703.91), EASYSIMD_FLOAT32_C(   380.22), EASYSIMD_FLOAT32_C(  -899.41), EASYSIMD_FLOAT32_C(   599.93) },
      { EASYSIMD_FLOAT32_C(   -45.25), EASYSIMD_FLOAT32_C(57818000146117217484800.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -433.04),
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   344.96), EASYSIMD_FLOAT32_C(  -154.03) } },
    { { EASYSIMD_FLOAT32_C(   732.26), EASYSIMD_FLOAT32_C(   266.10), EASYSIMD_FLOAT32_C(   315.19), EASYSIMD_FLOAT32_C(  -594.88),
        EASYSIMD_FLOAT32_C(  -350.87), EASYSIMD_FLOAT32_C(   446.44), EASYSIMD_FLOAT32_C(    74.70), EASYSIMD_FLOAT32_C(  -373.92) },
      UINT8_C(178),
      { EASYSIMD_FLOAT32_C(  -423.60), EASYSIMD_FLOAT32_C(  -552.21), EASYSIMD_FLOAT32_C(  -420.28), EASYSIMD_FLOAT32_C(  -601.92),
        EASYSIMD_FLOAT32_C(   307.23), EASYSIMD_FLOAT32_C(   803.08), EASYSIMD_FLOAT32_C(    43.83), EASYSIMD_FLOAT32_C(  -556.48) },
      { EASYSIMD_FLOAT32_C(  -787.25), EASYSIMD_FLOAT32_C(  -358.94), EASYSIMD_FLOAT32_C(  -323.74), EASYSIMD_FLOAT32_C(  -419.89),
        EASYSIMD_FLOAT32_C(   826.88), EASYSIMD_FLOAT32_C(   711.16), EASYSIMD_FLOAT32_C(   631.01), EASYSIMD_FLOAT32_C(   606.26) },
      { EASYSIMD_FLOAT32_C(   732.26), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   315.19), EASYSIMD_FLOAT32_C(  -594.88),
             EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    74.70),     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   235.74), EASYSIMD_FLOAT32_C(  -333.68), EASYSIMD_FLOAT32_C(   771.99), EASYSIMD_FLOAT32_C(  -719.46),
        EASYSIMD_FLOAT32_C(  -508.26), EASYSIMD_FLOAT32_C(   974.33), EASYSIMD_FLOAT32_C(   384.53), EASYSIMD_FLOAT32_C(   349.91) },
      UINT8_C( 46),
      { EASYSIMD_FLOAT32_C(   494.74), EASYSIMD_FLOAT32_C(   469.37), EASYSIMD_FLOAT32_C(   183.74), EASYSIMD_FLOAT32_C(   392.30),
        EASYSIMD_FLOAT32_C(   721.90), EASYSIMD_FLOAT32_C(  -175.69), EASYSIMD_FLOAT32_C(   175.42), EASYSIMD_FLOAT32_C(   247.56) },
      { EASYSIMD_FLOAT32_C(   891.23), EASYSIMD_FLOAT32_C(  -846.30), EASYSIMD_FLOAT32_C(   310.17), EASYSIMD_FLOAT32_C(  -812.68),
        EASYSIMD_FLOAT32_C(   533.92), EASYSIMD_FLOAT32_C(   410.76), EASYSIMD_FLOAT32_C(   787.25), EASYSIMD_FLOAT32_C(  -889.67) },
      { EASYSIMD_FLOAT32_C(   235.74), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(  -508.26),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   384.53), EASYSIMD_FLOAT32_C(   349.91) } },
    { { EASYSIMD_FLOAT32_C(  -298.61), EASYSIMD_FLOAT32_C(  -449.02), EASYSIMD_FLOAT32_C(   143.49), EASYSIMD_FLOAT32_C(   765.05),
        EASYSIMD_FLOAT32_C(   505.73), EASYSIMD_FLOAT32_C(  -915.12), EASYSIMD_FLOAT32_C(  -314.15), EASYSIMD_FLOAT32_C(  -927.30) },
      UINT8_C( 96),
      { EASYSIMD_FLOAT32_C(   858.55), EASYSIMD_FLOAT32_C(  -633.02), EASYSIMD_FLOAT32_C(  -491.59), EASYSIMD_FLOAT32_C(   165.78),
        EASYSIMD_FLOAT32_C(  -829.95), EASYSIMD_FLOAT32_C(   552.24), EASYSIMD_FLOAT32_C(   609.30), EASYSIMD_FLOAT32_C(  -617.20) },
      { EASYSIMD_FLOAT32_C(  -806.70), EASYSIMD_FLOAT32_C(  -714.44), EASYSIMD_FLOAT32_C(   -37.09), EASYSIMD_FLOAT32_C(  -979.82),
        EASYSIMD_FLOAT32_C(   996.72), EASYSIMD_FLOAT32_C(  -406.08), EASYSIMD_FLOAT32_C(   626.43), EASYSIMD_FLOAT32_C(   491.46) },
      { EASYSIMD_FLOAT32_C(  -298.61), EASYSIMD_FLOAT32_C(  -449.02), EASYSIMD_FLOAT32_C(   143.49), EASYSIMD_FLOAT32_C(   765.05),
        EASYSIMD_FLOAT32_C(   505.73), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -927.30) } },
    { { EASYSIMD_FLOAT32_C(   972.18), EASYSIMD_FLOAT32_C(   417.66), EASYSIMD_FLOAT32_C(   739.51), EASYSIMD_FLOAT32_C(   176.29),
        EASYSIMD_FLOAT32_C(   149.93), EASYSIMD_FLOAT32_C(     5.61), EASYSIMD_FLOAT32_C(  -508.52), EASYSIMD_FLOAT32_C(   555.05) },
      UINT8_C(250),
      { EASYSIMD_FLOAT32_C(  -936.71), EASYSIMD_FLOAT32_C(  -189.83), EASYSIMD_FLOAT32_C(  -116.24), EASYSIMD_FLOAT32_C(   785.19),
        EASYSIMD_FLOAT32_C(   634.48), EASYSIMD_FLOAT32_C(  -940.82), EASYSIMD_FLOAT32_C(    32.74), EASYSIMD_FLOAT32_C(   525.72) },
      { EASYSIMD_FLOAT32_C(  -787.12), EASYSIMD_FLOAT32_C(  -657.09), EASYSIMD_FLOAT32_C(   713.04), EASYSIMD_FLOAT32_C(   746.80),
        EASYSIMD_FLOAT32_C(   753.67), EASYSIMD_FLOAT32_C(   500.29), EASYSIMD_FLOAT32_C(   857.13), EASYSIMD_FLOAT32_C(   612.22) },
      { EASYSIMD_FLOAT32_C(   972.18), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   739.51),      EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256 src = easysimd_mm256_loadu_ps(test_vec[i].src);
    easysimd__m256 a = easysimd_mm256_loadu_ps(test_vec[i].a);
    easysimd__m256 b = easysimd_mm256_loadu_ps(test_vec[i].b);
    easysimd__m256 r = easysimd_mm256_mask_scalef_ps(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x8(r, easysimd_mm256_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x8_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m256 src = easysimd_test_x86_random_f32x8(EASYSIMD_FLOAT32_C(-1000.0), EASYSIMD_FLOAT32_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256 a = easysimd_test_x86_random_extract_f32x8(i, 2, 0, values);
    easysimd__m256 b = easysimd_test_x86_random_extract_f32x8(i, 2, 1, values);
    easysimd__m256 r = easysimd_mm256_mask_scalef_ps(src, k, a, b);

    easysimd_test_x86_write_f32x8(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float32 a[8];
    const easysimd_float32 b[8];
    const easysimd_float32 r[8];
  } test_vec[] = {
    { UINT8_C(186),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -178.84),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    73.91),
        EASYSIMD_FLOAT32_C(   775.85), EASYSIMD_FLOAT32_C(  -179.10), EASYSIMD_FLOAT32_C(  -902.23), EASYSIMD_FLOAT32_C(   808.26) },
      { EASYSIMD_FLOAT32_C(   157.12),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -829.15),
        EASYSIMD_FLOAT32_C(   857.21), EASYSIMD_FLOAT32_C(   874.94), EASYSIMD_FLOAT32_C(  -731.65), EASYSIMD_FLOAT32_C(   885.12) },
      { EASYSIMD_FLOAT32_C(     0.00),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
             EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT8_C(254),
      { EASYSIMD_FLOAT32_C(  -373.68), EASYSIMD_FLOAT32_C(  -338.69), EASYSIMD_FLOAT32_C(   -17.30), EASYSIMD_FLOAT32_C(  -429.35),
        EASYSIMD_FLOAT32_C(   603.79), EASYSIMD_FLOAT32_C(  -761.55), EASYSIMD_FLOAT32_C(   662.37), EASYSIMD_FLOAT32_C(   998.63) },
      { EASYSIMD_FLOAT32_C(   271.41), EASYSIMD_FLOAT32_C(   639.65), EASYSIMD_FLOAT32_C(   500.97), EASYSIMD_FLOAT32_C(   133.67),
        EASYSIMD_FLOAT32_C(  -849.31), EASYSIMD_FLOAT32_C(  -311.72), EASYSIMD_FLOAT32_C(  -251.83), EASYSIMD_FLOAT32_C(   361.48) },
      { EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT8_C( 91),
      { EASYSIMD_FLOAT32_C(   509.45), EASYSIMD_FLOAT32_C(  -862.03), EASYSIMD_FLOAT32_C(  -564.61), EASYSIMD_FLOAT32_C(   285.30),
        EASYSIMD_FLOAT32_C(   -41.13), EASYSIMD_FLOAT32_C(  -466.84), EASYSIMD_FLOAT32_C(    93.56), EASYSIMD_FLOAT32_C(  -884.01) },
      { EASYSIMD_FLOAT32_C(  -518.82), EASYSIMD_FLOAT32_C(   198.48), EASYSIMD_FLOAT32_C(  -713.16), EASYSIMD_FLOAT32_C(  -661.61),
        EASYSIMD_FLOAT32_C(    73.43), EASYSIMD_FLOAT32_C(  -444.81), EASYSIMD_FLOAT32_C(  -776.49), EASYSIMD_FLOAT32_C(   699.75) },
      { EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(-388461876968920180588544.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(167),
      { EASYSIMD_FLOAT32_C(   216.50), EASYSIMD_FLOAT32_C(   206.21), EASYSIMD_FLOAT32_C(  -729.60), EASYSIMD_FLOAT32_C(  -179.71),
        EASYSIMD_FLOAT32_C(   444.66), EASYSIMD_FLOAT32_C(   932.77), EASYSIMD_FLOAT32_C(  -181.08), EASYSIMD_FLOAT32_C(  -283.93) },
      { EASYSIMD_FLOAT32_C(   572.42), EASYSIMD_FLOAT32_C(  -680.11), EASYSIMD_FLOAT32_C(   849.74), EASYSIMD_FLOAT32_C(   723.11),
        EASYSIMD_FLOAT32_C(     8.17), EASYSIMD_FLOAT32_C(  -402.09), EASYSIMD_FLOAT32_C(    84.60), EASYSIMD_FLOAT32_C(  -482.38) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00) } },
    { UINT8_C( 15),
      { EASYSIMD_FLOAT32_C(  -264.12), EASYSIMD_FLOAT32_C(   519.99), EASYSIMD_FLOAT32_C(   802.92), EASYSIMD_FLOAT32_C(   694.75),
        EASYSIMD_FLOAT32_C(  -946.85), EASYSIMD_FLOAT32_C(  -103.53), EASYSIMD_FLOAT32_C(   810.74), EASYSIMD_FLOAT32_C(  -465.67) },
      { EASYSIMD_FLOAT32_C(  -905.04), EASYSIMD_FLOAT32_C(  -902.42), EASYSIMD_FLOAT32_C(  -127.28), EASYSIMD_FLOAT32_C(   168.39),
        EASYSIMD_FLOAT32_C(  -347.23), EASYSIMD_FLOAT32_C(    96.24), EASYSIMD_FLOAT32_C(  -131.87), EASYSIMD_FLOAT32_C(   869.27) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C( 37),
      { EASYSIMD_FLOAT32_C(  -697.56), EASYSIMD_FLOAT32_C(   138.53), EASYSIMD_FLOAT32_C(  -310.44), EASYSIMD_FLOAT32_C(   747.10),
        EASYSIMD_FLOAT32_C(    71.30), EASYSIMD_FLOAT32_C(   508.48), EASYSIMD_FLOAT32_C(  -536.83), EASYSIMD_FLOAT32_C(  -356.28) },
      { EASYSIMD_FLOAT32_C(   828.37), EASYSIMD_FLOAT32_C(  -687.09), EASYSIMD_FLOAT32_C(  -633.17), EASYSIMD_FLOAT32_C(  -163.46),
        EASYSIMD_FLOAT32_C(   -89.17), EASYSIMD_FLOAT32_C(   451.43), EASYSIMD_FLOAT32_C(   354.16), EASYSIMD_FLOAT32_C(   646.71) },
      {     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT8_C(173),
      { EASYSIMD_FLOAT32_C(   -28.58), EASYSIMD_FLOAT32_C(   157.08), EASYSIMD_FLOAT32_C(   341.46), EASYSIMD_FLOAT32_C(    24.57),
        EASYSIMD_FLOAT32_C(  -946.45), EASYSIMD_FLOAT32_C(   152.20), EASYSIMD_FLOAT32_C(   558.90), EASYSIMD_FLOAT32_C(  -851.49) },
      { EASYSIMD_FLOAT32_C(   249.78), EASYSIMD_FLOAT32_C(  -568.37), EASYSIMD_FLOAT32_C(   316.90), EASYSIMD_FLOAT32_C(   902.55),
        EASYSIMD_FLOAT32_C(   527.86), EASYSIMD_FLOAT32_C(  -814.97), EASYSIMD_FLOAT32_C(   771.83), EASYSIMD_FLOAT32_C(   830.31) },
      {     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF } },
    { UINT8_C(195),
      { EASYSIMD_FLOAT32_C(   323.56), EASYSIMD_FLOAT32_C(  -538.61), EASYSIMD_FLOAT32_C(   577.41), EASYSIMD_FLOAT32_C(  -605.14),
        EASYSIMD_FLOAT32_C(   969.87), EASYSIMD_FLOAT32_C(  -959.42), EASYSIMD_FLOAT32_C(    38.58), EASYSIMD_FLOAT32_C(   798.24) },
      { EASYSIMD_FLOAT32_C(  -646.50), EASYSIMD_FLOAT32_C(   405.42), EASYSIMD_FLOAT32_C(  -365.22), EASYSIMD_FLOAT32_C(   264.32),
        EASYSIMD_FLOAT32_C(  -143.15), EASYSIMD_FLOAT32_C(   988.94), EASYSIMD_FLOAT32_C(   -88.97), EASYSIMD_FLOAT32_C(   828.26) },
      { EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256 a = easysimd_mm256_loadu_ps(test_vec[i].a);
    easysimd__m256 b = easysimd_mm256_loadu_ps(test_vec[i].b);
    easysimd__m256 r = easysimd_mm256_maskz_scalef_ps(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x8(r, easysimd_mm256_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x8_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256 a = easysimd_test_x86_random_extract_f32x8(i, 2, 0, values);
    easysimd__m256 b = easysimd_test_x86_random_extract_f32x8(i, 2, 1, values);
    easysimd__m256 r = easysimd_mm256_maskz_scalef_ps(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 a[16];
    const easysimd_float32 b[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -941.86),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -47.07),
        EASYSIMD_FLOAT32_C(  -156.60), EASYSIMD_FLOAT32_C(   419.86), EASYSIMD_FLOAT32_C(  -712.98), EASYSIMD_FLOAT32_C(  -783.29),
        EASYSIMD_FLOAT32_C(    69.87), EASYSIMD_FLOAT32_C(   -21.10), EASYSIMD_FLOAT32_C(  -277.06), EASYSIMD_FLOAT32_C(   523.29),
        EASYSIMD_FLOAT32_C(  -586.99), EASYSIMD_FLOAT32_C(   332.51), EASYSIMD_FLOAT32_C(   560.50), EASYSIMD_FLOAT32_C(  -464.61) },
      { EASYSIMD_FLOAT32_C(   654.36),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   462.88),
        EASYSIMD_FLOAT32_C(  -277.88), EASYSIMD_FLOAT32_C(  -634.57), EASYSIMD_FLOAT32_C(   -80.52), EASYSIMD_FLOAT32_C(   989.53),
        EASYSIMD_FLOAT32_C(   286.30), EASYSIMD_FLOAT32_C(  -241.62), EASYSIMD_FLOAT32_C(  -571.25), EASYSIMD_FLOAT32_C(   770.87),
        EASYSIMD_FLOAT32_C(   519.90), EASYSIMD_FLOAT32_C(   854.89), EASYSIMD_FLOAT32_C(   -33.16), EASYSIMD_FLOAT32_C(   127.70) },
      {            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF,     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,
            -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   913.03), EASYSIMD_FLOAT32_C(   -34.30), EASYSIMD_FLOAT32_C(  -919.38), EASYSIMD_FLOAT32_C(  -243.57),
        EASYSIMD_FLOAT32_C(  -614.45), EASYSIMD_FLOAT32_C(  -632.36), EASYSIMD_FLOAT32_C(   -26.86), EASYSIMD_FLOAT32_C(   455.43),
        EASYSIMD_FLOAT32_C(   346.55), EASYSIMD_FLOAT32_C(   696.08), EASYSIMD_FLOAT32_C(   -21.28), EASYSIMD_FLOAT32_C(   759.56),
        EASYSIMD_FLOAT32_C(    28.59), EASYSIMD_FLOAT32_C(  -460.78), EASYSIMD_FLOAT32_C(  -705.05), EASYSIMD_FLOAT32_C(  -317.05) },
      { EASYSIMD_FLOAT32_C(   662.85), EASYSIMD_FLOAT32_C(    11.06), EASYSIMD_FLOAT32_C(  -854.18), EASYSIMD_FLOAT32_C(  -615.03),
        EASYSIMD_FLOAT32_C(   376.49), EASYSIMD_FLOAT32_C(    65.30), EASYSIMD_FLOAT32_C(  -625.50), EASYSIMD_FLOAT32_C(  -337.21),
        EASYSIMD_FLOAT32_C(   823.68), EASYSIMD_FLOAT32_C(  -196.74), EASYSIMD_FLOAT32_C(  -566.34), EASYSIMD_FLOAT32_C(   343.57),
        EASYSIMD_FLOAT32_C(  -341.85), EASYSIMD_FLOAT32_C(   400.50), EASYSIMD_FLOAT32_C(  -528.73), EASYSIMD_FLOAT32_C(  -428.82) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-70246.40), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00),
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-23329965624469988835328.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00) } },
    { { EASYSIMD_FLOAT32_C(  -633.80), EASYSIMD_FLOAT32_C(  -448.10), EASYSIMD_FLOAT32_C(   327.62), EASYSIMD_FLOAT32_C(  -248.25),
        EASYSIMD_FLOAT32_C(   -80.46), EASYSIMD_FLOAT32_C(  -699.24), EASYSIMD_FLOAT32_C(  -792.82), EASYSIMD_FLOAT32_C(  -733.92),
        EASYSIMD_FLOAT32_C(   996.84), EASYSIMD_FLOAT32_C(   185.90), EASYSIMD_FLOAT32_C(  -974.36), EASYSIMD_FLOAT32_C(    25.42),
        EASYSIMD_FLOAT32_C(   725.12), EASYSIMD_FLOAT32_C(  -679.41), EASYSIMD_FLOAT32_C(   708.37), EASYSIMD_FLOAT32_C(   387.97) },
      { EASYSIMD_FLOAT32_C(   331.65), EASYSIMD_FLOAT32_C(   854.19), EASYSIMD_FLOAT32_C(   772.94), EASYSIMD_FLOAT32_C(  -291.85),
        EASYSIMD_FLOAT32_C(   -80.51), EASYSIMD_FLOAT32_C(  -852.55), EASYSIMD_FLOAT32_C(   370.94), EASYSIMD_FLOAT32_C(  -256.84),
        EASYSIMD_FLOAT32_C(   -49.30), EASYSIMD_FLOAT32_C(   804.60), EASYSIMD_FLOAT32_C(  -913.26), EASYSIMD_FLOAT32_C(   608.85),
        EASYSIMD_FLOAT32_C(   205.10), EASYSIMD_FLOAT32_C(  -441.99), EASYSIMD_FLOAT32_C(  -819.97), EASYSIMD_FLOAT32_C(   571.30) },
      {     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   109.91), EASYSIMD_FLOAT32_C(   507.65), EASYSIMD_FLOAT32_C(  -676.94), EASYSIMD_FLOAT32_C(  -970.55),
        EASYSIMD_FLOAT32_C(   808.40), EASYSIMD_FLOAT32_C(  -469.76), EASYSIMD_FLOAT32_C(  -704.47), EASYSIMD_FLOAT32_C(   805.24),
        EASYSIMD_FLOAT32_C(   716.14), EASYSIMD_FLOAT32_C(  -678.83), EASYSIMD_FLOAT32_C(  -169.34), EASYSIMD_FLOAT32_C(   441.26),
        EASYSIMD_FLOAT32_C(  -358.23), EASYSIMD_FLOAT32_C(  -460.97), EASYSIMD_FLOAT32_C(  -170.77), EASYSIMD_FLOAT32_C(   973.42) },
      { EASYSIMD_FLOAT32_C(  -606.78), EASYSIMD_FLOAT32_C(  -397.82), EASYSIMD_FLOAT32_C(  -318.44), EASYSIMD_FLOAT32_C(   312.71),
        EASYSIMD_FLOAT32_C(  -250.38), EASYSIMD_FLOAT32_C(  -947.50), EASYSIMD_FLOAT32_C(  -944.13), EASYSIMD_FLOAT32_C(   700.32),
        EASYSIMD_FLOAT32_C(   857.10), EASYSIMD_FLOAT32_C(  -857.39), EASYSIMD_FLOAT32_C(   309.17), EASYSIMD_FLOAT32_C(    62.21),
        EASYSIMD_FLOAT32_C(  -299.38), EASYSIMD_FLOAT32_C(   489.21), EASYSIMD_FLOAT32_C(  -366.49), EASYSIMD_FLOAT32_C(   810.53) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(2034952617527265460224.00),
        EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(    -3.14), EASYSIMD_FLOAT32_C(   -43.43), EASYSIMD_FLOAT32_C(   839.97), EASYSIMD_FLOAT32_C(  -194.74),
        EASYSIMD_FLOAT32_C(   486.80), EASYSIMD_FLOAT32_C(  -864.50), EASYSIMD_FLOAT32_C(  -389.50), EASYSIMD_FLOAT32_C(   202.94),
        EASYSIMD_FLOAT32_C(  -543.32), EASYSIMD_FLOAT32_C(   441.16), EASYSIMD_FLOAT32_C(  -355.80), EASYSIMD_FLOAT32_C(    98.44),
        EASYSIMD_FLOAT32_C(   980.20), EASYSIMD_FLOAT32_C(   473.43), EASYSIMD_FLOAT32_C(    71.86), EASYSIMD_FLOAT32_C(  -626.58) },
      { EASYSIMD_FLOAT32_C(  -924.39), EASYSIMD_FLOAT32_C(   753.42), EASYSIMD_FLOAT32_C(   686.13), EASYSIMD_FLOAT32_C(  -174.77),
        EASYSIMD_FLOAT32_C(   805.92), EASYSIMD_FLOAT32_C(   742.00), EASYSIMD_FLOAT32_C(  -474.45), EASYSIMD_FLOAT32_C(   663.03),
        EASYSIMD_FLOAT32_C(   884.61), EASYSIMD_FLOAT32_C(   834.73), EASYSIMD_FLOAT32_C(  -274.77), EASYSIMD_FLOAT32_C(  -414.76),
        EASYSIMD_FLOAT32_C(   323.93), EASYSIMD_FLOAT32_C(   358.74), EASYSIMD_FLOAT32_C(  -604.24), EASYSIMD_FLOAT32_C(  -679.21) },
      { EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
             EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,
            -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),
             EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00) } },
    { { EASYSIMD_FLOAT32_C(  -684.70), EASYSIMD_FLOAT32_C(  -764.26), EASYSIMD_FLOAT32_C(   126.05), EASYSIMD_FLOAT32_C(   802.11),
        EASYSIMD_FLOAT32_C(  -628.76), EASYSIMD_FLOAT32_C(   736.55), EASYSIMD_FLOAT32_C(     5.05), EASYSIMD_FLOAT32_C(  -172.08),
        EASYSIMD_FLOAT32_C(   177.71), EASYSIMD_FLOAT32_C(   649.25), EASYSIMD_FLOAT32_C(   926.36), EASYSIMD_FLOAT32_C(   157.91),
        EASYSIMD_FLOAT32_C(   122.68), EASYSIMD_FLOAT32_C(    -1.78), EASYSIMD_FLOAT32_C(   531.33), EASYSIMD_FLOAT32_C(   198.28) },
      { EASYSIMD_FLOAT32_C(  -248.36), EASYSIMD_FLOAT32_C(   217.45), EASYSIMD_FLOAT32_C(  -976.49), EASYSIMD_FLOAT32_C(  -442.43),
        EASYSIMD_FLOAT32_C(   -40.54), EASYSIMD_FLOAT32_C(  -450.94), EASYSIMD_FLOAT32_C(  -779.41), EASYSIMD_FLOAT32_C(  -155.93),
        EASYSIMD_FLOAT32_C(  -616.21), EASYSIMD_FLOAT32_C(   -54.18), EASYSIMD_FLOAT32_C(   429.31), EASYSIMD_FLOAT32_C(   707.72),
        EASYSIMD_FLOAT32_C(  -695.44), EASYSIMD_FLOAT32_C(   825.07), EASYSIMD_FLOAT32_C(  -971.49), EASYSIMD_FLOAT32_C(  -380.13) },
      { EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(  -939.19), EASYSIMD_FLOAT32_C(   154.56), EASYSIMD_FLOAT32_C(  -578.03), EASYSIMD_FLOAT32_C(  -567.95),
        EASYSIMD_FLOAT32_C(  -108.89), EASYSIMD_FLOAT32_C(   427.02), EASYSIMD_FLOAT32_C(   259.97), EASYSIMD_FLOAT32_C(  -931.18),
        EASYSIMD_FLOAT32_C(    76.27), EASYSIMD_FLOAT32_C(   186.33), EASYSIMD_FLOAT32_C(   226.73), EASYSIMD_FLOAT32_C(  -801.06),
        EASYSIMD_FLOAT32_C(  -815.45), EASYSIMD_FLOAT32_C(  -241.94), EASYSIMD_FLOAT32_C(   397.23), EASYSIMD_FLOAT32_C(   -63.80) },
      { EASYSIMD_FLOAT32_C(   975.51), EASYSIMD_FLOAT32_C(   420.74), EASYSIMD_FLOAT32_C(   493.76), EASYSIMD_FLOAT32_C(   -65.03),
        EASYSIMD_FLOAT32_C(   969.81), EASYSIMD_FLOAT32_C(   714.36), EASYSIMD_FLOAT32_C(   779.04), EASYSIMD_FLOAT32_C(  -646.40),
        EASYSIMD_FLOAT32_C(  -339.82), EASYSIMD_FLOAT32_C(   208.34), EASYSIMD_FLOAT32_C(  -938.68), EASYSIMD_FLOAT32_C(   -35.26),
        EASYSIMD_FLOAT32_C(    33.41), EASYSIMD_FLOAT32_C(  -910.17), EASYSIMD_FLOAT32_C(   584.61), EASYSIMD_FLOAT32_C(    94.22) },
      {     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
            -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(-7004662267904.00), EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-1263689176990943439434161324032.00) } },
    { { EASYSIMD_FLOAT32_C(   244.39), EASYSIMD_FLOAT32_C(  -993.42), EASYSIMD_FLOAT32_C(   526.27), EASYSIMD_FLOAT32_C(  -864.50),
        EASYSIMD_FLOAT32_C(   433.60), EASYSIMD_FLOAT32_C(  -213.76), EASYSIMD_FLOAT32_C(  -795.68), EASYSIMD_FLOAT32_C(  -490.13),
        EASYSIMD_FLOAT32_C(   972.57), EASYSIMD_FLOAT32_C(   431.05), EASYSIMD_FLOAT32_C(  -291.19), EASYSIMD_FLOAT32_C(  -842.88),
        EASYSIMD_FLOAT32_C(  -810.89), EASYSIMD_FLOAT32_C(  -893.96), EASYSIMD_FLOAT32_C(    93.32), EASYSIMD_FLOAT32_C(  -835.37) },
      { EASYSIMD_FLOAT32_C(   526.79), EASYSIMD_FLOAT32_C(  -412.92), EASYSIMD_FLOAT32_C(    99.60), EASYSIMD_FLOAT32_C(   496.59),
        EASYSIMD_FLOAT32_C(  -698.56), EASYSIMD_FLOAT32_C(  -121.37), EASYSIMD_FLOAT32_C(   850.19), EASYSIMD_FLOAT32_C(   -38.38),
        EASYSIMD_FLOAT32_C(  -913.02), EASYSIMD_FLOAT32_C(   911.51), EASYSIMD_FLOAT32_C(   926.36), EASYSIMD_FLOAT32_C(   120.39),
        EASYSIMD_FLOAT32_C(  -998.66), EASYSIMD_FLOAT32_C(   510.97), EASYSIMD_FLOAT32_C(  -785.39), EASYSIMD_FLOAT32_C(   245.73) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(333563253070455536416637746937856.00),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 a = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd__m512 b = easysimd_mm512_loadu_ps(test_vec[i].b);
    easysimd__m512 r = easysimd_mm512_scalef_ps(a, b);
    easysimd_test_x86_assert_equal_f32x16(r, easysimd_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x16_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m512 a = easysimd_test_x86_random_extract_f32x16(i, 2, 0, values);
    easysimd__m512 b = easysimd_test_x86_random_extract_f32x16(i, 2, 1, values);
    easysimd__m512 r = easysimd_mm512_scalef_ps(a, b);

    easysimd_test_x86_write_f32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_mask_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[16];
    const easysimd__mmask16 k;
    const easysimd_float32 a[16];
    const easysimd_float32 b[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(  -384.09), EASYSIMD_FLOAT32_C(  -958.76), EASYSIMD_FLOAT32_C(   466.64), EASYSIMD_FLOAT32_C(   966.42),
        EASYSIMD_FLOAT32_C(  -935.87), EASYSIMD_FLOAT32_C(   220.72), EASYSIMD_FLOAT32_C(   714.63), EASYSIMD_FLOAT32_C(   933.35),
        EASYSIMD_FLOAT32_C(   753.44), EASYSIMD_FLOAT32_C(  -693.92), EASYSIMD_FLOAT32_C(  -785.64), EASYSIMD_FLOAT32_C(   651.72),
        EASYSIMD_FLOAT32_C(   585.75), EASYSIMD_FLOAT32_C(   125.22), EASYSIMD_FLOAT32_C(   285.70), EASYSIMD_FLOAT32_C(  -119.05) },
      UINT16_C( 6353),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   740.89),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -48.84),
        EASYSIMD_FLOAT32_C(  -472.87), EASYSIMD_FLOAT32_C(   585.55), EASYSIMD_FLOAT32_C(   461.03), EASYSIMD_FLOAT32_C(  -500.30),
        EASYSIMD_FLOAT32_C(    16.61), EASYSIMD_FLOAT32_C(  -830.16), EASYSIMD_FLOAT32_C(  -343.18), EASYSIMD_FLOAT32_C(   205.72),
        EASYSIMD_FLOAT32_C(  -724.11), EASYSIMD_FLOAT32_C(   750.14), EASYSIMD_FLOAT32_C(   370.35), EASYSIMD_FLOAT32_C(   802.67) },
      { EASYSIMD_FLOAT32_C(  -662.78),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -361.34),
        EASYSIMD_FLOAT32_C(   348.58), EASYSIMD_FLOAT32_C(   149.45), EASYSIMD_FLOAT32_C(   600.28), EASYSIMD_FLOAT32_C(   435.55),
        EASYSIMD_FLOAT32_C(    60.96), EASYSIMD_FLOAT32_C(   526.64), EASYSIMD_FLOAT32_C(  -444.05), EASYSIMD_FLOAT32_C(    62.30),
        EASYSIMD_FLOAT32_C(    37.62), EASYSIMD_FLOAT32_C(  -229.44), EASYSIMD_FLOAT32_C(  -691.97), EASYSIMD_FLOAT32_C(  -444.83) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -958.76), EASYSIMD_FLOAT32_C(   466.64), EASYSIMD_FLOAT32_C(   966.42),
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(   220.72),      EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(   753.44), EASYSIMD_FLOAT32_C(  -693.92), EASYSIMD_FLOAT32_C(  -785.64), EASYSIMD_FLOAT32_C(948716053340381773824.00),
        EASYSIMD_FLOAT32_C(-99520918585344.00), EASYSIMD_FLOAT32_C(   125.22), EASYSIMD_FLOAT32_C(   285.70), EASYSIMD_FLOAT32_C(  -119.05) } },
    { { EASYSIMD_FLOAT32_C(   622.41), EASYSIMD_FLOAT32_C(   402.50), EASYSIMD_FLOAT32_C(   168.18), EASYSIMD_FLOAT32_C(   951.95),
        EASYSIMD_FLOAT32_C(   716.56), EASYSIMD_FLOAT32_C(   604.02), EASYSIMD_FLOAT32_C(   275.93), EASYSIMD_FLOAT32_C(  -553.03),
        EASYSIMD_FLOAT32_C(    55.37), EASYSIMD_FLOAT32_C(   762.73), EASYSIMD_FLOAT32_C(  -158.00), EASYSIMD_FLOAT32_C(   316.47),
        EASYSIMD_FLOAT32_C(   320.59), EASYSIMD_FLOAT32_C(   457.91), EASYSIMD_FLOAT32_C(   357.71), EASYSIMD_FLOAT32_C(  -212.77) },
      UINT16_C(57868),
      { EASYSIMD_FLOAT32_C(  -488.55), EASYSIMD_FLOAT32_C(   689.26), EASYSIMD_FLOAT32_C(   506.33), EASYSIMD_FLOAT32_C(    38.58),
        EASYSIMD_FLOAT32_C(   274.81), EASYSIMD_FLOAT32_C(   -32.64), EASYSIMD_FLOAT32_C(   538.27), EASYSIMD_FLOAT32_C(  -708.59),
        EASYSIMD_FLOAT32_C(   137.20), EASYSIMD_FLOAT32_C(  -804.91), EASYSIMD_FLOAT32_C(   497.13), EASYSIMD_FLOAT32_C(   413.09),
        EASYSIMD_FLOAT32_C(   945.23), EASYSIMD_FLOAT32_C(  -132.52), EASYSIMD_FLOAT32_C(   215.76), EASYSIMD_FLOAT32_C(  -717.54) },
      { EASYSIMD_FLOAT32_C(   337.42), EASYSIMD_FLOAT32_C(  -484.97), EASYSIMD_FLOAT32_C(   -78.88), EASYSIMD_FLOAT32_C(  -314.00),
        EASYSIMD_FLOAT32_C(   664.48), EASYSIMD_FLOAT32_C(  -478.60), EASYSIMD_FLOAT32_C(  -878.45), EASYSIMD_FLOAT32_C(  -274.56),
        EASYSIMD_FLOAT32_C(  -951.95), EASYSIMD_FLOAT32_C(  -322.50), EASYSIMD_FLOAT32_C(   787.74), EASYSIMD_FLOAT32_C(    85.66),
        EASYSIMD_FLOAT32_C(   448.06), EASYSIMD_FLOAT32_C(  -904.23), EASYSIMD_FLOAT32_C(   640.83), EASYSIMD_FLOAT32_C(   959.51) },
      { EASYSIMD_FLOAT32_C(   622.41), EASYSIMD_FLOAT32_C(   402.50), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(   716.56), EASYSIMD_FLOAT32_C(   604.02), EASYSIMD_FLOAT32_C(   275.93), EASYSIMD_FLOAT32_C(  -553.03),
        EASYSIMD_FLOAT32_C(    55.37), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(  -158.00), EASYSIMD_FLOAT32_C(   316.47),
        EASYSIMD_FLOAT32_C(   320.59), EASYSIMD_FLOAT32_C(    -0.00),      EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(  -992.05), EASYSIMD_FLOAT32_C(   138.95), EASYSIMD_FLOAT32_C(   355.18), EASYSIMD_FLOAT32_C(   761.39),
        EASYSIMD_FLOAT32_C(   445.03), EASYSIMD_FLOAT32_C(   569.54), EASYSIMD_FLOAT32_C(   413.11), EASYSIMD_FLOAT32_C(    30.79),
        EASYSIMD_FLOAT32_C(  -305.24), EASYSIMD_FLOAT32_C(  -301.19), EASYSIMD_FLOAT32_C(   911.73), EASYSIMD_FLOAT32_C(  -292.42),
        EASYSIMD_FLOAT32_C(  -913.23), EASYSIMD_FLOAT32_C(   534.14), EASYSIMD_FLOAT32_C(  -889.91), EASYSIMD_FLOAT32_C(   254.96) },
      UINT16_C(49817),
      { EASYSIMD_FLOAT32_C(   785.03), EASYSIMD_FLOAT32_C(   147.16), EASYSIMD_FLOAT32_C(    -1.92), EASYSIMD_FLOAT32_C(    59.84),
        EASYSIMD_FLOAT32_C(  -885.48), EASYSIMD_FLOAT32_C(  -463.64), EASYSIMD_FLOAT32_C(   351.25), EASYSIMD_FLOAT32_C(   251.72),
        EASYSIMD_FLOAT32_C(  -268.55), EASYSIMD_FLOAT32_C(  -151.61), EASYSIMD_FLOAT32_C(  -335.18), EASYSIMD_FLOAT32_C(  -323.32),
        EASYSIMD_FLOAT32_C(   715.87), EASYSIMD_FLOAT32_C(   880.58), EASYSIMD_FLOAT32_C(   -40.86), EASYSIMD_FLOAT32_C(    53.29) },
      { EASYSIMD_FLOAT32_C(  -604.39), EASYSIMD_FLOAT32_C(   880.26), EASYSIMD_FLOAT32_C(   739.29), EASYSIMD_FLOAT32_C(  -939.91),
        EASYSIMD_FLOAT32_C(  -598.33), EASYSIMD_FLOAT32_C(   860.84), EASYSIMD_FLOAT32_C(  -214.46), EASYSIMD_FLOAT32_C(  -550.28),
        EASYSIMD_FLOAT32_C(  -461.66), EASYSIMD_FLOAT32_C(  -426.72), EASYSIMD_FLOAT32_C(   535.38), EASYSIMD_FLOAT32_C(   986.40),
        EASYSIMD_FLOAT32_C(  -330.95), EASYSIMD_FLOAT32_C(   176.21), EASYSIMD_FLOAT32_C(   945.91), EASYSIMD_FLOAT32_C(  -545.92) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   138.95), EASYSIMD_FLOAT32_C(   355.18), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   569.54), EASYSIMD_FLOAT32_C(   413.11), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(  -305.24), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   911.73), EASYSIMD_FLOAT32_C(  -292.42),
        EASYSIMD_FLOAT32_C(  -913.23), EASYSIMD_FLOAT32_C(   534.14),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(  -141.02), EASYSIMD_FLOAT32_C(  -237.99), EASYSIMD_FLOAT32_C(  -726.39), EASYSIMD_FLOAT32_C(   914.35),
        EASYSIMD_FLOAT32_C(  -475.26), EASYSIMD_FLOAT32_C(   115.61), EASYSIMD_FLOAT32_C(   230.82), EASYSIMD_FLOAT32_C(   845.33),
        EASYSIMD_FLOAT32_C(  -426.47), EASYSIMD_FLOAT32_C(  -411.48), EASYSIMD_FLOAT32_C(  -367.44), EASYSIMD_FLOAT32_C(   997.86),
        EASYSIMD_FLOAT32_C(  -989.64), EASYSIMD_FLOAT32_C(  -359.48), EASYSIMD_FLOAT32_C(   136.81), EASYSIMD_FLOAT32_C(   365.54) },
      UINT16_C(52705),
      { EASYSIMD_FLOAT32_C(  -676.62), EASYSIMD_FLOAT32_C(   -56.01), EASYSIMD_FLOAT32_C(   513.92), EASYSIMD_FLOAT32_C(  -562.10),
        EASYSIMD_FLOAT32_C(   480.35), EASYSIMD_FLOAT32_C(  -134.83), EASYSIMD_FLOAT32_C(   689.63), EASYSIMD_FLOAT32_C(  -788.20),
        EASYSIMD_FLOAT32_C(   713.56), EASYSIMD_FLOAT32_C(  -645.56), EASYSIMD_FLOAT32_C(  -111.52), EASYSIMD_FLOAT32_C(   429.42),
        EASYSIMD_FLOAT32_C(  -764.98), EASYSIMD_FLOAT32_C(   847.63), EASYSIMD_FLOAT32_C(  -517.29), EASYSIMD_FLOAT32_C(  -369.37) },
      { EASYSIMD_FLOAT32_C(   727.89), EASYSIMD_FLOAT32_C(  -778.00), EASYSIMD_FLOAT32_C(  -309.27), EASYSIMD_FLOAT32_C(  -870.44),
        EASYSIMD_FLOAT32_C(  -917.16), EASYSIMD_FLOAT32_C(   476.26), EASYSIMD_FLOAT32_C(  -420.73), EASYSIMD_FLOAT32_C(  -378.82),
        EASYSIMD_FLOAT32_C(  -950.46), EASYSIMD_FLOAT32_C(  -885.35), EASYSIMD_FLOAT32_C(  -392.42), EASYSIMD_FLOAT32_C(  -281.40),
        EASYSIMD_FLOAT32_C(   290.87), EASYSIMD_FLOAT32_C(  -446.51), EASYSIMD_FLOAT32_C(   172.67), EASYSIMD_FLOAT32_C(   614.25) },
      {     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -237.99), EASYSIMD_FLOAT32_C(  -726.39), EASYSIMD_FLOAT32_C(   914.35),
        EASYSIMD_FLOAT32_C(  -475.26),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -411.48), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(  -989.64), EASYSIMD_FLOAT32_C(  -359.48),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF } },
    { { EASYSIMD_FLOAT32_C(   -64.92), EASYSIMD_FLOAT32_C(   815.02), EASYSIMD_FLOAT32_C(   612.63), EASYSIMD_FLOAT32_C(   629.84),
        EASYSIMD_FLOAT32_C(  -486.17), EASYSIMD_FLOAT32_C(   524.36), EASYSIMD_FLOAT32_C(  -662.57), EASYSIMD_FLOAT32_C(  -399.40),
        EASYSIMD_FLOAT32_C(    58.50), EASYSIMD_FLOAT32_C(  -552.49), EASYSIMD_FLOAT32_C(   855.56), EASYSIMD_FLOAT32_C(  -455.41),
        EASYSIMD_FLOAT32_C(  -725.84), EASYSIMD_FLOAT32_C(  -285.46), EASYSIMD_FLOAT32_C(   306.60), EASYSIMD_FLOAT32_C(  -452.23) },
      UINT16_C(57400),
      { EASYSIMD_FLOAT32_C(   497.48), EASYSIMD_FLOAT32_C(  -313.41), EASYSIMD_FLOAT32_C(  -947.85), EASYSIMD_FLOAT32_C(   -22.17),
        EASYSIMD_FLOAT32_C(   551.76), EASYSIMD_FLOAT32_C(   741.77), EASYSIMD_FLOAT32_C(   189.63), EASYSIMD_FLOAT32_C(   265.32),
        EASYSIMD_FLOAT32_C(  -903.79), EASYSIMD_FLOAT32_C(  -921.89), EASYSIMD_FLOAT32_C(  -305.26), EASYSIMD_FLOAT32_C(  -668.76),
        EASYSIMD_FLOAT32_C(   925.73), EASYSIMD_FLOAT32_C(   177.45), EASYSIMD_FLOAT32_C(   -38.13), EASYSIMD_FLOAT32_C(   653.62) },
      { EASYSIMD_FLOAT32_C(   399.45), EASYSIMD_FLOAT32_C(   652.59), EASYSIMD_FLOAT32_C(   783.18), EASYSIMD_FLOAT32_C(   482.29),
        EASYSIMD_FLOAT32_C(   128.86), EASYSIMD_FLOAT32_C(  -637.55), EASYSIMD_FLOAT32_C(  -896.53), EASYSIMD_FLOAT32_C(   178.40),
        EASYSIMD_FLOAT32_C(  -522.89), EASYSIMD_FLOAT32_C(  -288.94), EASYSIMD_FLOAT32_C(   897.00), EASYSIMD_FLOAT32_C(   767.97),
        EASYSIMD_FLOAT32_C(   264.55), EASYSIMD_FLOAT32_C(    69.67), EASYSIMD_FLOAT32_C(   382.22), EASYSIMD_FLOAT32_C(  -237.97) },
      { EASYSIMD_FLOAT32_C(   -64.92), EASYSIMD_FLOAT32_C(   815.02), EASYSIMD_FLOAT32_C(   612.63),     -EASYSIMD_MATH_INFINITYF,
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -662.57), EASYSIMD_FLOAT32_C(  -399.40),
        EASYSIMD_FLOAT32_C(    58.50), EASYSIMD_FLOAT32_C(  -552.49), EASYSIMD_FLOAT32_C(   855.56), EASYSIMD_FLOAT32_C(  -455.41),
        EASYSIMD_FLOAT32_C(  -725.84), EASYSIMD_FLOAT32_C(104747989746712466948096.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00) } },
    { { EASYSIMD_FLOAT32_C(   663.39), EASYSIMD_FLOAT32_C(   859.70), EASYSIMD_FLOAT32_C(   676.68), EASYSIMD_FLOAT32_C(  -763.09),
        EASYSIMD_FLOAT32_C(  -551.77), EASYSIMD_FLOAT32_C(  -690.76), EASYSIMD_FLOAT32_C(  -765.23), EASYSIMD_FLOAT32_C(  -541.42),
        EASYSIMD_FLOAT32_C(   -50.24), EASYSIMD_FLOAT32_C(   371.58), EASYSIMD_FLOAT32_C(   824.12), EASYSIMD_FLOAT32_C(   351.66),
        EASYSIMD_FLOAT32_C(   953.42), EASYSIMD_FLOAT32_C(  -240.79), EASYSIMD_FLOAT32_C(   166.68), EASYSIMD_FLOAT32_C(   566.05) },
      UINT16_C(32446),
      { EASYSIMD_FLOAT32_C(   756.26), EASYSIMD_FLOAT32_C(   434.37), EASYSIMD_FLOAT32_C(   739.85), EASYSIMD_FLOAT32_C(   308.03),
        EASYSIMD_FLOAT32_C(   176.14), EASYSIMD_FLOAT32_C(   -70.52), EASYSIMD_FLOAT32_C(  -426.66), EASYSIMD_FLOAT32_C(   272.35),
        EASYSIMD_FLOAT32_C(     7.59), EASYSIMD_FLOAT32_C(   268.08), EASYSIMD_FLOAT32_C(   603.59), EASYSIMD_FLOAT32_C(   -66.68),
        EASYSIMD_FLOAT32_C(  -554.46), EASYSIMD_FLOAT32_C(  -434.54), EASYSIMD_FLOAT32_C(  -413.06), EASYSIMD_FLOAT32_C(   844.99) },
      { EASYSIMD_FLOAT32_C(  -781.95), EASYSIMD_FLOAT32_C(  -629.87), EASYSIMD_FLOAT32_C(   327.28), EASYSIMD_FLOAT32_C(   346.91),
        EASYSIMD_FLOAT32_C(  -267.42), EASYSIMD_FLOAT32_C(   430.76), EASYSIMD_FLOAT32_C(  -474.69), EASYSIMD_FLOAT32_C(   209.69),
        EASYSIMD_FLOAT32_C(  -858.19), EASYSIMD_FLOAT32_C(  -577.69), EASYSIMD_FLOAT32_C(   -22.34), EASYSIMD_FLOAT32_C(   406.36),
        EASYSIMD_FLOAT32_C(   491.98), EASYSIMD_FLOAT32_C(  -640.12), EASYSIMD_FLOAT32_C(  -831.62), EASYSIMD_FLOAT32_C(   248.25) },
      { EASYSIMD_FLOAT32_C(   663.39), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -765.23),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(   -50.24), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   566.05) } },
    { { EASYSIMD_FLOAT32_C(    90.40), EASYSIMD_FLOAT32_C(  -273.52), EASYSIMD_FLOAT32_C(  -718.89), EASYSIMD_FLOAT32_C(  -851.10),
        EASYSIMD_FLOAT32_C(   173.99), EASYSIMD_FLOAT32_C(  -863.33), EASYSIMD_FLOAT32_C(  -306.51), EASYSIMD_FLOAT32_C(   448.15),
        EASYSIMD_FLOAT32_C(  -148.79), EASYSIMD_FLOAT32_C(  -999.91), EASYSIMD_FLOAT32_C(   995.92), EASYSIMD_FLOAT32_C(   480.10),
        EASYSIMD_FLOAT32_C(   831.43), EASYSIMD_FLOAT32_C(   659.31), EASYSIMD_FLOAT32_C(   339.80), EASYSIMD_FLOAT32_C(   508.11) },
      UINT16_C( 2559),
      { EASYSIMD_FLOAT32_C(   794.25), EASYSIMD_FLOAT32_C(   908.24), EASYSIMD_FLOAT32_C(  -443.72), EASYSIMD_FLOAT32_C(   -29.61),
        EASYSIMD_FLOAT32_C(  -162.28), EASYSIMD_FLOAT32_C(   129.62), EASYSIMD_FLOAT32_C(  -757.26), EASYSIMD_FLOAT32_C(   845.31),
        EASYSIMD_FLOAT32_C(  -602.30), EASYSIMD_FLOAT32_C(   846.33), EASYSIMD_FLOAT32_C(  -221.37), EASYSIMD_FLOAT32_C(  -156.76),
        EASYSIMD_FLOAT32_C(  -588.21), EASYSIMD_FLOAT32_C(   365.57), EASYSIMD_FLOAT32_C(  -311.77), EASYSIMD_FLOAT32_C(  -370.16) },
      { EASYSIMD_FLOAT32_C(   735.70), EASYSIMD_FLOAT32_C(  -984.49), EASYSIMD_FLOAT32_C(   976.75), EASYSIMD_FLOAT32_C(  -531.72),
        EASYSIMD_FLOAT32_C(   446.27), EASYSIMD_FLOAT32_C(  -497.93), EASYSIMD_FLOAT32_C(   677.96), EASYSIMD_FLOAT32_C(   588.08),
        EASYSIMD_FLOAT32_C(   -75.62), EASYSIMD_FLOAT32_C(  -344.38), EASYSIMD_FLOAT32_C(    -5.56), EASYSIMD_FLOAT32_C(  -583.64),
        EASYSIMD_FLOAT32_C(    15.50), EASYSIMD_FLOAT32_C(   162.82), EASYSIMD_FLOAT32_C(   664.61), EASYSIMD_FLOAT32_C(  -190.25) },
      {      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00),
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(  -999.91), EASYSIMD_FLOAT32_C(   995.92), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(   831.43), EASYSIMD_FLOAT32_C(   659.31), EASYSIMD_FLOAT32_C(   339.80), EASYSIMD_FLOAT32_C(   508.11) } },
    { { EASYSIMD_FLOAT32_C(   817.35), EASYSIMD_FLOAT32_C(  -869.01), EASYSIMD_FLOAT32_C(  -753.39), EASYSIMD_FLOAT32_C(  -232.89),
        EASYSIMD_FLOAT32_C(   502.57), EASYSIMD_FLOAT32_C(  -929.27), EASYSIMD_FLOAT32_C(  -881.23), EASYSIMD_FLOAT32_C(   455.99),
        EASYSIMD_FLOAT32_C(  -170.06), EASYSIMD_FLOAT32_C(   285.45), EASYSIMD_FLOAT32_C(    22.03), EASYSIMD_FLOAT32_C(   218.99),
        EASYSIMD_FLOAT32_C(   -34.04), EASYSIMD_FLOAT32_C(  -887.56), EASYSIMD_FLOAT32_C(   945.47), EASYSIMD_FLOAT32_C(   247.07) },
      UINT16_C(32166),
      { EASYSIMD_FLOAT32_C(    71.06), EASYSIMD_FLOAT32_C(  -779.11), EASYSIMD_FLOAT32_C(   780.14), EASYSIMD_FLOAT32_C(   908.78),
        EASYSIMD_FLOAT32_C(   350.50), EASYSIMD_FLOAT32_C(  -977.11), EASYSIMD_FLOAT32_C(   754.08), EASYSIMD_FLOAT32_C(   748.21),
        EASYSIMD_FLOAT32_C(   869.22), EASYSIMD_FLOAT32_C(  -467.29), EASYSIMD_FLOAT32_C(  -408.55), EASYSIMD_FLOAT32_C(  -718.99),
        EASYSIMD_FLOAT32_C(   898.28), EASYSIMD_FLOAT32_C(   279.68), EASYSIMD_FLOAT32_C(   -89.14), EASYSIMD_FLOAT32_C(   633.98) },
      { EASYSIMD_FLOAT32_C(   295.19), EASYSIMD_FLOAT32_C(  -112.39), EASYSIMD_FLOAT32_C(  -897.74), EASYSIMD_FLOAT32_C(  -258.54),
        EASYSIMD_FLOAT32_C(   389.68), EASYSIMD_FLOAT32_C(   780.22), EASYSIMD_FLOAT32_C(  -670.46), EASYSIMD_FLOAT32_C(  -685.95),
        EASYSIMD_FLOAT32_C(  -564.16), EASYSIMD_FLOAT32_C(   323.98), EASYSIMD_FLOAT32_C(  -269.58), EASYSIMD_FLOAT32_C(   451.34),
        EASYSIMD_FLOAT32_C(  -513.20), EASYSIMD_FLOAT32_C(  -604.97), EASYSIMD_FLOAT32_C(  -738.90), EASYSIMD_FLOAT32_C(   557.86) },
      { EASYSIMD_FLOAT32_C(   817.35), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(  -232.89),
        EASYSIMD_FLOAT32_C(   502.57),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(  -881.23), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   285.45), EASYSIMD_FLOAT32_C(    -0.00),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   247.07) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 src = easysimd_mm512_loadu_ps(test_vec[i].src);
    easysimd__m512 a = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd__m512 b = easysimd_mm512_loadu_ps(test_vec[i].b);
    easysimd__m512 r = easysimd_mm512_mask_scalef_ps(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x16(r, easysimd_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x16_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m512 src = easysimd_test_x86_random_f32x16(EASYSIMD_FLOAT32_C(-1000.0), EASYSIMD_FLOAT32_C(1000.0));
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512 a = easysimd_test_x86_random_extract_f32x16(i, 2, 0, values);
    easysimd__m512 b = easysimd_test_x86_random_extract_f32x16(i, 2, 1, values);
    easysimd__m512 r = easysimd_mm512_mask_scalef_ps(src, k, a, b);

    easysimd_test_x86_write_f32x16(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_scalef_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask16 k;
    const easysimd_float32 a[16];
    const easysimd_float32 b[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { UINT16_C(60257),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   254.81),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(  -407.97),
        EASYSIMD_FLOAT32_C(   760.87), EASYSIMD_FLOAT32_C(  -325.12), EASYSIMD_FLOAT32_C(    16.51), EASYSIMD_FLOAT32_C(    38.28),
        EASYSIMD_FLOAT32_C(   599.38), EASYSIMD_FLOAT32_C(   485.34), EASYSIMD_FLOAT32_C(   133.72), EASYSIMD_FLOAT32_C(   580.55),
        EASYSIMD_FLOAT32_C(  -139.95), EASYSIMD_FLOAT32_C(  -474.22), EASYSIMD_FLOAT32_C(  -119.72), EASYSIMD_FLOAT32_C(   230.75) },
      { EASYSIMD_FLOAT32_C(   613.23),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   488.81),
        EASYSIMD_FLOAT32_C(   971.27), EASYSIMD_FLOAT32_C(   124.58), EASYSIMD_FLOAT32_C(  -409.85), EASYSIMD_FLOAT32_C(  -229.54),
        EASYSIMD_FLOAT32_C(  -583.28), EASYSIMD_FLOAT32_C(   611.22), EASYSIMD_FLOAT32_C(   -28.00), EASYSIMD_FLOAT32_C(   -40.38),
        EASYSIMD_FLOAT32_C(   556.64), EASYSIMD_FLOAT32_C(   264.91), EASYSIMD_FLOAT32_C(   835.06), EASYSIMD_FLOAT32_C(   -53.83) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(18948),
      { EASYSIMD_FLOAT32_C(  -480.28), EASYSIMD_FLOAT32_C(   460.06), EASYSIMD_FLOAT32_C(   538.20), EASYSIMD_FLOAT32_C(  -719.40),
        EASYSIMD_FLOAT32_C(  -865.06), EASYSIMD_FLOAT32_C(  -445.29), EASYSIMD_FLOAT32_C(   318.88), EASYSIMD_FLOAT32_C(   734.32),
        EASYSIMD_FLOAT32_C(  -959.95), EASYSIMD_FLOAT32_C(  -547.40), EASYSIMD_FLOAT32_C(   314.88), EASYSIMD_FLOAT32_C(   -99.90),
        EASYSIMD_FLOAT32_C(   -21.62), EASYSIMD_FLOAT32_C(  -804.84), EASYSIMD_FLOAT32_C(  -869.16), EASYSIMD_FLOAT32_C(  -408.39) },
      { EASYSIMD_FLOAT32_C(   239.48), EASYSIMD_FLOAT32_C(  -209.55), EASYSIMD_FLOAT32_C(  -919.58), EASYSIMD_FLOAT32_C(   210.74),
        EASYSIMD_FLOAT32_C(   915.03), EASYSIMD_FLOAT32_C(  -329.43), EASYSIMD_FLOAT32_C(   981.21), EASYSIMD_FLOAT32_C(  -668.25),
        EASYSIMD_FLOAT32_C(  -718.22), EASYSIMD_FLOAT32_C(   -46.79), EASYSIMD_FLOAT32_C(   291.36), EASYSIMD_FLOAT32_C(   838.42),
        EASYSIMD_FLOAT32_C(  -781.88), EASYSIMD_FLOAT32_C(   126.42), EASYSIMD_FLOAT32_C(  -215.40), EASYSIMD_FLOAT32_C(  -262.16) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(38861),
      { EASYSIMD_FLOAT32_C(  -413.52), EASYSIMD_FLOAT32_C(  -677.20), EASYSIMD_FLOAT32_C(    18.44), EASYSIMD_FLOAT32_C(  -278.58),
        EASYSIMD_FLOAT32_C(  -122.49), EASYSIMD_FLOAT32_C(  -662.68), EASYSIMD_FLOAT32_C(  -544.26), EASYSIMD_FLOAT32_C(   -82.44),
        EASYSIMD_FLOAT32_C(  -210.08), EASYSIMD_FLOAT32_C(   770.62), EASYSIMD_FLOAT32_C(   817.65), EASYSIMD_FLOAT32_C(   768.30),
        EASYSIMD_FLOAT32_C(   965.78), EASYSIMD_FLOAT32_C(   948.50), EASYSIMD_FLOAT32_C(  -640.09), EASYSIMD_FLOAT32_C(   205.26) },
      { EASYSIMD_FLOAT32_C(  -261.05), EASYSIMD_FLOAT32_C(  -559.68), EASYSIMD_FLOAT32_C(  -584.00), EASYSIMD_FLOAT32_C(  -346.02),
        EASYSIMD_FLOAT32_C(   110.89), EASYSIMD_FLOAT32_C(  -602.79), EASYSIMD_FLOAT32_C(   -14.27), EASYSIMD_FLOAT32_C(   392.68),
        EASYSIMD_FLOAT32_C(   350.41), EASYSIMD_FLOAT32_C(  -722.91), EASYSIMD_FLOAT32_C(   231.10), EASYSIMD_FLOAT32_C(   568.53),
        EASYSIMD_FLOAT32_C(   403.51), EASYSIMD_FLOAT32_C(  -984.30), EASYSIMD_FLOAT32_C(  -693.63), EASYSIMD_FLOAT32_C(   989.99) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.02),     -EASYSIMD_MATH_INFINITYF,
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT16_C( 9085),
      { EASYSIMD_FLOAT32_C(  -661.50), EASYSIMD_FLOAT32_C(   324.81), EASYSIMD_FLOAT32_C(  -288.59), EASYSIMD_FLOAT32_C(   216.01),
        EASYSIMD_FLOAT32_C(   662.13), EASYSIMD_FLOAT32_C(   167.15), EASYSIMD_FLOAT32_C(  -866.44), EASYSIMD_FLOAT32_C(  -547.95),
        EASYSIMD_FLOAT32_C(   -62.23), EASYSIMD_FLOAT32_C(   951.22), EASYSIMD_FLOAT32_C(  -779.65), EASYSIMD_FLOAT32_C(   -96.45),
        EASYSIMD_FLOAT32_C(   899.71), EASYSIMD_FLOAT32_C(  -419.75), EASYSIMD_FLOAT32_C(  -891.19), EASYSIMD_FLOAT32_C(  -361.34) },
      { EASYSIMD_FLOAT32_C(    20.58), EASYSIMD_FLOAT32_C(  -475.19), EASYSIMD_FLOAT32_C(   292.64), EASYSIMD_FLOAT32_C(  -868.53),
        EASYSIMD_FLOAT32_C(   -77.98), EASYSIMD_FLOAT32_C(  -721.63), EASYSIMD_FLOAT32_C(   524.15), EASYSIMD_FLOAT32_C(  -727.57),
        EASYSIMD_FLOAT32_C(  -444.54), EASYSIMD_FLOAT32_C(  -244.75), EASYSIMD_FLOAT32_C(   840.96), EASYSIMD_FLOAT32_C(   958.97),
        EASYSIMD_FLOAT32_C(  -229.06), EASYSIMD_FLOAT32_C(  -852.67), EASYSIMD_FLOAT32_C(   948.96), EASYSIMD_FLOAT32_C(   109.44) },
      { EASYSIMD_FLOAT32_C(-693633024.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(43730),
      { EASYSIMD_FLOAT32_C(   472.13), EASYSIMD_FLOAT32_C(  -339.63), EASYSIMD_FLOAT32_C(  -674.55), EASYSIMD_FLOAT32_C(   134.26),
        EASYSIMD_FLOAT32_C(   827.52), EASYSIMD_FLOAT32_C(  -540.99), EASYSIMD_FLOAT32_C(   586.31), EASYSIMD_FLOAT32_C(  -234.71),
        EASYSIMD_FLOAT32_C(  -589.77), EASYSIMD_FLOAT32_C(   806.65), EASYSIMD_FLOAT32_C(   668.84), EASYSIMD_FLOAT32_C(  -690.06),
        EASYSIMD_FLOAT32_C(  -613.09), EASYSIMD_FLOAT32_C(   777.65), EASYSIMD_FLOAT32_C(   -51.40), EASYSIMD_FLOAT32_C(   407.49) },
      { EASYSIMD_FLOAT32_C(  -697.54), EASYSIMD_FLOAT32_C(  -758.76), EASYSIMD_FLOAT32_C(   538.96), EASYSIMD_FLOAT32_C(   224.47),
        EASYSIMD_FLOAT32_C(  -480.40), EASYSIMD_FLOAT32_C(    63.11), EASYSIMD_FLOAT32_C(   496.90), EASYSIMD_FLOAT32_C(    75.06),
        EASYSIMD_FLOAT32_C(   818.35), EASYSIMD_FLOAT32_C(   337.86), EASYSIMD_FLOAT32_C(    34.03), EASYSIMD_FLOAT32_C(  -410.70),
        EASYSIMD_FLOAT32_C(   485.18), EASYSIMD_FLOAT32_C(   -17.01), EASYSIMD_FLOAT32_C(   698.74), EASYSIMD_FLOAT32_C(   -42.68) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(-8867093351197406438359040.00),
        EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(37360),
      { EASYSIMD_FLOAT32_C(   643.36), EASYSIMD_FLOAT32_C(  -975.82), EASYSIMD_FLOAT32_C(  -908.42), EASYSIMD_FLOAT32_C(   470.88),
        EASYSIMD_FLOAT32_C(  -516.81), EASYSIMD_FLOAT32_C(   677.89), EASYSIMD_FLOAT32_C(  -763.83), EASYSIMD_FLOAT32_C(  -106.58),
        EASYSIMD_FLOAT32_C(   484.54), EASYSIMD_FLOAT32_C(   905.01), EASYSIMD_FLOAT32_C(   203.36), EASYSIMD_FLOAT32_C(   871.45),
        EASYSIMD_FLOAT32_C(   682.65), EASYSIMD_FLOAT32_C(  -848.04), EASYSIMD_FLOAT32_C(   278.94), EASYSIMD_FLOAT32_C(   985.11) },
      { EASYSIMD_FLOAT32_C(  -606.80), EASYSIMD_FLOAT32_C(  -182.10), EASYSIMD_FLOAT32_C(   209.58), EASYSIMD_FLOAT32_C(   -87.20),
        EASYSIMD_FLOAT32_C(   881.00), EASYSIMD_FLOAT32_C(  -293.52), EASYSIMD_FLOAT32_C(   987.86), EASYSIMD_FLOAT32_C(   699.35),
        EASYSIMD_FLOAT32_C(  -955.66), EASYSIMD_FLOAT32_C(    21.89), EASYSIMD_FLOAT32_C(  -711.35), EASYSIMD_FLOAT32_C(   529.52),
        EASYSIMD_FLOAT32_C(  -995.12), EASYSIMD_FLOAT32_C(   987.39), EASYSIMD_FLOAT32_C(  -513.16), EASYSIMD_FLOAT32_C(   648.24) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),     -EASYSIMD_MATH_INFINITYF,     -EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF } },
    { UINT16_C(23765),
      { EASYSIMD_FLOAT32_C(  -988.43), EASYSIMD_FLOAT32_C(  -421.58), EASYSIMD_FLOAT32_C(   119.12), EASYSIMD_FLOAT32_C(  -505.24),
        EASYSIMD_FLOAT32_C(  -743.69), EASYSIMD_FLOAT32_C(   355.29), EASYSIMD_FLOAT32_C(   388.18), EASYSIMD_FLOAT32_C(   740.85),
        EASYSIMD_FLOAT32_C(   260.29), EASYSIMD_FLOAT32_C(  -408.46), EASYSIMD_FLOAT32_C(   612.30), EASYSIMD_FLOAT32_C(   -57.05),
        EASYSIMD_FLOAT32_C(  -256.50), EASYSIMD_FLOAT32_C(  -108.76), EASYSIMD_FLOAT32_C(   -71.94), EASYSIMD_FLOAT32_C(   136.70) },
      { EASYSIMD_FLOAT32_C(   709.14), EASYSIMD_FLOAT32_C(  -862.36), EASYSIMD_FLOAT32_C(  -950.50), EASYSIMD_FLOAT32_C(   590.14),
        EASYSIMD_FLOAT32_C(  -155.88), EASYSIMD_FLOAT32_C(  -962.63), EASYSIMD_FLOAT32_C(   289.49), EASYSIMD_FLOAT32_C(  -111.55),
        EASYSIMD_FLOAT32_C(    59.26), EASYSIMD_FLOAT32_C(   578.14), EASYSIMD_FLOAT32_C(  -582.02), EASYSIMD_FLOAT32_C(    64.14),
        EASYSIMD_FLOAT32_C(   565.53), EASYSIMD_FLOAT32_C(   -95.18), EASYSIMD_FLOAT32_C(  -287.62), EASYSIMD_FLOAT32_C(   577.10) },
      {     -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(-1052386735331381084160.00),
            -EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00) } },
    { UINT16_C(13355),
      { EASYSIMD_FLOAT32_C(   483.24), EASYSIMD_FLOAT32_C(   831.50), EASYSIMD_FLOAT32_C(  -928.13), EASYSIMD_FLOAT32_C(   739.55),
        EASYSIMD_FLOAT32_C(   186.79), EASYSIMD_FLOAT32_C(   460.05), EASYSIMD_FLOAT32_C(   480.40), EASYSIMD_FLOAT32_C(  -552.91),
        EASYSIMD_FLOAT32_C(  -948.41), EASYSIMD_FLOAT32_C(    92.70), EASYSIMD_FLOAT32_C(   390.03), EASYSIMD_FLOAT32_C(  -204.90),
        EASYSIMD_FLOAT32_C(   983.95), EASYSIMD_FLOAT32_C(  -681.91), EASYSIMD_FLOAT32_C(   931.80), EASYSIMD_FLOAT32_C(   693.08) },
      { EASYSIMD_FLOAT32_C(  -544.27), EASYSIMD_FLOAT32_C(   981.30), EASYSIMD_FLOAT32_C(   283.22), EASYSIMD_FLOAT32_C(   299.84),
        EASYSIMD_FLOAT32_C(  -981.34), EASYSIMD_FLOAT32_C(  -427.29), EASYSIMD_FLOAT32_C(  -811.70), EASYSIMD_FLOAT32_C(    77.92),
        EASYSIMD_FLOAT32_C(  -849.14), EASYSIMD_FLOAT32_C(  -393.73), EASYSIMD_FLOAT32_C(  -857.94), EASYSIMD_FLOAT32_C(   716.39),
        EASYSIMD_FLOAT32_C(   511.09), EASYSIMD_FLOAT32_C(  -145.55), EASYSIMD_FLOAT32_C(   293.49), EASYSIMD_FLOAT32_C(    -5.67) },
      { EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(     0.00),      EASYSIMD_MATH_INFINITYF,
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
        EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00),
             EASYSIMD_MATH_INFINITYF, EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 a = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd__m512 b = easysimd_mm512_loadu_ps(test_vec[i].b);
    easysimd__m512 r = easysimd_mm512_maskz_scalef_ps(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x16(r, easysimd_mm512_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x16_full(8, 2, values, -1000.0f, 1000.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512 a = easysimd_test_x86_random_extract_f32x16(i, 2, 0, values);
    easysimd__m512 b = easysimd_test_x86_random_extract_f32x16(i, 2, 1, values);
    easysimd__m512 r = easysimd_mm512_maskz_scalef_ps(k, a, b);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 a[2];
    const easysimd_float64 b[2];
    const easysimd_float64 r[2];
  } test_vec[] = {
    { {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    14.65) },
      { EASYSIMD_FLOAT64_C(    73.76),             EASYSIMD_MATH_NAN },
      {             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN } },
    { {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -30.10) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -60.62) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    -0.00) } },
    { { EASYSIMD_FLOAT64_C(    18.39), EASYSIMD_FLOAT64_C(   -19.05) },
      { EASYSIMD_FLOAT64_C(     8.69), EASYSIMD_FLOAT64_C(     2.38) },
      { EASYSIMD_FLOAT64_C(  4707.84), EASYSIMD_FLOAT64_C(   -76.20) } },
    { { EASYSIMD_FLOAT64_C(   -25.14), EASYSIMD_FLOAT64_C(    99.57) },
      { EASYSIMD_FLOAT64_C(    63.92), EASYSIMD_FLOAT64_C(    15.05) },
      { EASYSIMD_FLOAT64_C(-231875573006529069056.00), EASYSIMD_FLOAT64_C(3262709.76) } },
    { { EASYSIMD_FLOAT64_C(   -26.71), EASYSIMD_FLOAT64_C(   -61.81) },
      { EASYSIMD_FLOAT64_C(    53.58), EASYSIMD_FLOAT64_C(   -85.95) },
      { EASYSIMD_FLOAT64_C(-240582292094131904.00), EASYSIMD_FLOAT64_C(    -0.00) } },
    { { EASYSIMD_FLOAT64_C(    30.91), EASYSIMD_FLOAT64_C(    80.20) },
      { EASYSIMD_FLOAT64_C(   -51.60), EASYSIMD_FLOAT64_C(   -87.81) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { { EASYSIMD_FLOAT64_C(    50.75), EASYSIMD_FLOAT64_C(   -84.71) },
      { EASYSIMD_FLOAT64_C(   -31.49), EASYSIMD_FLOAT64_C(    85.93) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-3277059397745767354566967296.00) } },
    { { EASYSIMD_FLOAT64_C(   -22.94), EASYSIMD_FLOAT64_C(     9.42) },
      { EASYSIMD_FLOAT64_C(    83.85), EASYSIMD_FLOAT64_C(     4.58) },
      { EASYSIMD_FLOAT64_C(-221862066415676758511583232.00), EASYSIMD_FLOAT64_C(   150.72) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128d a = easysimd_mm_loadu_pd(test_vec[i].a);
    easysimd__m128d b = easysimd_mm_loadu_pd(test_vec[i].b);
    easysimd__m128d r = easysimd_mm_scalef_pd(a, b);
    easysimd_test_x86_assert_equal_f64x2(r, easysimd_mm_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x2_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128d a = easysimd_test_x86_random_extract_f64x2(i, 2, 0, values);
    easysimd__m128d b = easysimd_test_x86_random_extract_f64x2(i, 2, 1, values);
    easysimd__m128d r = easysimd_mm_scalef_pd(a, b);

    easysimd_test_x86_write_f64x2(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_mask_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 src[2];
    const easysimd__mmask8 k;
    const easysimd_float64 a[2];
    const easysimd_float64 b[2];
    const easysimd_float64 r[2];
  } test_vec[] = {
    { { EASYSIMD_FLOAT64_C(  -683.93), EASYSIMD_FLOAT64_C(  -643.14) },
      UINT8_C( 97),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    57.61) },
      { EASYSIMD_FLOAT64_C(    53.43),             EASYSIMD_MATH_NAN },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(  -643.14) } },
    { { EASYSIMD_FLOAT64_C(  -408.83), EASYSIMD_FLOAT64_C(   845.11) },
      UINT8_C( 22),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    48.83) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    45.90) },
      { EASYSIMD_FLOAT64_C(  -408.83), EASYSIMD_FLOAT64_C(1718052889097666.50) } },
    { { EASYSIMD_FLOAT64_C(  -949.80), EASYSIMD_FLOAT64_C(  -857.08) },
      UINT8_C(201),
      { EASYSIMD_FLOAT64_C(   -70.22), EASYSIMD_FLOAT64_C(    50.02) },
      { EASYSIMD_FLOAT64_C(   -51.72), EASYSIMD_FLOAT64_C(     4.64) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(  -857.08) } },
    { { EASYSIMD_FLOAT64_C(  -466.99), EASYSIMD_FLOAT64_C(   189.32) },
      UINT8_C(190),
      { EASYSIMD_FLOAT64_C(    49.59), EASYSIMD_FLOAT64_C(   -87.80) },
      { EASYSIMD_FLOAT64_C(   -80.31), EASYSIMD_FLOAT64_C(   -77.12) },
      { EASYSIMD_FLOAT64_C(  -466.99), EASYSIMD_FLOAT64_C(    -0.00) } },
    { { EASYSIMD_FLOAT64_C(  -344.95), EASYSIMD_FLOAT64_C(   386.18) },
      UINT8_C(156),
      { EASYSIMD_FLOAT64_C(   -49.61), EASYSIMD_FLOAT64_C(    73.26) },
      { EASYSIMD_FLOAT64_C(   -63.07), EASYSIMD_FLOAT64_C(    81.30) },
      { EASYSIMD_FLOAT64_C(  -344.95), EASYSIMD_FLOAT64_C(   386.18) } },
    { { EASYSIMD_FLOAT64_C(   158.99), EASYSIMD_FLOAT64_C(   118.79) },
      UINT8_C( 37),
      { EASYSIMD_FLOAT64_C(    53.46), EASYSIMD_FLOAT64_C(   -14.67) },
      { EASYSIMD_FLOAT64_C(    93.50), EASYSIMD_FLOAT64_C(     4.21) },
      { EASYSIMD_FLOAT64_C(529442196001571444413106749440.00), EASYSIMD_FLOAT64_C(   118.79) } },
    { { EASYSIMD_FLOAT64_C(   -27.96), EASYSIMD_FLOAT64_C(  -346.62) },
      UINT8_C(189),
      { EASYSIMD_FLOAT64_C(     0.62), EASYSIMD_FLOAT64_C(   -37.99) },
      { EASYSIMD_FLOAT64_C(    -9.86), EASYSIMD_FLOAT64_C(    77.68) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(  -346.62) } },
    { { EASYSIMD_FLOAT64_C(   -93.00), EASYSIMD_FLOAT64_C(   695.44) },
      UINT8_C(140),
      { EASYSIMD_FLOAT64_C(    71.43), EASYSIMD_FLOAT64_C(   -26.01) },
      { EASYSIMD_FLOAT64_C(   -17.74), EASYSIMD_FLOAT64_C(    95.49) },
      { EASYSIMD_FLOAT64_C(   -93.00), EASYSIMD_FLOAT64_C(   695.44) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128d src = easysimd_mm_loadu_pd(test_vec[i].src);
    easysimd__m128d a = easysimd_mm_loadu_pd(test_vec[i].a);
    easysimd__m128d b = easysimd_mm_loadu_pd(test_vec[i].b);
    easysimd__m128d r = easysimd_mm_mask_scalef_pd(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x2(r, easysimd_mm_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x2_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128d src = easysimd_test_x86_random_f64x2(EASYSIMD_FLOAT64_C(-1000.0), EASYSIMD_FLOAT64_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128d a = easysimd_test_x86_random_extract_f64x2(i, 2, 0, values);
    easysimd__m128d b = easysimd_test_x86_random_extract_f64x2(i, 2, 1, values);
    easysimd__m128d r = easysimd_mm_mask_scalef_pd(src, k, a, b);

    easysimd_test_x86_write_f64x2(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float64 a[2];
    const easysimd_float64 b[2];
    const easysimd_float64 r[2];
  } test_vec[] = {
    { UINT8_C(123),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -40.32) },
      { EASYSIMD_FLOAT64_C(    61.82),             EASYSIMD_MATH_NAN },
      {             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN } },
    { UINT8_C( 40),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -55.92) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    65.28) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(206),
      { EASYSIMD_FLOAT64_C(   -20.24), EASYSIMD_FLOAT64_C(    17.07) },
      { EASYSIMD_FLOAT64_C(   -75.60), EASYSIMD_FLOAT64_C(   -35.73) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(202),
      { EASYSIMD_FLOAT64_C(    55.84), EASYSIMD_FLOAT64_C(   -70.58) },
      { EASYSIMD_FLOAT64_C(   -21.43), EASYSIMD_FLOAT64_C(    44.63) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-1241656491014881.25) } },
    { UINT8_C( 11),
      { EASYSIMD_FLOAT64_C(   -17.28), EASYSIMD_FLOAT64_C(    97.50) },
      { EASYSIMD_FLOAT64_C(   -16.98), EASYSIMD_FLOAT64_C(    48.23) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(27443810229288960.00) } },
    { UINT8_C(223),
      { EASYSIMD_FLOAT64_C(    36.11), EASYSIMD_FLOAT64_C(   -55.71) },
      { EASYSIMD_FLOAT64_C(   -35.87), EASYSIMD_FLOAT64_C(   -52.01) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00) } },
    { UINT8_C(137),
      { EASYSIMD_FLOAT64_C(   -57.52), EASYSIMD_FLOAT64_C(    61.33) },
      { EASYSIMD_FLOAT64_C(    13.33), EASYSIMD_FLOAT64_C(    26.00) },
      { EASYSIMD_FLOAT64_C(-471203.84), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(221),
      { EASYSIMD_FLOAT64_C(   -47.97), EASYSIMD_FLOAT64_C(   -17.12) },
      { EASYSIMD_FLOAT64_C(    10.14), EASYSIMD_FLOAT64_C(   -95.26) },
      { EASYSIMD_FLOAT64_C(-49121.28), EASYSIMD_FLOAT64_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128d a = easysimd_mm_loadu_pd(test_vec[i].a);
    easysimd__m128d b = easysimd_mm_loadu_pd(test_vec[i].b);
    easysimd__m128d r = easysimd_mm_maskz_scalef_pd(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x2(r, easysimd_mm_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x2_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128d a = easysimd_test_x86_random_extract_f64x2(i, 2, 0, values);
    easysimd__m128d b = easysimd_test_x86_random_extract_f64x2(i, 2, 1, values);
    easysimd__m128d r = easysimd_mm_maskz_scalef_pd(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x2(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 a[4];
    const easysimd_float64 b[4];
    const easysimd_float64 r[4];
  } test_vec[] = {
    { {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -98.02),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    14.34) },
      { EASYSIMD_FLOAT64_C(    22.61),             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -40.04) },
      {             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(     0.00) } },
    { { EASYSIMD_FLOAT64_C(    -4.76), EASYSIMD_FLOAT64_C(     2.92), EASYSIMD_FLOAT64_C(    74.43), EASYSIMD_FLOAT64_C(    19.75) },
      { EASYSIMD_FLOAT64_C(     1.84), EASYSIMD_FLOAT64_C(   -74.38), EASYSIMD_FLOAT64_C(   -33.99), EASYSIMD_FLOAT64_C(   -68.40) },
      { EASYSIMD_FLOAT64_C(    -9.52), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { { EASYSIMD_FLOAT64_C(    68.17), EASYSIMD_FLOAT64_C(   -15.58), EASYSIMD_FLOAT64_C(    50.42), EASYSIMD_FLOAT64_C(   -37.05) },
      { EASYSIMD_FLOAT64_C(   -69.82), EASYSIMD_FLOAT64_C(   -94.10), EASYSIMD_FLOAT64_C(    71.05), EASYSIMD_FLOAT64_C(   -56.51) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(119050859033143759863808.00), EASYSIMD_FLOAT64_C(    -0.00) } },
    { { EASYSIMD_FLOAT64_C(   -36.90), EASYSIMD_FLOAT64_C(    88.15), EASYSIMD_FLOAT64_C(    42.92), EASYSIMD_FLOAT64_C(   -12.71) },
      { EASYSIMD_FLOAT64_C(    79.73), EASYSIMD_FLOAT64_C(   -61.58), EASYSIMD_FLOAT64_C(   -58.02), EASYSIMD_FLOAT64_C(     6.34) },
      { EASYSIMD_FLOAT64_C(-22304681371889907414335488.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(  -813.44) } },
    { { EASYSIMD_FLOAT64_C(   -59.60), EASYSIMD_FLOAT64_C(   -82.73), EASYSIMD_FLOAT64_C(   -79.32), EASYSIMD_FLOAT64_C(    63.02) },
      { EASYSIMD_FLOAT64_C(    65.75), EASYSIMD_FLOAT64_C(    91.64), EASYSIMD_FLOAT64_C(   -77.02), EASYSIMD_FLOAT64_C(   -39.01) },
      { EASYSIMD_FLOAT64_C(-2198851893586178605056.00), EASYSIMD_FLOAT64_C(-204829558900159030136433278976.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { { EASYSIMD_FLOAT64_C(    -5.44), EASYSIMD_FLOAT64_C(    97.41), EASYSIMD_FLOAT64_C(    80.74), EASYSIMD_FLOAT64_C(    96.39) },
      { EASYSIMD_FLOAT64_C(   -76.97), EASYSIMD_FLOAT64_C(   -53.25), EASYSIMD_FLOAT64_C(   -72.00), EASYSIMD_FLOAT64_C(    91.20) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(238650080773435610802428051456.00) } },
    { { EASYSIMD_FLOAT64_C(    31.18), EASYSIMD_FLOAT64_C(    78.42), EASYSIMD_FLOAT64_C(   -45.85), EASYSIMD_FLOAT64_C(    61.36) },
      { EASYSIMD_FLOAT64_C(    84.31), EASYSIMD_FLOAT64_C(   -74.80), EASYSIMD_FLOAT64_C(   -95.16), EASYSIMD_FLOAT64_C(   -52.59) },
      { EASYSIMD_FLOAT64_C(603108912889346197179858944.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { { EASYSIMD_FLOAT64_C(   -86.66), EASYSIMD_FLOAT64_C(    47.76), EASYSIMD_FLOAT64_C(    34.70), EASYSIMD_FLOAT64_C(    93.08) },
      { EASYSIMD_FLOAT64_C(    86.19), EASYSIMD_FLOAT64_C(    76.68), EASYSIMD_FLOAT64_C(    -0.58), EASYSIMD_FLOAT64_C(   -73.41) },
      { EASYSIMD_FLOAT64_C(-6704992737779440650039590912.00), EASYSIMD_FLOAT64_C(3608643571549667936174080.00), EASYSIMD_FLOAT64_C(    17.35), EASYSIMD_FLOAT64_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256d a = easysimd_mm256_loadu_pd(test_vec[i].a);
    easysimd__m256d b = easysimd_mm256_loadu_pd(test_vec[i].b);
    easysimd__m256d r = easysimd_mm256_scalef_pd(a, b);
    easysimd_test_x86_assert_equal_f64x4(r, easysimd_mm256_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x4_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m256d a = easysimd_test_x86_random_extract_f64x4(i, 2, 0, values);
    easysimd__m256d b = easysimd_test_x86_random_extract_f64x4(i, 2, 1, values);
    easysimd__m256d r = easysimd_mm256_scalef_pd(a, b);

    easysimd_test_x86_write_f64x4(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_mask_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 src[4];
    const easysimd__mmask8 k;
    const easysimd_float64 a[4];
    const easysimd_float64 b[4];
    const easysimd_float64 r[4];
  } test_vec[] = {
    { { EASYSIMD_FLOAT64_C(  -835.99), EASYSIMD_FLOAT64_C(    39.26), EASYSIMD_FLOAT64_C(   644.55), EASYSIMD_FLOAT64_C(   246.88) },
      UINT8_C( 98),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    20.10),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    59.70) },
      { EASYSIMD_FLOAT64_C(    11.73),             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -93.71) },
      { EASYSIMD_FLOAT64_C(  -835.99),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   644.55), EASYSIMD_FLOAT64_C(   246.88) } },
    { { EASYSIMD_FLOAT64_C(  -880.30), EASYSIMD_FLOAT64_C(  -570.31), EASYSIMD_FLOAT64_C(   584.35), EASYSIMD_FLOAT64_C(  -378.30) },
      UINT8_C(  6),
      { EASYSIMD_FLOAT64_C(   -90.01), EASYSIMD_FLOAT64_C(   -98.57), EASYSIMD_FLOAT64_C(   -97.32), EASYSIMD_FLOAT64_C(   -66.98) },
      { EASYSIMD_FLOAT64_C(   -51.82), EASYSIMD_FLOAT64_C(   -69.32), EASYSIMD_FLOAT64_C(   -75.78), EASYSIMD_FLOAT64_C(    79.36) },
      { EASYSIMD_FLOAT64_C(  -880.30), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(  -378.30) } },
    { { EASYSIMD_FLOAT64_C(   345.86), EASYSIMD_FLOAT64_C(   430.52), EASYSIMD_FLOAT64_C(   697.90), EASYSIMD_FLOAT64_C(   -99.07) },
      UINT8_C( 91),
      { EASYSIMD_FLOAT64_C(   -90.90), EASYSIMD_FLOAT64_C(   -21.63), EASYSIMD_FLOAT64_C(    40.71), EASYSIMD_FLOAT64_C(    93.41) },
      { EASYSIMD_FLOAT64_C(     3.56), EASYSIMD_FLOAT64_C(    45.56), EASYSIMD_FLOAT64_C(   -59.18), EASYSIMD_FLOAT64_C(    16.91) },
      { EASYSIMD_FLOAT64_C(  -727.20), EASYSIMD_FLOAT64_C(-761037968281436.12), EASYSIMD_FLOAT64_C(   697.90), EASYSIMD_FLOAT64_C(6121717.76) } },
    { { EASYSIMD_FLOAT64_C(  -763.22), EASYSIMD_FLOAT64_C(   863.15), EASYSIMD_FLOAT64_C(   164.23), EASYSIMD_FLOAT64_C(   811.29) },
      UINT8_C(249),
      { EASYSIMD_FLOAT64_C(    -6.68), EASYSIMD_FLOAT64_C(    75.52), EASYSIMD_FLOAT64_C(     9.98), EASYSIMD_FLOAT64_C(   -20.49) },
      { EASYSIMD_FLOAT64_C(    52.20), EASYSIMD_FLOAT64_C(   -90.60), EASYSIMD_FLOAT64_C(     6.09), EASYSIMD_FLOAT64_C(    46.15) },
      { EASYSIMD_FLOAT64_C(-30084045510834912.00), EASYSIMD_FLOAT64_C(   863.15), EASYSIMD_FLOAT64_C(   164.23), EASYSIMD_FLOAT64_C(-1441855568200335.25) } },
    { { EASYSIMD_FLOAT64_C(  -593.66), EASYSIMD_FLOAT64_C(  -445.14), EASYSIMD_FLOAT64_C(   631.97), EASYSIMD_FLOAT64_C(   403.63) },
      UINT8_C( 71),
      { EASYSIMD_FLOAT64_C(    29.49), EASYSIMD_FLOAT64_C(    -4.30), EASYSIMD_FLOAT64_C(     5.85), EASYSIMD_FLOAT64_C(   -58.77) },
      { EASYSIMD_FLOAT64_C(     8.29), EASYSIMD_FLOAT64_C(    26.54), EASYSIMD_FLOAT64_C(   -52.48), EASYSIMD_FLOAT64_C(    18.28) },
      { EASYSIMD_FLOAT64_C(  7549.44), EASYSIMD_FLOAT64_C(-288568115.20), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   403.63) } },
    { { EASYSIMD_FLOAT64_C(   778.03), EASYSIMD_FLOAT64_C(   922.89), EASYSIMD_FLOAT64_C(  -664.40), EASYSIMD_FLOAT64_C(   -14.97) },
      UINT8_C(118),
      { EASYSIMD_FLOAT64_C(    27.97), EASYSIMD_FLOAT64_C(   -49.80), EASYSIMD_FLOAT64_C(    51.30), EASYSIMD_FLOAT64_C(    76.15) },
      { EASYSIMD_FLOAT64_C(   -19.12), EASYSIMD_FLOAT64_C(    75.52), EASYSIMD_FLOAT64_C(    55.51), EASYSIMD_FLOAT64_C(   -10.02) },
      { EASYSIMD_FLOAT64_C(   778.03), EASYSIMD_FLOAT64_C(-1881390806775266545762304.00), EASYSIMD_FLOAT64_C(1848277287072851456.00), EASYSIMD_FLOAT64_C(   -14.97) } },
    { { EASYSIMD_FLOAT64_C(   567.88), EASYSIMD_FLOAT64_C(   149.04), EASYSIMD_FLOAT64_C(   -57.09), EASYSIMD_FLOAT64_C(   212.43) },
      UINT8_C(210),
      { EASYSIMD_FLOAT64_C(   -46.11), EASYSIMD_FLOAT64_C(    -3.78), EASYSIMD_FLOAT64_C(   -16.61), EASYSIMD_FLOAT64_C(    57.45) },
      { EASYSIMD_FLOAT64_C(   -58.22), EASYSIMD_FLOAT64_C(    24.21), EASYSIMD_FLOAT64_C(   -25.64), EASYSIMD_FLOAT64_C(    35.10) },
      { EASYSIMD_FLOAT64_C(   567.88), EASYSIMD_FLOAT64_C(-63417876.48), EASYSIMD_FLOAT64_C(   -57.09), EASYSIMD_FLOAT64_C(   212.43) } },
    { { EASYSIMD_FLOAT64_C(   247.57), EASYSIMD_FLOAT64_C(   332.13), EASYSIMD_FLOAT64_C(  -174.39), EASYSIMD_FLOAT64_C(  -168.09) },
      UINT8_C( 28),
      { EASYSIMD_FLOAT64_C(    -0.27), EASYSIMD_FLOAT64_C(    84.34), EASYSIMD_FLOAT64_C(   -85.39), EASYSIMD_FLOAT64_C(   -48.07) },
      { EASYSIMD_FLOAT64_C(    93.74), EASYSIMD_FLOAT64_C(    20.70), EASYSIMD_FLOAT64_C(    98.08), EASYSIMD_FLOAT64_C(    23.23) },
      { EASYSIMD_FLOAT64_C(   247.57), EASYSIMD_FLOAT64_C(   332.13), EASYSIMD_FLOAT64_C(-27061171188372127328594856771584.00), EASYSIMD_FLOAT64_C(-403240386.56) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256d src = easysimd_mm256_loadu_pd(test_vec[i].src);
    easysimd__m256d a = easysimd_mm256_loadu_pd(test_vec[i].a);
    easysimd__m256d b = easysimd_mm256_loadu_pd(test_vec[i].b);
    easysimd__m256d r = easysimd_mm256_mask_scalef_pd(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x4(r, easysimd_mm256_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x4_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m256d src = easysimd_test_x86_random_f64x4(EASYSIMD_FLOAT64_C(-1000.0), EASYSIMD_FLOAT64_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256d a = easysimd_test_x86_random_extract_f64x4(i, 2, 0, values);
    easysimd__m256d b = easysimd_test_x86_random_extract_f64x4(i, 2, 1, values);
    easysimd__m256d r = easysimd_mm256_mask_scalef_pd(src, k, a, b);

    easysimd_test_x86_write_f64x4(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float64 a[4];
    const easysimd_float64 b[4];
    const easysimd_float64 r[4];
  } test_vec[] = {
    { UINT8_C( 69),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -82.22),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -53.38) },
      { EASYSIMD_FLOAT64_C(     7.87),             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    -5.81) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(     0.00),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(236),
      { EASYSIMD_FLOAT64_C(   -12.11), EASYSIMD_FLOAT64_C(   -48.57), EASYSIMD_FLOAT64_C(    22.28), EASYSIMD_FLOAT64_C(    28.52) },
      { EASYSIMD_FLOAT64_C(     6.91), EASYSIMD_FLOAT64_C(   -14.52), EASYSIMD_FLOAT64_C(   -31.11), EASYSIMD_FLOAT64_C(    46.74) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(2006916583946977.25) } },
    { UINT8_C( 31),
      { EASYSIMD_FLOAT64_C(   -36.72), EASYSIMD_FLOAT64_C(   -38.82), EASYSIMD_FLOAT64_C(    80.30), EASYSIMD_FLOAT64_C(    61.79) },
      { EASYSIMD_FLOAT64_C(   -48.46), EASYSIMD_FLOAT64_C(    37.08), EASYSIMD_FLOAT64_C(   -23.31), EASYSIMD_FLOAT64_C(    45.83) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(-5335380173783.04), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(2174042351368929.25) } },
    { UINT8_C(147),
      { EASYSIMD_FLOAT64_C(   -41.67), EASYSIMD_FLOAT64_C(    16.28), EASYSIMD_FLOAT64_C(   -29.41), EASYSIMD_FLOAT64_C(    91.54) },
      { EASYSIMD_FLOAT64_C(    98.84), EASYSIMD_FLOAT64_C(    53.78), EASYSIMD_FLOAT64_C(    86.92), EASYSIMD_FLOAT64_C(   -24.33) },
      { EASYSIMD_FLOAT64_C(-13205750127877580330523860926464.00), EASYSIMD_FLOAT64_C(146637203867183360.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C( 72),
      { EASYSIMD_FLOAT64_C(    71.56), EASYSIMD_FLOAT64_C(    25.36), EASYSIMD_FLOAT64_C(    22.29), EASYSIMD_FLOAT64_C(   -20.57) },
      { EASYSIMD_FLOAT64_C(    -3.18), EASYSIMD_FLOAT64_C(    92.59), EASYSIMD_FLOAT64_C(    73.62), EASYSIMD_FLOAT64_C(    84.72) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-397881665751566759476854784.00) } },
    { UINT8_C(232),
      { EASYSIMD_FLOAT64_C(   -55.98), EASYSIMD_FLOAT64_C(    -4.10), EASYSIMD_FLOAT64_C(    13.24), EASYSIMD_FLOAT64_C(    50.93) },
      { EASYSIMD_FLOAT64_C(    81.38), EASYSIMD_FLOAT64_C(    82.13), EASYSIMD_FLOAT64_C(    -2.33), EASYSIMD_FLOAT64_C(   -55.34) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(160),
      { EASYSIMD_FLOAT64_C(   -56.69), EASYSIMD_FLOAT64_C(   -22.04), EASYSIMD_FLOAT64_C(   -93.56), EASYSIMD_FLOAT64_C(    -5.15) },
      { EASYSIMD_FLOAT64_C(   -84.95), EASYSIMD_FLOAT64_C(   -16.87), EASYSIMD_FLOAT64_C(   -59.32), EASYSIMD_FLOAT64_C(   -26.63) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C( 29),
      { EASYSIMD_FLOAT64_C(    99.42), EASYSIMD_FLOAT64_C(    11.27), EASYSIMD_FLOAT64_C(   -35.09), EASYSIMD_FLOAT64_C(    98.26) },
      { EASYSIMD_FLOAT64_C(   -34.94), EASYSIMD_FLOAT64_C(   -48.16), EASYSIMD_FLOAT64_C(   -26.07), EASYSIMD_FLOAT64_C(   -63.38) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256d a = easysimd_mm256_loadu_pd(test_vec[i].a);
    easysimd__m256d b = easysimd_mm256_loadu_pd(test_vec[i].b);
    easysimd__m256d r = easysimd_mm256_maskz_scalef_pd(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x4(r, easysimd_mm256_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x4_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256d a = easysimd_test_x86_random_extract_f64x4(i, 2, 0, values);
    easysimd__m256d b = easysimd_test_x86_random_extract_f64x4(i, 2, 1, values);
    easysimd__m256d r = easysimd_mm256_maskz_scalef_pd(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 a[8];
    const easysimd_float64 b[8];
    const easysimd_float64 r[8];
  } test_vec[] = {
    { {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(     3.52),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    82.72),
        EASYSIMD_FLOAT64_C(   -70.09), EASYSIMD_FLOAT64_C(    38.95), EASYSIMD_FLOAT64_C(   -64.55), EASYSIMD_FLOAT64_C(    80.50) },
      { EASYSIMD_FLOAT64_C(    55.63),             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    88.21),
        EASYSIMD_FLOAT64_C(   -89.05), EASYSIMD_FLOAT64_C(    49.51), EASYSIMD_FLOAT64_C(    20.06), EASYSIMD_FLOAT64_C(    16.65) },
      {             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(25600600012421663733070168064.00),
        EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(21926900685760104.00), EASYSIMD_FLOAT64_C(-67685580.80), EASYSIMD_FLOAT64_C(5275648.00) } },
    { { EASYSIMD_FLOAT64_C(    72.14), EASYSIMD_FLOAT64_C(   -64.35), EASYSIMD_FLOAT64_C(   -86.99), EASYSIMD_FLOAT64_C(    12.78),
        EASYSIMD_FLOAT64_C(    48.87), EASYSIMD_FLOAT64_C(    35.58), EASYSIMD_FLOAT64_C(   -50.15), EASYSIMD_FLOAT64_C(   -28.04) },
      { EASYSIMD_FLOAT64_C(   -50.35), EASYSIMD_FLOAT64_C(    12.93), EASYSIMD_FLOAT64_C(   -43.72), EASYSIMD_FLOAT64_C(    45.63),
        EASYSIMD_FLOAT64_C(    18.72), EASYSIMD_FLOAT64_C(    92.32), EASYSIMD_FLOAT64_C(   -91.81), EASYSIMD_FLOAT64_C(    52.08) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-263577.60), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(449656275295272.94),
        EASYSIMD_FLOAT64_C(12810977.28), EASYSIMD_FLOAT64_C(176183626391095312279394058240.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(-126280933551468704.00) } },
    { { EASYSIMD_FLOAT64_C(    -4.16), EASYSIMD_FLOAT64_C(   -75.71), EASYSIMD_FLOAT64_C(    34.79), EASYSIMD_FLOAT64_C(    25.75),
        EASYSIMD_FLOAT64_C(    63.24), EASYSIMD_FLOAT64_C(    70.24), EASYSIMD_FLOAT64_C(     6.25), EASYSIMD_FLOAT64_C(    18.87) },
      { EASYSIMD_FLOAT64_C(    52.58), EASYSIMD_FLOAT64_C(   -80.99), EASYSIMD_FLOAT64_C(     7.07), EASYSIMD_FLOAT64_C(    63.54),
        EASYSIMD_FLOAT64_C(    68.52), EASYSIMD_FLOAT64_C(   -72.86), EASYSIMD_FLOAT64_C(   -19.81), EASYSIMD_FLOAT64_C(    40.66) },
      { EASYSIMD_FLOAT64_C(-18734974449861264.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(  4453.12), EASYSIMD_FLOAT64_C(237501829949010477056.00),
        EASYSIMD_FLOAT64_C(18665153523542273294336.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(20747784416133.12) } },
    { { EASYSIMD_FLOAT64_C(   -37.21), EASYSIMD_FLOAT64_C(    -6.81), EASYSIMD_FLOAT64_C(   -46.56), EASYSIMD_FLOAT64_C(   -88.34),
        EASYSIMD_FLOAT64_C(   -71.23), EASYSIMD_FLOAT64_C(     3.29), EASYSIMD_FLOAT64_C(   -16.38), EASYSIMD_FLOAT64_C(   -21.58) },
      { EASYSIMD_FLOAT64_C(   -83.78), EASYSIMD_FLOAT64_C(    39.89), EASYSIMD_FLOAT64_C(   -75.94), EASYSIMD_FLOAT64_C(    34.93),
        EASYSIMD_FLOAT64_C(    32.21), EASYSIMD_FLOAT64_C(   -67.75), EASYSIMD_FLOAT64_C(   -12.99), EASYSIMD_FLOAT64_C(   -71.95) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(-3743837092577.28), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(-1517669643714.56),
        EASYSIMD_FLOAT64_C(-305930520494.08), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(    -0.00) } },
    { { EASYSIMD_FLOAT64_C(   -43.46), EASYSIMD_FLOAT64_C(   -78.20), EASYSIMD_FLOAT64_C(    53.80), EASYSIMD_FLOAT64_C(   -80.23),
        EASYSIMD_FLOAT64_C(    92.04), EASYSIMD_FLOAT64_C(   -39.95), EASYSIMD_FLOAT64_C(    38.64), EASYSIMD_FLOAT64_C(    44.63) },
      { EASYSIMD_FLOAT64_C(   -20.94), EASYSIMD_FLOAT64_C(   -54.29), EASYSIMD_FLOAT64_C(     8.17), EASYSIMD_FLOAT64_C(   -52.42),
        EASYSIMD_FLOAT64_C(   -27.15), EASYSIMD_FLOAT64_C(    88.35), EASYSIMD_FLOAT64_C(    88.24), EASYSIMD_FLOAT64_C(    35.64) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C( 13772.80), EASYSIMD_FLOAT64_C(    -0.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-12363926142362736375164305408.00), EASYSIMD_FLOAT64_C(11958500779496773631447400448.00), EASYSIMD_FLOAT64_C(1533475123363.84) } },
    { { EASYSIMD_FLOAT64_C(   -18.45), EASYSIMD_FLOAT64_C(   -58.32), EASYSIMD_FLOAT64_C(    47.30), EASYSIMD_FLOAT64_C(    10.32),
        EASYSIMD_FLOAT64_C(    44.97), EASYSIMD_FLOAT64_C(   -69.08), EASYSIMD_FLOAT64_C(    88.74), EASYSIMD_FLOAT64_C(    61.18) },
      { EASYSIMD_FLOAT64_C(    70.81), EASYSIMD_FLOAT64_C(   -87.20), EASYSIMD_FLOAT64_C(    -3.89), EASYSIMD_FLOAT64_C(     3.02),
        EASYSIMD_FLOAT64_C(   -54.95), EASYSIMD_FLOAT64_C(    83.12), EASYSIMD_FLOAT64_C(    31.07), EASYSIMD_FLOAT64_C(     1.58) },
      { EASYSIMD_FLOAT64_C(-21781915402236237709312.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     2.96), EASYSIMD_FLOAT64_C(    82.56),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-668100764951828650616946688.00), EASYSIMD_FLOAT64_C(190567698923.52), EASYSIMD_FLOAT64_C(   122.36) } },
    { { EASYSIMD_FLOAT64_C(   -95.08), EASYSIMD_FLOAT64_C(   -15.13), EASYSIMD_FLOAT64_C(    21.36), EASYSIMD_FLOAT64_C(    96.97),
        EASYSIMD_FLOAT64_C(    44.91), EASYSIMD_FLOAT64_C(   -40.00), EASYSIMD_FLOAT64_C(    41.60), EASYSIMD_FLOAT64_C(   -76.03) },
      { EASYSIMD_FLOAT64_C(     5.71), EASYSIMD_FLOAT64_C(   -50.24), EASYSIMD_FLOAT64_C(   -28.45), EASYSIMD_FLOAT64_C(    78.56),
        EASYSIMD_FLOAT64_C(   -61.89), EASYSIMD_FLOAT64_C(   -40.21), EASYSIMD_FLOAT64_C(    14.19), EASYSIMD_FLOAT64_C(    19.66) },
      { EASYSIMD_FLOAT64_C( -3042.56), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(29307384182007647424217088.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(681574.40), EASYSIMD_FLOAT64_C(-39861616.64) } },
    { { EASYSIMD_FLOAT64_C(     1.47), EASYSIMD_FLOAT64_C(   -38.51), EASYSIMD_FLOAT64_C(   -70.02), EASYSIMD_FLOAT64_C(   -53.56),
        EASYSIMD_FLOAT64_C(    -7.59), EASYSIMD_FLOAT64_C(   -81.28), EASYSIMD_FLOAT64_C(   -92.38), EASYSIMD_FLOAT64_C(   -36.78) },
      { EASYSIMD_FLOAT64_C(   -68.49), EASYSIMD_FLOAT64_C(     3.73), EASYSIMD_FLOAT64_C(    66.24), EASYSIMD_FLOAT64_C(   -23.44),
        EASYSIMD_FLOAT64_C(   -13.15), EASYSIMD_FLOAT64_C(    -2.69), EASYSIMD_FLOAT64_C(    78.14), EASYSIMD_FLOAT64_C(    -8.22) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(  -308.08), EASYSIMD_FLOAT64_C(-5166564080164570923008.00), EASYSIMD_FLOAT64_C(    -0.00),
        EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(   -10.16), EASYSIMD_FLOAT64_C(-27920141803999859415449600.00), EASYSIMD_FLOAT64_C(    -0.07) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512d a = easysimd_mm512_loadu_pd(test_vec[i].a);
    easysimd__m512d b = easysimd_mm512_loadu_pd(test_vec[i].b);
    easysimd__m512d r = easysimd_mm512_scalef_pd(a, b);
    easysimd_test_x86_assert_equal_f64x8(r, easysimd_mm512_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x8_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m512d a = easysimd_test_x86_random_extract_f64x8(i, 2, 0, values);
    easysimd__m512d b = easysimd_test_x86_random_extract_f64x8(i, 2, 1, values);
    easysimd__m512d r = easysimd_mm512_scalef_pd(a, b);

    easysimd_test_x86_write_f64x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_mask_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 src[8];
    const easysimd__mmask8 k;
    const easysimd_float64 a[8];
    const easysimd_float64 b[8];
    const easysimd_float64 r[8];
  } test_vec[] = {
    { { EASYSIMD_FLOAT64_C(  -161.86), EASYSIMD_FLOAT64_C(  -689.84), EASYSIMD_FLOAT64_C(  -760.83), EASYSIMD_FLOAT64_C(  -853.23),
        EASYSIMD_FLOAT64_C(    59.60), EASYSIMD_FLOAT64_C(  -500.46), EASYSIMD_FLOAT64_C(  -972.68), EASYSIMD_FLOAT64_C(   329.52) },
      UINT8_C( 53),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    -0.50),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    27.08),
        EASYSIMD_FLOAT64_C(    59.49), EASYSIMD_FLOAT64_C(   -69.66), EASYSIMD_FLOAT64_C(    51.05), EASYSIMD_FLOAT64_C(   -34.80) },
      { EASYSIMD_FLOAT64_C(   -19.90),             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    18.21),
        EASYSIMD_FLOAT64_C(   -17.60), EASYSIMD_FLOAT64_C(    57.95), EASYSIMD_FLOAT64_C(   -62.13), EASYSIMD_FLOAT64_C(    83.87) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(  -689.84),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(  -853.23),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-10039064001364119552.00), EASYSIMD_FLOAT64_C(  -972.68), EASYSIMD_FLOAT64_C(   329.52) } },
    { { EASYSIMD_FLOAT64_C(   466.56), EASYSIMD_FLOAT64_C(   875.54), EASYSIMD_FLOAT64_C(  -763.98), EASYSIMD_FLOAT64_C(   645.69),
        EASYSIMD_FLOAT64_C(  -868.26), EASYSIMD_FLOAT64_C(   770.97), EASYSIMD_FLOAT64_C(  -135.66), EASYSIMD_FLOAT64_C(  -602.20) },
      UINT8_C(134),
      { EASYSIMD_FLOAT64_C(   -80.56), EASYSIMD_FLOAT64_C(   -32.15), EASYSIMD_FLOAT64_C(   -69.69), EASYSIMD_FLOAT64_C(    11.85),
        EASYSIMD_FLOAT64_C(   -13.44), EASYSIMD_FLOAT64_C(   -62.07), EASYSIMD_FLOAT64_C(    75.06), EASYSIMD_FLOAT64_C(    18.08) },
      { EASYSIMD_FLOAT64_C(    41.66), EASYSIMD_FLOAT64_C(    41.30), EASYSIMD_FLOAT64_C(    94.63), EASYSIMD_FLOAT64_C(   -71.49),
        EASYSIMD_FLOAT64_C(   -61.39), EASYSIMD_FLOAT64_C(    72.78), EASYSIMD_FLOAT64_C(    20.29), EASYSIMD_FLOAT64_C(   -79.22) },
      { EASYSIMD_FLOAT64_C(   466.56), EASYSIMD_FLOAT64_C(-70698597665996.80), EASYSIMD_FLOAT64_C(-1380352661404770376687523201024.00), EASYSIMD_FLOAT64_C(   645.69),
        EASYSIMD_FLOAT64_C(  -868.26), EASYSIMD_FLOAT64_C(   770.97), EASYSIMD_FLOAT64_C(  -135.66), EASYSIMD_FLOAT64_C(     0.00) } },
    { { EASYSIMD_FLOAT64_C(   172.80), EASYSIMD_FLOAT64_C(  -845.80), EASYSIMD_FLOAT64_C(  -987.32), EASYSIMD_FLOAT64_C(  -965.66),
        EASYSIMD_FLOAT64_C(  -172.29), EASYSIMD_FLOAT64_C(   -41.83), EASYSIMD_FLOAT64_C(   298.33), EASYSIMD_FLOAT64_C(   572.92) },
      UINT8_C(149),
      { EASYSIMD_FLOAT64_C(   -27.73), EASYSIMD_FLOAT64_C(   -90.97), EASYSIMD_FLOAT64_C(    47.86), EASYSIMD_FLOAT64_C(   -68.23),
        EASYSIMD_FLOAT64_C(   -60.63), EASYSIMD_FLOAT64_C(    -1.09), EASYSIMD_FLOAT64_C(    -3.03), EASYSIMD_FLOAT64_C(    19.47) },
      { EASYSIMD_FLOAT64_C(    21.52), EASYSIMD_FLOAT64_C(    40.73), EASYSIMD_FLOAT64_C(   -62.31), EASYSIMD_FLOAT64_C(   -96.08),
        EASYSIMD_FLOAT64_C(    -1.32), EASYSIMD_FLOAT64_C(   -24.44), EASYSIMD_FLOAT64_C(    87.79), EASYSIMD_FLOAT64_C(    18.12) },
      { EASYSIMD_FLOAT64_C(-58154024.96), EASYSIMD_FLOAT64_C(  -845.80), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(  -965.66),
        EASYSIMD_FLOAT64_C(   -15.16), EASYSIMD_FLOAT64_C(   -41.83), EASYSIMD_FLOAT64_C(   298.33), EASYSIMD_FLOAT64_C(5103943.68) } },
    { { EASYSIMD_FLOAT64_C(    21.90), EASYSIMD_FLOAT64_C(  -732.90), EASYSIMD_FLOAT64_C(  -290.17), EASYSIMD_FLOAT64_C(  -259.18),
        EASYSIMD_FLOAT64_C(   105.25), EASYSIMD_FLOAT64_C(    19.99), EASYSIMD_FLOAT64_C(   -20.01), EASYSIMD_FLOAT64_C(   252.01) },
      UINT8_C( 47),
      { EASYSIMD_FLOAT64_C(    43.41), EASYSIMD_FLOAT64_C(   -81.90), EASYSIMD_FLOAT64_C(   -70.04), EASYSIMD_FLOAT64_C(   -70.03),
        EASYSIMD_FLOAT64_C(   -43.98), EASYSIMD_FLOAT64_C(   -94.97), EASYSIMD_FLOAT64_C(    48.05), EASYSIMD_FLOAT64_C(    97.68) },
      { EASYSIMD_FLOAT64_C(    46.33), EASYSIMD_FLOAT64_C(    42.68), EASYSIMD_FLOAT64_C(   -73.81), EASYSIMD_FLOAT64_C(    84.94),
        EASYSIMD_FLOAT64_C(    15.46), EASYSIMD_FLOAT64_C(    46.48), EASYSIMD_FLOAT64_C(   -94.29), EASYSIMD_FLOAT64_C(    87.73) },
      { EASYSIMD_FLOAT64_C(3054707184752394.00), EASYSIMD_FLOAT64_C(-360200009259417.62), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(-1354577202361799719665008640.00),
        EASYSIMD_FLOAT64_C(   105.25), EASYSIMD_FLOAT64_C(-6682919634552750.00), EASYSIMD_FLOAT64_C(   -20.01), EASYSIMD_FLOAT64_C(   252.01) } },
    { { EASYSIMD_FLOAT64_C(   479.53), EASYSIMD_FLOAT64_C(   279.33), EASYSIMD_FLOAT64_C(   409.11), EASYSIMD_FLOAT64_C(  -981.28),
        EASYSIMD_FLOAT64_C(  -254.11), EASYSIMD_FLOAT64_C(   284.65), EASYSIMD_FLOAT64_C(  -745.27), EASYSIMD_FLOAT64_C(  -608.42) },
      UINT8_C(  4),
      { EASYSIMD_FLOAT64_C(    55.51), EASYSIMD_FLOAT64_C(    53.58), EASYSIMD_FLOAT64_C(   -80.50), EASYSIMD_FLOAT64_C(    94.89),
        EASYSIMD_FLOAT64_C(   -47.51), EASYSIMD_FLOAT64_C(    16.47), EASYSIMD_FLOAT64_C(    14.36), EASYSIMD_FLOAT64_C(    74.01) },
      { EASYSIMD_FLOAT64_C(   -42.81), EASYSIMD_FLOAT64_C(    52.05), EASYSIMD_FLOAT64_C(    77.93), EASYSIMD_FLOAT64_C(    55.87),
        EASYSIMD_FLOAT64_C(   -72.39), EASYSIMD_FLOAT64_C(    65.72), EASYSIMD_FLOAT64_C(   -26.01), EASYSIMD_FLOAT64_C(    71.02) },
      { EASYSIMD_FLOAT64_C(   479.53), EASYSIMD_FLOAT64_C(   279.33), EASYSIMD_FLOAT64_C(-12164816059872206070480896.00), EASYSIMD_FLOAT64_C(  -981.28),
        EASYSIMD_FLOAT64_C(  -254.11), EASYSIMD_FLOAT64_C(   284.65), EASYSIMD_FLOAT64_C(  -745.27), EASYSIMD_FLOAT64_C(  -608.42) } },
    { { EASYSIMD_FLOAT64_C(  -974.30), EASYSIMD_FLOAT64_C(   255.92), EASYSIMD_FLOAT64_C(   814.19), EASYSIMD_FLOAT64_C(   729.95),
        EASYSIMD_FLOAT64_C(  -571.28), EASYSIMD_FLOAT64_C(   968.38), EASYSIMD_FLOAT64_C(   742.63), EASYSIMD_FLOAT64_C(  -536.94) },
      UINT8_C( 19),
      { EASYSIMD_FLOAT64_C(    83.81), EASYSIMD_FLOAT64_C(     3.95), EASYSIMD_FLOAT64_C(   -99.01), EASYSIMD_FLOAT64_C(   -60.17),
        EASYSIMD_FLOAT64_C(     8.98), EASYSIMD_FLOAT64_C(    49.03), EASYSIMD_FLOAT64_C(   -62.49), EASYSIMD_FLOAT64_C(   -44.69) },
      { EASYSIMD_FLOAT64_C(    -8.29), EASYSIMD_FLOAT64_C(   -36.29), EASYSIMD_FLOAT64_C(   -59.76), EASYSIMD_FLOAT64_C(   -92.83),
        EASYSIMD_FLOAT64_C(   -89.81), EASYSIMD_FLOAT64_C(   -54.04), EASYSIMD_FLOAT64_C(    94.90), EASYSIMD_FLOAT64_C(    65.70) },
      { EASYSIMD_FLOAT64_C(     0.16), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   814.19), EASYSIMD_FLOAT64_C(   729.95),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   968.38), EASYSIMD_FLOAT64_C(   742.63), EASYSIMD_FLOAT64_C(  -536.94) } },
    { { EASYSIMD_FLOAT64_C(  -299.20), EASYSIMD_FLOAT64_C(   761.39), EASYSIMD_FLOAT64_C(  -630.98), EASYSIMD_FLOAT64_C(  -293.69),
        EASYSIMD_FLOAT64_C(  -216.71), EASYSIMD_FLOAT64_C(  -363.88), EASYSIMD_FLOAT64_C(   416.14), EASYSIMD_FLOAT64_C(   524.11) },
      UINT8_C(105),
      { EASYSIMD_FLOAT64_C(    99.53), EASYSIMD_FLOAT64_C(   -85.60), EASYSIMD_FLOAT64_C(    60.58), EASYSIMD_FLOAT64_C(   -47.97),
        EASYSIMD_FLOAT64_C(    30.86), EASYSIMD_FLOAT64_C(   -25.06), EASYSIMD_FLOAT64_C(   -73.96), EASYSIMD_FLOAT64_C(    88.06) },
      { EASYSIMD_FLOAT64_C(   -73.01), EASYSIMD_FLOAT64_C(   -96.03), EASYSIMD_FLOAT64_C(    43.92), EASYSIMD_FLOAT64_C(   -45.40),
        EASYSIMD_FLOAT64_C(    69.68), EASYSIMD_FLOAT64_C(   -82.09), EASYSIMD_FLOAT64_C(   -74.38), EASYSIMD_FLOAT64_C(    53.49) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   761.39), EASYSIMD_FLOAT64_C(  -630.98), EASYSIMD_FLOAT64_C(    -0.00),
        EASYSIMD_FLOAT64_C(  -216.71), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(   524.11) } },
    { { EASYSIMD_FLOAT64_C(  -563.87), EASYSIMD_FLOAT64_C(  -495.90), EASYSIMD_FLOAT64_C(    -6.62), EASYSIMD_FLOAT64_C(  -484.29),
        EASYSIMD_FLOAT64_C(   983.63), EASYSIMD_FLOAT64_C(  -727.29), EASYSIMD_FLOAT64_C(   924.82), EASYSIMD_FLOAT64_C(  -997.65) },
      UINT8_C(190),
      { EASYSIMD_FLOAT64_C(    21.87), EASYSIMD_FLOAT64_C(   -73.39), EASYSIMD_FLOAT64_C(    93.33), EASYSIMD_FLOAT64_C(   -69.15),
        EASYSIMD_FLOAT64_C(    75.64), EASYSIMD_FLOAT64_C(   -69.16), EASYSIMD_FLOAT64_C(   -13.85), EASYSIMD_FLOAT64_C(   -32.65) },
      { EASYSIMD_FLOAT64_C(    -5.45), EASYSIMD_FLOAT64_C(    26.40), EASYSIMD_FLOAT64_C(   -25.48), EASYSIMD_FLOAT64_C(     4.73),
        EASYSIMD_FLOAT64_C(    72.36), EASYSIMD_FLOAT64_C(   -30.58), EASYSIMD_FLOAT64_C(   -29.57), EASYSIMD_FLOAT64_C(    71.89) },
      { EASYSIMD_FLOAT64_C(  -563.87), EASYSIMD_FLOAT64_C(-4925119528.96), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C( -1106.40),
        EASYSIMD_FLOAT64_C(357199800764259966648320.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(   924.82), EASYSIMD_FLOAT64_C(-77092632832846954758144.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512d src = easysimd_mm512_loadu_pd(test_vec[i].src);
    easysimd__m512d a = easysimd_mm512_loadu_pd(test_vec[i].a);
    easysimd__m512d b = easysimd_mm512_loadu_pd(test_vec[i].b);
    easysimd__m512d r = easysimd_mm512_mask_scalef_pd(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x8(r, easysimd_mm512_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x8_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m512d src = easysimd_test_x86_random_f64x8(EASYSIMD_FLOAT64_C(-1000.0), EASYSIMD_FLOAT64_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m512d a = easysimd_test_x86_random_extract_f64x8(i, 2, 0, values);
    easysimd__m512d b = easysimd_test_x86_random_extract_f64x8(i, 2, 1, values);
    easysimd__m512d r = easysimd_mm512_mask_scalef_pd(src, k, a, b);

    easysimd_test_x86_write_f64x8(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_scalef_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float64 a[8];
    const easysimd_float64 b[8];
    const easysimd_float64 r[8];
  } test_vec[] = {
    { UINT8_C( 75),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -74.29),             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -37.41),
        EASYSIMD_FLOAT64_C(   -71.72), EASYSIMD_FLOAT64_C(   -33.39), EASYSIMD_FLOAT64_C(   -55.99), EASYSIMD_FLOAT64_C(   -98.73) },
      { EASYSIMD_FLOAT64_C(     9.48),             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    55.79),
        EASYSIMD_FLOAT64_C(    20.45), EASYSIMD_FLOAT64_C(   -54.38), EASYSIMD_FLOAT64_C(    31.93), EASYSIMD_FLOAT64_C(    57.36) },
      {             EASYSIMD_MATH_NAN,             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-1347837296479441920.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-120237609451.52), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(115),
      { EASYSIMD_FLOAT64_C(    16.25), EASYSIMD_FLOAT64_C(   -89.74), EASYSIMD_FLOAT64_C(   -79.03), EASYSIMD_FLOAT64_C(   -42.14),
        EASYSIMD_FLOAT64_C(    62.67), EASYSIMD_FLOAT64_C(    95.10), EASYSIMD_FLOAT64_C(     1.47), EASYSIMD_FLOAT64_C(   -86.92) },
      { EASYSIMD_FLOAT64_C(    -5.56), EASYSIMD_FLOAT64_C(    53.05), EASYSIMD_FLOAT64_C(   -88.56), EASYSIMD_FLOAT64_C(    21.71),
        EASYSIMD_FLOAT64_C(    45.53), EASYSIMD_FLOAT64_C(   -88.32), EASYSIMD_FLOAT64_C(   -76.43), EASYSIMD_FLOAT64_C(   -33.52) },
      { EASYSIMD_FLOAT64_C(     0.25), EASYSIMD_FLOAT64_C(-808306061120456576.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00),
        EASYSIMD_FLOAT64_C(2205004598807101.50), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(182),
      { EASYSIMD_FLOAT64_C(   -62.62), EASYSIMD_FLOAT64_C(    64.59), EASYSIMD_FLOAT64_C(    29.06), EASYSIMD_FLOAT64_C(   -34.34),
        EASYSIMD_FLOAT64_C(   -68.80), EASYSIMD_FLOAT64_C(    73.07), EASYSIMD_FLOAT64_C(   -33.07), EASYSIMD_FLOAT64_C(    40.68) },
      { EASYSIMD_FLOAT64_C(   -86.09), EASYSIMD_FLOAT64_C(   -57.53), EASYSIMD_FLOAT64_C(    -3.53), EASYSIMD_FLOAT64_C(    34.36),
        EASYSIMD_FLOAT64_C(   -11.91), EASYSIMD_FLOAT64_C(   -71.60), EASYSIMD_FLOAT64_C(    -8.28), EASYSIMD_FLOAT64_C(   -95.66) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     1.82), EASYSIMD_FLOAT64_C(     0.00),
        EASYSIMD_FLOAT64_C(    -0.02), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C( 11),
      { EASYSIMD_FLOAT64_C(   -61.35), EASYSIMD_FLOAT64_C(    12.69), EASYSIMD_FLOAT64_C(   -37.80), EASYSIMD_FLOAT64_C(   -98.68),
        EASYSIMD_FLOAT64_C(     7.79), EASYSIMD_FLOAT64_C(    63.67), EASYSIMD_FLOAT64_C(   -85.60), EASYSIMD_FLOAT64_C(   -97.77) },
      { EASYSIMD_FLOAT64_C(    16.72), EASYSIMD_FLOAT64_C(   -74.16), EASYSIMD_FLOAT64_C(    23.94), EASYSIMD_FLOAT64_C(   -37.75),
        EASYSIMD_FLOAT64_C(   -62.49), EASYSIMD_FLOAT64_C(    47.52), EASYSIMD_FLOAT64_C(    28.72), EASYSIMD_FLOAT64_C(   -25.10) },
      { EASYSIMD_FLOAT64_C(-4020633.60), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C( 86),
      { EASYSIMD_FLOAT64_C(    12.11), EASYSIMD_FLOAT64_C(   -42.22), EASYSIMD_FLOAT64_C(    40.56), EASYSIMD_FLOAT64_C(    43.31),
        EASYSIMD_FLOAT64_C(   -69.15), EASYSIMD_FLOAT64_C(   -92.51), EASYSIMD_FLOAT64_C(   -16.01), EASYSIMD_FLOAT64_C(   -55.24) },
      { EASYSIMD_FLOAT64_C(   -50.04), EASYSIMD_FLOAT64_C(    80.46), EASYSIMD_FLOAT64_C(    79.12), EASYSIMD_FLOAT64_C(    38.05),
        EASYSIMD_FLOAT64_C(   -91.14), EASYSIMD_FLOAT64_C(   -29.16), EASYSIMD_FLOAT64_C(    42.39), EASYSIMD_FLOAT64_C(   -52.49) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-51040848104129642381705216.00), EASYSIMD_FLOAT64_C(24517015621784681037430784.00), EASYSIMD_FLOAT64_C(     0.00),
        EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-70412724642775.05), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(100),
      { EASYSIMD_FLOAT64_C(    83.52), EASYSIMD_FLOAT64_C(   -95.42), EASYSIMD_FLOAT64_C(   -51.17), EASYSIMD_FLOAT64_C(    -8.69),
        EASYSIMD_FLOAT64_C(    68.26), EASYSIMD_FLOAT64_C(   -36.77), EASYSIMD_FLOAT64_C(    -6.45), EASYSIMD_FLOAT64_C(   -15.03) },
      { EASYSIMD_FLOAT64_C(   -10.93), EASYSIMD_FLOAT64_C(   -82.51), EASYSIMD_FLOAT64_C(    47.22), EASYSIMD_FLOAT64_C(    26.58),
        EASYSIMD_FLOAT64_C(    65.01), EASYSIMD_FLOAT64_C(   -24.06), EASYSIMD_FLOAT64_C(   -98.52), EASYSIMD_FLOAT64_C(   -22.88) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(-7201537279142134.00), EASYSIMD_FLOAT64_C(     0.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(135),
      { EASYSIMD_FLOAT64_C(    33.72), EASYSIMD_FLOAT64_C(    42.04), EASYSIMD_FLOAT64_C(   -79.57), EASYSIMD_FLOAT64_C(    64.57),
        EASYSIMD_FLOAT64_C(    49.53), EASYSIMD_FLOAT64_C(     4.42), EASYSIMD_FLOAT64_C(   -90.67), EASYSIMD_FLOAT64_C(    99.49) },
      { EASYSIMD_FLOAT64_C(   -15.11), EASYSIMD_FLOAT64_C(    88.45), EASYSIMD_FLOAT64_C(    37.55), EASYSIMD_FLOAT64_C(    -6.25),
        EASYSIMD_FLOAT64_C(   -40.71), EASYSIMD_FLOAT64_C(   -20.07), EASYSIMD_FLOAT64_C(    41.26), EASYSIMD_FLOAT64_C(   -57.19) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(13010749812889346425307004928.00), EASYSIMD_FLOAT64_C(-10936017527767.04), EASYSIMD_FLOAT64_C(     0.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
    { UINT8_C(  5),
      { EASYSIMD_FLOAT64_C(   -15.48), EASYSIMD_FLOAT64_C(    90.09), EASYSIMD_FLOAT64_C(    34.13), EASYSIMD_FLOAT64_C(   -47.23),
        EASYSIMD_FLOAT64_C(   -46.68), EASYSIMD_FLOAT64_C(   -72.33), EASYSIMD_FLOAT64_C(    37.75), EASYSIMD_FLOAT64_C(    42.39) },
      { EASYSIMD_FLOAT64_C(   -54.84), EASYSIMD_FLOAT64_C(   -15.03), EASYSIMD_FLOAT64_C(   -31.03), EASYSIMD_FLOAT64_C(   -89.83),
        EASYSIMD_FLOAT64_C(    60.91), EASYSIMD_FLOAT64_C(   -29.55), EASYSIMD_FLOAT64_C(   -12.71), EASYSIMD_FLOAT64_C(    -5.37) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00),
        EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(     0.00) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512d a = easysimd_mm512_loadu_pd(test_vec[i].a);
    easysimd__m512d b = easysimd_mm512_loadu_pd(test_vec[i].b);
    easysimd__m512d r = easysimd_mm512_maskz_scalef_pd(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x8(r, easysimd_mm512_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x8_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m512d a = easysimd_test_x86_random_extract_f64x8(i, 2, 0, values);
    easysimd__m512d b = easysimd_test_x86_random_extract_f64x8(i, 2, 1, values);
    easysimd__m512d r = easysimd_mm512_maskz_scalef_pd(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_scalef_ss (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     8.46),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -43.86) },
      { EASYSIMD_FLOAT32_C(     2.77),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    94.26) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(     8.46),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -43.86) } },
    { { EASYSIMD_FLOAT32_C(    22.22), EASYSIMD_FLOAT32_C(    99.63), EASYSIMD_FLOAT32_C(    63.82), EASYSIMD_FLOAT32_C(   -81.67) },
      { EASYSIMD_FLOAT32_C(    56.56), EASYSIMD_FLOAT32_C(    -8.28), EASYSIMD_FLOAT32_C(   -19.28), EASYSIMD_FLOAT32_C(   -43.97) },
      { EASYSIMD_FLOAT32_C(1601119690044735488.00), EASYSIMD_FLOAT32_C(    99.63), EASYSIMD_FLOAT32_C(    63.82), EASYSIMD_FLOAT32_C(   -81.67) } },
    { { EASYSIMD_FLOAT32_C(   -70.33), EASYSIMD_FLOAT32_C(    37.05), EASYSIMD_FLOAT32_C(   -71.07), EASYSIMD_FLOAT32_C(    34.14) },
      { EASYSIMD_FLOAT32_C(   -79.13), EASYSIMD_FLOAT32_C(    49.31), EASYSIMD_FLOAT32_C(    -6.87), EASYSIMD_FLOAT32_C(    71.23) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    37.05), EASYSIMD_FLOAT32_C(   -71.07), EASYSIMD_FLOAT32_C(    34.14) } },
    { { EASYSIMD_FLOAT32_C(    29.98), EASYSIMD_FLOAT32_C(    69.93), EASYSIMD_FLOAT32_C(   -39.05), EASYSIMD_FLOAT32_C(   -77.82) },
      { EASYSIMD_FLOAT32_C(   -34.23), EASYSIMD_FLOAT32_C(   -95.61), EASYSIMD_FLOAT32_C(   -20.06), EASYSIMD_FLOAT32_C(    75.82) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(    69.93), EASYSIMD_FLOAT32_C(   -39.05), EASYSIMD_FLOAT32_C(   -77.82) } },
    { { EASYSIMD_FLOAT32_C(    12.85), EASYSIMD_FLOAT32_C(    72.11), EASYSIMD_FLOAT32_C(   -68.04), EASYSIMD_FLOAT32_C(   -84.38) },
      { EASYSIMD_FLOAT32_C(    93.74), EASYSIMD_FLOAT32_C(   -93.74), EASYSIMD_FLOAT32_C(   -90.12), EASYSIMD_FLOAT32_C(    15.95) },
      { EASYSIMD_FLOAT32_C(127260239816430278555346141184.00), EASYSIMD_FLOAT32_C(    72.11), EASYSIMD_FLOAT32_C(   -68.04), EASYSIMD_FLOAT32_C(   -84.38) } },
    { { EASYSIMD_FLOAT32_C(   -94.12), EASYSIMD_FLOAT32_C(    73.70), EASYSIMD_FLOAT32_C(    34.29), EASYSIMD_FLOAT32_C(    62.45) },
      { EASYSIMD_FLOAT32_C(   -34.57), EASYSIMD_FLOAT32_C(   -85.00), EASYSIMD_FLOAT32_C(   -81.52), EASYSIMD_FLOAT32_C(    -4.90) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(    73.70), EASYSIMD_FLOAT32_C(    34.29), EASYSIMD_FLOAT32_C(    62.45) } },
    { { EASYSIMD_FLOAT32_C(    52.06), EASYSIMD_FLOAT32_C(   -52.60), EASYSIMD_FLOAT32_C(   -70.76), EASYSIMD_FLOAT32_C(    72.93) },
      { EASYSIMD_FLOAT32_C(    96.71), EASYSIMD_FLOAT32_C(    22.38), EASYSIMD_FLOAT32_C(    44.16), EASYSIMD_FLOAT32_C(    26.69) },
      { EASYSIMD_FLOAT32_C(4124618249295925180436523778048.00), EASYSIMD_FLOAT32_C(   -52.60), EASYSIMD_FLOAT32_C(   -70.76), EASYSIMD_FLOAT32_C(    72.93) } },
    { { EASYSIMD_FLOAT32_C(    -7.69), EASYSIMD_FLOAT32_C(   -94.90), EASYSIMD_FLOAT32_C(    48.88), EASYSIMD_FLOAT32_C(    58.08) },
      { EASYSIMD_FLOAT32_C(   -90.51), EASYSIMD_FLOAT32_C(   -71.19), EASYSIMD_FLOAT32_C(    33.90), EASYSIMD_FLOAT32_C(    22.34) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   -94.90), EASYSIMD_FLOAT32_C(    48.88), EASYSIMD_FLOAT32_C(    58.08) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 a = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128 b = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128 r = easysimd_mm_scalef_ss(a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128 a = easysimd_test_x86_random_extract_f32x4(i, 2, 0, values);
    easysimd__m128 b = easysimd_test_x86_random_extract_f32x4(i, 2, 1, values);
    easysimd__m128 r = easysimd_mm_scalef_ss(a, b);

    easysimd_test_x86_write_f32x4(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_mask_scalef_ss (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 src[4];
    const easysimd__mmask8 k;
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(   321.56), EASYSIMD_FLOAT32_C(   103.07), EASYSIMD_FLOAT32_C(   870.41), EASYSIMD_FLOAT32_C(   353.61) },
      UINT8_C( 68),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    14.74),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -72.92) },
      { EASYSIMD_FLOAT32_C(    42.33),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -50.64) },
      { EASYSIMD_FLOAT32_C(   321.56), EASYSIMD_FLOAT32_C(    14.74),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -72.92) } },
    { { EASYSIMD_FLOAT32_C(   573.63), EASYSIMD_FLOAT32_C(  -621.46), EASYSIMD_FLOAT32_C(  -603.81), EASYSIMD_FLOAT32_C(  -953.39) },
      UINT8_C(119),
      { EASYSIMD_FLOAT32_C(    -0.71), EASYSIMD_FLOAT32_C(    -1.98), EASYSIMD_FLOAT32_C(   -23.02), EASYSIMD_FLOAT32_C(    52.28) },
      { EASYSIMD_FLOAT32_C(    95.17), EASYSIMD_FLOAT32_C(   -63.55), EASYSIMD_FLOAT32_C(    71.25), EASYSIMD_FLOAT32_C(    69.36) },
      { EASYSIMD_FLOAT32_C(-28125996842537872929171963904.00), EASYSIMD_FLOAT32_C(    -1.98), EASYSIMD_FLOAT32_C(   -23.02), EASYSIMD_FLOAT32_C(    52.28) } },
    { { EASYSIMD_FLOAT32_C(   484.51), EASYSIMD_FLOAT32_C(  -115.93), EASYSIMD_FLOAT32_C(   186.45), EASYSIMD_FLOAT32_C(  -733.62) },
      UINT8_C( 47),
      { EASYSIMD_FLOAT32_C(    64.20), EASYSIMD_FLOAT32_C(   -96.12), EASYSIMD_FLOAT32_C(   -96.39), EASYSIMD_FLOAT32_C(   -17.49) },
      { EASYSIMD_FLOAT32_C(   -36.36), EASYSIMD_FLOAT32_C(   -78.88), EASYSIMD_FLOAT32_C(    -0.44), EASYSIMD_FLOAT32_C(    32.66) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -96.12), EASYSIMD_FLOAT32_C(   -96.39), EASYSIMD_FLOAT32_C(   -17.49) } },
    { { EASYSIMD_FLOAT32_C(   485.42), EASYSIMD_FLOAT32_C(    84.35), EASYSIMD_FLOAT32_C(  -331.91), EASYSIMD_FLOAT32_C(  -579.17) },
      UINT8_C(110),
      { EASYSIMD_FLOAT32_C(    35.09), EASYSIMD_FLOAT32_C(   -20.10), EASYSIMD_FLOAT32_C(    97.37), EASYSIMD_FLOAT32_C(   -96.10) },
      { EASYSIMD_FLOAT32_C(   -27.26), EASYSIMD_FLOAT32_C(   -36.11), EASYSIMD_FLOAT32_C(    -8.13), EASYSIMD_FLOAT32_C(   -49.72) },
      { EASYSIMD_FLOAT32_C(   485.42), EASYSIMD_FLOAT32_C(   -20.10), EASYSIMD_FLOAT32_C(    97.37), EASYSIMD_FLOAT32_C(   -96.10) } },
    { { EASYSIMD_FLOAT32_C(   -31.73), EASYSIMD_FLOAT32_C(  -317.18), EASYSIMD_FLOAT32_C(  -506.44), EASYSIMD_FLOAT32_C(  -932.52) },
      UINT8_C( 58),
      { EASYSIMD_FLOAT32_C(    78.63), EASYSIMD_FLOAT32_C(    98.37), EASYSIMD_FLOAT32_C(   -22.64), EASYSIMD_FLOAT32_C(    20.96) },
      { EASYSIMD_FLOAT32_C(   -96.80), EASYSIMD_FLOAT32_C(   -84.35), EASYSIMD_FLOAT32_C(    70.32), EASYSIMD_FLOAT32_C(     2.49) },
      { EASYSIMD_FLOAT32_C(   -31.73), EASYSIMD_FLOAT32_C(    98.37), EASYSIMD_FLOAT32_C(   -22.64), EASYSIMD_FLOAT32_C(    20.96) } },
    { { EASYSIMD_FLOAT32_C(   -87.31), EASYSIMD_FLOAT32_C(   894.08), EASYSIMD_FLOAT32_C(   793.10), EASYSIMD_FLOAT32_C(  -749.47) },
      UINT8_C( 58),
      { EASYSIMD_FLOAT32_C(    13.66), EASYSIMD_FLOAT32_C(   -52.70), EASYSIMD_FLOAT32_C(   -45.23), EASYSIMD_FLOAT32_C(     8.83) },
      { EASYSIMD_FLOAT32_C(   -16.25), EASYSIMD_FLOAT32_C(   -73.98), EASYSIMD_FLOAT32_C(   -21.81), EASYSIMD_FLOAT32_C(   -52.06) },
      { EASYSIMD_FLOAT32_C(   -87.31), EASYSIMD_FLOAT32_C(   -52.70), EASYSIMD_FLOAT32_C(   -45.23), EASYSIMD_FLOAT32_C(     8.83) } },
    { { EASYSIMD_FLOAT32_C(  -546.05), EASYSIMD_FLOAT32_C(   572.09), EASYSIMD_FLOAT32_C(   326.61), EASYSIMD_FLOAT32_C(  -675.63) },
      UINT8_C( 85),
      { EASYSIMD_FLOAT32_C(   -70.10), EASYSIMD_FLOAT32_C(   -18.20), EASYSIMD_FLOAT32_C(    30.46), EASYSIMD_FLOAT32_C(    -6.46) },
      { EASYSIMD_FLOAT32_C(     2.91), EASYSIMD_FLOAT32_C(   -69.98), EASYSIMD_FLOAT32_C(   -73.80), EASYSIMD_FLOAT32_C(   -61.99) },
      { EASYSIMD_FLOAT32_C(  -280.40), EASYSIMD_FLOAT32_C(   -18.20), EASYSIMD_FLOAT32_C(    30.46), EASYSIMD_FLOAT32_C(    -6.46) } },
    { { EASYSIMD_FLOAT32_C(  -413.85), EASYSIMD_FLOAT32_C(   897.99), EASYSIMD_FLOAT32_C(   304.24), EASYSIMD_FLOAT32_C(   -17.66) },
      UINT8_C( 74),
      { EASYSIMD_FLOAT32_C(     9.92), EASYSIMD_FLOAT32_C(   -76.43), EASYSIMD_FLOAT32_C(   -58.09), EASYSIMD_FLOAT32_C(    82.66) },
      { EASYSIMD_FLOAT32_C(   -12.54), EASYSIMD_FLOAT32_C(    33.78), EASYSIMD_FLOAT32_C(   -67.05), EASYSIMD_FLOAT32_C(   -33.92) },
      { EASYSIMD_FLOAT32_C(  -413.85), EASYSIMD_FLOAT32_C(   -76.43), EASYSIMD_FLOAT32_C(   -58.09), EASYSIMD_FLOAT32_C(    82.66) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 src = easysimd_mm_loadu_ps(test_vec[i].src);
    easysimd__m128 a = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128 b = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128 r = easysimd_mm_mask_scalef_ss(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128 src = easysimd_test_x86_random_f32x4(EASYSIMD_FLOAT32_C(-1000.0), EASYSIMD_FLOAT32_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128 a = easysimd_test_x86_random_extract_f32x4(i, 2, 0, values);
    easysimd__m128 b = easysimd_test_x86_random_extract_f32x4(i, 2, 1, values);
    easysimd__m128 r = easysimd_mm_mask_scalef_ss(src, k, a, b);

    easysimd_test_x86_write_f32x4(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_scalef_ss (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float32 a[4];
    const easysimd_float32 b[4];
    const easysimd_float32 r[4];
  } test_vec[] = {
    { UINT8_C( 91),
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -13.69),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    92.32) },
      { EASYSIMD_FLOAT32_C(    -7.87),            EASYSIMD_MATH_NANF,            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    40.59) },
      {            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(   -13.69),            EASYSIMD_MATH_NANF, EASYSIMD_FLOAT32_C(    92.32) } },
    { UINT8_C(186),
      { EASYSIMD_FLOAT32_C(    67.39), EASYSIMD_FLOAT32_C(   -52.02), EASYSIMD_FLOAT32_C(    54.28), EASYSIMD_FLOAT32_C(    29.68) },
      { EASYSIMD_FLOAT32_C(   -66.62), EASYSIMD_FLOAT32_C(    66.41), EASYSIMD_FLOAT32_C(    55.44), EASYSIMD_FLOAT32_C(   -26.62) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -52.02), EASYSIMD_FLOAT32_C(    54.28), EASYSIMD_FLOAT32_C(    29.68) } },
    { UINT8_C(219),
      { EASYSIMD_FLOAT32_C(   -81.80), EASYSIMD_FLOAT32_C(    26.08), EASYSIMD_FLOAT32_C(    64.57), EASYSIMD_FLOAT32_C(   -95.69) },
      { EASYSIMD_FLOAT32_C(    75.38), EASYSIMD_FLOAT32_C(   -99.29), EASYSIMD_FLOAT32_C(    88.91), EASYSIMD_FLOAT32_C(   -94.01) },
      { EASYSIMD_FLOAT32_C(-3090316741682046288527360.00), EASYSIMD_FLOAT32_C(    26.08), EASYSIMD_FLOAT32_C(    64.57), EASYSIMD_FLOAT32_C(   -95.69) } },
    { UINT8_C(121),
      { EASYSIMD_FLOAT32_C(   -17.89), EASYSIMD_FLOAT32_C(   -96.36), EASYSIMD_FLOAT32_C(    42.61), EASYSIMD_FLOAT32_C(   -46.05) },
      { EASYSIMD_FLOAT32_C(   -69.23), EASYSIMD_FLOAT32_C(    42.52), EASYSIMD_FLOAT32_C(   -33.23), EASYSIMD_FLOAT32_C(    79.27) },
      { EASYSIMD_FLOAT32_C(    -0.00), EASYSIMD_FLOAT32_C(   -96.36), EASYSIMD_FLOAT32_C(    42.61), EASYSIMD_FLOAT32_C(   -46.05) } },
    { UINT8_C(188),
      { EASYSIMD_FLOAT32_C(   -71.17), EASYSIMD_FLOAT32_C(     2.07), EASYSIMD_FLOAT32_C(    71.59), EASYSIMD_FLOAT32_C(    20.96) },
      { EASYSIMD_FLOAT32_C(    50.12), EASYSIMD_FLOAT32_C(    64.72), EASYSIMD_FLOAT32_C(   -38.45), EASYSIMD_FLOAT32_C(    17.51) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(     2.07), EASYSIMD_FLOAT32_C(    71.59), EASYSIMD_FLOAT32_C(    20.96) } },
    { UINT8_C( 40),
      { EASYSIMD_FLOAT32_C(   -87.30), EASYSIMD_FLOAT32_C(   -84.17), EASYSIMD_FLOAT32_C(   -52.81), EASYSIMD_FLOAT32_C(   -53.92) },
      { EASYSIMD_FLOAT32_C(    82.24), EASYSIMD_FLOAT32_C(   -97.37), EASYSIMD_FLOAT32_C(    19.46), EASYSIMD_FLOAT32_C(   -99.56) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -84.17), EASYSIMD_FLOAT32_C(   -52.81), EASYSIMD_FLOAT32_C(   -53.92) } },
    { UINT8_C(121),
      { EASYSIMD_FLOAT32_C(    28.72), EASYSIMD_FLOAT32_C(   -15.97), EASYSIMD_FLOAT32_C(   -95.25), EASYSIMD_FLOAT32_C(     4.09) },
      { EASYSIMD_FLOAT32_C(   -15.26), EASYSIMD_FLOAT32_C(    93.67), EASYSIMD_FLOAT32_C(    10.09), EASYSIMD_FLOAT32_C(    66.85) },
      { EASYSIMD_FLOAT32_C(     0.00), EASYSIMD_FLOAT32_C(   -15.97), EASYSIMD_FLOAT32_C(   -95.25), EASYSIMD_FLOAT32_C(     4.09) } },
    { UINT8_C(159),
      { EASYSIMD_FLOAT32_C(    97.31), EASYSIMD_FLOAT32_C(   -47.31), EASYSIMD_FLOAT32_C(   -79.20), EASYSIMD_FLOAT32_C(   -71.92) },
      { EASYSIMD_FLOAT32_C(    95.22), EASYSIMD_FLOAT32_C(   -12.43), EASYSIMD_FLOAT32_C(   -92.66), EASYSIMD_FLOAT32_C(   -75.95) },
      { EASYSIMD_FLOAT32_C(3854846150417465776443546927104.00), EASYSIMD_FLOAT32_C(   -47.31), EASYSIMD_FLOAT32_C(   -79.20), EASYSIMD_FLOAT32_C(   -71.92) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128 a = easysimd_mm_loadu_ps(test_vec[i].a);
    easysimd__m128 b = easysimd_mm_loadu_ps(test_vec[i].b);
    easysimd__m128 r = easysimd_mm_maskz_scalef_ss(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f32x4(r, easysimd_mm_loadu_ps(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float32 values[8 * 2 * sizeof(easysimd__m128)];
  easysimd_test_x86_random_f32x4_full(8, 2, values, -100.0f, 100.0f, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128 a = easysimd_test_x86_random_extract_f32x4(i, 2, 0, values);
    easysimd__m128 b = easysimd_test_x86_random_extract_f32x4(i, 2, 1, values);
    easysimd__m128 r = easysimd_mm_maskz_scalef_ss(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f32x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_scalef_sd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 a[2];
    const easysimd_float64 b[2];
    const easysimd_float64 r[2];
  } test_vec[] = {
    { {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    -7.28) },
      { EASYSIMD_FLOAT64_C(    15.70),             EASYSIMD_MATH_NAN },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    -7.28) } },
    { {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -32.67) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -36.49) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -32.67) } },
    { { EASYSIMD_FLOAT64_C(    74.68), EASYSIMD_FLOAT64_C(    88.10) },
      { EASYSIMD_FLOAT64_C(    15.04), EASYSIMD_FLOAT64_C(    11.85) },
      { EASYSIMD_FLOAT64_C(2447114.24), EASYSIMD_FLOAT64_C(    88.10) } },
    { { EASYSIMD_FLOAT64_C(   -68.62), EASYSIMD_FLOAT64_C(    24.41) },
      { EASYSIMD_FLOAT64_C(    76.59), EASYSIMD_FLOAT64_C(    61.07) },
      { EASYSIMD_FLOAT64_C(-5184780608872241216618496.00), EASYSIMD_FLOAT64_C(    24.41) } },
    { { EASYSIMD_FLOAT64_C(   -35.11), EASYSIMD_FLOAT64_C(    50.04) },
      { EASYSIMD_FLOAT64_C(    67.17), EASYSIMD_FLOAT64_C(   -63.07) },
      { EASYSIMD_FLOAT64_C(-5181321475423538774016.00), EASYSIMD_FLOAT64_C(    50.04) } },
    { { EASYSIMD_FLOAT64_C(    39.02), EASYSIMD_FLOAT64_C(   -47.15) },
      { EASYSIMD_FLOAT64_C(    76.34), EASYSIMD_FLOAT64_C(     7.26) },
      { EASYSIMD_FLOAT64_C(2948267842585177136037888.00), EASYSIMD_FLOAT64_C(   -47.15) } },
    { { EASYSIMD_FLOAT64_C(    27.11), EASYSIMD_FLOAT64_C(    65.60) },
      { EASYSIMD_FLOAT64_C(    84.64), EASYSIMD_FLOAT64_C(    93.98) },
      { EASYSIMD_FLOAT64_C(524383663516041539825434624.00), EASYSIMD_FLOAT64_C(    65.60) } },
    { { EASYSIMD_FLOAT64_C(    79.86), EASYSIMD_FLOAT64_C(    22.49) },
      { EASYSIMD_FLOAT64_C(   -72.03), EASYSIMD_FLOAT64_C(   -51.51) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    22.49) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128d a = easysimd_mm_loadu_pd(test_vec[i].a);
    easysimd__m128d b = easysimd_mm_loadu_pd(test_vec[i].b);
    easysimd__m128d r = easysimd_mm_scalef_sd(a, b);
    easysimd_test_x86_assert_equal_f64x2(r, easysimd_mm_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x2_full(8, 2, values, -100.0, 100.0, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128d a = easysimd_test_x86_random_extract_f64x2(i, 2, 0, values);
    easysimd__m128d b = easysimd_test_x86_random_extract_f64x2(i, 2, 1, values);
    easysimd__m128d r = easysimd_mm_scalef_sd(a, b);

    easysimd_test_x86_write_f64x2(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_mask_scalef_sd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 src[2];
    const easysimd__mmask8 k;
    const easysimd_float64 a[2];
    const easysimd_float64 b[2];
    const easysimd_float64 r[2];
  } test_vec[] = {
    { { EASYSIMD_FLOAT64_C(  -756.00), EASYSIMD_FLOAT64_C(   511.84) },
      UINT8_C( 43),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    43.68) },
      { EASYSIMD_FLOAT64_C(    61.65),             EASYSIMD_MATH_NAN },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    43.68) } },
    { { EASYSIMD_FLOAT64_C(  -645.93), EASYSIMD_FLOAT64_C(  -177.17) },
      UINT8_C( 56),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    31.10) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    85.68) },
      { EASYSIMD_FLOAT64_C(  -645.93), EASYSIMD_FLOAT64_C(    31.10) } },
    { { EASYSIMD_FLOAT64_C(  -789.10), EASYSIMD_FLOAT64_C(  -985.21) },
      UINT8_C(154),
      { EASYSIMD_FLOAT64_C(    19.20), EASYSIMD_FLOAT64_C(    93.02) },
      { EASYSIMD_FLOAT64_C(    -2.47), EASYSIMD_FLOAT64_C(    50.57) },
      { EASYSIMD_FLOAT64_C(  -789.10), EASYSIMD_FLOAT64_C(    93.02) } },
    { { EASYSIMD_FLOAT64_C(   186.22), EASYSIMD_FLOAT64_C(   520.54) },
      UINT8_C(150),
      { EASYSIMD_FLOAT64_C(    17.42), EASYSIMD_FLOAT64_C(   -25.88) },
      { EASYSIMD_FLOAT64_C(    11.64), EASYSIMD_FLOAT64_C(    82.31) },
      { EASYSIMD_FLOAT64_C(   186.22), EASYSIMD_FLOAT64_C(   -25.88) } },
    { { EASYSIMD_FLOAT64_C(   927.41), EASYSIMD_FLOAT64_C(  -363.02) },
      UINT8_C(111),
      { EASYSIMD_FLOAT64_C(   -75.84), EASYSIMD_FLOAT64_C(   -21.19) },
      { EASYSIMD_FLOAT64_C(   -80.76), EASYSIMD_FLOAT64_C(    63.18) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(   -21.19) } },
    { { EASYSIMD_FLOAT64_C(  -830.99), EASYSIMD_FLOAT64_C(   425.11) },
      UINT8_C(181),
      { EASYSIMD_FLOAT64_C(    31.66), EASYSIMD_FLOAT64_C(    95.59) },
      { EASYSIMD_FLOAT64_C(   -29.56), EASYSIMD_FLOAT64_C(   -41.23) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    95.59) } },
    { { EASYSIMD_FLOAT64_C(   800.81), EASYSIMD_FLOAT64_C(  -258.28) },
      UINT8_C(152),
      { EASYSIMD_FLOAT64_C(    61.19), EASYSIMD_FLOAT64_C(   -44.92) },
      { EASYSIMD_FLOAT64_C(   -47.25), EASYSIMD_FLOAT64_C(    41.05) },
      { EASYSIMD_FLOAT64_C(   800.81), EASYSIMD_FLOAT64_C(   -44.92) } },
    { { EASYSIMD_FLOAT64_C(  -494.75), EASYSIMD_FLOAT64_C(   329.42) },
      UINT8_C( 55),
      { EASYSIMD_FLOAT64_C(    77.57), EASYSIMD_FLOAT64_C(   -19.28) },
      { EASYSIMD_FLOAT64_C(    89.53), EASYSIMD_FLOAT64_C(    92.79) },
      { EASYSIMD_FLOAT64_C(48013504423683469739837882368.00), EASYSIMD_FLOAT64_C(   -19.28) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128d src = easysimd_mm_loadu_pd(test_vec[i].src);
    easysimd__m128d a = easysimd_mm_loadu_pd(test_vec[i].a);
    easysimd__m128d b = easysimd_mm_loadu_pd(test_vec[i].b);
    easysimd__m128d r = easysimd_mm_mask_scalef_sd(src, test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x2(r, easysimd_mm_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x2_full(8, 2, values, -100.0, 100.0, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__m128d src = easysimd_test_x86_random_f64x2(EASYSIMD_FLOAT64_C(-1000.0), EASYSIMD_FLOAT64_C(1000.0));
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128d a = easysimd_test_x86_random_extract_f64x2(i, 2, 0, values);
    easysimd__m128d b = easysimd_test_x86_random_extract_f64x2(i, 2, 1, values);
    easysimd__m128d r = easysimd_mm_mask_scalef_sd(src, k, a, b);

    easysimd_test_x86_write_f64x2(2, src, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_scalef_sd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd__mmask8 k;
    const easysimd_float64 a[2];
    const easysimd_float64 b[2];
    const easysimd_float64 r[2];
  } test_vec[] = {
    { UINT8_C( 22),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    85.69) },
      { EASYSIMD_FLOAT64_C(    -4.94),             EASYSIMD_MATH_NAN },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(    85.69) } },
    { UINT8_C(108),
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(   -15.41) },
      {             EASYSIMD_MATH_NAN, EASYSIMD_FLOAT64_C(    -9.18) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   -15.41) } },
    { UINT8_C( 87),
      { EASYSIMD_FLOAT64_C(   -64.22), EASYSIMD_FLOAT64_C(   -16.77) },
      { EASYSIMD_FLOAT64_C(    26.22), EASYSIMD_FLOAT64_C(    18.06) },
      { EASYSIMD_FLOAT64_C(-4309731246.08), EASYSIMD_FLOAT64_C(   -16.77) } },
    { UINT8_C( 35),
      { EASYSIMD_FLOAT64_C(    68.46), EASYSIMD_FLOAT64_C(    47.31) },
      { EASYSIMD_FLOAT64_C(    19.54), EASYSIMD_FLOAT64_C(   -53.28) },
      { EASYSIMD_FLOAT64_C(35892756.48), EASYSIMD_FLOAT64_C(    47.31) } },
    { UINT8_C(199),
      { EASYSIMD_FLOAT64_C(   -34.06), EASYSIMD_FLOAT64_C(   -28.41) },
      { EASYSIMD_FLOAT64_C(   -57.61), EASYSIMD_FLOAT64_C(   -41.32) },
      { EASYSIMD_FLOAT64_C(    -0.00), EASYSIMD_FLOAT64_C(   -28.41) } },
    { UINT8_C(204),
      { EASYSIMD_FLOAT64_C(    35.29), EASYSIMD_FLOAT64_C(   -79.62) },
      { EASYSIMD_FLOAT64_C(   -24.42), EASYSIMD_FLOAT64_C(   -22.20) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   -79.62) } },
    { UINT8_C(246),
      { EASYSIMD_FLOAT64_C(   -82.38), EASYSIMD_FLOAT64_C(   -44.34) },
      { EASYSIMD_FLOAT64_C(    51.97), EASYSIMD_FLOAT64_C(   -89.56) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   -44.34) } },
    { UINT8_C( 76),
      { EASYSIMD_FLOAT64_C(     6.18), EASYSIMD_FLOAT64_C(   -15.08) },
      { EASYSIMD_FLOAT64_C(    64.45), EASYSIMD_FLOAT64_C(   -88.21) },
      { EASYSIMD_FLOAT64_C(     0.00), EASYSIMD_FLOAT64_C(   -15.08) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128d a = easysimd_mm_loadu_pd(test_vec[i].a);
    easysimd__m128d b = easysimd_mm_loadu_pd(test_vec[i].b);
    easysimd__m128d r = easysimd_mm_maskz_scalef_sd(test_vec[i].k, a, b);
    easysimd_test_x86_assert_equal_f64x2(r, easysimd_mm_loadu_pd(test_vec[i].r), 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  easysimd_float64 values[8 * 2 * sizeof(easysimd__m128d)];
  easysimd_test_x86_random_f64x2_full(8, 2, values, -100.0, 100.0, EASYSIMD_TEST_VEC_FLOAT_NAN);

  for (size_t i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128d a = easysimd_test_x86_random_extract_f64x2(i, 2, 0, values);
    easysimd__m128d b = easysimd_test_x86_random_extract_f64x2(i, 2, 1, values);
    easysimd__m128d r = easysimd_mm_maskz_scalef_sd(k, a, b);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_f64x2(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_f64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

EASYSIMD_TEST_FUNC_LIST_BEGIN
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_mask_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_mask_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_mask_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_scalef_ps)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_mask_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_mask_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_mask_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_scalef_pd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_scalef_ss)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_mask_scalef_ss)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_scalef_ss)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_scalef_sd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_mask_scalef_sd)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_scalef_sd)
EASYSIMD_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
