#define EASYSIMD_TEST_X86_AVX512_INSN shldv

#include <test/x86/avx512/test-avx512.h>
#include <easysimd/x86/avx512/shldv.h>

static int
test_easysimd_mm_shldv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int16_t a[8];
    int16_t b[8];
    int16_t c[8];
    int16_t r[8];
  } test_vec[8] = {
    { {  INT16_C( 27527),  INT16_C( 18784),  INT16_C( 26536),  INT16_C( 26024), -INT16_C( 31606), -INT16_C( 10615),  INT16_C( 30085),  INT16_C( 24367) },
      {  INT16_C( 20338),  INT16_C(  6358),  INT16_C(  2499),  INT16_C(  8481),  INT16_C( 12109), -INT16_C(  1915), -INT16_C( 21686), -INT16_C( 11914) },
      { -INT16_C( 10729), -INT16_C( 16614), -INT16_C( 15554), -INT16_C( 14300), -INT16_C( 20921), -INT16_C( 12897), -INT16_C( 12765), -INT16_C( 27348) },
      { -INT16_C( 15449), -INT16_C( 32669),  INT16_C(   624),  INT16_C( 23170),  INT16_C( 17687), -INT16_C(   958), -INT16_C( 21459), -INT16_C(   745) } },
    { {  INT16_C(   541), -INT16_C(  8018), -INT16_C( 12533),  INT16_C( 22529), -INT16_C( 30721),  INT16_C( 18768), -INT16_C( 14542),  INT16_C( 18715) },
      {  INT16_C( 13725), -INT16_C(  9463),  INT16_C( 11768),  INT16_C( 16548),  INT16_C( 17371), -INT16_C(   243),  INT16_C( 14609),  INT16_C( 12180) },
      {  INT16_C( 16955),  INT16_C( 18191),  INT16_C(  4370),  INT16_C(  4511), -INT16_C(  3944), -INT16_C( 13734),  INT16_C( 30135),  INT16_C( 21524) },
      { -INT16_C(  5716),  INT16_C( 28036),  INT16_C( 15404), -INT16_C( 24494), -INT16_C(   189),  INT16_C( 17404), -INT16_C( 26340), -INT16_C( 28238) } },
    { {  INT16_C(  7595), -INT16_C( 23760), -INT16_C( 11190),  INT16_C(  9955), -INT16_C(  4073),  INT16_C( 10277), -INT16_C( 18135),  INT16_C( 25943) },
      {  INT16_C( 26620),  INT16_C(  3756),  INT16_C( 19320),  INT16_C(  4127),  INT16_C( 31035), -INT16_C(  3366), -INT16_C(  4369), -INT16_C( 26041) },
      {  INT16_C( 30475),  INT16_C( 22077),  INT16_C(  8523),  INT16_C( 25212), -INT16_C( 24303),  INT16_C( 15242), -INT16_C(  7590),  INT16_C( 22176) },
      {  INT16_C( 23359),  INT16_C(   469),  INT16_C( 21083),  INT16_C( 12545), -INT16_C(  8146), -INT16_C( 26677), -INT16_C( 22597),  INT16_C( 25943) } },
    { {  INT16_C( 19529), -INT16_C( 16028), -INT16_C( 31849), -INT16_C( 11311), -INT16_C( 21507), -INT16_C(  4923),  INT16_C(  3226), -INT16_C( 23162) },
      { -INT16_C( 15485), -INT16_C( 12549),  INT16_C( 30692), -INT16_C(  2512), -INT16_C( 17640),  INT16_C( 29489), -INT16_C( 11875), -INT16_C(  6455) },
      {  INT16_C( 11805), -INT16_C( 19289),  INT16_C( 30897), -INT16_C( 20857),  INT16_C( 19747), -INT16_C( 16998),  INT16_C(  8281), -INT16_C(  8861) },
      {  INT16_C( 14448), -INT16_C( 19865),  INT16_C(  1838), -INT16_C(  5893),  INT16_C( 24557),  INT16_C(  5580),  INT16_C( 13731),  INT16_C( 11319) } },
    { {  INT16_C( 24292), -INT16_C( 14165), -INT16_C(  9002), -INT16_C(  4418), -INT16_C(  4201),  INT16_C( 13409),  INT16_C( 11200), -INT16_C(  8934) },
      { -INT16_C( 16039),  INT16_C(  2706),  INT16_C(  6457),  INT16_C( 23737),  INT16_C( 21350), -INT16_C( 16358),  INT16_C( 32116),  INT16_C( 22685) },
      {  INT16_C( 18651), -INT16_C( 20192), -INT16_C(  8412), -INT16_C( 17504),  INT16_C(   462), -INT16_C( 28689),  INT16_C(  2348), -INT16_C( 31380) },
      {  INT16_C(  9738), -INT16_C( 14165), -INT16_C( 12959), -INT16_C(  4418), -INT16_C( 11047), -INT16_C(  8179),  INT16_C(  2007), -INT16_C( 23159) } },
    { { -INT16_C(   310),  INT16_C(   912),  INT16_C( 18712),  INT16_C( 32352),  INT16_C( 31388),  INT16_C(  4158), -INT16_C(  9225), -INT16_C( 11672) },
      { -INT16_C( 30428),  INT16_C( 18564),  INT16_C(  9320),  INT16_C( 13828), -INT16_C(  3291),  INT16_C( 21189),  INT16_C( 13053), -INT16_C( 14377) },
      {  INT16_C( 26416),  INT16_C( 18635),  INT16_C( 11184),  INT16_C( 19911),  INT16_C(  1445), -INT16_C( 25507), -INT16_C( 14623),  INT16_C(  1390) },
      { -INT16_C(   310), -INT16_C( 32188),  INT16_C( 18712),  INT16_C( 12315),  INT16_C( 21406), -INT16_C( 13736), -INT16_C( 18450),  INT16_C( 12789) } },
    { { -INT16_C(  3505), -INT16_C( 18611),  INT16_C( 20758),  INT16_C( 15597), -INT16_C( 19643),  INT16_C( 17038),  INT16_C( 26085),  INT16_C(  5385) },
      { -INT16_C( 11059),  INT16_C( 32094),  INT16_C(  9727), -INT16_C( 23350),  INT16_C( 10282),  INT16_C(  2880), -INT16_C( 20498),  INT16_C( 15632) },
      {  INT16_C( 24225), -INT16_C( 18188), -INT16_C(  7761), -INT16_C(  2828), -INT16_C( 32108),  INT16_C( 31030),  INT16_C( 16615), -INT16_C( 19313) },
      { -INT16_C(  7009),  INT16_C( 29911),  INT16_C(  4863), -INT16_C( 12582),  INT16_C( 13394), -INT16_C( 23678), -INT16_C(  3369), -INT16_C( 24952) } },
    { { -INT16_C(  4844),  INT16_C(  5170), -INT16_C(  1006),  INT16_C( 15544), -INT16_C(  1756),  INT16_C(  4680),  INT16_C( 22696),  INT16_C( 18767) },
      {  INT16_C( 17334),  INT16_C( 26113), -INT16_C(  2779), -INT16_C( 18086), -INT16_C( 28297),  INT16_C( 24371), -INT16_C( 15663), -INT16_C(  6893) },
      {  INT16_C( 17839), -INT16_C( 15879), -INT16_C( 19902),  INT16_C( 26365),  INT16_C( 17835),  INT16_C( 21369), -INT16_C( 14178),  INT16_C( 21660) },
      {  INT16_C(  8667),  INT16_C( 25804), -INT16_C(  4021),  INT16_C(  5931),  INT16_C(  9355), -INT16_C( 28482),  INT16_C( 12468), -INT16_C(   431) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m128i a = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_shldv_epi16(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_shldv_epi16");
    easysimd_assert_m128i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m128i a = easysimd_test_x86_random_i16x8();
    easysimd__m128i b = easysimd_test_x86_random_i16x8();
    easysimd__m128i c = easysimd_test_x86_random_i16x8();
    easysimd__m128i r = easysimd_mm_shldv_epi16(a, b, c);

    easysimd_test_x86_write_i16x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_shldv_epi32 (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int32_t a[4];
    const int32_t b[4];
    const int32_t c[4];
    const int32_t r[4];
  } test_vec[] = {
    { { -INT32_C(  1406714453),  INT32_C(  1468213792), -INT32_C(  1399156962),  INT32_C(  1073995188) },
      { -INT32_C(  1176851836), -INT32_C(  1981218022),  INT32_C(   866914973),  INT32_C(  1536447664) },
      { -INT32_C(  1308116079),  INT32_C(    50957029), -INT32_C(   827350246),  INT32_C(    68137600) },
      {  INT32_C(  2069328821), -INT32_C(   261798895),  INT32_C(  2026811466),  INT32_C(  1073995188) } },
    { {  INT32_C(  1992157532), -INT32_C(  1979668499),  INT32_C(  1790815417), -INT32_C(  1849339648) },
      { -INT32_C(   247214836),  INT32_C(  1911835991),  INT32_C(  1900061680), -INT32_C(  1300934826) },
      {  INT32_C(   623457080), -INT32_C(  1817171494), -INT32_C(   704811563), -INT32_C(   882457665) },
      {  INT32_C(  1559315405), -INT32_C(  1245195979), -INT32_C(  1758582764),  INT32_C(  1497016235) } },
    { { -INT32_C(   407000432), -INT32_C(   413552137), -INT32_C(  1420256939),  INT32_C(   543018728) },
      { -INT32_C(   616135167), -INT32_C(  2073102673),  INT32_C(   576285795), -INT32_C(  1074872273) },
      {  INT32_C(  1638312810), -INT32_C(  1320616100), -INT32_C(  2141412968),  INT32_C(  1889647215) },
      { -INT32_C(   156613779),  INT32_C(  2017914730),  INT32_C(  1428314476), -INT32_C(   411803657) } },
    { { -INT32_C(   263461056),  INT32_C(  1081391581),  INT32_C(  1415826981), -INT32_C(   132951666) },
      {  INT32_C(  1482275580),  INT32_C(  1376428473), -INT32_C(  1311611326),  INT32_C(  1629582112) },
      {  INT32_C(   928083034),  INT32_C(  1266205990),  INT32_C(   564190099),  INT32_C(   672772908) },
      {  INT32_C(    23160555),  INT32_C(   489584468),  INT32_C(  1898811027),  INT32_C(   890824210) } },
    { {  INT32_C(   662729325),  INT32_C(  1450805780),  INT32_C(   285756401),  INT32_C(   426912191) },
      { -INT32_C(  1135492202),  INT32_C(   470272393), -INT32_C(   801200220), -INT32_C(   923248805) },
      { -INT32_C(   554731318), -INT32_C(   197892093),  INT32_C(  1929723060), -INT32_C(    57903002) },
      {  INT32_C(    29996785), -INT32_C(  1278455648), -INT32_C(  1088617494),  INT32_C(  1552576498) } },
    { { -INT32_C(   994517701),  INT32_C(  1256308646), -INT32_C(  1038475417),  INT32_C(  1082790518) },
      { -INT32_C(  1910605173), -INT32_C(  1769843742), -INT32_C(   183924849),  INT32_C(  1005688575) },
      {  INT32_C(   452962675), -INT32_C(   798695319),  INT32_C(  1989312511),  INT32_C(   481696913) },
      { -INT32_C(   371429133), -INT32_C(  1015067347), -INT32_C(    91962425),  INT32_C(   619476963) } },
    { {  INT32_C(  2041238934), -INT32_C(  1223742424), -INT32_C(  1280501324),  INT32_C(   586063535) },
      { -INT32_C(  1321406904), -INT32_C(   830365234), -INT32_C(  1320938720), -INT32_C(   959514065) },
      { -INT32_C(   146835249),  INT32_C(  1504661157),  INT32_C(   369908839),  INT32_C(  1111096314) },
      {  INT32_C(  1791711390), -INT32_C(   505051879), -INT32_C(   695412136), -INT32_C(  1088734232) } },
    { { -INT32_C(  1208781335),  INT32_C(   914715670), -INT32_C(  1209480825), -INT32_C(  1820477756) },
      { -INT32_C(   745817042),  INT32_C(  1915501066), -INT32_C(  1870120554),  INT32_C(   500416820) },
      {  INT32_C(  1305790007), -INT32_C(  1031513541), -INT32_C(   411472861),  INT32_C(  1350301218) },
      { -INT32_C(   186006050), -INT32_C(  1282317872), -INT32_C(  1085912004),  INT32_C(  1308023568) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m128i a = easysimd_x_mm_loadu_epi32(test_vec[i].a);
    easysimd__m128i b = easysimd_x_mm_loadu_epi32(test_vec[i].b);
    easysimd__m128i c = easysimd_x_mm_loadu_epi32(test_vec[i].c);
    easysimd__m128i r = easysimd_mm_shldv_epi32(a, b, c);
    easysimd_test_x86_assert_equal_i32x4(r, easysimd_x_mm_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m128i a = easysimd_test_x86_random_i32x4();
    easysimd__m128i b = easysimd_test_x86_random_i32x4();
    easysimd__m128i c = easysimd_test_x86_random_i32x4();
    easysimd__m128i r = easysimd_mm_shldv_epi32(a, b, c);

    easysimd_test_x86_write_i32x4(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_shldv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int16_t a[16];
    int16_t b[16];
    int16_t c[16];
    int16_t r[16];
  } test_vec[8] = {
    { { -INT16_C( 28145),  INT16_C( 16041), -INT16_C(   624), -INT16_C( 26844), -INT16_C( 24217), -INT16_C( 17643),  INT16_C(  5377), -INT16_C( 10400),
         INT16_C( 26240),  INT16_C( 32401),  INT16_C( 19053),  INT16_C( 10069),  INT16_C(  2243), -INT16_C( 30842), -INT16_C(  9333), -INT16_C( 25649) },
      {  INT16_C( 30829), -INT16_C(   295), -INT16_C(   395), -INT16_C(  9067), -INT16_C( 21857), -INT16_C( 24424), -INT16_C(  1857),  INT16_C( 16503),
         INT16_C(  2142), -INT16_C( 13378),  INT16_C(  5203),  INT16_C(  5874),  INT16_C( 30748), -INT16_C( 22371),  INT16_C( 27987), -INT16_C( 16061) },
      {  INT16_C(  7397),  INT16_C( 23487),  INT16_C( 21530), -INT16_C( 18121), -INT16_C( 12290), -INT16_C( 16807), -INT16_C( 11833),  INT16_C(  9726),
        -INT16_C( 17191),  INT16_C( 11504), -INT16_C(  7472), -INT16_C(  4798), -INT16_C(  8102), -INT16_C( 20843), -INT16_C( 10163),  INT16_C( 12911) },
      {  INT16_C( 16879), -INT16_C(   148),  INT16_C( 17401), -INT16_C( 28050), -INT16_C(  5465),  INT16_C( 11073), -INT16_C( 32516),  INT16_C(  4125),
         INT16_C(    16),  INT16_C( 32401),  INT16_C( 19053), -INT16_C( 25260),  INT16_C(  3552), -INT16_C(  3883),  INT16_C( 28074), -INT16_C(  8031) } },
    { {  INT16_C( 12020),  INT16_C(  3981), -INT16_C( 14974), -INT16_C( 32568),  INT16_C(  8852),  INT16_C( 23614),  INT16_C( 15603), -INT16_C( 13183),
         INT16_C( 29433), -INT16_C( 13831),  INT16_C( 15188), -INT16_C( 20554),  INT16_C( 19227),  INT16_C( 26717), -INT16_C( 13277),  INT16_C(  6299) },
      {  INT16_C( 10490),  INT16_C( 31783), -INT16_C(  4115), -INT16_C( 32004),  INT16_C( 15121),  INT16_C(  1246),  INT16_C( 24439),  INT16_C( 28881),
        -INT16_C( 13615),  INT16_C(  9786), -INT16_C(  4091),  INT16_C(  8661),  INT16_C( 12860),  INT16_C( 24457),  INT16_C(  9470), -INT16_C(  1929) },
      { -INT16_C( 25011),  INT16_C( 14964),  INT16_C( 28814), -INT16_C( 24644), -INT16_C( 25941),  INT16_C(  9124),  INT16_C( 30202), -INT16_C( 13421),
        -INT16_C( 12993),  INT16_C( 17649), -INT16_C( 14658), -INT16_C(  1435), -INT16_C(  4104), -INT16_C(  2471), -INT16_C( 12013),  INT16_C( 24814) },
      { -INT16_C( 31457), -INT16_C(  1833), -INT16_C( 17413), -INT16_C( 30673), -INT16_C( 24104), -INT16_C( 15392), -INT16_C( 12931),  INT16_C( 25611),
        -INT16_C(  6808), -INT16_C( 27662),  INT16_C( 15361), -INT16_C(  2364),  INT16_C(  6962), -INT16_C( 17729),  INT16_C( 24857), -INT16_C(   483) } },
    { {  INT16_C( 25199), -INT16_C(   613),  INT16_C( 22483),  INT16_C( 32413),  INT16_C( 16882), -INT16_C(  4959),  INT16_C( 13750), -INT16_C(  2633),
        -INT16_C( 22270), -INT16_C( 16327), -INT16_C( 24721),  INT16_C( 26810),  INT16_C(  5262), -INT16_C( 24226),  INT16_C( 19941),  INT16_C( 21506) },
      { -INT16_C( 25169), -INT16_C( 32174), -INT16_C(  4108), -INT16_C(  6655), -INT16_C( 24016), -INT16_C(  6446), -INT16_C( 29993), -INT16_C(  9509),
         INT16_C(  5171), -INT16_C( 23910),  INT16_C( 21939),  INT16_C( 16650),  INT16_C( 26985),  INT16_C( 20195), -INT16_C(  6730),  INT16_C( 26018) },
      { -INT16_C(  2942),  INT16_C( 30440), -INT16_C(  5661),  INT16_C(  4957),  INT16_C( 12171),  INT16_C( 25593), -INT16_C( 11079), -INT16_C(  5059),
        -INT16_C( 10263), -INT16_C( 25457), -INT16_C( 26324), -INT16_C( 27170), -INT16_C( 16126), -INT16_C( 18205), -INT16_C( 31066),  INT16_C( 10270) },
      { -INT16_C( 30274), -INT16_C( 25726), -INT16_C( 16737), -INT16_C( 17216), -INT16_C( 27375),  INT16_C( 17357),  INT16_C( 27925), -INT16_C(  1189),
         INT16_C(  1064), -INT16_C( 11955), -INT16_C(  2725), -INT16_C( 28606),  INT16_C( 21049),  INT16_C(  2802),  INT16_C( 31097), -INT16_C( 26264) } },
    { {  INT16_C(  1658),  INT16_C( 24222), -INT16_C(  1041),  INT16_C( 31345),  INT16_C( 27435), -INT16_C(  6947),  INT16_C(  6719),  INT16_C( 10449),
         INT16_C( 24818),  INT16_C(  7877), -INT16_C( 23559), -INT16_C(   844), -INT16_C( 26780),  INT16_C(  2740), -INT16_C( 11747), -INT16_C( 26574) },
      { -INT16_C( 12072), -INT16_C( 14346),  INT16_C( 26572), -INT16_C(  2238),  INT16_C(  8146),  INT16_C(  4827), -INT16_C( 21446),  INT16_C( 11322),
        -INT16_C(   244),  INT16_C(  1610), -INT16_C(   350),  INT16_C(  1538), -INT16_C( 18794), -INT16_C( 19696),  INT16_C( 17033),  INT16_C( 24907) },
      {  INT16_C( 16659), -INT16_C(  8407),  INT16_C( 27561),  INT16_C( 31702), -INT16_C( 20086), -INT16_C( 15219), -INT16_C( 14242),  INT16_C( 27376),
         INT16_C( 15303),  INT16_C( 27248),  INT16_C( 29241), -INT16_C( 12432), -INT16_C( 32471), -INT16_C( 19837), -INT16_C( 12605), -INT16_C( 10733) },
      {  INT16_C( 13270),  INT16_C( 15759), -INT16_C(  8497), -INT16_C( 25475), -INT16_C( 21377), -INT16_C( 23973), -INT16_C(  5362),  INT16_C( 10449),
         INT16_C( 31103),  INT16_C(  7877), -INT16_C(  3075), -INT16_C(   844), -INT16_C( 13971),  INT16_C( 21925), -INT16_C( 28438), -INT16_C( 15981) } },
    { {  INT16_C( 15376), -INT16_C( 17995), -INT16_C( 29785),  INT16_C( 12852), -INT16_C( 15811), -INT16_C( 25610), -INT16_C(  6262),  INT16_C( 20741),
         INT16_C( 30242),  INT16_C( 23483),  INT16_C( 11496),  INT16_C(  4395), -INT16_C( 20819),  INT16_C( 28867), -INT16_C( 10372), -INT16_C( 29625) },
      { -INT16_C(  1005), -INT16_C( 17595),  INT16_C( 31368), -INT16_C( 14867), -INT16_C(  7364), -INT16_C( 14752),  INT16_C( 26058), -INT16_C(  5097),
        -INT16_C( 11301), -INT16_C( 15288),  INT16_C( 29695), -INT16_C( 21291), -INT16_C( 26335), -INT16_C( 25316),  INT16_C( 25456), -INT16_C( 31958) },
      {  INT16_C( 28512), -INT16_C(  6082),  INT16_C( 11241),  INT16_C(  9645),  INT16_C(  3343), -INT16_C(  9749),  INT16_C(   882),  INT16_C( 20166),
         INT16_C(  3798), -INT16_C( 10990), -INT16_C(  6271), -INT16_C( 23935), -INT16_C( 25216), -INT16_C(  4033),  INT16_C( 26881),  INT16_C( 24948) },
      {  INT16_C( 15376),  INT16_C( 28369),  INT16_C( 20213), -INT16_C( 26435), -INT16_C(  3682), -INT16_C( 18893), -INT16_C( 25047),  INT16_C( 16763),
        -INT16_C( 30540),  INT16_C( 28399),  INT16_C( 22992),  INT16_C(  8791), -INT16_C( 20819), -INT16_C( 12658), -INT16_C( 20744), -INT16_C( 15240) } },
    { { -INT16_C( 19751), -INT16_C( 15799), -INT16_C(  2338), -INT16_C(  4632), -INT16_C( 11517),  INT16_C( 30150), -INT16_C( 29482), -INT16_C( 21309),
        -INT16_C( 10854),  INT16_C(  7041),  INT16_C(   701),  INT16_C( 15805), -INT16_C(   608), -INT16_C( 24274), -INT16_C( 23962),  INT16_C( 16130) },
      {  INT16_C( 19284),  INT16_C( 12802), -INT16_C(  5567),  INT16_C( 17439), -INT16_C(  6467), -INT16_C( 27463),  INT16_C( 32114),  INT16_C(  3392),
        -INT16_C( 15790),  INT16_C(  3880), -INT16_C(  6460),  INT16_C( 25677),  INT16_C( 31715),  INT16_C( 18693),  INT16_C(  1821),  INT16_C( 29065) },
      { -INT16_C( 29870), -INT16_C( 27740), -INT16_C( 15499),  INT16_C( 13015), -INT16_C( 28247),  INT16_C(  7366),  INT16_C(  1806),  INT16_C( 24617),
         INT16_C( 20937), -INT16_C( 29328), -INT16_C( 17097),  INT16_C(  6898), -INT16_C(  2248),  INT16_C( 21860), -INT16_C(  4609),  INT16_C( 20934) },
      { -INT16_C( 13467),  INT16_C(  9363), -INT16_C(  9251), -INT16_C(  3038),  INT16_C(  1997),  INT16_C( 29093), -INT16_C( 24740), -INT16_C( 31206),
         INT16_C( 13700),  INT16_C(  7041),  INT16_C( 24307), -INT16_C(  2315), -INT16_C( 24453),  INT16_C(  4836),  INT16_C(   910), -INT16_C( 16228) } },
    { {  INT16_C( 27256), -INT16_C(  4635), -INT16_C( 17362), -INT16_C( 10465), -INT16_C(  6579),  INT16_C( 23539),  INT16_C(  7405), -INT16_C( 18756),
         INT16_C( 11374), -INT16_C( 23229),  INT16_C( 13801),  INT16_C(  8640),  INT16_C(  9261),  INT16_C( 11382),  INT16_C( 15377), -INT16_C( 30339) },
      {  INT16_C( 25255), -INT16_C( 10890), -INT16_C( 27361),  INT16_C( 27820), -INT16_C( 24453),  INT16_C( 26824), -INT16_C( 31556),  INT16_C( 10782),
         INT16_C( 25264), -INT16_C( 26160), -INT16_C( 28521), -INT16_C( 15174),  INT16_C( 12468), -INT16_C( 14864),  INT16_C( 28268),  INT16_C(  4942) },
      { -INT16_C( 15152), -INT16_C(  4120), -INT16_C( 27303), -INT16_C( 10916),  INT16_C(  9269), -INT16_C(  3779),  INT16_C( 23720),  INT16_C( 22556),
        -INT16_C(  4930),  INT16_C( 22001), -INT16_C( 21636),  INT16_C( 12314),  INT16_C(  2779),  INT16_C( 18421),  INT16_C( 17272),  INT16_C( 18779) },
      {  INT16_C( 27256), -INT16_C(  6699),  INT16_C( 23850), -INT16_C(  2358), -INT16_C( 13900),  INT16_C( 27929), -INT16_C(  4732), -INT16_C( 15711),
        -INT16_C( 26452),  INT16_C( 19079), -INT16_C( 26359),  INT16_C(   786),  INT16_C( 27013), -INT16_C( 28968),  INT16_C(  4462), -INT16_C(  5990) } },
    { {  INT16_C( 17159),  INT16_C( 24632), -INT16_C( 27432),  INT16_C(  3381),  INT16_C( 29624),  INT16_C( 24831),  INT16_C(  7119), -INT16_C( 29256),
        -INT16_C( 22265), -INT16_C( 31774), -INT16_C(   940),  INT16_C( 12211), -INT16_C( 22521),  INT16_C( 32631), -INT16_C( 11541), -INT16_C(  3384) },
      {  INT16_C(   277), -INT16_C(  4526), -INT16_C( 30571),  INT16_C( 20219), -INT16_C(  1285), -INT16_C( 13650),  INT16_C( 26389),  INT16_C(  7255),
         INT16_C( 14608),  INT16_C( 26015),  INT16_C( 21046),  INT16_C( 15764),  INT16_C(  3066), -INT16_C(  6724), -INT16_C( 31267), -INT16_C(  3113) },
      {  INT16_C( 10886),  INT16_C(  7137), -INT16_C(  9038), -INT16_C( 21143),  INT16_C(  6359), -INT16_C(  5001), -INT16_C( 12673), -INT16_C( 28919),
        -INT16_C( 22521),  INT16_C( 15860), -INT16_C( 30213), -INT16_C(  2694),  INT16_C( 14228),  INT16_C( 29403), -INT16_C( 19780),  INT16_C( 16997) },
      { -INT16_C( 15936), -INT16_C( 16271),  INT16_C( 21346),  INT16_C( 27293), -INT16_C(  9091),  INT16_C( 32741), -INT16_C( 19574),  INT16_C( 28728),
        -INT16_C( 31844),  INT16_C( 15910), -INT16_C( 23919), -INT16_C( 13066), -INT16_C( 32656), -INT16_C( 16595), -INT16_C( 18339),  INT16_C( 22814) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m256i a = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_shldv_epi16(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_shldv_epi16");
    easysimd_assert_m256i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m256i a = easysimd_test_x86_random_i16x16();
    easysimd__m256i b = easysimd_test_x86_random_i16x16();
    easysimd__m256i c = easysimd_test_x86_random_i16x16();
    easysimd__m256i r = easysimd_mm256_shldv_epi16(a, b, c);

    easysimd_test_x86_write_i16x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_shldv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int32_t a[8];
    int32_t b[8];
    int32_t c[8];
    int32_t r[8];
  } test_vec[8] = {
    { {  INT32_C(   792515842), -INT32_C(  1013573612),  INT32_C(   315558645),  INT32_C(   768105050),  INT32_C(   643438155),  INT32_C(  1238898570),  INT32_C(   354228056),  INT32_C(  1018764602) },
      {  INT32_C(   107738866),  INT32_C(    80347406),  INT32_C(  1695979787),  INT32_C(  1066590195),  INT32_C(  2137386229),  INT32_C(  1556626692), -INT32_C(  1905138348), -INT32_C(   188077566) },
      {  INT32_C(   804992288),  INT32_C(  1110689078),  INT32_C(  1386695006),  INT32_C(   496056872),  INT32_C(   714929702), -INT32_C(  2021235405),  INT32_C(  1293350730),  INT32_C(  1111613474) },
      {  INT32_C(   792515842),  INT32_C(    83964544),  INT32_C(  1497736770), -INT32_C(   933602753), -INT32_C(  1769631009), -INT32_C(  1135417791),  INT32_C(  1952277049), -INT32_C(   219908885) } },
    { {  INT32_C(  1282489366),  INT32_C(  1619960833),  INT32_C(   380778222), -INT32_C(  1774959760),  INT32_C(  1824641081), -INT32_C(  2131540171),  INT32_C(  1640827199),  INT32_C(    10686186) },
      {  INT32_C(  1280054603), -INT32_C(  1481843783), -INT32_C(  2118230511), -INT32_C(   635964767), -INT32_C(   129574718),  INT32_C(  1601714720),  INT32_C(   767575363), -INT32_C(  1641192621) },
      {  INT32_C(   854293112),  INT32_C(  1725536085), -INT32_C(  1746429962),  INT32_C(  1282604681), -INT32_C(   146491177),  INT32_C(   911654130),  INT32_C(  1415779841), -INT32_C(   218918535) },
      {  INT32_C(   374098965), -INT32_C(  2144012901), -INT32_C(  1147113577),  INT32_C(  1753670068),  INT32_C(   486286188),  INT32_C(   483753440), -INT32_C(  1013312898), -INT32_C(   717464890) } },
    { {  INT32_C(  1613028875),  INT32_C(  1808203125),  INT32_C(   503557525), -INT32_C(  2106952277),  INT32_C(   544845357),  INT32_C(  1800851306),  INT32_C(  1606466021),  INT32_C(  1431417674) },
      {  INT32_C(   112555409),  INT32_C(   124943218), -INT32_C(   735677144),  INT32_C(   391549162), -INT32_C(  1455960001), -INT32_C(  2062185057), -INT32_C(  1847274169),  INT32_C(   434582920) },
      {  INT32_C(   471833770),  INT32_C(  1076138264), -INT32_C(   267105786),  INT32_C(   419982298), -INT32_C(   624738501),  INT32_C(   341825741),  INT32_C(   900023213),  INT32_C(   575573112) },
      { -INT32_C(  1820840934),  INT32_C(  1963422331), -INT32_C(  2132056715), -INT32_C(  1403168189),  INT32_C(  1833549441), -INT32_C(   638758750),  INT32_C(   389853756),  INT32_C(  1243211573) } },
    { {  INT32_C(  1094675753),  INT32_C(    92365823), -INT32_C(  2013882707),  INT32_C(  1017249281),  INT32_C(   169239613), -INT32_C(   383879620),  INT32_C(   840877241),  INT32_C(  2035575888) },
      { -INT32_C(   658861095), -INT32_C(  1545716490), -INT32_C(   752102190),  INT32_C(   252693714),  INT32_C(  1813652784),  INT32_C(  1431648411),  INT32_C(  1300722684), -INT32_C(  1194927137) },
      {  INT32_C(  1704034671), -INT32_C(  1895206979),  INT32_C(   358757443),  INT32_C(   807694592),  INT32_C(   849100438),  INT32_C(  1938289015),  INT32_C(  1136660068),  INT32_C(  1492879337) },
      { -INT32_C(  1231754147), -INT32_C(   193214562),  INT32_C(  1068807534),  INT32_C(  1017249281),  INT32_C(   257623689),  INT32_C(   506112668),  INT32_C(   569133972), -INT32_C(  1462197903) } },
    { { -INT32_C(   977368056),  INT32_C(  1045743611), -INT32_C(    78399749), -INT32_C(  1121224665),  INT32_C(   770688950),  INT32_C(   480343736),  INT32_C(  1851744644), -INT32_C(   255436056) },
      { -INT32_C(   491420441),  INT32_C(  1176570187), -INT32_C(   431917889), -INT32_C(  1549505300), -INT32_C(   338652365), -INT32_C(  1912114934), -INT32_C(  1141086509), -INT32_C(  1465072703) },
      { -INT32_C(  1819647673),  INT32_C(   718908267),  INT32_C(   202447648), -INT32_C(  1146112633),  INT32_C(  1386643528), -INT32_C(   991842575), -INT32_C(   712975084), -INT32_C(   394449760) },
      { -INT32_C(   549059471), -INT32_C(  1505764815), -INT32_C(    78399749), -INT32_C(  1782836271), -INT32_C(   272124181), -INT32_C(   311354354),  INT32_C(   407617478), -INT32_C(   255436056) } },
    { { -INT32_C(   126154611), -INT32_C(   752659277), -INT32_C(   136301457),  INT32_C(   833785833),  INT32_C(    25450511),  INT32_C(   465921286), -INT32_C(   470792894), -INT32_C(     3445135) },
      {  INT32_C(   704071286),  INT32_C(   184359578),  INT32_C(   922869070),  INT32_C(  2087301996),  INT32_C(   310242571), -INT32_C(  1808973230), -INT32_C(   109634168),  INT32_C(    33047179) },
      {  INT32_C(   590082184),  INT32_C(  1496131594),  INT32_C(  1905274373), -INT32_C(   319948319),  INT32_C(   956197606),  INT32_C(   902638509), -INT32_C(   735165367),  INT32_C(   265693063) },
      {  INT32_C(  2064157993), -INT32_C(  1923953621), -INT32_C(    66679322),  INT32_C(  1667571666),  INT32_C(  1628832708), -INT32_C(  1398746491), -INT32_C(   527792654), -INT32_C(   440977280) } },
    { {  INT32_C(   556925207),  INT32_C(   779771689),  INT32_C(  1855916941), -INT32_C(   346321660), -INT32_C(  1541187081), -INT32_C(   824577915), -INT32_C(  1130231755),  INT32_C(  1187739695) },
      { -INT32_C(  1570242951), -INT32_C(   338632099), -INT32_C(   245796627), -INT32_C(   186862339), -INT32_C(  1818689522),  INT32_C(   627143408), -INT32_C(  1444871302), -INT32_C(   168841860) },
      {  INT32_C(   144201643),  INT32_C(   653486137), -INT32_C(   719893032),  INT32_C(   264958977), -INT32_C(   459119628),  INT32_C(  1342833621), -INT32_C(  2080773369),  INT32_C(  1131997592) },
      { -INT32_C(  1878475501),  INT32_C(  1406640580), -INT32_C(  1913562768), -INT32_C(   692643319), -INT32_C(  1619445360),  INT32_C(   279227438),  INT32_C(  1359223508),  INT32_C(   804646829) } },
    { {  INT32_C(  2035028032),  INT32_C(  1369390969), -INT32_C(  1909999988), -INT32_C(  1633816150),  INT32_C(   696467540),  INT32_C(  1249480003),  INT32_C(   298677112), -INT32_C(  1672198564) },
      { -INT32_C(   820666282),  INT32_C(  1814148320),  INT32_C(   368724074), -INT32_C(  1917609927),  INT32_C(   464926424),  INT32_C(  1013330115), -INT32_C(    11717725), -INT32_C(   795106951) },
      {  INT32_C(   580890690), -INT32_C(   829505436),  INT32_C(  1105430792), -INT32_C(   103901407), -INT32_C(  1860926003),  INT32_C(  1489861301),  INT32_C(   660019886), -INT32_C(    34082117) },
      { -INT32_C(   449822461),  INT32_C(   435419030),  INT32_C(   666274837),  INT32_C(  1027334997),  INT32_C(  1745519478), -INT32_C(  1469608762),  INT32_C(  1558069203), -INT32_C(   427500277) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m256i a = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_shldv_epi32(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_shldv_epi32");
    easysimd_assert_m256i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m256i a = easysimd_test_x86_random_i32x8();
    easysimd__m256i b = easysimd_test_x86_random_i32x8();
    easysimd__m256i c = easysimd_test_x86_random_i32x8();
    easysimd__m256i r = easysimd_mm256_shldv_epi32(a, b, c);

    easysimd_test_x86_write_i32x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_shldv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int16_t a[32];
    int16_t b[32];
    int16_t c[32];
    int16_t r[32];
  } test_vec[8] = {
    { {  INT16_C( 21140),  INT16_C(  7111), -INT16_C( 23414),  INT16_C(  7762), -INT16_C( 17732), -INT16_C(  8551),  INT16_C( 12748),  INT16_C( 10129),
        -INT16_C( 22936),  INT16_C(  9175),  INT16_C( 16173), -INT16_C( 27560), -INT16_C( 12096), -INT16_C( 17080), -INT16_C( 16747),  INT16_C( 10702),
        -INT16_C( 27376), -INT16_C( 26043), -INT16_C( 26822), -INT16_C(  2376),  INT16_C( 20818),  INT16_C(  7892),  INT16_C( 25987), -INT16_C(  5307),
         INT16_C(  7179),  INT16_C( 14350),  INT16_C( 26203),  INT16_C(  7117),  INT16_C(  5431), -INT16_C( 13095), -INT16_C( 22573), -INT16_C(  6922) },
      {  INT16_C( 15165),  INT16_C( 30590),  INT16_C( 14290),  INT16_C(  9325),  INT16_C( 17032),  INT16_C(  2882), -INT16_C( 30553), -INT16_C( 19466),
         INT16_C(  1444),  INT16_C(   235), -INT16_C( 18325), -INT16_C( 24037), -INT16_C(  2867), -INT16_C( 24209),  INT16_C( 26012), -INT16_C(  9851),
         INT16_C(   928),  INT16_C( 29264), -INT16_C( 17094), -INT16_C( 15465), -INT16_C(  9729), -INT16_C( 22578), -INT16_C( 15007),  INT16_C(  1626),
         INT16_C( 17866),  INT16_C( 13574),  INT16_C(  8702), -INT16_C( 13352),  INT16_C( 18198), -INT16_C( 19860), -INT16_C(  3668),  INT16_C( 19595) },
      { -INT16_C(  9227),  INT16_C( 12222),  INT16_C( 21912), -INT16_C( 26382), -INT16_C( 16081), -INT16_C( 28609), -INT16_C( 26234),  INT16_C( 20630),
        -INT16_C( 25378), -INT16_C(  9083),  INT16_C( 23998), -INT16_C( 11096),  INT16_C(  5284),  INT16_C( 20614),  INT16_C(  4358), -INT16_C(  1124),
         INT16_C( 23532), -INT16_C( 31702),  INT16_C(  7600), -INT16_C(  8420),  INT16_C( 23518),  INT16_C( 25712),  INT16_C(  1780), -INT16_C( 11340),
         INT16_C( 14755),  INT16_C( 25007),  INT16_C( 22423),  INT16_C( 15157), -INT16_C( 17556),  INT16_C( 29324),  INT16_C( 10444), -INT16_C( 18323) },
      {  INT16_C( 21127), -INT16_C(  8737), -INT16_C( 30153),  INT16_C( 31048),  INT16_C(  8516), -INT16_C( 31327),  INT16_C( 29474), -INT16_C(  7060),
         INT16_C(   361),  INT16_C( 31456),  INT16_C( 28186),  INT16_C( 22690),  INT16_C(  3087),  INT16_C( 21032), -INT16_C( 23207), -INT16_C(  4712),
         INT16_C(    58),  INT16_C(  5577), -INT16_C( 26822), -INT16_C( 29639), -INT16_C( 18817),  INT16_C(  7892),  INT16_C( 22588), -INT16_C( 19376),
        -INT16_C(  8102),  INT16_C(  6787),  INT16_C( 11664),  INT16_C( 31161),  INT16_C( 29809), -INT16_C( 25818),  INT16_C( 16154), -INT16_C( 13935) } },
    { { -INT16_C( 26749),  INT16_C( 13372),  INT16_C( 22964), -INT16_C( 28141), -INT16_C( 31820), -INT16_C( 22026), -INT16_C( 21878),  INT16_C( 11644),
         INT16_C( 11236),  INT16_C( 31630), -INT16_C( 15485), -INT16_C(  4170),  INT16_C( 17022),  INT16_C( 19041), -INT16_C( 12693), -INT16_C(  4606),
         INT16_C( 15973),  INT16_C(  6690),  INT16_C( 13975),  INT16_C( 19628), -INT16_C( 23623),  INT16_C( 17397),  INT16_C( 29005),  INT16_C( 12656),
        -INT16_C(   356),  INT16_C(  8108),  INT16_C( 25537),  INT16_C( 16142),  INT16_C( 28581),  INT16_C(  4233), -INT16_C( 29891), -INT16_C( 23553) },
      {  INT16_C(  8650),  INT16_C( 25021),  INT16_C( 26967),  INT16_C(  4525), -INT16_C( 24052),  INT16_C( 23124), -INT16_C( 15085), -INT16_C( 20341),
         INT16_C( 14531), -INT16_C( 31281), -INT16_C(  8549),  INT16_C( 16580),  INT16_C( 20045), -INT16_C( 29871),  INT16_C( 20697), -INT16_C( 23762),
        -INT16_C(  5263), -INT16_C( 14075), -INT16_C( 19884),  INT16_C( 25050),  INT16_C( 11861),  INT16_C( 26811),  INT16_C( 18163), -INT16_C( 18664),
        -INT16_C(  6018),  INT16_C(  6460),  INT16_C(   198),  INT16_C(  4954), -INT16_C( 21682),  INT16_C( 10398), -INT16_C( 13061),  INT16_C( 27851) },
      { -INT16_C( 12105),  INT16_C(  3125),  INT16_C(  3971), -INT16_C( 10131),  INT16_C( 10302),  INT16_C( 12608),  INT16_C( 22894), -INT16_C(  4632),
         INT16_C(  9281),  INT16_C(  1798),  INT16_C( 24613),  INT16_C( 29466), -INT16_C( 18165),  INT16_C(  1691),  INT16_C( 26501),  INT16_C( 15731),
        -INT16_C( 22473), -INT16_C( 17847), -INT16_C( 18760), -INT16_C(  2414), -INT16_C( 11298),  INT16_C( 19495),  INT16_C(  4140),  INT16_C( 27961),
         INT16_C( 16436),  INT16_C( 22900), -INT16_C( 29024), -INT16_C( 21299),  INT16_C( 26695), -INT16_C( 12878),  INT16_C(  9679),  INT16_C(  1802) },
      { -INT16_C( 15984), -INT16_C( 30836), -INT16_C( 12893),  INT16_C( 25141),  INT16_C( 10371), -INT16_C( 22026), -INT16_C( 20156),  INT16_C( 31920),
         INT16_C( 22472), -INT16_C(  7263),  INT16_C( 28795), -INT16_C(  9981), -INT16_C(  3470),  INT16_C(  3162), -INT16_C( 12950),  INT16_C( 28693),
         INT16_C( 13045),  INT16_C( 17810), -INT16_C( 26702),  INT16_C( 12977),  INT16_C( 19349), -INT16_C(  1356), -INT16_C( 11153), -INT16_C(  7826),
        -INT16_C(  5682), -INT16_C(  1343),  INT16_C( 25537), -INT16_C( 15765), -INT16_C( 11563),  INT16_C( 16932), -INT16_C(  6531), -INT16_C(   589) } },
    { {  INT16_C( 21454), -INT16_C( 31039),  INT16_C( 21513), -INT16_C(  6276), -INT16_C( 23769),  INT16_C( 21299),  INT16_C( 28083), -INT16_C(  5952),
         INT16_C( 13485),  INT16_C( 19777),  INT16_C(  3778),  INT16_C(  2809), -INT16_C( 21385),  INT16_C( 18135), -INT16_C(  7727), -INT16_C( 24755),
         INT16_C(  3892),  INT16_C( 15653), -INT16_C( 24221), -INT16_C( 30172),  INT16_C( 22341), -INT16_C(  1827), -INT16_C( 25148),  INT16_C( 29152),
         INT16_C(  8913), -INT16_C( 27713), -INT16_C( 18384), -INT16_C( 22627),  INT16_C( 29796),  INT16_C( 14062),  INT16_C( 15189), -INT16_C( 30251) },
      { -INT16_C(  1206), -INT16_C( 21050), -INT16_C(  5476), -INT16_C(  7881),  INT16_C(  5186),  INT16_C(  1754), -INT16_C( 17743), -INT16_C( 32136),
         INT16_C( 14300),  INT16_C(  3350), -INT16_C( 19473),  INT16_C( 21684), -INT16_C( 24024),  INT16_C( 32138),  INT16_C( 24542),  INT16_C( 10247),
        -INT16_C( 12966), -INT16_C(  2090),  INT16_C(  3512), -INT16_C(  1320), -INT16_C( 19934), -INT16_C( 11520),  INT16_C( 30829),  INT16_C( 18774),
         INT16_C( 27823), -INT16_C( 24746),  INT16_C(  2847),  INT16_C( 18419),  INT16_C( 32173), -INT16_C( 29755), -INT16_C( 13092),  INT16_C( 14260) },
      { -INT16_C( 30055),  INT16_C( 20782),  INT16_C(  1687), -INT16_C( 18101),  INT16_C( 19641),  INT16_C(  9869), -INT16_C(  7228),  INT16_C( 29807),
        -INT16_C( 14769),  INT16_C( 28179),  INT16_C(  1745),  INT16_C( 32438),  INT16_C( 31619),  INT16_C( 24330), -INT16_C( 16825), -INT16_C(  8042),
        -INT16_C( 15288), -INT16_C(  8398),  INT16_C( 32203), -INT16_C( 31591),  INT16_C(  9929), -INT16_C( 29014),  INT16_C(  6409),  INT16_C( 22530),
         INT16_C(  5599), -INT16_C( 20282),  INT16_C( 31771), -INT16_C( 25041),  INT16_C( 14839),  INT16_C( 16125), -INT16_C( 27401),  INT16_C( 16159) },
      { -INT16_C( 25098),  INT16_C( 27505),  INT16_C(  1269), -INT16_C(  6391),  INT16_C( 20008),  INT16_C( 24795), -INT16_C(  9413),  INT16_C( 16700),
        -INT16_C( 25618),  INT16_C( 27144),  INT16_C(  7557), -INT16_C( 16811),  INT16_C( 25533),  INT16_C( 24054), -INT16_C(  5969), -INT16_C( 11446),
         INT16_C( 13517), -INT16_C(  2921),  INT16_C(  6253),  INT16_C( 18933), -INT16_C( 29852),  INT16_C( 30540), -INT16_C( 30480), -INT16_C( 14463),
        -INT16_C( 18857), -INT16_C(  4121), -INT16_C( 32680), -INT16_C( 23559),  INT16_C( 12862), -INT16_C( 11912), -INT16_C( 21786), -INT16_C( 25638) } },
    { {  INT16_C( 20824),  INT16_C(  8990), -INT16_C( 18482), -INT16_C( 26457),  INT16_C( 20957), -INT16_C(  6618),  INT16_C( 10347),  INT16_C( 19006),
         INT16_C(  1341),  INT16_C( 22779),  INT16_C( 10881),  INT16_C( 31222), -INT16_C(  3229),  INT16_C( 23223), -INT16_C( 10617), -INT16_C(  8039),
        -INT16_C( 18649), -INT16_C(  2557), -INT16_C( 21649),  INT16_C( 19598), -INT16_C( 19204),  INT16_C( 26419),  INT16_C( 29148),  INT16_C(  6578),
        -INT16_C( 21130), -INT16_C(  1935),  INT16_C( 26583),  INT16_C( 14961),  INT16_C( 10330), -INT16_C(  7532),  INT16_C( 11775),  INT16_C(  9922) },
      { -INT16_C( 14876),  INT16_C( 21276), -INT16_C( 21904),  INT16_C( 28064), -INT16_C( 11426),  INT16_C( 15060), -INT16_C( 31164), -INT16_C( 17581),
        -INT16_C( 15309),  INT16_C(  2739),  INT16_C(  9259), -INT16_C( 31164), -INT16_C( 10164),  INT16_C( 19304),  INT16_C( 10757), -INT16_C(  5518),
        -INT16_C( 28945),  INT16_C( 24637), -INT16_C(  8903), -INT16_C( 26675), -INT16_C( 24144), -INT16_C(  2606),  INT16_C(  9512),  INT16_C( 23472),
         INT16_C( 25578),  INT16_C(  5478), -INT16_C( 21881), -INT16_C( 11365),  INT16_C(   899), -INT16_C( 30689), -INT16_C( 28371),  INT16_C(  7538) },
      { -INT16_C( 20449),  INT16_C( 22653),  INT16_C( 19085),  INT16_C( 16112), -INT16_C( 15637),  INT16_C(  4915), -INT16_C(  7193), -INT16_C( 11921),
        -INT16_C( 10938), -INT16_C( 12825), -INT16_C( 32129),  INT16_C(   672), -INT16_C( 16506), -INT16_C( 19573), -INT16_C(   688),  INT16_C( 28880),
         INT16_C( 19885),  INT16_C( 15304), -INT16_C( 18281), -INT16_C( 31879), -INT16_C( 21382),  INT16_C( 25238),  INT16_C(  1423), -INT16_C( 10957),
         INT16_C(  6874),  INT16_C( 23202),  INT16_C( 17053),  INT16_C(  9052), -INT16_C(  6398),  INT16_C( 21206), -INT16_C( 22555), -INT16_C( 27966) },
      {  INT16_C( 25330), -INT16_C( 13725), -INT16_C( 10930), -INT16_C( 26457), -INT16_C(  4454),  INT16_C( 12593),  INT16_C( 13763),  INT16_C( 23977),
         INT16_C( 20337),  INT16_C( 32133), -INT16_C( 28139),  INT16_C( 31222), -INT16_C(  9994), -INT16_C( 17829), -INT16_C( 10617), -INT16_C(  8039),
        -INT16_C(  3619),  INT16_C(   864), -INT16_C( 18450),  INT16_C(  7471), -INT16_C(  3450), -INT16_C( 13059),  INT16_C(  4756), -INT16_C( 12910),
        -INT16_C(  9841), -INT16_C(  7740), -INT16_C(  2736),  INT16_C(  7481), -INT16_C( 24216), -INT16_C( 23262), -INT16_C( 16398), -INT16_C( 25848) } },
    { { -INT16_C( 29708), -INT16_C( 29491),  INT16_C( 17987), -INT16_C( 16881), -INT16_C( 23054), -INT16_C( 32480),  INT16_C( 21419), -INT16_C( 31402),
        -INT16_C(  1938),  INT16_C(  3039),  INT16_C( 15419),  INT16_C( 15662),  INT16_C(  1059),  INT16_C(  2191),  INT16_C( 21163), -INT16_C( 24421),
         INT16_C( 26845),  INT16_C(  8236),  INT16_C( 15279), -INT16_C( 24098), -INT16_C(   288), -INT16_C( 29917),  INT16_C( 31058), -INT16_C( 16367),
        -INT16_C(  3982), -INT16_C( 21045), -INT16_C(  1748),  INT16_C( 20714),  INT16_C( 31229), -INT16_C( 22184), -INT16_C(  3125), -INT16_C( 22455) },
      {  INT16_C( 30044),  INT16_C(  3017), -INT16_C( 22608), -INT16_C( 28500), -INT16_C( 12378), -INT16_C(  2020),  INT16_C( 11593), -INT16_C( 17480),
        -INT16_C( 31971),  INT16_C( 19048),  INT16_C( 21116),  INT16_C( 31130), -INT16_C(  3381), -INT16_C( 26846),  INT16_C( 27622),  INT16_C( 16959),
         INT16_C(  2272), -INT16_C( 28595), -INT16_C(  1616),  INT16_C( 22049),  INT16_C( 15817),  INT16_C(  4686),  INT16_C(  1642), -INT16_C( 30771),
         INT16_C( 13705),  INT16_C(  1489),  INT16_C( 27527),  INT16_C( 21118), -INT16_C( 24226),  INT16_C( 17641),  INT16_C( 10508), -INT16_C(  4730) },
      { -INT16_C( 11471), -INT16_C(  7811), -INT16_C( 24884), -INT16_C( 27337), -INT16_C( 31269),  INT16_C( 17831),  INT16_C( 29835),  INT16_C(  5325),
        -INT16_C( 24919),  INT16_C( 12313), -INT16_C( 26614),  INT16_C( 26755),  INT16_C( 27705),  INT16_C( 17836),  INT16_C( 12949), -INT16_C( 14542),
        -INT16_C( 20475), -INT16_C( 11864), -INT16_C(  8114),  INT16_C( 10855),  INT16_C(  3685), -INT16_C(  3729),  INT16_C( 15491),  INT16_C( 11269),
         INT16_C(  8155), -INT16_C(  6819), -INT16_C(  8009), -INT16_C(  4019), -INT16_C(  1716), -INT16_C(  7627),  INT16_C( 26667),  INT16_C( 12457) },
      {  INT16_C(  6120), -INT16_C( 24199),  INT16_C( 14971),  INT16_C(  1992), -INT16_C( 27011), -INT16_C( 28548),  INT16_C( 22890), -INT16_C( 10377),
        -INT16_C(  8954), -INT16_C( 16748), -INT16_C(  4791), -INT16_C(  5773),  INT16_C( 18405), -INT16_C(  1678),  INT16_C( 21869), -INT16_C( 32147),
         INT16_C(  7073),  INT16_C( 11408), -INT16_C(   404), -INT16_C(  4309), -INT16_C(  9209), -INT16_C( 30425), -INT16_C( 13680),  INT16_C(   560),
        -INT16_C( 28244),  INT16_C( 24762), -INT16_C( 27083),  INT16_C( 19023), -INT16_C(  9707),  INT16_C( 11016),  INT16_C( 22856), -INT16_C( 27685) } },
    { {  INT16_C( 20760),  INT16_C( 26113),  INT16_C( 26673), -INT16_C( 26736),  INT16_C(   119), -INT16_C(  1400), -INT16_C( 29380),  INT16_C(  5926),
        -INT16_C( 31828),  INT16_C( 25596),  INT16_C( 18787), -INT16_C( 20397), -INT16_C( 30398),  INT16_C( 28050),  INT16_C( 15345),  INT16_C(  2461),
        -INT16_C( 24692), -INT16_C( 16785),  INT16_C(     7),  INT16_C( 32341), -INT16_C(  8960),  INT16_C( 15480), -INT16_C( 24726),  INT16_C(  5972),
         INT16_C( 20514), -INT16_C( 31110), -INT16_C( 12646), -INT16_C(  9162), -INT16_C( 14249),  INT16_C( 18506), -INT16_C(  6397), -INT16_C( 28847) },
      { -INT16_C( 16250), -INT16_C( 29107), -INT16_C( 23872), -INT16_C( 16372), -INT16_C( 31361), -INT16_C(  5379),  INT16_C( 20772),  INT16_C( 17921),
         INT16_C( 31649),  INT16_C( 15308),  INT16_C(   585), -INT16_C( 24552),  INT16_C( 25290), -INT16_C( 12824),  INT16_C( 14665), -INT16_C( 12195),
        -INT16_C( 21766), -INT16_C( 17826),  INT16_C( 27213), -INT16_C( 13189),  INT16_C( 30959),  INT16_C(  5046), -INT16_C( 18487),  INT16_C( 27226),
         INT16_C(  9779),  INT16_C( 31910), -INT16_C( 16855), -INT16_C(  3299),  INT16_C(  1312),  INT16_C( 27073),  INT16_C(  7743),  INT16_C( 14649) },
      { -INT16_C( 26680),  INT16_C(  5619),  INT16_C( 28162), -INT16_C(  3614), -INT16_C( 26394), -INT16_C( 20731),  INT16_C( 24400), -INT16_C( 31974),
        -INT16_C( 16251), -INT16_C( 20737),  INT16_C(  7294), -INT16_C( 24926),  INT16_C( 25378),  INT16_C( 24839),  INT16_C( 16769),  INT16_C( 18842),
        -INT16_C( 29224), -INT16_C(  9633),  INT16_C( 16892), -INT16_C(  7476), -INT16_C( 11815),  INT16_C( 10642), -INT16_C( 21456), -INT16_C( 19028),
        -INT16_C( 21396), -INT16_C(  5532),  INT16_C(  1736), -INT16_C(  5496), -INT16_C( 28823), -INT16_C(  5557), -INT16_C(  6704), -INT16_C( 22221) },
      {  INT16_C(  6336),  INT16_C( 12300), -INT16_C( 24378),  INT16_C( 24131),  INT16_C(  7649),  INT16_C( 20765), -INT16_C( 29380), -INT16_C( 26344),
         INT16_C( 30095),  INT16_C(  7654), -INT16_C( 16238), -INT16_C( 16050),  INT16_C(  9481), -INT16_C( 13978),  INT16_C( 30690),  INT16_C( 30529),
        -INT16_C( 29526), -INT16_C(  8913),  INT16_C( 30372),  INT16_C( 23751),  INT16_C(   241), -INT16_C(  3616), -INT16_C( 24726),  INT16_C( 18085),
         INT16_C(  8803),  INT16_C( 26535), -INT16_C( 25922),  INT16_C( 14067), -INT16_C( 20982),  INT16_C( 21326), -INT16_C(  6397),  INT16_C( 31369) } },
    { { -INT16_C( 28045),  INT16_C( 28547),  INT16_C( 20435), -INT16_C( 21167), -INT16_C(  7392),  INT16_C( 20694), -INT16_C( 31857), -INT16_C(  1274),
         INT16_C( 27183), -INT16_C(  2075),  INT16_C( 28016), -INT16_C(  9758),  INT16_C( 11773), -INT16_C( 12861), -INT16_C(  2541), -INT16_C( 31114),
        -INT16_C(  1399),  INT16_C( 23797),  INT16_C( 17993),  INT16_C( 27145), -INT16_C(  8150), -INT16_C( 17990), -INT16_C( 16285), -INT16_C( 27979),
        -INT16_C( 26070), -INT16_C( 25975),  INT16_C( 27400),  INT16_C(  1395),  INT16_C( 13977), -INT16_C( 21294),  INT16_C( 18733), -INT16_C( 18894) },
      {  INT16_C( 10051), -INT16_C( 29678),  INT16_C(  7277), -INT16_C( 26634), -INT16_C( 19972),  INT16_C( 24401),  INT16_C(  1649), -INT16_C( 25359),
         INT16_C( 31392), -INT16_C( 22474), -INT16_C( 21786),  INT16_C( 32685), -INT16_C( 32544),  INT16_C(  3371),  INT16_C( 24009),  INT16_C(  3267),
        -INT16_C( 10620), -INT16_C(  3688), -INT16_C( 28686), -INT16_C(  4471), -INT16_C(  9664), -INT16_C( 20147),  INT16_C( 16096), -INT16_C( 32691),
        -INT16_C( 31560), -INT16_C( 25047), -INT16_C( 10706),  INT16_C(  3613),  INT16_C( 18518),  INT16_C(  7964), -INT16_C(  8283),  INT16_C( 10539) },
      { -INT16_C( 15179), -INT16_C( 22757), -INT16_C( 23469), -INT16_C( 27755), -INT16_C(  7554),  INT16_C( 24132), -INT16_C( 28128), -INT16_C(  9762),
         INT16_C(  1814),  INT16_C( 17527), -INT16_C( 27170),  INT16_C( 13394),  INT16_C( 28381), -INT16_C( 31916),  INT16_C( 32590),  INT16_C(   940),
        -INT16_C( 14525), -INT16_C( 26965),  INT16_C( 16491), -INT16_C(  5847),  INT16_C( 28195),  INT16_C( 17223),  INT16_C(  9728),  INT16_C(  5660),
        -INT16_C( 27603),  INT16_C(  2906), -INT16_C( 21463),  INT16_C(  1600), -INT16_C( 27621),  INT16_C( 27017),  INT16_C( 13843),  INT16_C( 22380) },
      {  INT16_C( 20068),  INT16_C(  7264),  INT16_C( 32408), -INT16_C( 21966),  INT16_C( 11391),  INT16_C(  3429), -INT16_C( 31857), -INT16_C( 22724),
        -INT16_C( 29730), -INT16_C(  3372),  INT16_C( 10937),  INT16_C( 26505), -INT16_C( 20452), -INT16_C(  9168), -INT16_C( 10382),  INT16_C( 24780),
        -INT16_C( 11186), -INT16_C( 20596),  INT16_C( 19583),  INT16_C(  5085),  INT16_C(   342), -INT16_C(  8872), -INT16_C( 16285),  INT16_C( 22532),
         INT16_C( 20631),  INT16_C(  9848),  INT16_C(  4524),  INT16_C(  1395), -INT16_C( 13758), -INT16_C( 23490),  INT16_C( 18798),  INT16_C(  8850) } },
    { {  INT16_C(  6141),  INT16_C( 27117),  INT16_C(  5976),  INT16_C( 31570), -INT16_C( 25979), -INT16_C( 31298), -INT16_C(  9280), -INT16_C(  4709),
        -INT16_C(  2705), -INT16_C( 26375),  INT16_C( 14753), -INT16_C( 17250),  INT16_C( 10445), -INT16_C(  8155), -INT16_C( 28066),  INT16_C( 23351),
         INT16_C(  9641),  INT16_C(   452),  INT16_C(  5948), -INT16_C( 16004),  INT16_C( 15281),  INT16_C( 28998), -INT16_C(  7914), -INT16_C( 31394),
         INT16_C( 22486),  INT16_C( 30493), -INT16_C( 17520),  INT16_C( 23860),  INT16_C( 23011),  INT16_C( 16702),  INT16_C( 30187), -INT16_C( 27235) },
      {  INT16_C( 24986), -INT16_C( 10602),  INT16_C(  4984),  INT16_C( 10647), -INT16_C(  8882),  INT16_C( 25754), -INT16_C(  1602), -INT16_C( 27415),
         INT16_C(  1616), -INT16_C(  7924),  INT16_C( 16577), -INT16_C( 23234),  INT16_C( 31897), -INT16_C( 31258), -INT16_C( 31758), -INT16_C( 29670),
        -INT16_C( 20251),  INT16_C( 23907), -INT16_C(  1341),  INT16_C(  4487),  INT16_C(  8664), -INT16_C( 27019),  INT16_C( 24090),  INT16_C( 27435),
         INT16_C( 14180),  INT16_C(  9804), -INT16_C( 30089),  INT16_C(  4299), -INT16_C( 20217), -INT16_C(  1643), -INT16_C( 20683),  INT16_C(  6789) },
      { -INT16_C(  6048),  INT16_C(  9079), -INT16_C(   285), -INT16_C( 17611), -INT16_C( 21984),  INT16_C( 14929),  INT16_C( 31753),  INT16_C( 28069),
        -INT16_C(  3661),  INT16_C( 10899),  INT16_C( 24188), -INT16_C( 31941), -INT16_C( 12272),  INT16_C( 17788),  INT16_C(   384), -INT16_C(  8097),
        -INT16_C( 10518), -INT16_C( 13053),  INT16_C( 14549), -INT16_C(  2680), -INT16_C(  9757), -INT16_C(  5073), -INT16_C( 10922),  INT16_C(  2393),
        -INT16_C(  4666),  INT16_C( 16948),  INT16_C( 28491),  INT16_C( 23493),  INT16_C( 16703), -INT16_C( 16480), -INT16_C(   189),  INT16_C( 11679) },
      {  INT16_C(  6141), -INT16_C(  2325), -INT16_C( 17728),  INT16_C( 27205), -INT16_C( 25979),  INT16_C(  2940), -INT16_C( 32269), -INT16_C( 19598),
        -INT16_C( 21640), -INT16_C( 14385),  INT16_C(  5132), -INT16_C(  2775),  INT16_C( 10445),  INT16_C( 22622), -INT16_C( 28066), -INT16_C( 14835),
        -INT16_C( 22845),  INT16_C(  3618), -INT16_C(  6241),  INT16_C( 31761), -INT16_C(  8823),  INT16_C( 19258),  INT16_C( 17815), -INT16_C( 17194),
        -INT16_C(  2675),  INT16_C( 29138), -INT16_C( 31661), -INT16_C( 22910), -INT16_C( 10109),  INT16_C( 16702), -INT16_C( 20643), -INT16_C( 29374) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_shldv_epi16(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_shldv_epi16");
    easysimd_assert_m512i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i16x32();
    easysimd__m512i b = easysimd_test_x86_random_i16x32();
    easysimd__m512i c = easysimd_test_x86_random_i16x32();
    easysimd__m512i r = easysimd_mm512_shldv_epi16(a, b, c);

    easysimd_test_x86_write_i16x32(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x32(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_shldv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int32_t a[16];
    int32_t b[16];
    int32_t c[16];
    int32_t r[16];
  } test_vec[8] = {
    { {  INT32_C(  1363703746),  INT32_C(  1112142614),  INT32_C(   701449980), -INT32_C(   119850376), -INT32_C(   651899204),  INT32_C(  1919700839),  INT32_C(   762665361),  INT32_C(   391170900),
         INT32_C(  1483249730), -INT32_C(  2019904885),  INT32_C(  1890675192),  INT32_C(  1617464483), -INT32_C(  1053193126),  INT32_C(  1815389659),  INT32_C(  1385867774), -INT32_C(  1234572684) },
      {  INT32_C(   219140738),  INT32_C(  2090183044), -INT32_C(  1226029549),  INT32_C(   756438226), -INT32_C(  1125232671), -INT32_C(   232185100),  INT32_C(  1078313932),  INT32_C(   804761261),
         INT32_C(    71042688), -INT32_C(  1031745105), -INT32_C(   361141225), -INT32_C(  1575514175), -INT32_C(   748812833), -INT32_C(   188315864), -INT32_C(   147584182),  INT32_C(   975580089) },
      { -INT32_C(   516005071),  INT32_C(  1285799732), -INT32_C(   331998165), -INT32_C(  1953608276),  INT32_C(  2053041490), -INT32_C(  1083300748), -INT32_C(   373906641),  INT32_C(     2350542),
         INT32_C(  1960927552),  INT32_C(  1287685152),  INT32_C(  1295578785), -INT32_C(  1764178109),  INT32_C(   672151220), -INT32_C(  1964540069), -INT32_C(   260858334), -INT32_C(  1141860741) },
      { -INT32_C(   276555233),  INT32_C(   828885338),  INT32_C(  2050483639), -INT32_C(  1280867631),  INT32_C(   989000633), -INT32_C(   159440238), -INT32_C(  1396137950),  INT32_C(   852823037),
         INT32_C(  1483249730), -INT32_C(  2019904885), -INT32_C(   513616911),  INT32_C(    54813981), -INT32_C(   978504224), -INT32_C(   542755783),  INT32_C(  1248503803), -INT32_C(  1580125859) } },
    { {  INT32_C(   405787128), -INT32_C(   144379818),  INT32_C(   709139942),  INT32_C(   415243364), -INT32_C(  1388261294),  INT32_C(  1899505743),  INT32_C(  1096985542),  INT32_C(   989614658),
         INT32_C(  2052205348),  INT32_C(    41006875), -INT32_C(  1205029548),  INT32_C(   600894673),  INT32_C(   215027900), -INT32_C(    25360072), -INT32_C(   163586124),  INT32_C(  1446001458) },
      { -INT32_C(  2100264089), -INT32_C(  1903935174), -INT32_C(   951668490),  INT32_C(  1508513436),  INT32_C(  1600502566),  INT32_C(  2036196036), -INT32_C(   194011710),  INT32_C(  1061855448),
         INT32_C(  1573001763),  INT32_C(  1374373467), -INT32_C(  1827130889),  INT32_C(  1844183623), -INT32_C(  2100538946), -INT32_C(   151311820), -INT32_C(  1612026937),  INT32_C(   786379787) },
      { -INT32_C(  1450466994), -INT32_C(   554010905), -INT32_C(   294514009), -INT32_C(   765764076), -INT32_C(   464181072),  INT32_C(   433737810), -INT32_C(   960969541),  INT32_C(  1190434808),
         INT32_C(   552566584), -INT32_C(  1661015563),  INT32_C(   260731131),  INT32_C(  2145576655),  INT32_C(  1617114894),  INT32_C(  1132019079), -INT32_C(   116838143),  INT32_C(    20971209) },
      { -INT32_C(   193060684), -INT32_C(  1300747449),  INT32_C(   575599459), -INT32_C(   968515935), -INT32_C(   799907995), -INT32_C(  1589779081),  INT32_C(   933461230),  INT32_C(  1111444128),
         INT32_C(   610124314), -INT32_C(   479576728), -INT32_C(  1533492849),  INT32_C(  1986574070),  INT32_C(  1143939251),  INT32_C(  1048878203), -INT32_C(   327172247),  INT32_C(  1618371677) } },
    { {  INT32_C(  1931554429),  INT32_C(   302981143),  INT32_C(  1596037776), -INT32_C(  1898052736), -INT32_C(  1024573126),  INT32_C(  2131060606),  INT32_C(  1635258008), -INT32_C(  1973176564),
        -INT32_C(    50494235),  INT32_C(   890113188),  INT32_C(   647245990),  INT32_C(  1857319731),  INT32_C(   858825396), -INT32_C(  1565379319),  INT32_C(  1342384963), -INT32_C(   925210910) },
      { -INT32_C(  1882925077), -INT32_C(  1966812189),  INT32_C(   917526787), -INT32_C(  2136709684),  INT32_C(   296997895),  INT32_C(  1303602697),  INT32_C(  1939715729),  INT32_C(   138114845),
         INT32_C(   831979598), -INT32_C(   692364077), -INT32_C(  2129892171), -INT32_C(   670977583), -INT32_C(  1880509051), -INT32_C(  1394828261),  INT32_C(  1881110867),  INT32_C(  1048075248) },
      {  INT32_C(   779030363),  INT32_C(   537144171),  INT32_C(  1755386007),  INT32_C(  1195418561),  INT32_C(  1943415384),  INT32_C(   421507782),  INT32_C(   461979179), -INT32_C(   195493479),
         INT32_C(  2082654225), -INT32_C(  1969412365), -INT32_C(   118342089),  INT32_C(   960443361),  INT32_C(   598480221), -INT32_C(   230831161), -INT32_C(  1559378422), -INT32_C(   644323640) },
      { -INT32_C(   327276865),  INT32_C(  2030091350),  INT32_C(  1209751596),  INT32_C(   498861825),  INT32_C(   974238676), -INT32_C(  1051074669), -INT32_C(  1066089572),  INT32_C(   403732206),
         INT32_C(   164258606),  INT32_C(  1697035738),  INT32_C(  1396737590), -INT32_C(   580327833), -INT32_C(  1845676368),  INT32_C(  1494910166),  INT32_C(   212667840), -INT32_C(   630791618) } },
    { {  INT32_C(   576043567),  INT32_C(   414053089),  INT32_C(   303079217),  INT32_C(   793530578),  INT32_C(   760477797), -INT32_C(   836792124),  INT32_C(   510733654), -INT32_C(  1023997549),
        -INT32_C(  1511699004),  INT32_C(  1891471935),  INT32_C(    75746609), -INT32_C(  2093756643), -INT32_C(  1951365433),  INT32_C(  1834602262), -INT32_C(  1869886468), -INT32_C(  1739422764) },
      {  INT32_C(   255670224), -INT32_C(    75433271), -INT32_C(   436272184), -INT32_C(  1721224494), -INT32_C(   819652423), -INT32_C(   465797400),  INT32_C(   510969929),  INT32_C(   464963403),
        -INT32_C(   936708866), -INT32_C(  1228690706),  INT32_C(  2140979885), -INT32_C(  1390869260),  INT32_C(    92093981),  INT32_C(   115980732), -INT32_C(   870031743),  INT32_C(   602397221) },
      { -INT32_C(  1108667698),  INT32_C(  1785966268),  INT32_C(  1709772656),  INT32_C(   823263764), -INT32_C(    46756032), -INT32_C(   905765047), -INT32_C(  1567152259), -INT32_C(   792297983),
         INT32_C(  1301131664), -INT32_C(   793313184),  INT32_C(   607494160), -INT32_C(   480950109),  INT32_C(   551586775),  INT32_C(   686547882),  INT32_C(   214598154), -INT32_C(  1847816192) },
      {  INT32_C(  1854653391),  INT32_C(   532156332), -INT32_C(  1624119809),  INT32_C(   220829315),  INT32_C(   760477797),  INT32_C(  1059162568), -INT32_C(  1009870583), -INT32_C(  2047995098),
         INT32_C(  1304741930),  INT32_C(  1891471935), -INT32_C(   852394084),  INT32_C(   429816045),  INT32_C(  1669512863),  INT32_C(  1732007963),  INT32_C(   791671600), -INT32_C(  1739422764) } },
    { { -INT32_C(  1562482366),  INT32_C(  2037552489), -INT32_C(   660756427), -INT32_C(   943918352),  INT32_C(   686333053), -INT32_C(  1974414464),  INT32_C(  1435900501), -INT32_C(   303664469),
         INT32_C(  1167049947), -INT32_C(  1883373223), -INT32_C(  1721279319), -INT32_C(   866049202),  INT32_C(  1089751488),  INT32_C(  1909081116),  INT32_C(   163995998), -INT32_C(  1342788141) },
      { -INT32_C(   873167503),  INT32_C(   811250311),  INT32_C(  1573568782), -INT32_C(  1524028443), -INT32_C(  1864032908), -INT32_C(  1090408607), -INT32_C(   456538352), -INT32_C(   426524812),
        -INT32_C(   860780731),  INT32_C(  1224477497), -INT32_C(  1314535732),  INT32_C(  1700187889),  INT32_C(  1291140075), -INT32_C(    83101973),  INT32_C(   853529790), -INT32_C(   652709228) },
      {  INT32_C(   866503161), -INT32_C(  1585733164),  INT32_C(  1498554472), -INT32_C(   641750546), -INT32_C(   819612444),  INT32_C(  1774923947), -INT32_C(  1717851643),  INT32_C(   376615965),
         INT32_C(  1380521853),  INT32_C(   552846520), -INT32_C(   763738652), -INT32_C(   743753234), -INT32_C(  1734160147),  INT32_C(   100756737),  INT32_C(   899652888), -INT32_C(   833941167) },
      { -INT32_C(  2053641974),  INT32_C(  1452475819), -INT32_C(  1649920675),  INT32_C(  1018964298), -INT32_C(  1903573031), -INT32_C(  2036595208), -INT32_C(  1295824196),  INT32_C(  2094168046),
         INT32_C(  2039886056),  INT32_C(  1497955339), -INT32_C(  1770665317),  INT32_C(  1221826901), -INT32_C(  1992816226), -INT32_C(   476805063),  INT32_C(  1580392404),  INT32_C(  1537716784) } },
    { { -INT32_C(   534735576),  INT32_C(  1040257881),  INT32_C(  1192262489), -INT32_C(  1592083276), -INT32_C(  1925530228),  INT32_C(  1116945194),  INT32_C(   695677656),  INT32_C(  1811465027),
        -INT32_C(  1320413096), -INT32_C(  2047914708),  INT32_C(  2093744328),  INT32_C(  1209919420), -INT32_C(   824813660),  INT32_C(  1796303251), -INT32_C(   543848292), -INT32_C(  1555329717) },
      { -INT32_C(   782919771), -INT32_C(  1403632412),  INT32_C(     2630468), -INT32_C(  1370929910),  INT32_C(   813440925),  INT32_C(   614174088),  INT32_C(  1627664406),  INT32_C(  1661292477),
        -INT32_C(   902538522), -INT32_C(   478770274), -INT32_C(  1193042258), -INT32_C(  2140787485), -INT32_C(   726605237), -INT32_C(  2030547856),  INT32_C(   988281980),  INT32_C(   832433227) },
      { -INT32_C(   436481722),  INT32_C(   180908380), -INT32_C(   205346033),  INT32_C(   594749656),  INT32_C(  2079794187), -INT32_C(   335417232),  INT32_C(   942074092),  INT32_C(   459916245),
        -INT32_C(   251632235), -INT32_C(   419641130),  INT32_C(  1289338484), -INT32_C(   227586841), -INT32_C(   529701008),  INT32_C(  1137536599),  INT32_C(   729543510),  INT32_C(  1279780279) },
      {  INT32_C(   136661556), -INT32_C(  1698339762),  INT32_C(  1034715156), -INT32_C(  1263646395), -INT32_C(   705928829),  INT32_C(   992617627),  INT32_C(  1932363280),  INT32_C(  1751933097),
         INT32_C(   186205835),  INT32_C(  1262017954),  INT32_C(   210472505),  INT32_C(   250863168),  INT32_C(  1470420144), -INT32_C(   909935578),  INT32_C(   655276543), -INT32_C(  1516712202) } },
    { {  INT32_C(   540886858), -INT32_C(  2079966960), -INT32_C(   539959304), -INT32_C(  1664008404), -INT32_C(    42123610),  INT32_C(    37833388), -INT32_C(   198263747), -INT32_C(   348097119),
        -INT32_C(   871596356), -INT32_C(  1353706825),  INT32_C(   512631026),  INT32_C(   112877408),  INT32_C(  1225013149), -INT32_C(  1085520511), -INT32_C(  1548518911), -INT32_C(  1416694545) },
      {  INT32_C(   695769714), -INT32_C(  1613117267),  INT32_C(  1237149673),  INT32_C(  1682929607),  INT32_C(   816731055), -INT32_C(  1695548776),  INT32_C(  1664983924),  INT32_C(   151964567),
         INT32_C(   322078310),  INT32_C(   951192399),  INT32_C(   981561203), -INT32_C(  1784753946), -INT32_C(  1127855068), -INT32_C(  1168722618), -INT32_C(   283274408), -INT32_C(   973591457) },
      {  INT32_C(    30944178), -INT32_C(  1455846858), -INT32_C(   538723591), -INT32_C(  1351253365),  INT32_C(   359349198),  INT32_C(  1238352624), -INT32_C(  1271337643), -INT32_C(   881250023),
        -INT32_C(  1832038052), -INT32_C(   734263589),  INT32_C(  1286873025),  INT32_C(  1895508385),  INT32_C(  1418028644),  INT32_C(  2124239912),  INT32_C(  1513281089),  INT32_C(  1663478791) },
      {  INT32_C(   489203170),  INT32_C(  1143469682), -INT32_C(   258770225), -INT32_C(  1980144862),  INT32_C(  1336511531),  INT32_C(  1252825839), -INT32_C(  2018744396),  INT32_C(  1108483479),
        -INT32_C(  1053611930), -INT32_C(  1178234790),  INT32_C(  1025262052),  INT32_C(   225754817), -INT32_C(  1874626085),  INT32_C(  1279623610),  INT32_C(  1197929475), -INT32_C(   948275230) } },
    { { -INT32_C(   638192643), -INT32_C(  1163054599), -INT32_C(   234462895), -INT32_C(   295566966), -INT32_C(  1874598040),  INT32_C(  2098126908), -INT32_C(  1109900874), -INT32_C(   366936339),
        -INT32_C(   356313359), -INT32_C(  1733988025),  INT32_C(  1569434578),  INT32_C(   357297581),  INT32_C(   296062677),  INT32_C(   630109295), -INT32_C(   488413451),  INT32_C(  1439433572) },
      {  INT32_C(  1631621145), -INT32_C(   738597631),  INT32_C(  1026589840),  INT32_C(  1196588146),  INT32_C(  2035873802), -INT32_C(  1583356244), -INT32_C(  1316781491), -INT32_C(  1626910843),
        -INT32_C(   536852513), -INT32_C(  1128990420), -INT32_C(   251992962),  INT32_C(  1798786144), -INT32_C(   253456572), -INT32_C(  1030651019), -INT32_C(  1955326971),  INT32_C(  1126857572) },
      { -INT32_C(   299619646), -INT32_C(  1582639069),  INT32_C(   496084156),  INT32_C(   898156785), -INT32_C(   853119913), -INT32_C(   175130640),  INT32_C(   813695948),  INT32_C(  1081322110),
        -INT32_C(   131164204),  INT32_C(   748280175),  INT32_C(  1850289021),  INT32_C(  1269092851),  INT32_C(   756599357),  INT32_C(  1294182273),  INT32_C(   696099755),  INT32_C(   577433934) },
      {  INT32_C(  1742196725), -INT32_C(   714502194),  INT32_C(   332597321),  INT32_C(    51678884), -INT32_C(  1271092100), -INT32_C(   532897377), -INT32_C(  2078577896),  INT32_C(  1740755937),
         INT32_C(  1864237060), -INT32_C(  1197220262),  INT32_C(  1579113615),  INT32_C(  1835751866), -INT32_C(  1105423896),  INT32_C(  1260218591),  INT32_C(   456633435),  INT32_C(    14225610) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_shldv_epi32(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_shldv_epi32");
    easysimd_assert_m512i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    easysimd__m512i b = easysimd_test_x86_random_i32x16();
    easysimd__m512i c = easysimd_test_x86_random_i32x16();
    easysimd__m512i r = easysimd_mm512_shldv_epi32(a, b, c);

    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_shldv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int16_t a[8];
    int16_t b[8];
    int16_t c[8];
    int16_t r[8];
  } test_vec[8] = {
    { UINT8_C(250),
      { -INT16_C( 23890),  INT16_C( 26648), -INT16_C( 12474), -INT16_C( 18390),  INT16_C( 17805), -INT16_C( 12305), -INT16_C(  3512), -INT16_C( 19487) },
      {  INT16_C( 14988),  INT16_C( 20892), -INT16_C( 14430), -INT16_C( 11790),  INT16_C(  9004), -INT16_C( 16749), -INT16_C(  5988),  INT16_C( 19128) },
      { -INT16_C( 12150), -INT16_C( 11853), -INT16_C(  8801),  INT16_C( 11401),  INT16_C( 30754),  INT16_C( 27643), -INT16_C(  8854), -INT16_C(  2530) },
      {  INT16_C(     0),  INT16_C( 16578),  INT16_C(     0),  INT16_C( 21923),  INT16_C(  5684),  INT16_C( 32244),  INT16_C(  9122),  INT16_C( 21166) } },
    { UINT8_C( 23),
      {  INT16_C( 18362), -INT16_C( 32327), -INT16_C( 30151),  INT16_C( 23725),  INT16_C( 27421),  INT16_C(  1785),  INT16_C( 17187), -INT16_C(  3184) },
      {  INT16_C( 25078), -INT16_C( 11118), -INT16_C( 16406),  INT16_C( 25334),  INT16_C( 25018), -INT16_C( 26676), -INT16_C( 15745),  INT16_C( 14766) },
      {  INT16_C( 26377),  INT16_C( 17083),  INT16_C( 26865),  INT16_C(  3999), -INT16_C( 26412), -INT16_C(  2283), -INT16_C( 23077), -INT16_C( 11541) },
      {  INT16_C( 29891), -INT16_C( 12636),  INT16_C(  5235),  INT16_C(     0), -INT16_C( 20010),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT8_C(  7),
      { -INT16_C( 22915),  INT16_C( 15601),  INT16_C( 21660), -INT16_C(   265), -INT16_C( 29152), -INT16_C(  7299), -INT16_C( 18627), -INT16_C( 23316) },
      {  INT16_C( 12146), -INT16_C(  9578), -INT16_C( 23090),  INT16_C( 26286), -INT16_C( 22854),  INT16_C( 24385),  INT16_C(  5009),  INT16_C(  3686) },
      {  INT16_C( 22713),  INT16_C( 22091),  INT16_C( 17068), -INT16_C( 13228), -INT16_C( 11824),  INT16_C(  3503), -INT16_C( 25464), -INT16_C(  1358) },
      { -INT16_C(  1442), -INT16_C( 28972), -INT16_C( 13732),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT8_C(203),
      { -INT16_C( 10936), -INT16_C(  4711), -INT16_C(   125),  INT16_C( 10663),  INT16_C(  1600),  INT16_C( 21690), -INT16_C( 13971), -INT16_C( 15091) },
      {  INT16_C( 25364),  INT16_C( 22129),  INT16_C( 15799), -INT16_C( 30426),  INT16_C( 13549), -INT16_C( 30447),  INT16_C(  3302),  INT16_C( 11860) },
      { -INT16_C(  4639),  INT16_C( 25627), -INT16_C( 15636),  INT16_C( 11406),  INT16_C( 18632),  INT16_C( 13696), -INT16_C( 29167),  INT16_C(  9722) },
      { -INT16_C( 21872), -INT16_C( 13645),  INT16_C(     0), -INT16_C(  7607),  INT16_C(     0),  INT16_C(     0), -INT16_C( 27942),  INT16_C( 13497) } },
    { UINT8_C(241),
      {  INT16_C( 31595), -INT16_C( 22103),  INT16_C( 12962), -INT16_C( 10602),  INT16_C(  8003),  INT16_C( 20412), -INT16_C(  5517),  INT16_C( 24624) },
      { -INT16_C( 27387), -INT16_C( 14516),  INT16_C( 30755),  INT16_C( 27535), -INT16_C( 14855), -INT16_C( 30851), -INT16_C( 23873),  INT16_C( 11128) },
      {  INT16_C(  8478), -INT16_C( 16172),  INT16_C( 27219), -INT16_C( 26730),  INT16_C( 21129), -INT16_C(   794),  INT16_C(  5948),  INT16_C( 16732) },
      { -INT16_C(  6847),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 30837), -INT16_C(  4319),  INT16_C( 14891),  INT16_C(   695) } },
    { UINT8_C(172),
      {  INT16_C(  2216),  INT16_C(  8399),  INT16_C( 14999),  INT16_C( 23577), -INT16_C( 24393),  INT16_C( 23068),  INT16_C( 18201),  INT16_C( 14968) },
      {  INT16_C( 14363), -INT16_C( 31346),  INT16_C(  9678),  INT16_C(  8206),  INT16_C(  2571),  INT16_C(  8796), -INT16_C( 25242),  INT16_C(  3790) },
      { -INT16_C( 25179),  INT16_C( 15406),  INT16_C( 18648), -INT16_C( 28775), -INT16_C( 18968),  INT16_C(   489),  INT16_C( 25084),  INT16_C(  5948) },
      {  INT16_C(     0),  INT16_C(     0), -INT16_C( 26843),  INT16_C( 12864),  INT16_C(     0),  INT16_C( 14404),  INT16_C(     0), -INT16_C( 32532) } },
    { UINT8_C(153),
      { -INT16_C( 25398), -INT16_C(  4249), -INT16_C( 30806), -INT16_C( 19206),  INT16_C(  7651), -INT16_C( 32742),  INT16_C( 10475), -INT16_C( 30427) },
      {  INT16_C( 25174), -INT16_C( 24991), -INT16_C(  3845), -INT16_C( 20345), -INT16_C( 30502),  INT16_C( 15276), -INT16_C( 15420), -INT16_C( 28971) },
      {  INT16_C( 15455),  INT16_C(  2429),  INT16_C( 30916), -INT16_C( 22595), -INT16_C( 10347), -INT16_C( 32728),  INT16_C( 19967),  INT16_C( 21769) },
      {  INT16_C( 12587),  INT16_C(     0),  INT16_C(     0),  INT16_C( 22032), -INT16_C( 17295),  INT16_C(     0),  INT16_C(     0),  INT16_C( 19229) } },
    { UINT8_C(175),
      { -INT16_C(  2966),  INT16_C( 23466),  INT16_C( 23163),  INT16_C(   821),  INT16_C( 28678), -INT16_C( 13880),  INT16_C( 22085), -INT16_C( 32216) },
      {  INT16_C( 12756),  INT16_C( 19526), -INT16_C(  4626), -INT16_C( 14879),  INT16_C( 24853),  INT16_C( 25540),  INT16_C(  6763), -INT16_C( 10990) },
      { -INT16_C( 17138), -INT16_C( 30416),  INT16_C( 25879),  INT16_C(  7820),  INT16_C( 21718),  INT16_C(  7143),  INT16_C(  4267),  INT16_C( 32669) },
      { -INT16_C( 29579),  INT16_C( 23466),  INT16_C( 15862),  INT16_C( 23646),  INT16_C(     0), -INT16_C(  7119),  INT16_C(     0),  INT16_C(  6818) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m128i a  = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b  = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c  = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r  = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_maskz_shldv_epi16(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_maskz_shldv_epi16");
    easysimd_assert_m128i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128i a = easysimd_test_x86_random_i16x8();
    easysimd__m128i b = easysimd_test_x86_random_i16x8();
    easysimd__m128i c = easysimd_test_x86_random_i16x8();
    easysimd__m128i r = easysimd_mm_maskz_shldv_epi16(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_shldv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int32_t a[4];
    int32_t b[4];
    int32_t c[4];
    int32_t r[4];
  } test_vec[8] = {
    { UINT8_C(252),
      { -INT32_C(   950021665),  INT32_C(  1682152752), -INT32_C(   632724446), -INT32_C(  2134381558) },
      { -INT32_C(   366099113), -INT32_C(  1413502975), -INT32_C(  1143664768),  INT32_C(   867631956) },
      {  INT32_C(   100275925), -INT32_C(   697745997), -INT32_C(  1397706078), -INT32_C(   164857697) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(  1764069514),  INT32_C(   433815978) } },
    { UINT8_C( 61),
      {  INT32_C(    37675097), -INT32_C(  1367152225), -INT32_C(  1040040513),  INT32_C(   177681908) },
      {  INT32_C(  1841143087), -INT32_C(  1190161658), -INT32_C(  1135035580),  INT32_C(  1106857703) },
      { -INT32_C(   851232978), -INT32_C(   545471200), -INT32_C(   157123070), -INT32_C(   486524492) },
      { -INT32_C(  1206494353),  INT32_C(           0),  INT32_C(   134805246),  INT32_C(  1598300052) } },
    { UINT8_C(214),
      {  INT32_C(  1373458621),  INT32_C(   446010975),  INT32_C(  1006785006), -INT32_C(  2123742390) },
      {  INT32_C(  1268856710),  INT32_C(   843940275),  INT32_C(  1558594339),  INT32_C(     3393859) },
      {  INT32_C(  2035355674), -INT32_C(  1802180954), -INT32_C(  2117036489),  INT32_C(  1593981657) },
      {  INT32_C(           0), -INT32_C(  1520068660), -INT32_C(   147950815),  INT32_C(           0) } },
    { UINT8_C(113),
      {  INT32_C(   623225508),  INT32_C(   977819639),  INT32_C(   108897341), -INT32_C(   417301033) },
      { -INT32_C(  1249010993), -INT32_C(   991092434),  INT32_C(   731737841),  INT32_C(   362675313) },
      { -INT32_C(  1657093466),  INT32_C(  1456964121), -INT32_C(    27503578), -INT32_C(  1595572783) },
      {  INT32_C(  1231726893),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C( 23),
      { -INT32_C(  1807395213), -INT32_C(  1316615869), -INT32_C(  1574784602),  INT32_C(   273168206) },
      { -INT32_C(   215358095),  INT32_C(   270172092),  INT32_C(  1507924188),  INT32_C(  1886421757) },
      {  INT32_C(   453359064),  INT32_C(  1691126718), -INT32_C(  1962479812), -INT32_C(  1734652378) },
      {  INT32_C(  1945315813), -INT32_C(  1006198801),  INT32_C(  1704857997),  INT32_C(           0) } },
    { UINT8_C( 51),
      {  INT32_C(  1156549573), -INT32_C(  1121910875),  INT32_C(  1656453600), -INT32_C(  1640354839) },
      { -INT32_C(  1151576784),  INT32_C(   301514786),  INT32_C(   339182534), -INT32_C(   481833186) },
      {  INT32_C(     2635355),  INT32_C(   381569077), -INT32_C(  1418167870), -INT32_C(   716524636) },
      {  INT32_C(   769319593), -INT32_C(   190693608),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C(  8),
      {  INT32_C(  1730842790),  INT32_C(   187513736),  INT32_C(  1110065779), -INT32_C(  1063449207) },
      {  INT32_C(  2130026037), -INT32_C(   717223076),  INT32_C(   930737028), -INT32_C(   599830987) },
      {  INT32_C(  1732471519),  INT32_C(   410218661),  INT32_C(  1012637106), -INT32_C(   520292182) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1949706096) } },
    { UINT8_C(150),
      { -INT32_C(    34447631), -INT32_C(  1987983458), -INT32_C(  1883260863),  INT32_C(  1634638839) },
      {  INT32_C(  1309136606), -INT32_C(   436134071),  INT32_C(  1938832762),  INT32_C(   705261625) },
      {  INT32_C(  1814559950),  INT32_C(    83273923),  INT32_C(  1486140768),  INT32_C(   783876688) },
      {  INT32_C(           0),  INT32_C(  1276001527), -INT32_C(  1883260863),  INT32_C(           0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m128i a  = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b  = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c  = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r  = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_maskz_shldv_epi32(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_maskz_shldv_epi32");
    easysimd_assert_m128i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128i a = easysimd_test_x86_random_i32x4();
    easysimd__m128i b = easysimd_test_x86_random_i32x4();
    easysimd__m128i c = easysimd_test_x86_random_i32x4();
    easysimd__m128i r = easysimd_mm_maskz_shldv_epi32(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_shldv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask16 k;
    int16_t a[16];
    int16_t b[16];
    int16_t c[16];
    int16_t r[16];
  } test_vec[16] = {
    { UINT16_C(29795),
      { -INT16_C(  3053), -INT16_C( 10579), -INT16_C( 13045),  INT16_C( 31256), -INT16_C( 13601), -INT16_C(  6199), -INT16_C( 11748), -INT16_C( 28811),
        -INT16_C( 26663),  INT16_C( 15338),  INT16_C( 18748),  INT16_C( 15940), -INT16_C( 31502),  INT16_C(  8317), -INT16_C(  7920),  INT16_C(  9108) },
      {  INT16_C( 16853), -INT16_C(  7686),  INT16_C(  4622), -INT16_C(  4773),  INT16_C(  9436), -INT16_C(  1835),  INT16_C( 19190), -INT16_C( 12152),
         INT16_C( 29409),  INT16_C(  7691),  INT16_C( 20411), -INT16_C( 21156), -INT16_C(  9773), -INT16_C(  7218),  INT16_C( 25274), -INT16_C( 28665) },
      {  INT16_C(   420), -INT16_C( 19855), -INT16_C( 13293), -INT16_C(  4192),  INT16_C( 30192), -INT16_C(  6425),  INT16_C( 28607), -INT16_C( 24394),
        -INT16_C( 15903), -INT16_C( 25154),  INT16_C(  6672), -INT16_C(  7350),  INT16_C(  6388), -INT16_C( 20793), -INT16_C( 12677),  INT16_C(  7998) },
      {  INT16_C( 16692), -INT16_C( 21157),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(  6916),  INT16_C(  9595),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C( 18748),  INT16_C(     0),  INT16_C( 20269),  INT16_C( 16113), -INT16_C( 31979),  INT16_C(     0) } },
    { UINT16_C(45007),
      { -INT16_C(  7471),  INT16_C( 29051),  INT16_C( 27601), -INT16_C( 18202), -INT16_C( 23214),  INT16_C(  2088),  INT16_C(  2374),  INT16_C(  1226),
        -INT16_C(  9562), -INT16_C(  3809),  INT16_C(  5054), -INT16_C( 31479), -INT16_C( 31551),  INT16_C(    83),  INT16_C(  8867),  INT16_C( 30127) },
      {  INT16_C( 11012), -INT16_C( 10778), -INT16_C( 12906), -INT16_C(  6003), -INT16_C( 19086), -INT16_C( 18191), -INT16_C( 17473),  INT16_C( 26045),
        -INT16_C(  9067),  INT16_C( 21334),  INT16_C( 24815), -INT16_C( 20264),  INT16_C( 11236), -INT16_C( 30544),  INT16_C( 24653),  INT16_C( 20989) },
      { -INT16_C(  7285),  INT16_C(  8486), -INT16_C( 19280),  INT16_C(  8970), -INT16_C(  1175),  INT16_C( 10459), -INT16_C( 26442),  INT16_C( 19342),
        -INT16_C(  7052),  INT16_C( 25503),  INT16_C( 30532),  INT16_C( 10516), -INT16_C( 15197), -INT16_C(  3919), -INT16_C( 20956), -INT16_C( 20670) },
      { -INT16_C( 30376),  INT16_C( 24309),  INT16_C( 27601), -INT16_C( 25694),  INT16_C(     0),  INT16_C(     0),  INT16_C( 20910), -INT16_C( 26257),
        -INT16_C( 21907), -INT16_C( 22101),  INT16_C( 15334),  INT16_C( 20635),  INT16_C(     0),  INT16_C(   167),  INT16_C(     0), -INT16_C( 10563) } },
    { UINT16_C(26769),
      {  INT16_C( 17105), -INT16_C(  9444), -INT16_C( 31131),  INT16_C( 16598), -INT16_C( 29522),  INT16_C( 15577),  INT16_C( 19927),  INT16_C( 30241),
         INT16_C( 26033), -INT16_C( 14866), -INT16_C( 28274),  INT16_C( 16265), -INT16_C( 20863), -INT16_C( 15379),  INT16_C( 32605),  INT16_C( 11820) },
      {  INT16_C( 18625),  INT16_C(  9737), -INT16_C(  8242),  INT16_C( 32102),  INT16_C( 16235),  INT16_C( 17337), -INT16_C(  9587),  INT16_C( 16057),
        -INT16_C( 22720), -INT16_C( 12797), -INT16_C( 29640), -INT16_C( 17906), -INT16_C(  1222), -INT16_C( 26499), -INT16_C( 22150),  INT16_C( 15302) },
      { -INT16_C( 12046), -INT16_C( 16287), -INT16_C( 14161),  INT16_C(  6973), -INT16_C(  2297), -INT16_C( 27554),  INT16_C(  6097),  INT16_C(  4562),
        -INT16_C( 10817), -INT16_C(  2080), -INT16_C(  4510), -INT16_C( 25423),  INT16_C( 12265),  INT16_C( 25652), -INT16_C(  1064), -INT16_C( 13665) },
      {  INT16_C(  2885),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 22303),  INT16_C(     0),  INT16_C(     0), -INT16_C( 10108),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 32531),  INT16_C(     0),  INT16_C( 16089),  INT16_C( 23977),  INT16_C(     0) } },
    { UINT16_C(  459),
      {  INT16_C( 31371), -INT16_C( 14135), -INT16_C( 12139), -INT16_C(  3137), -INT16_C( 28315),  INT16_C( 14091), -INT16_C( 13662), -INT16_C( 32243),
         INT16_C( 28609),  INT16_C( 29552),  INT16_C( 23051),  INT16_C( 16546),  INT16_C( 31422),  INT16_C( 23867),  INT16_C(  1605), -INT16_C( 12194) },
      {  INT16_C( 10112),  INT16_C(  5784),  INT16_C( 22776),  INT16_C( 23817),  INT16_C(  5353), -INT16_C( 29804), -INT16_C( 24098), -INT16_C( 24562),
         INT16_C( 32272),  INT16_C(  7187), -INT16_C( 18984), -INT16_C( 27044), -INT16_C( 26833),  INT16_C( 29940),  INT16_C( 21149),  INT16_C(  7492) },
      { -INT16_C(  8838),  INT16_C( 29235),  INT16_C( 15669),  INT16_C(  7887),  INT16_C( 25425),  INT16_C( 12457), -INT16_C( 18683),  INT16_C(  5584),
        -INT16_C(  7370),  INT16_C(  3633), -INT16_C( 29288), -INT16_C( 14427), -INT16_C( 26332), -INT16_C( 16068), -INT16_C( 32533),  INT16_C( 26079) },
      {  INT16_C( 11422),  INT16_C( 17992),  INT16_C(     0), -INT16_C( 20860),  INT16_C(     0),  INT16_C(     0),  INT16_C( 21588), -INT16_C( 32243),
        -INT16_C(  4001),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C( 4701),
      { -INT16_C( 27945), -INT16_C( 22961), -INT16_C( 24144),  INT16_C( 23050),  INT16_C(  4049), -INT16_C( 24303),  INT16_C( 18212),  INT16_C( 22148),
         INT16_C(  7254), -INT16_C(  1053),  INT16_C(  2275),  INT16_C(  8084),  INT16_C( 32713), -INT16_C( 22368), -INT16_C(   539), -INT16_C( 17221) },
      {  INT16_C(  2704),  INT16_C( 16483),  INT16_C( 28075),  INT16_C( 31898), -INT16_C( 21380), -INT16_C( 24547), -INT16_C( 24077),  INT16_C( 18934),
        -INT16_C(  9539), -INT16_C( 24252), -INT16_C( 10014), -INT16_C( 21568),  INT16_C( 24664),  INT16_C( 15700),  INT16_C(  3934), -INT16_C(  4359) },
      {  INT16_C( 23577), -INT16_C( 15058), -INT16_C( 13879),  INT16_C( 17729),  INT16_C( 24437),  INT16_C( 26854), -INT16_C(  9216), -INT16_C( 16718),
        -INT16_C(  2378), -INT16_C( 26529),  INT16_C(  8143),  INT16_C( 10052), -INT16_C( 26496), -INT16_C(  8604),  INT16_C( 23975), -INT16_C( 16180) },
      { -INT16_C( 20971),  INT16_C(     0),  INT16_C( 24795), -INT16_C( 19436), -INT16_C(  1483),  INT16_C(     0),  INT16_C( 18212),  INT16_C(     0),
         INT16_C(     0), -INT16_C( 12126),  INT16_C(     0),  INT16_C(     0),  INT16_C( 32713),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C(64186),
      { -INT16_C( 31867), -INT16_C( 14397),  INT16_C( 14537), -INT16_C( 20698),  INT16_C(  9889),  INT16_C( 21387),  INT16_C( 17124),  INT16_C( 17225),
         INT16_C(  6362),  INT16_C(  7779), -INT16_C(  7361), -INT16_C( 23626),  INT16_C( 24001), -INT16_C( 29439), -INT16_C( 17634), -INT16_C( 23673) },
      {  INT16_C( 19262),  INT16_C(  1898), -INT16_C( 28541),  INT16_C(  9398),  INT16_C( 17079), -INT16_C( 25737), -INT16_C( 15996),  INT16_C( 24287),
         INT16_C( 17113),  INT16_C(  6525),  INT16_C( 13093), -INT16_C(  6468), -INT16_C( 17007), -INT16_C( 20621), -INT16_C(  1416), -INT16_C( 18606) },
      { -INT16_C( 17083), -INT16_C( 13890),  INT16_C( 30029),  INT16_C(  1261),  INT16_C( 26039),  INT16_C( 15264),  INT16_C( 32550), -INT16_C(   103),
         INT16_C(  5825), -INT16_C(  6632), -INT16_C( 10934), -INT16_C(  9268),  INT16_C( 16274),  INT16_C(  2954), -INT16_C(  9159),  INT16_C( 32706) },
      {  INT16_C(     0), -INT16_C( 15910),  INT16_C(     0), -INT16_C( 15210),  INT16_C( 20641),  INT16_C( 21387),  INT16_C(     0), -INT16_C( 27971),
         INT16_C(     0),  INT16_C( 25369),  INT16_C(     0),  INT16_C( 28267),  INT16_C( 30470),  INT16_C(  1725),  INT16_C( 15860), -INT16_C( 29154) } },
    { UINT16_C(32921),
      { -INT16_C(  6328),  INT16_C( 13813), -INT16_C( 21269), -INT16_C( 29798), -INT16_C( 16153), -INT16_C( 32502), -INT16_C( 13376), -INT16_C( 10089),
        -INT16_C(  7759),  INT16_C( 32173),  INT16_C( 16572),  INT16_C( 18108), -INT16_C(  2485),  INT16_C(  3363), -INT16_C( 17291), -INT16_C( 17011) },
      { -INT16_C( 31837), -INT16_C( 28686), -INT16_C( 29393),  INT16_C(  5914),  INT16_C(  9549),  INT16_C(  3480),  INT16_C( 12272), -INT16_C( 23834),
        -INT16_C( 27887), -INT16_C( 13025), -INT16_C(  9005),  INT16_C(  7700),  INT16_C( 14290),  INT16_C( 18219), -INT16_C( 17933), -INT16_C( 26876) },
      { -INT16_C(  2500),  INT16_C( 27430),  INT16_C( 16515), -INT16_C( 11902),  INT16_C(  6757),  INT16_C( 22238), -INT16_C( 15286),  INT16_C( 23544),
         INT16_C(  5976),  INT16_C( 11048),  INT16_C( 15603), -INT16_C( 15030),  INT16_C( 30067),  INT16_C( 26380),  INT16_C(  4142),  INT16_C( 27390) },
      { -INT16_C( 30662),  INT16_C(     0),  INT16_C(     0),  INT16_C( 11880),  INT16_C(  7396),  INT16_C(     0),  INT16_C(     0), -INT16_C( 26718),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 26049) } },
    { UINT16_C( 9223),
      { -INT16_C( 29994),  INT16_C( 22628), -INT16_C( 13733),  INT16_C( 14963), -INT16_C( 17120),  INT16_C(  6398),  INT16_C( 22040),  INT16_C( 16431),
         INT16_C(  9090), -INT16_C( 13187), -INT16_C(  3864), -INT16_C(  2751),  INT16_C( 28759),  INT16_C( 21765),  INT16_C(  3290), -INT16_C( 20359) },
      { -INT16_C(  8553), -INT16_C(  3575),  INT16_C( 31912), -INT16_C( 14292),  INT16_C( 11065),  INT16_C( 20960),  INT16_C(  3969),  INT16_C(   913),
         INT16_C(  3634),  INT16_C(  7119),  INT16_C(  4607),  INT16_C( 22032),  INT16_C(  5505),  INT16_C( 23468),  INT16_C(  9506), -INT16_C( 18164) },
      {  INT16_C(  5379), -INT16_C( 21589), -INT16_C( 10095), -INT16_C( 13709),  INT16_C( 21251), -INT16_C( 31717), -INT16_C( 21405), -INT16_C( 27256),
         INT16_C( 22459), -INT16_C( 17744), -INT16_C( 16280), -INT16_C(  5872), -INT16_C( 17194), -INT16_C(  1979),  INT16_C( 20962), -INT16_C(  6735) },
      {  INT16_C( 22198),  INT16_C( 10128), -INT16_C( 27466),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0), -INT16_C(  6127),  INT16_C(     0),  INT16_C(     0), -INT16_C( 24405),  INT16_C(     0),  INT16_C(     0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask16 k = test_vec[i].k;
    easysimd__m256i a  = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b  = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c  = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r  = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_maskz_shldv_epi16(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_maskz_shldv_epi16");
    easysimd_assert_m256i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m256i a = easysimd_test_x86_random_i16x16();
    easysimd__m256i b = easysimd_test_x86_random_i16x16();
    easysimd__m256i c = easysimd_test_x86_random_i16x16();
    easysimd__m256i r = easysimd_mm256_maskz_shldv_epi16(k, a, b, c);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_shldv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int32_t a[8];
    int32_t b[8];
    int32_t c[8];
    int32_t r[8];
  } test_vec[8] = {
    { UINT8_C(127),
      {  INT32_C(  1422793349), -INT32_C(  1508614620), -INT32_C(  1063759133), -INT32_C(  1286379113),  INT32_C(    46027454),  INT32_C(  2094631298),  INT32_C(  1298195261),  INT32_C(   567083419) },
      {  INT32_C(  1081449243), -INT32_C(   572093959),  INT32_C(  1939701724), -INT32_C(  1507397400), -INT32_C(   995498942), -INT32_C(  1438612883),  INT32_C(    16294245), -INT32_C(  1121860190) },
      {  INT32_C(  1509791328), -INT32_C(    63511520),  INT32_C(  1265619811),  INT32_C(   116495812), -INT32_C(   406087047), -INT32_C(  2121200868),  INT32_C(  1317177772), -INT32_C(  1374903474) },
      {  INT32_C(  1422793349), -INT32_C(  1508614620),  INT32_C(    79861531),  INT32_C(   892770682),  INT32_C(  2106151880),  INT32_C(   715393062),  INT32_C(   238276623),  INT32_C(           0) } },
    { UINT8_C( 58),
      { -INT32_C(   312866807),  INT32_C(   307254846),  INT32_C(  1524014021),  INT32_C(   668195981), -INT32_C(  1287341401), -INT32_C(   715143860), -INT32_C(   349917625), -INT32_C(  1020931398) },
      {  INT32_C(   431063002), -INT32_C(  1708457515),  INT32_C(   720634269), -INT32_C(  2058237987), -INT32_C(   835152510), -INT32_C(  1566337189), -INT32_C(     7485627),  INT32_C(  1958982298) },
      {  INT32_C(   109933617),  INT32_C(   312522869), -INT32_C(  1757637447), -INT32_C(   568553892),  INT32_C(  2125222947),  INT32_C(   824266731), -INT32_C(  1322209769), -INT32_C(  1843006623) },
      {  INT32_C(           0), -INT32_C(   942455456),  INT32_C(           0), -INT32_C(   665510787), -INT32_C(  1708796610), -INT32_C(    30776043),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C(103),
      {  INT32_C(  1809684915), -INT32_C(   836374727), -INT32_C(  1171604436),  INT32_C(   752683224),  INT32_C(    51862708),  INT32_C(   723142781),  INT32_C(  1821166457), -INT32_C(  1529602063) },
      { -INT32_C(   250629704), -INT32_C(   859884384), -INT32_C(   930682384), -INT32_C(  1510710031),  INT32_C(  1034489024), -INT32_C(   848772268), -INT32_C(  2143619697), -INT32_C(   870052332) },
      {  INT32_C(  1606235071),  INT32_C(  1479310696),  INT32_C(  1478603366), -INT32_C(   688057066),  INT32_C(  1980999201), -INT32_C(   113017750), -INT32_C(  2055635599),  INT32_C(  1246862731) },
      { -INT32_C(   125314852),  INT32_C(   636434892), -INT32_C(  1968239822),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1763833653), -INT32_C(  1762459531),  INT32_C(           0) } },
    { UINT8_C(208),
      { -INT32_C(  1959220722), -INT32_C(  1997368874), -INT32_C(   945861966), -INT32_C(   286689977),  INT32_C(    89677705),  INT32_C(   544625058),  INT32_C(  1739324362),  INT32_C(  1513616972) },
      {  INT32_C(  1994813600), -INT32_C(  1275144191),  INT32_C(  1769643298), -INT32_C(  1671994605),  INT32_C(  1705095106), -INT32_C(   897247488),  INT32_C(  1580281874), -INT32_C(   960992986) },
      { -INT32_C(   633561383), -INT32_C(  1735574666), -INT32_C(   352188456),  INT32_C(   763844971),  INT32_C(   160573449),  INT32_C(  1372854079),  INT32_C(  1856963912),  INT32_C(  1194682478) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1329655093),  INT32_C(           0), -INT32_C(  1409562018), -INT32_C(    40685138) } },
    { UINT8_C(  6),
      { -INT32_C(  1401085583), -INT32_C(  1232792146),  INT32_C(  1898016791),  INT32_C(   544886520), -INT32_C(   127892511),  INT32_C(  1564520791), -INT32_C(   909398175),  INT32_C(  1439634404) },
      { -INT32_C(   486388684),  INT32_C(  2040104802), -INT32_C(   269829385), -INT32_C(   384801784),  INT32_C(  1071804648), -INT32_C(  2103696863), -INT32_C(  1253349167), -INT32_C(  1358226565) },
      { -INT32_C(   913175193), -INT32_C(  1958532204), -INT32_C(   293917211),  INT32_C(  2060946322),  INT32_C(   481933819), -INT32_C(  1382066468),  INT32_C(   962849470),  INT32_C(  1843949061) },
      {  INT32_C(           0),  INT32_C(  1525127576),  INT32_C(   606995197),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C(123),
      { -INT32_C(  1508952453), -INT32_C(  1483957639), -INT32_C(  1606845931),  INT32_C(   194753361), -INT32_C(  1025001364),  INT32_C(  1098945623),  INT32_C(  1699199479),  INT32_C(   501265570) },
      {  INT32_C(  1690562538), -INT32_C(  1626648694),  INT32_C(   457196745),  INT32_C(  1663491063), -INT32_C(   366604909), -INT32_C(  1725127007),  INT32_C(    50230112),  INT32_C(   287301415) },
      {  INT32_C(  1484120782), -INT32_C(    67600334), -INT32_C(  1156171580), -INT32_C(  1491125229), -INT32_C(   342801079),  INT32_C(  1266990571),  INT32_C(  1464697392),  INT32_C(   812215393) },
      { -INT32_C(   845227728),  INT32_C(  1776712749),  INT32_C(           0), -INT32_C(  1702160074), -INT32_C(   814687788),  INT32_C(    77774025), -INT32_C(  1174994178),  INT32_C(           0) } },
    { UINT8_C( 79),
      {  INT32_C(  1602324702), -INT32_C(  1205633920), -INT32_C(   808657005),  INT32_C(  1125741566), -INT32_C(  1037171708),  INT32_C(   183663240),  INT32_C(   879512263), -INT32_C(  1853645645) },
      { -INT32_C(  1510996956),  INT32_C(   324867200), -INT32_C(   236770829), -INT32_C(  1590362980), -INT32_C(  2006752768), -INT32_C(  1533913636),  INT32_C(  1389952671), -INT32_C(  1075553382) },
      { -INT32_C(   547040161), -INT32_C(   604782104), -INT32_C(  2016618773), -INT32_C(   769130286),  INT32_C(  1062898531), -INT32_C(  2132546335), -INT32_C(  2049721365),  INT32_C(  1967437590) },
      {  INT32_C(  1391985170),  INT32_C(   595361811),  INT32_C(  1727831951), -INT32_C(   805665581),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1649818262),  INT32_C(           0) } },
    { UINT8_C(139),
      {  INT32_C(  1786009000),  INT32_C(   508907336),  INT32_C(   485547036), -INT32_C(  1870675451),  INT32_C(   141672220),  INT32_C(  1593045666),  INT32_C(  2088008133),  INT32_C(  1711794877) },
      { -INT32_C(  2016380097), -INT32_C(   408607285),  INT32_C(   100898049),  INT32_C(  1939309399), -INT32_C(   461699006), -INT32_C(  1086164998), -INT32_C(  1522812952), -INT32_C(   536132703) },
      { -INT32_C(  1989682242),  INT32_C(    40897536), -INT32_C(   133663583),  INT32_C(   963354615), -INT32_C(  1575098712),  INT32_C(  1029857365), -INT32_C(  1193042665), -INT32_C(  1617367328) },
      {  INT32_C(   569646799),  INT32_C(   508907336),  INT32_C(           0),  INT32_C(    45730753),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1711794877) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m256i a  = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b  = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c  = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r  = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_maskz_shldv_epi32(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_maskz_shldv_epi32");
    easysimd_assert_m256i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256i a = easysimd_test_x86_random_i32x8();
    easysimd__m256i b = easysimd_test_x86_random_i32x8();
    easysimd__m256i c = easysimd_test_x86_random_i32x8();
    easysimd__m256i r = easysimd_mm256_maskz_shldv_epi32(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_shldv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask32 k;
    int16_t a[32];
    int16_t b[32];
    int16_t c[32];
    int16_t r[32];
  } test_vec[] = {
    { UINT32_C(1751017516),
      {  INT16_C(  6514), -INT16_C(  9409),  INT16_C( 30174), -INT16_C(  3532), -INT16_C(  8373), -INT16_C( 16124),  INT16_C(  8437), -INT16_C( 11026),
        -INT16_C(  5168), -INT16_C(  4810), -INT16_C( 31914), -INT16_C( 21494), -INT16_C( 21916), -INT16_C( 28426),  INT16_C( 21778), -INT16_C( 31496),
         INT16_C( 14190),  INT16_C( 19551), -INT16_C( 27731), -INT16_C(  1986),  INT16_C( 17266),  INT16_C( 26809), -INT16_C( 22429),  INT16_C( 13116),
         INT16_C( 29331), -INT16_C(  5856),  INT16_C( 10997),  INT16_C( 22934), -INT16_C( 29484), -INT16_C(  6423), -INT16_C(  7711),  INT16_C( 20330) },
      { -INT16_C( 14056), -INT16_C( 14949), -INT16_C(  9636), -INT16_C( 12354),  INT16_C( 30493), -INT16_C( 32713),  INT16_C( 29471), -INT16_C( 19533),
        -INT16_C( 11035), -INT16_C(  9572),  INT16_C( 13054), -INT16_C( 11469),  INT16_C(  7359), -INT16_C( 24391),  INT16_C(  9469),  INT16_C(  5616),
        -INT16_C( 29715),  INT16_C( 19163), -INT16_C( 26267), -INT16_C( 32231),  INT16_C( 20496),  INT16_C( 12290), -INT16_C( 18749), -INT16_C( 22301),
         INT16_C( 32650), -INT16_C( 30590), -INT16_C( 19022),  INT16_C( 29019),  INT16_C(  5585), -INT16_C( 12783),  INT16_C(   313),  INT16_C(  9955) },
      { -INT16_C( 16755), -INT16_C(  3472), -INT16_C( 30377),  INT16_C( 26741),  INT16_C( 30681), -INT16_C( 25448),  INT16_C( 31533), -INT16_C( 18620),
        -INT16_C( 14598), -INT16_C( 21440), -INT16_C( 25733),  INT16_C( 19485),  INT16_C( 12208), -INT16_C(  5862), -INT16_C(   464), -INT16_C( 17136),
        -INT16_C( 32580),  INT16_C(  5296),  INT16_C(  9482), -INT16_C(  7300),  INT16_C(  5276), -INT16_C( 13696), -INT16_C( 15217), -INT16_C( 30335),
        -INT16_C( 15989),  INT16_C(  1590),  INT16_C( 21341),  INT16_C(  3411),  INT16_C( 28034), -INT16_C( 19465),  INT16_C(  1899),  INT16_C( 10352) },
      {  INT16_C(     0),  INT16_C(     0), -INT16_C(  4243),  INT16_C( 18073),  INT16_C(     0),  INT16_C(  1152),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 23142),  INT16_C(     0), -INT16_C(  9598),  INT16_C( 21778),  INT16_C(     0),
         INT16_C(     0),  INT16_C( 19551), -INT16_C( 18843), -INT16_C(  6111),  INT16_C(  9473),  INT16_C(     0), -INT16_C(  9375),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 13133),  INT16_C(     0),  INT16_C( 29927),  INT16_C(  2057),  INT16_C(     0) } },
    { UINT32_C(2436636807),
      { -INT16_C( 18363), -INT16_C(  7563), -INT16_C(  2612),  INT16_C( 23468),  INT16_C( 11705),  INT16_C( 17636),  INT16_C(  6895),  INT16_C( 19531),
        -INT16_C( 24978), -INT16_C(  4007),  INT16_C( 20491),  INT16_C( 30627),  INT16_C(  5207), -INT16_C(  8289), -INT16_C(  9420),  INT16_C( 31344),
        -INT16_C(  6765),  INT16_C( 24412),  INT16_C(  2266), -INT16_C( 27462), -INT16_C( 25035),  INT16_C(  9432),  INT16_C(  9145),  INT16_C( 10096),
        -INT16_C( 13631), -INT16_C( 13033), -INT16_C( 17638),  INT16_C( 29252), -INT16_C(  7217),  INT16_C(   849), -INT16_C( 15938),  INT16_C( 20861) },
      { -INT16_C(  9817), -INT16_C( 32336),  INT16_C( 27361),  INT16_C(  5909), -INT16_C(  4600), -INT16_C( 16069), -INT16_C( 21487), -INT16_C( 11288),
         INT16_C(   118), -INT16_C( 28512), -INT16_C(  6981), -INT16_C( 30206),  INT16_C( 21447), -INT16_C( 31347),  INT16_C(  2837), -INT16_C( 17194),
        -INT16_C( 31004), -INT16_C( 14787),  INT16_C( 21488), -INT16_C(  1827),  INT16_C(  6209),  INT16_C( 21178), -INT16_C( 23868),  INT16_C( 14885),
        -INT16_C( 14942),  INT16_C( 24011), -INT16_C( 12887),  INT16_C( 28903),  INT16_C( 29985),  INT16_C( 14069), -INT16_C( 13440),  INT16_C( 25842) },
      {  INT16_C( 12113),  INT16_C( 16682),  INT16_C(  1922), -INT16_C( 15558), -INT16_C(  3040), -INT16_C(  7146),  INT16_C( 15254),  INT16_C( 14623),
        -INT16_C(  5631), -INT16_C( 21866),  INT16_C( 32439), -INT16_C( 10213),  INT16_C(  4339),  INT16_C( 29454),  INT16_C(   220),  INT16_C( 11735),
         INT16_C(   560), -INT16_C( 19857), -INT16_C( 22263),  INT16_C( 10614), -INT16_C( 29539),  INT16_C( 13070),  INT16_C( 11719), -INT16_C( 14228),
         INT16_C(   791), -INT16_C( 12685), -INT16_C( 29055),  INT16_C( 29863), -INT16_C( 19042),  INT16_C( 31463), -INT16_C( 16714), -INT16_C(  6488) },
      {  INT16_C( 28811), -INT16_C( 10746), -INT16_C( 10447),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(  5644),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(  7837),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0), -INT16_C( 19289),  INT16_C( 11966), -INT16_C( 23800),  INT16_C(  5294),  INT16_C(     0),  INT16_C(     0),
         INT16_C( 24802),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(  8888),  INT16_C(     0),  INT16_C(     0),  INT16_C( 32100) } },
    { UINT32_C(3398965184),
      {  INT16_C(  3776),  INT16_C( 24051),  INT16_C(   410),  INT16_C( 25232), -INT16_C(   722),  INT16_C( 17706), -INT16_C( 25344), -INT16_C( 32492),
        -INT16_C( 17621), -INT16_C( 13579), -INT16_C(  9104),  INT16_C(  9796), -INT16_C(  4966),  INT16_C( 23308), -INT16_C( 23293), -INT16_C( 15579),
         INT16_C(  6323),  INT16_C( 20000), -INT16_C( 20198),  INT16_C( 18608), -INT16_C(  9554), -INT16_C( 20850), -INT16_C( 23944), -INT16_C( 23761),
         INT16_C(  9309), -INT16_C( 12947), -INT16_C( 19968), -INT16_C( 25868),  INT16_C(   158), -INT16_C( 23819),  INT16_C(  6821),  INT16_C( 22885) },
      { -INT16_C( 31181),  INT16_C( 19879),  INT16_C( 22327), -INT16_C(  6763),  INT16_C(  9009), -INT16_C( 22125), -INT16_C( 15675),  INT16_C(  8781),
        -INT16_C( 17690), -INT16_C(  6416), -INT16_C(  7060),  INT16_C(  2944),  INT16_C( 30436), -INT16_C( 30035),  INT16_C(  4752), -INT16_C( 15389),
        -INT16_C( 30056), -INT16_C( 12528), -INT16_C( 22815),  INT16_C(  4788),  INT16_C( 18377), -INT16_C( 28740),  INT16_C(  2313), -INT16_C(  4175),
        -INT16_C( 24125),  INT16_C( 12501),  INT16_C( 22149),  INT16_C( 27195), -INT16_C(  5940),  INT16_C( 23796), -INT16_C( 10246), -INT16_C( 27872) },
      {  INT16_C( 12385),  INT16_C( 16994),  INT16_C(  6102), -INT16_C( 24492),  INT16_C(  4190),  INT16_C( 26671), -INT16_C(  8167), -INT16_C(  8873),
         INT16_C( 11650),  INT16_C(  1805),  INT16_C( 18563),  INT16_C( 20337),  INT16_C( 25904),  INT16_C( 10923), -INT16_C( 13508), -INT16_C( 25155),
         INT16_C(  8444), -INT16_C( 11553),  INT16_C( 13367), -INT16_C( 27278), -INT16_C( 24252),  INT16_C( 24317),  INT16_C( 21890),  INT16_C(  1083),
         INT16_C( 18562),  INT16_C(  1291),  INT16_C( 32144), -INT16_C( 16300), -INT16_C(    30),  INT16_C(  8170), -INT16_C( 22325), -INT16_C( 14404) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(   389), -INT16_C( 30191),
        -INT16_C(  4946), -INT16_C( 17186), -INT16_C(  7289),  INT16_C(     0), -INT16_C(  4966),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  8896), -INT16_C( 21788),  INT16_C(     0),  INT16_C(     0),  INT16_C( 32637),
         INT16_C(     0),  INT16_C( 27014),  INT16_C(     0), -INT16_C( 20666),  INT16_C(     0),  INT16_C(     0),  INT16_C( 11967),  INT16_C( 22834) } },
    { UINT32_C(4288257224),
      {  INT16_C(  3280),  INT16_C(  5268), -INT16_C( 27987),  INT16_C( 12146), -INT16_C( 21017),  INT16_C( 26931),  INT16_C( 16373), -INT16_C( 31378),
        -INT16_C( 15684), -INT16_C( 25019),  INT16_C( 12481), -INT16_C( 29507),  INT16_C( 31448), -INT16_C( 24493), -INT16_C(  4842), -INT16_C(  6497),
         INT16_C( 13305), -INT16_C( 22790),  INT16_C( 28101), -INT16_C( 21290),  INT16_C(  2330),  INT16_C(  4117), -INT16_C( 31928),  INT16_C(  1173),
        -INT16_C(  9403),  INT16_C(  1955),  INT16_C( 24587), -INT16_C(  7277), -INT16_C(  6182), -INT16_C(  3965),  INT16_C(  8916), -INT16_C( 12842) },
      { -INT16_C( 11947),  INT16_C(  7027),  INT16_C( 18750),  INT16_C( 22727), -INT16_C(  8877), -INT16_C( 25752), -INT16_C(   416), -INT16_C( 22880),
         INT16_C( 17369), -INT16_C(  6995),  INT16_C( 16547),  INT16_C( 32455),  INT16_C( 18983), -INT16_C(  1170),  INT16_C( 17772), -INT16_C( 15928),
         INT16_C( 15382),  INT16_C( 21724), -INT16_C( 23419), -INT16_C( 10068),  INT16_C(  5505), -INT16_C(  7820),  INT16_C(  5139), -INT16_C(  4985),
         INT16_C( 13399), -INT16_C(  1328), -INT16_C( 26763), -INT16_C( 25480), -INT16_C(  6175),  INT16_C( 19864),  INT16_C( 24620),  INT16_C( 16910) },
      { -INT16_C(  5220),  INT16_C(  8854),  INT16_C( 17039),  INT16_C(  4346),  INT16_C( 28247),  INT16_C( 27377),  INT16_C( 31106), -INT16_C(  9898),
         INT16_C(  9901),  INT16_C(  8916),  INT16_C( 19645), -INT16_C( 24897),  INT16_C( 22323),  INT16_C( 24555), -INT16_C(  1353),  INT16_C( 21665),
         INT16_C( 14309),  INT16_C( 29814),  INT16_C( 28794), -INT16_C( 11900),  INT16_C( 30175),  INT16_C( 24892), -INT16_C( 27922), -INT16_C( 25541),
         INT16_C(  4025),  INT16_C( 30398),  INT16_C( 32091), -INT16_C( 28907),  INT16_C(   212), -INT16_C( 29458), -INT16_C( 28422), -INT16_C(  8224) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 13981),  INT16_C(     0),  INT16_C(     0), -INT16_C(    41),  INT16_C( 23465),
         INT16_C(     0),  INT16_C(     0),  INT16_C( 10260), -INT16_C( 16541), -INT16_C( 10558),  INT16_C(     0),  INT16_C(     0), -INT16_C( 12993),
         INT16_C( 32551),  INT16_C(     0),  INT16_C(     0), -INT16_C( 12947),  INT16_C(  2752),  INT16_C(     0),  INT16_C(     0), -INT16_C( 20636),
        -INT16_C( 30104), -INT16_C(   332),  INT16_C( 23739),  INT16_C( 29299),  INT16_C( 32174), -INT16_C( 11418),  INT16_C( 20864), -INT16_C( 12842) } },
    { UINT32_C(1095980743),
      { -INT16_C( 10298), -INT16_C( 23277),  INT16_C( 20301),  INT16_C( 15111),  INT16_C( 17121), -INT16_C( 25897), -INT16_C( 27055), -INT16_C( 21487),
         INT16_C(  9747), -INT16_C(  6085),  INT16_C( 10790),  INT16_C(  8564),  INT16_C( 21690), -INT16_C( 32512),  INT16_C( 21674),  INT16_C( 28867),
        -INT16_C( 10709),  INT16_C( 30742),  INT16_C(  7461),  INT16_C(  1716), -INT16_C( 29857), -INT16_C( 20319), -INT16_C( 19935),  INT16_C( 13660),
        -INT16_C( 26408), -INT16_C(   483), -INT16_C( 28222),  INT16_C( 31775),  INT16_C(  8421), -INT16_C( 28675), -INT16_C( 16268), -INT16_C( 24577) },
      {  INT16_C(  5526), -INT16_C( 17640), -INT16_C( 13262), -INT16_C( 28222),  INT16_C( 25431),  INT16_C( 31041), -INT16_C( 25067), -INT16_C(  4690),
        -INT16_C( 13514), -INT16_C(  1813),  INT16_C(  2908),  INT16_C( 16756),  INT16_C( 28971), -INT16_C( 24624), -INT16_C( 12494), -INT16_C( 14274),
         INT16_C( 22245),  INT16_C(  6020),  INT16_C( 17954),  INT16_C( 31401), -INT16_C(  5463), -INT16_C( 16653), -INT16_C( 24184), -INT16_C( 16725),
        -INT16_C( 27028), -INT16_C( 14154),  INT16_C( 10913), -INT16_C( 13303), -INT16_C(  9828), -INT16_C( 12693), -INT16_C( 21848), -INT16_C( 29290) },
      {  INT16_C(  6656),  INT16_C(  9125),  INT16_C( 20064),  INT16_C(  2461), -INT16_C( 28616), -INT16_C( 15929),  INT16_C( 29233), -INT16_C( 25217),
         INT16_C( 13833), -INT16_C( 21915),  INT16_C( 28256), -INT16_C(   905), -INT16_C(  7609), -INT16_C(  4150),  INT16_C( 24972), -INT16_C( 29315),
         INT16_C(  8827), -INT16_C(  9040),  INT16_C( 19824), -INT16_C( 22299), -INT16_C( 21027),  INT16_C(  3689), -INT16_C(  5857),  INT16_C( 10411),
         INT16_C(  4127),  INT16_C( 32723),  INT16_C( 19070), -INT16_C( 14980),  INT16_C( 17964), -INT16_C( 17996),  INT16_C( 12711),  INT16_C(  9030) },
      { -INT16_C( 10298), -INT16_C( 23945),  INT16_C( 20301),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 11427), -INT16_C(  2345),
         INT16_C(     0),  INT16_C(  1919),  INT16_C( 10790),  INT16_C(     0),  INT16_C( 23864),  INT16_C(     0), -INT16_C( 21261),  INT16_C(     0),
         INT16_C( 23223),  INT16_C( 30742),  INT16_C(     0),  INT16_C(     0), -INT16_C(   683),  INT16_C(     0), -INT16_C( 12092),  INT16_C(     0),
         INT16_C( 19254),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 14933),  INT16_C(     0) } },
    { UINT32_C(3288331859),
      { -INT16_C(  7101),  INT16_C(  8300), -INT16_C( 10863), -INT16_C( 20178), -INT16_C(  9794), -INT16_C(  8743), -INT16_C( 21271),  INT16_C( 26461),
        -INT16_C(  9738),  INT16_C(  9004), -INT16_C(  8161), -INT16_C( 14372),  INT16_C(  8722),  INT16_C( 26090), -INT16_C(  5864),  INT16_C( 23337),
        -INT16_C( 27187),  INT16_C( 24443), -INT16_C( 22166),  INT16_C( 10512), -INT16_C(  5758),  INT16_C( 27398),  INT16_C( 25494), -INT16_C( 29486),
        -INT16_C(   452),  INT16_C( 23727), -INT16_C( 29730), -INT16_C(  4061),  INT16_C(  3501), -INT16_C( 15018),  INT16_C( 32758), -INT16_C( 15584) },
      { -INT16_C( 25836),  INT16_C( 32290),  INT16_C( 12868), -INT16_C( 14681), -INT16_C( 20964), -INT16_C( 19919),  INT16_C(   785),  INT16_C( 20030),
        -INT16_C(  4607), -INT16_C(  8022), -INT16_C( 12935),  INT16_C( 10192),  INT16_C(  9946), -INT16_C( 12052),  INT16_C(  3493), -INT16_C( 18029),
        -INT16_C( 18776), -INT16_C(  4808), -INT16_C(  8216),  INT16_C(  1203), -INT16_C(  6771), -INT16_C( 24650), -INT16_C(  2584), -INT16_C(  5395),
        -INT16_C( 26653),  INT16_C( 23754), -INT16_C( 26012),  INT16_C( 16003),  INT16_C( 28865),  INT16_C( 26126), -INT16_C( 24195),  INT16_C(  9504) },
      {  INT16_C( 22615),  INT16_C( 16402), -INT16_C( 14793), -INT16_C( 15036), -INT16_C(  1109), -INT16_C( 27804),  INT16_C( 20976), -INT16_C( 11395),
         INT16_C( 18408),  INT16_C( 19503), -INT16_C( 19486), -INT16_C( 23670), -INT16_C( 26589), -INT16_C( 24567),  INT16_C( 10553), -INT16_C( 28219),
        -INT16_C( 10111), -INT16_C( 17967),  INT16_C(  5534),  INT16_C( 18814), -INT16_C(  7664),  INT16_C(   220),  INT16_C( 23091),  INT16_C(  7123),
         INT16_C(   929), -INT16_C( 31897), -INT16_C(  3658), -INT16_C(  9946),  INT16_C( 12425), -INT16_C( 15751),  INT16_C( 15961), -INT16_C(  9389) },
      {  INT16_C(  8653), -INT16_C( 32335),  INT16_C(     0),  INT16_C(     0), -INT16_C(  2704),  INT16_C(     0), -INT16_C( 21271),  INT16_C(     0),
         INT16_C(     0),  INT16_C( 28757), -INT16_C( 32641),  INT16_C(     0),  INT16_C(  4241), -INT16_C( 10847),  INT16_C( 12315),  INT16_C( 25911),
         INT16_C( 11163), -INT16_C( 16649), -INT16_C( 18438),  INT16_C(   300), -INT16_C(  5758),  INT16_C( 27131),  INT16_C(  7351),  INT16_C( 26263),
        -INT16_C(   903),  INT16_C( 22446),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(  4798),  INT16_C(  6401) } },
    { UINT32_C(3029607446),
      {  INT16_C(  4666),  INT16_C( 19197), -INT16_C(  9484),  INT16_C( 10059),  INT16_C(  7732), -INT16_C( 10942), -INT16_C( 22239), -INT16_C( 10407),
         INT16_C( 32666),  INT16_C(  9136),  INT16_C( 10671),  INT16_C(  2533),  INT16_C( 14696),  INT16_C( 32484),  INT16_C( 30813), -INT16_C( 26829),
         INT16_C( 12426),  INT16_C( 32482),  INT16_C( 11530),  INT16_C( 16037), -INT16_C(  6325),  INT16_C( 27924),  INT16_C( 28048),  INT16_C( 10820),
        -INT16_C(  2580), -INT16_C( 25523),  INT16_C( 12830), -INT16_C( 31067), -INT16_C( 30357), -INT16_C( 14075),  INT16_C( 14337), -INT16_C( 29856) },
      {  INT16_C( 17000),  INT16_C( 29449), -INT16_C( 20881), -INT16_C( 17487), -INT16_C( 14955),  INT16_C(  9512),  INT16_C( 27698),  INT16_C(  8015),
        -INT16_C( 25503), -INT16_C( 32581),  INT16_C( 24782),  INT16_C( 14854),  INT16_C(  3049), -INT16_C(  5629),  INT16_C( 25411), -INT16_C( 21387),
         INT16_C( 32422),  INT16_C(  5407), -INT16_C( 12244), -INT16_C( 15920), -INT16_C(  1898), -INT16_C( 14106),  INT16_C( 13669), -INT16_C( 14617),
        -INT16_C( 23855), -INT16_C( 24762),  INT16_C( 19714), -INT16_C(  5159), -INT16_C(  9128), -INT16_C( 25387),  INT16_C( 19008), -INT16_C(  6584) },
      {  INT16_C( 26568), -INT16_C(  2821), -INT16_C( 13257), -INT16_C( 12875), -INT16_C( 25660),  INT16_C( 10646),  INT16_C( 32208), -INT16_C( 24080),
         INT16_C( 13856),  INT16_C(  8769),  INT16_C(  6787), -INT16_C(  9202), -INT16_C(  7177),  INT16_C( 14200), -INT16_C( 16338), -INT16_C(  2531),
         INT16_C(  6183),  INT16_C( 24299), -INT16_C( 24348), -INT16_C( 22228), -INT16_C( 15812),  INT16_C(  3282), -INT16_C( 15809),  INT16_C( 24494),
        -INT16_C(  4103),  INT16_C( 31874), -INT16_C( 28663),  INT16_C(    88), -INT16_C( 12173), -INT16_C( 24265),  INT16_C( 21648), -INT16_C( 18536) },
      {  INT16_C(     0), -INT16_C(  5224),  INT16_C( 31319),  INT16_C(     0), -INT16_C(  7348),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C( 19835),  INT16_C(     0),  INT16_C(     0), -INT16_C(  6934),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0), -INT16_C( 12115),  INT16_C(     0), -INT16_C( 16503),  INT16_C(     0),  INT16_C(     0),  INT16_C( 12729),
         INT16_C(     0),  INT16_C(     0),  INT16_C( 15514),  INT16_C(     0),  INT16_C( 19294), -INT16_C( 32050),  INT16_C(     0),  INT16_C( 24806) } },
    { UINT32_C(1360429933),
      {  INT16_C( 16931),  INT16_C( 24570), -INT16_C( 13052),  INT16_C( 17260),  INT16_C(  6799), -INT16_C( 30557),  INT16_C(  9481),  INT16_C(  4613),
         INT16_C( 23989),  INT16_C( 10259),  INT16_C( 18990), -INT16_C( 16694),  INT16_C( 25247),  INT16_C(  3190), -INT16_C( 29467),  INT16_C(  2141),
         INT16_C( 22734), -INT16_C( 11672), -INT16_C( 11227), -INT16_C( 19435), -INT16_C( 18194), -INT16_C(  2243),  INT16_C( 17117), -INT16_C( 28151),
         INT16_C(  7327), -INT16_C( 12869), -INT16_C( 31385),  INT16_C(  1676),  INT16_C(   743), -INT16_C( 13294),  INT16_C( 28558),  INT16_C( 23764) },
      {  INT16_C( 15559), -INT16_C(  5074),  INT16_C( 17168), -INT16_C(   351), -INT16_C(  8452), -INT16_C(  9739), -INT16_C(   224), -INT16_C( 16532),
         INT16_C( 10011), -INT16_C( 32115),  INT16_C(  6572), -INT16_C( 27768), -INT16_C( 26085), -INT16_C( 22177),  INT16_C( 13066), -INT16_C( 12027),
         INT16_C( 13168), -INT16_C( 32578),  INT16_C( 24438),  INT16_C( 29311),  INT16_C( 29757),  INT16_C( 23884), -INT16_C( 18317), -INT16_C( 28900),
        -INT16_C( 22049), -INT16_C( 29935), -INT16_C( 25918), -INT16_C(  8930),  INT16_C( 32052),  INT16_C( 16006), -INT16_C( 29776),  INT16_C(  8208) },
      { -INT16_C( 12610),  INT16_C( 13729),  INT16_C(  8237),  INT16_C( 27303), -INT16_C(  3180),  INT16_C(  2247), -INT16_C(  7253), -INT16_C( 30057),
        -INT16_C( 22387),  INT16_C( 20245),  INT16_C( 13122),  INT16_C( 30509), -INT16_C( 19536),  INT16_C( 25013), -INT16_C( 15041), -INT16_C(   639),
         INT16_C(  8851), -INT16_C( 16334), -INT16_C(  9662), -INT16_C( 10454), -INT16_C(  3635),  INT16_C( 31199),  INT16_C( 30421),  INT16_C( 25091),
         INT16_C(  6430),  INT16_C( 25009), -INT16_C(  8628), -INT16_C(   552), -INT16_C( 29294), -INT16_C( 11938), -INT16_C(  8365), -INT16_C(  6450) },
      { -INT16_C( 12495),  INT16_C(     0), -INT16_C( 30622), -INT16_C( 18817),  INT16_C(     0),  INT16_C( 20972),  INT16_C( 20473),  INT16_C(     0),
        -INT16_C( 23325),  INT16_C(   624),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  4283),
         INT16_C(     0),  INT16_C( 18850),  INT16_C( 20629),  INT16_C(     0), -INT16_C( 12665),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
        -INT16_C(  5513),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  2973),  INT16_C(     0),  INT16_C( 31860),  INT16_C(     0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask32 k = test_vec[i].k;
    easysimd__m512i a  = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b  = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c  = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r  = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_maskz_shldv_epi16(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_maskz_shldv_epi16");
    easysimd_assert_m512i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask32 k = easysimd_test_x86_random_mmask32();
    easysimd__m512i a = easysimd_test_x86_random_i16x32();
    easysimd__m512i b = easysimd_test_x86_random_i16x32();
    easysimd__m512i c = easysimd_test_x86_random_i16x32();
    easysimd__m512i r = easysimd_mm512_maskz_shldv_epi16(k, a, b, c);

    easysimd_test_x86_write_mmask32(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x32(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_shldv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask16 k;
    int32_t a[16];
    int32_t b[16];
    int32_t c[16];
    int32_t r[16];
  } test_vec[8] = {
    { UINT16_C(25261),
      {  INT32_C(  1274331862),  INT32_C(   196609851), -INT32_C(   181920019),  INT32_C(  1695691516), -INT32_C(  2130625644),  INT32_C(  1185161137),  INT32_C(  1527580671),  INT32_C(  1153350253),
        -INT32_C(  1198542212), -INT32_C(  1480374342),  INT32_C(  1654516837), -INT32_C(  1295536354), -INT32_C(  1674262294), -INT32_C(   404563736),  INT32_C(  1296232415),  INT32_C(   647037098) },
      {  INT32_C(  1843273907), -INT32_C(   854285721), -INT32_C(  1406160498),  INT32_C(  1264514656), -INT32_C(  1477995841),  INT32_C(  1250871659),  INT32_C(  1654116536), -INT32_C(  2071385903),
        -INT32_C(  1326356664), -INT32_C(  1753414391),  INT32_C(   390311095),  INT32_C(  1633854114), -INT32_C(  1626846924), -INT32_C(   873818606),  INT32_C(   942506343), -INT32_C(   222513494) },
      {  INT32_C(   664972574),  INT32_C(  1774133170),  INT32_C(  1853948619), -INT32_C(   640687196),  INT32_C(  1064884269), -INT32_C(   720739730), -INT32_C(  1911736092),  INT32_C(   209766894),
         INT32_C(   691282806),  INT32_C(   244511554), -INT32_C(  1703144459),  INT32_C(   611535863), -INT32_C(  1838945501),  INT32_C(   845639246), -INT32_C(  1799326298), -INT32_C(  1247723458) },
      { -INT32_C(  1686665172),  INT32_C(           0),  INT32_C(  1089957217),  INT32_C(  1361260484),  INT32_C(           0),  INT32_C(   132928163),  INT32_C(           0), -INT32_C(  1365548766),
         INT32_C(           0), -INT32_C(  1626530070),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1237699846),  INT32_C(  1354495950),  INT32_C(           0) } },
    { UINT16_C(54627),
      {  INT32_C(  1892198110),  INT32_C(   814005684), -INT32_C(   897877161),  INT32_C(    45522847), -INT32_C(  1737489359), -INT32_C(   166914506),  INT32_C(  1278626987), -INT32_C(   551446015),
        -INT32_C(   196089536), -INT32_C(    31140954), -INT32_C(   305619122),  INT32_C(  1878031934), -INT32_C(  1207410558),  INT32_C(   581834103),  INT32_C(  1651434849), -INT32_C(  1086222465) },
      {  INT32_C(   515084664), -INT32_C(  1289955484), -INT32_C(  1247746698), -INT32_C(   433811357),  INT32_C(  1755196657), -INT32_C(  1551217342), -INT32_C(  1324943310), -INT32_C(     9418873),
         INT32_C(  1025319896),  INT32_C(  1894791930), -INT32_C(  2111467489),  INT32_C(   308824609), -INT32_C(  1199962250), -INT32_C(  2040789932), -INT32_C(  2093522180), -INT32_C(  2105366615) },
      { -INT32_C(   994074678), -INT32_C(   130764839),  INT32_C(  1618696767),  INT32_C(   443736996),  INT32_C(  1054076138), -INT32_C(   322686992),  INT32_C(   980417425),  INT32_C(  1824321954),
         INT32_C(  1781562257),  INT32_C(  1784898858),  INT32_C(  1674239679), -INT32_C(  1401078335),  INT32_C(   451563561),  INT32_C(   268873599),  INT32_C(  1296791210), -INT32_C(   122091673) },
      {  INT32_C(   580614266),  INT32_C(  1768307118),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(   372679562), -INT32_C(  1722326515),  INT32_C(           0),
        -INT32_C(   763332038),  INT32_C(           0),  INT32_C(  1091749903),  INT32_C(           0),  INT32_C(   281085296),  INT32_C(           0), -INT32_C(  1147828724), -INT32_C(  1597521983) } },
    { UINT16_C(60035),
      { -INT32_C(   967856797), -INT32_C(   492564969), -INT32_C(   299932303), -INT32_C(    62961647),  INT32_C(  1772863074),  INT32_C(   450844111),  INT32_C(  1545684642), -INT32_C(  1572428737),
         INT32_C(  1768461650),  INT32_C(   340462755), -INT32_C(  2096993679),  INT32_C(   360661427), -INT32_C(   813815296),  INT32_C(   585719167), -INT32_C(   478279004),  INT32_C(    25543855) },
      { -INT32_C(    60101287),  INT32_C(  1779480313), -INT32_C(   739438048),  INT32_C(  1424583764),  INT32_C(   371419030),  INT32_C(  1765280965), -INT32_C(   984828394), -INT32_C(   741944966),
        -INT32_C(  1211158082),  INT32_C(   119660519),  INT32_C(  1171984369),  INT32_C(   312067195), -INT32_C(   265765845), -INT32_C(   547790648), -INT32_C(  1868258026),  INT32_C(   878930806) },
      { -INT32_C(  2081738084),  INT32_C(    42601745), -INT32_C(  1756863204),  INT32_C(  1437196585),  INT32_C(  1715851678),  INT32_C(  1195745073), -INT32_C(  1143477692), -INT32_C(   235980203),
         INT32_C(  2104810348),  INT32_C(    75562728), -INT32_C(  1919170460),  INT32_C(  1206011305),  INT32_C(  1219373078),  INT32_C(   193983431),  INT32_C(   851863517),  INT32_C(   237221537) },
      {  INT32_C(  1069985493),  INT32_C(   472831009),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  2013628198),
         INT32_C(           0),  INT32_C(  1259119367),  INT32_C(           0), -INT32_C(    24943067),  INT32_C(           0),  INT32_C(  1957609455), -INT32_C(  1844144990),  INT32_C(    51087710) } },
    { UINT16_C(38801),
      {  INT32_C(   194410891),  INT32_C(   416545405),  INT32_C(  1784511879),  INT32_C(  1922200772),  INT32_C(  1264998844),  INT32_C(   733102948), -INT32_C(  1713286026), -INT32_C(   315526558),
         INT32_C(  1761200107),  INT32_C(  1216400577),  INT32_C(   246603337),  INT32_C(   243287122),  INT32_C(    39446173), -INT32_C(  1607660502), -INT32_C(  1036448160),  INT32_C(  1806658176) },
      { -INT32_C(   221009871), -INT32_C(  1103408267), -INT32_C(  2083721935), -INT32_C(   812561102),  INT32_C(  1574038323),  INT32_C(  1476263671), -INT32_C(  1944504564), -INT32_C(   738735967),
        -INT32_C(   423245199),  INT32_C(  1336147998),  INT32_C(   550728174), -INT32_C(   235969346),  INT32_C(  1179631951), -INT32_C(   862106433),  INT32_C(   626570883), -INT32_C(   252161921) },
      {  INT32_C(   953597210), -INT32_C(  1400341826), -INT32_C(  1446224917),  INT32_C(   261864383),  INT32_C(  1012263548), -INT32_C(  1173818570),  INT32_C(   685727913), -INT32_C(   887564368),
         INT32_C(  1375989396),  INT32_C(  1425967977), -INT32_C(  1493251354),  INT32_C(    45455750), -INT32_C(  1187116413), -INT32_C(  1485617411),  INT32_C(  1473204903), -INT32_C(  1105008599) },
      {  INT32_C(   801853088),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(   975364429),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1919079415),
         INT32_C(  2126408796),  INT32_C(    26837663), -INT32_C(  1397255608),  INT32_C(           0),  INT32_C(   315569386),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1591017953) } },
    { UINT16_C( 9942),
      {  INT32_C(   263274256), -INT32_C(  1831233388), -INT32_C(   215261378), -INT32_C(  1593987486), -INT32_C(   605553817),  INT32_C(  1898811042),  INT32_C(   140072933),  INT32_C(   623783957),
         INT32_C(    53796719), -INT32_C(  1248522633), -INT32_C(   811024275), -INT32_C(   697260434),  INT32_C(  1135695777), -INT32_C(   894116123),  INT32_C(  1255280181), -INT32_C(  1385168834) },
      {  INT32_C(  1471259872),  INT32_C(   537740978),  INT32_C(  1978643719), -INT32_C(    62169253), -INT32_C(  1690305354),  INT32_C(   275182811),  INT32_C(  1079719938),  INT32_C(   435014457),
         INT32_C(   577805935), -INT32_C(   331186715), -INT32_C(  1906233037),  INT32_C(  1200336273), -INT32_C(  2065446231), -INT32_C(  1063958082), -INT32_C(  1174343551),  INT32_C(   718532283) },
      {  INT32_C(  1900823692), -INT32_C(   195195199),  INT32_C(  1367588800),  INT32_C(   362286700), -INT32_C(  1751483432),  INT32_C(  1180118980), -INT32_C(   637511649), -INT32_C(   771435450),
        -INT32_C(   649834216), -INT32_C(  1613848097), -INT32_C(   856665760),  INT32_C(   937593183), -INT32_C(   909214716), -INT32_C(   904976725), -INT32_C(   995881090), -INT32_C(    74012445) },
      {  INT32_C(           0),  INT32_C(   632500520), -INT32_C(   215261378),  INT32_C(           0),  INT32_C(  1738227708),  INT32_C(           0), -INT32_C(  1607623679),  INT32_C(  1267467590),
         INT32_C(           0), -INT32_C(   165593358), -INT32_C(   811024275),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1493750268),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(56057),
      { -INT32_C(  1552098859),  INT32_C(  1777654904), -INT32_C(  1947053143),  INT32_C(  1493694090), -INT32_C(   830491969),  INT32_C(   551484796),  INT32_C(  1472774593), -INT32_C(  1842167107),
         INT32_C(   322285211),  INT32_C(   863775114),  INT32_C(   113143420),  INT32_C(   610256229), -INT32_C(   202121609), -INT32_C(  1676422693),  INT32_C(  1341447314),  INT32_C(   971056798) },
      {  INT32_C(  1582044884), -INT32_C(  1148008129), -INT32_C(  1664987081), -INT32_C(  1916722922), -INT32_C(   612256768),  INT32_C(   393778309),  INT32_C(   241658992),  INT32_C(  1715947666),
        -INT32_C(  1631284129), -INT32_C(  1806018979), -INT32_C(  1120854873),  INT32_C(  1028321853),  INT32_C(   723110822), -INT32_C(   800943776), -INT32_C(  1881167363),  INT32_C(  1375020786) },
      {  INT32_C(   401586618), -INT32_C(  1213445872), -INT32_C(  1552622235),  INT32_C(  1977663183), -INT32_C(   358549110), -INT32_C(  2017795446),  INT32_C(  2115410316),  INT32_C(  2060389312),
        -INT32_C(   711803195),  INT32_C(  1837907464), -INT32_C(   368050149),  INT32_C(  1214247358),  INT32_C(  1966276586),  INT32_C(  1845292513),  INT32_C(  1189811078), -INT32_C(   473843170) },
      {  INT32_C(  1434005595),  INT32_C(           0),  INT32_C(           0), -INT32_C(    79345952), -INT32_C(    20250770),  INT32_C(  2079715421), -INT32_C(  1944317722), -INT32_C(  1842167107),
         INT32_C(           0),  INT32_C(  2083097236),  INT32_C(           0),  INT32_C(  1330822287), -INT32_C(   814097236),  INT32_C(           0), -INT32_C(    46717789), -INT32_C(  1803728452) } },
    { UINT16_C(21369),
      {  INT32_C(  1150386616), -INT32_C(    12276498), -INT32_C(   168819818),  INT32_C(  2129975883),  INT32_C(  1282135375),  INT32_C(   778039619), -INT32_C(   102138568),  INT32_C(   424436321),
        -INT32_C(   782311965),  INT32_C(   533766793), -INT32_C(   250298203), -INT32_C(   361822053),  INT32_C(   540465885),  INT32_C(    55547339),  INT32_C(  1962686483),  INT32_C(  2106411162) },
      { -INT32_C(  1370559707),  INT32_C(   869080974),  INT32_C(  2049237471), -INT32_C(   949644311),  INT32_C(   971479917),  INT32_C(  1144796721),  INT32_C(   146291054), -INT32_C(  1484438143),
        -INT32_C(  1084894159), -INT32_C(   755883021), -INT32_C(   296937724),  INT32_C(   414560938),  INT32_C(  2119277645),  INT32_C(  1103269331),  INT32_C(  1212840646), -INT32_C(   235941952) },
      { -INT32_C(  1766832989),  INT32_C(  1818862183),  INT32_C(  1683666617), -INT32_C(  1250160792),  INT32_C(  2117389739),  INT32_C(   566294106),  INT32_C(   828967537),  INT32_C(  2099402969),
         INT32_C(    68407964),  INT32_C(   779123828), -INT32_C(  1701656014), -INT32_C(  2075128103),  INT32_C(   889423067), -INT32_C(   346635398), -INT32_C(  1508065331), -INT32_C(  1272758761) },
      {  INT32_C(   613158341),  INT32_C(           0),  INT32_C(           0), -INT32_C(   187020345),  INT32_C(  1588230607),  INT32_C(   219214040), -INT32_C(    93318800),  INT32_C(           0),
         INT32_C(  1005935939),  INT32_C(   681389858),  INT32_C(           0),  INT32_C(           0), -INT32_C(   336425758),  INT32_C(           0), -INT32_C(  2029885175),  INT32_C(           0) } },
    { UINT16_C(14096),
      {  INT32_C(   682853816),  INT32_C(  1173546675), -INT32_C(   799814784),  INT32_C(  1381248591), -INT32_C(  1172975773), -INT32_C(   679877958), -INT32_C(  1407872631), -INT32_C(    35445179),
         INT32_C(  1579521963), -INT32_C(    39643267),  INT32_C(   835647202), -INT32_C(  2021383644), -INT32_C(  1404986895),  INT32_C(    92519292), -INT32_C(  1850632116),  INT32_C(  1770952126) },
      { -INT32_C(  1446530260), -INT32_C(  1398379830), -INT32_C(  2065861536), -INT32_C(  2012454505),  INT32_C(  1999916539),  INT32_C(  1417459464),  INT32_C(   249900368), -INT32_C(   294095934),
        -INT32_C(   258523354),  INT32_C(   178011818),  INT32_C(  1234139826), -INT32_C(   690840613), -INT32_C(   246610200),  INT32_C(   239454654), -INT32_C(  1189336073), -INT32_C(   978807650) },
      {  INT32_C(  2125807572),  INT32_C(   814240381), -INT32_C(  1485236276), -INT32_C(  1686221902),  INT32_C(   277662546), -INT32_C(  1944137323), -INT32_C(  1689961732), -INT32_C(  1553928753),
        -INT32_C(  1440672467),  INT32_C(   869968231),  INT32_C(  1943753921), -INT32_C(   250717793), -INT32_C(  1191077340),  INT32_C(  1749360492),  INT32_C(   688098138), -INT32_C(  1513331848) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1032707281),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),
        -INT32_C(  1292534254), -INT32_C(   779370875),  INT32_C(  1671294404),  INT32_C(           0), -INT32_C(  1004953825),  INT32_C(  1001898212),  INT32_C(           0),  INT32_C(           0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask16 k = test_vec[i].k;
    easysimd__m512i a  = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b  = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c  = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r  = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_maskz_shldv_epi32(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_maskz_shldv_epi32");
    easysimd_assert_m512i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    easysimd__m512i b = easysimd_test_x86_random_i32x16();
    easysimd__m512i c = easysimd_test_x86_random_i32x16();
    easysimd__m512i r = easysimd_mm512_maskz_shldv_epi32(k, a, b, c);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

EASYSIMD_TEST_FUNC_LIST_BEGIN
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_shldv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_shldv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_shldv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_shldv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_shldv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_shldv_epi32)

  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_shldv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_shldv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_shldv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_shldv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_shldv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_shldv_epi32)
EASYSIMD_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
