#define EASYSIMD_TEST_X86_AVX512_INSN shrdv

#include <test/x86/avx512/test-avx512.h>
#include <easysimd/x86/avx512/shrdv.h>

static int
test_easysimd_mm_shrdv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int16_t a[8];
    int16_t b[8];
    int16_t c[8];
    int16_t r[8];
  } test_vec[8] = {
    { {  INT16_C( 10811), -INT16_C( 24615),  INT16_C(  9770),  INT16_C( 11397), -INT16_C( 32322), -INT16_C(  9778),  INT16_C(  8614),  INT16_C( 10225) },
      { -INT16_C( 30918),  INT16_C(  4002),  INT16_C(  7816),  INT16_C( 21264),  INT16_C( 12076), -INT16_C( 17945), -INT16_C(  6664),  INT16_C( 13150) },
      {  INT16_C( 14095),  INT16_C( 15059),  INT16_C( 22621),  INT16_C(  7014),  INT16_C( 13529), -INT16_C( 32524), -INT16_C(  6827), -INT16_C( 28505) },
      {  INT16_C(  3700),  INT16_C( 21499), -INT16_C(  3007),  INT16_C( 16562), -INT16_C( 27072),  INT16_C( 32156), -INT16_C( 16115), -INT16_C( 17329) } },
    { {  INT16_C( 18797), -INT16_C(  2657), -INT16_C( 20633), -INT16_C( 27832),  INT16_C( 12254), -INT16_C( 10675), -INT16_C( 21740),  INT16_C(  9226) },
      { -INT16_C(  8734),  INT16_C( 16478), -INT16_C( 15307),  INT16_C(  3675),  INT16_C( 20729),  INT16_C( 20110),  INT16_C( 13621), -INT16_C( 23842) },
      {  INT16_C( 32127), -INT16_C(  6505), -INT16_C(  8403),  INT16_C(  2938), -INT16_C( 14578),  INT16_C(  9186), -INT16_C(  5006),  INT16_C( 21575) },
      { -INT16_C( 17468), -INT16_C( 16917),  INT16_C(  8621), -INT16_C( 26908),  INT16_C( 17380), -INT16_C( 19053),  INT16_C( 27333), -INT16_C( 17336) } },
    { { -INT16_C( 23095), -INT16_C(   364), -INT16_C(  3991),  INT16_C( 25100), -INT16_C( 25792),  INT16_C( 30129), -INT16_C( 28720),  INT16_C( 20248) },
      { -INT16_C( 20723),  INT16_C( 14902), -INT16_C( 20337), -INT16_C( 25275),  INT16_C( 10103), -INT16_C(  5696),  INT16_C(  1811), -INT16_C(  9155) },
      { -INT16_C( 11604),  INT16_C(  5850), -INT16_C(  6206),  INT16_C(   632),  INT16_C( 10626),  INT16_C( 21111), -INT16_C( 28743), -INT16_C( 14686) },
      { -INT16_C(  3878), -INT16_C( 29249), -INT16_C(   998),  INT16_C( 17762), -INT16_C(  6448), -INT16_C( 32533), -INT16_C( 30265),  INT16_C( 21446) } },
    { { -INT16_C( 10177), -INT16_C( 12800),  INT16_C( 17800), -INT16_C(   149),  INT16_C( 11373), -INT16_C( 32536),  INT16_C(  9523), -INT16_C(  8099) },
      {  INT16_C( 14327), -INT16_C( 17930),  INT16_C( 28190), -INT16_C( 24389),  INT16_C( 13208),  INT16_C( 20979), -INT16_C( 27198),  INT16_C(   279) },
      {  INT16_C(  5997), -INT16_C(  2609),  INT16_C( 15196), -INT16_C( 13836), -INT16_C(  9113), -INT16_C( 26038), -INT16_C( 22783), -INT16_C(  1670) },
      { -INT16_C( 16450),  INT16_C( 29677), -INT16_C(  7708), -INT16_C( 16394),  INT16_C( 12376),  INT16_C( 31968),  INT16_C(  4761),  INT16_C( 17912) } },
    { {  INT16_C( 28894), -INT16_C(   590),  INT16_C( 28383),  INT16_C( 30621), -INT16_C( 28511),  INT16_C( 25544), -INT16_C(  8411), -INT16_C( 28059) },
      {  INT16_C( 13558),  INT16_C( 21127),  INT16_C( 31599), -INT16_C( 10724),  INT16_C( 26199),  INT16_C( 22897), -INT16_C(  5363), -INT16_C(  5294) },
      {  INT16_C(  1116),  INT16_C( 15336), -INT16_C( 31118),  INT16_C(  5042),  INT16_C( 31254),  INT16_C( 15479), -INT16_C(  9127),  INT16_C( 20430) },
      {  INT16_C( 20327), -INT16_C( 30723), -INT16_C(  9289),  INT16_C(  7655),  INT16_C( 24130), -INT16_C(  7481), -INT16_C( 30993), -INT16_C( 21174) } },
    { {  INT16_C( 22032), -INT16_C( 32607), -INT16_C( 16943),  INT16_C( 10582), -INT16_C( 14557),  INT16_C( 12418), -INT16_C( 11085),  INT16_C(  3868) },
      {  INT16_C(  1240),  INT16_C( 19274), -INT16_C(   886), -INT16_C( 24226), -INT16_C( 10890), -INT16_C( 12323), -INT16_C( 21583), -INT16_C( 15842) },
      { -INT16_C( 16639), -INT16_C( 11454), -INT16_C( 26499), -INT16_C( 24324),  INT16_C( 32352),  INT16_C(  5073), -INT16_C(  4782),  INT16_C( 10786) },
      {  INT16_C( 11016), -INT16_C( 24536), -INT16_C(  7083),  INT16_C(  5602), -INT16_C( 14557), -INT16_C( 26559),  INT16_C( 29996), -INT16_C( 31801) } },
    { {  INT16_C( 27889),  INT16_C( 31861), -INT16_C( 11160), -INT16_C(  8675), -INT16_C(  1367),  INT16_C( 23469), -INT16_C( 13403), -INT16_C( 22755) },
      {  INT16_C( 24458),  INT16_C(  1914),  INT16_C( 30455),  INT16_C( 22440),  INT16_C( 31220),  INT16_C( 18026), -INT16_C( 29594),  INT16_C( 22384) },
      { -INT16_C(  6408),  INT16_C( 24787), -INT16_C(  3910),  INT16_C( 25406), -INT16_C(  5142), -INT16_C( 28482), -INT16_C(  9290),  INT16_C( 16695) },
      { -INT16_C( 30100),  INT16_C( 20366), -INT16_C( 16907),  INT16_C( 24227),  INT16_C( 32062),  INT16_C(  6569), -INT16_C( 25810), -INT16_C(  7858) } },
    { { -INT16_C( 20166),  INT16_C( 12872), -INT16_C(  4057),  INT16_C(  7049), -INT16_C(  2967), -INT16_C( 12447), -INT16_C( 11904),  INT16_C( 31015) },
      { -INT16_C(  1353),  INT16_C( 29145),  INT16_C(  6379), -INT16_C( 10795), -INT16_C( 27901), -INT16_C( 17819), -INT16_C( 25489), -INT16_C( 22021) },
      {  INT16_C( 17229),  INT16_C( 29915),  INT16_C( 25908), -INT16_C( 25201), -INT16_C(  4007), -INT16_C(  9875), -INT16_C( 27454),  INT16_C( 31058) },
      { -INT16_C( 10819),  INT16_C( 15142), -INT16_C( 16638), -INT16_C( 21590), -INT16_C( 32262), -INT16_C( 11474), -INT16_C(  2976), -INT16_C(  8631) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m128i a = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_shrdv_epi16(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_shrdv_epi16");
    easysimd_assert_m128i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m128i a = easysimd_test_x86_random_i16x8();
    easysimd__m128i b = easysimd_test_x86_random_i16x8();
    easysimd__m128i c = easysimd_test_x86_random_i16x8();
    easysimd__m128i r = easysimd_mm_shrdv_epi16(a, b, c);

    easysimd_test_x86_write_i16x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_shrdv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int32_t a[4];
    int32_t b[4];
    int32_t c[4];
    int32_t r[4];
  } test_vec[8] = {
    { { -INT32_C(  2036417830),  INT32_C(  1549829387),  INT32_C(   824613131),  INT32_C(   288577428) },
      { -INT32_C(  1403546795), -INT32_C(  1809084323),  INT32_C(   206239506), -INT32_C(   685144579) },
      {  INT32_C(  1264437055),  INT32_C(  1487387980), -INT32_C(   343290281),  INT32_C(  2063383589) },
      {  INT32_C(  1487873707),  INT32_C(    97895944), -INT32_C(  1779555230), -INT32_C(   393635140) } },
    { { -INT32_C(  1389997232), -INT32_C(   163425820),  INT32_C(  1174572104),  INT32_C(  1360866065) },
      {  INT32_C(  1067219954), -INT32_C(  1885912264),  INT32_C(   930750481),  INT32_C(   766605021) },
      { -INT32_C(  1361389366),  INT32_C(  1923357737), -INT32_C(  1162303831), -INT32_C(  1005857326) },
      { -INT32_C(    55883372), -INT32_C(  1669652184),  INT32_C(   144900422),  INT32_C(  1572295751) } },
    { {  INT32_C(  1953941944), -INT32_C(  1143353617), -INT32_C(   983959329), -INT32_C(   151274717) },
      {  INT32_C(   582204193), -INT32_C(    19042925),  INT32_C(   762458459),  INT32_C(    29211209) },
      {  INT32_C(  1937060740), -INT32_C(   533836287),  INT32_C(  1789232967),  INT32_C(  1684054338) },
      {  INT32_C(   390556827), -INT32_C(   571676809), -INT32_C(  1215646735),  INT32_C(  2109664968) } },
    { { -INT32_C(   276425636), -INT32_C(   588422271), -INT32_C(   569745516), -INT32_C(  1629501670) },
      { -INT32_C(    82749958), -INT32_C(   354664541),  INT32_C(   139821510),  INT32_C(  2121053474) },
      {  INT32_C(  1265496777), -INT32_C(   366519722), -INT32_C(   725077574), -INT32_C(   227366664) },
      { -INT32_C(    42482934),  INT32_C(  1895731059),  INT32_C(   358642103),  INT32_C(  1823810206) } },
    { { -INT32_C(  1594981379), -INT32_C(  2004104510),  INT32_C(  1854988363),  INT32_C(  1609366933) },
      {  INT32_C(  1168792303),  INT32_C(  1848693172), -INT32_C(    79497213), -INT32_C(  1645300576) },
      { -INT32_C(   113320905), -INT32_C(   243152474),  INT32_C(  1046418089), -INT32_C(    23245809) },
      {  INT32_C(  1421205313), -INT32_C(   769511637),  INT32_C(    28788848),  INT32_C(  1765851097) } },
    { {  INT32_C(  1514424230),  INT32_C(   482964505),  INT32_C(   219614060), -INT32_C(   139852352) },
      { -INT32_C(  2014189343),  INT32_C(  1517908657), -INT32_C(  1818634108), -INT32_C(   896387548) },
      { -INT32_C(  1759127938), -INT32_C(  1229722038), -INT32_C(  1178350855), -INT32_C(  1313771824) },
      {  INT32_C(   533177221), -INT32_C(  1404620195), -INT32_C(   856931834),  INT32_C(   908392362) } },
    { {  INT32_C(   137994838), -INT32_C(  1721585132), -INT32_C(  1356006518), -INT32_C(  1334198734) },
      { -INT32_C(   565731692), -INT32_C(  2036991348), -INT32_C(  1807787836),  INT32_C(   491188422) },
      { -INT32_C(  1490714734), -INT32_C(  1153398991), -INT32_C(  1251316605), -INT32_C(  1083841493) },
      { -INT32_C(   408616434), -INT32_C(    45724495), -INT32_C(  1780113551),  INT32_C(   416681783) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m128i a = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_shrdv_epi32(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_shrdv_epi32");
    easysimd_assert_m128i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m128i a = easysimd_test_x86_random_i32x4();
    easysimd__m128i b = easysimd_test_x86_random_i32x4();
    easysimd__m128i c = easysimd_test_x86_random_i32x4();
    easysimd__m128i r = easysimd_mm_shrdv_epi32(a, b, c);

    easysimd_test_x86_write_i32x4(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_shrdv_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int64_t a[2];
    int64_t b[2];
    int64_t c[2];
    int64_t r[2];
  } test_vec[8] = {
    { { -INT64_C( 8201293569423209388), -INT64_C( 7429070045895222922) },
      {  INT64_C( 8985150093669893868),  INT64_C( 1354941091699767541) },
      {  INT64_C( 4522935399252927043),  INT64_C( 4614671555181785162) },
      { -INT64_C( 7942690723818983030),  INT64_C( 4424287082115873510) } },
    { {  INT64_C( 7891595686031117729), -INT64_C( 2909966836086088244) },
      {  INT64_C( 1973089903148146522),  INT64_C( 5915362326127318658) },
      {  INT64_C( 6505695466395204196),  INT64_C( 5127209552753996988) },
      {  INT64_C(  157874432140396871),  INT64_C( 2412076849489340461) } },
    { { -INT64_C( 8463166362613041760),  INT64_C( 1433966226851305698) },
      { -INT64_C( 2640737625200246670),  INT64_C( 6962094159522643563) },
      { -INT64_C( 5324558966891411320),  INT64_C( 7365689916208544886) },
      {  INT64_C( 8253564070757755445),  INT64_C( 8741206899300084815) } },
    { { -INT64_C( 4004895935545596304),  INT64_C( 8223501355728279294) },
      { -INT64_C( 4300623945716797241),  INT64_C( 4247776027388517017) },
      {  INT64_C( 1760120314131994951),  INT64_C( 1380060045635915211) },
      { -INT64_C( 8101738781744378804),  INT64_C( 5993802885924111378) } },
    { { -INT64_C( 2235756537992828442),  INT64_C( 5304502598998286745) },
      {  INT64_C( 7416404510734444474), -INT64_C( 7041305757972970775) },
      { -INT64_C( 8101471098063620502),  INT64_C( 1942899029871623851) },
      {  INT64_C( 2807215475056459327),  INT64_C( 3965036259300684716) } },
    { {  INT64_C( 3096746193966786039), -INT64_C( 4543383989622139748) },
      {  INT64_C( 4117137295745860767), -INT64_C( 7099118155936164352) },
      { -INT64_C( 2437247559351179070), -INT64_C( 3075354679229313732) },
      { -INT64_C( 3837499469935691395), -INT64_C( 2905426052721319924) } },
    { { -INT64_C( 4201139623114980374),  INT64_C( 4028082242816678051) },
      {  INT64_C( 8802400088421438727),  INT64_C( 7638208872591416309) },
      { -INT64_C( 7301296003911292383),  INT64_C( 8708494319392379181) },
      {  INT64_C( 2638276518271862498), -INT64_C(  864312471795941580) } },
    { {  INT64_C( 8257326264881386974),  INT64_C( 2535700324952220485) },
      { -INT64_C( 3055210035244559608),  INT64_C( 2625971617720204423) },
      {  INT64_C( 7086369062090978152), -INT64_C( 7160627112252541573) },
      { -INT64_C( 6269281079414056982), -INT64_C( 8202628601501216540) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m128i a = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_shrdv_epi64(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_shrdv_epi64");
    easysimd_assert_m128i_i64(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m128i a = easysimd_test_x86_random_i64x2();
    easysimd__m128i b = easysimd_test_x86_random_i64x2();
    easysimd__m128i c = easysimd_test_x86_random_i64x2();
    easysimd__m128i r = easysimd_mm_shrdv_epi64(a, b, c);

    easysimd_test_x86_write_i64x2(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x2(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_shrdv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int16_t a[16];
    int16_t b[16];
    int16_t c[16];
    int16_t r[16];
  } test_vec[8] = {
    { { -INT16_C( 22332), -INT16_C(  3590), -INT16_C(  7197),  INT16_C(  5720),  INT16_C( 28036),  INT16_C(   952), -INT16_C( 20643),  INT16_C( 18931),
        -INT16_C( 14421),  INT16_C( 29333),  INT16_C( 19882), -INT16_C( 16247),  INT16_C( 10889),  INT16_C( 11024),  INT16_C( 29530),  INT16_C(  7850) },
      { -INT16_C( 23524), -INT16_C(   241),  INT16_C( 26504),  INT16_C(  3093), -INT16_C( 12588),  INT16_C( 12559),  INT16_C(   893),  INT16_C( 10362),
         INT16_C(  4042),  INT16_C( 29851),  INT16_C(  9309), -INT16_C(  6604),  INT16_C( 17486), -INT16_C( 22511), -INT16_C( 17481), -INT16_C( 11322) },
      { -INT16_C( 10913), -INT16_C(  6190), -INT16_C(  6084),  INT16_C(  4339),  INT16_C(   950),  INT16_C( 13122), -INT16_C( 17402), -INT16_C( 12197),
        -INT16_C(  2356),  INT16_C( 10564),  INT16_C( 30746),  INT16_C( 26639),  INT16_C(  8380),  INT16_C( 29456), -INT16_C( 10533),  INT16_C( 14919) },
      {  INT16_C( 18489), -INT16_C(   898),  INT16_C( 30862), -INT16_C( 23861),  INT16_C( 20918), -INT16_C( 16146), -INT16_C(  2371),  INT16_C(  3913),
        -INT16_C(   852), -INT16_C( 18647),  INT16_C(  5971), -INT16_C( 13207),  INT16_C( 17634),  INT16_C( 11024),  INT16_C( 30446), -INT16_C( 29635) } },
    { {  INT16_C(  6571), -INT16_C(  6366),  INT16_C(  5377), -INT16_C( 18440),  INT16_C( 14872),  INT16_C(  7914),  INT16_C( 18166), -INT16_C( 15634),
         INT16_C( 12860),  INT16_C( 22507), -INT16_C(  1366),  INT16_C( 26303), -INT16_C( 12262), -INT16_C(  2598),  INT16_C(  8614),  INT16_C( 21040) },
      {  INT16_C( 21050),  INT16_C( 15417),  INT16_C( 12647), -INT16_C( 32525), -INT16_C(  8597),  INT16_C( 25246), -INT16_C( 29404),  INT16_C( 24612),
         INT16_C(  4287),  INT16_C( 27319),  INT16_C( 30474),  INT16_C(  9680), -INT16_C( 21945), -INT16_C(  4838),  INT16_C( 19147),  INT16_C(  1599) },
      {  INT16_C( 31132),  INT16_C(  1090),  INT16_C( 13738),  INT16_C(  5764),  INT16_C(  8723),  INT16_C( 14200), -INT16_C( 25425),  INT16_C( 28568),
         INT16_C( 20396), -INT16_C( 18471), -INT16_C( 22074),  INT16_C(  3548), -INT16_C(  2476),  INT16_C(  8187),  INT16_C( 14913), -INT16_C(  8923) },
      {  INT16_C(  9121),  INT16_C( 31176),  INT16_C( 22981),  INT16_C( 15231),  INT16_C( 26435), -INT16_C( 25058),  INT16_C(  6728),  INT16_C(  9410),
         INT16_C(  3059),  INT16_C( 23467),  INT16_C( 11242),  INT16_C( 23814),  INT16_C( 32001), -INT16_C( 23714), -INT16_C( 28461), -INT16_C(  1391) } },
    { {  INT16_C( 26547),  INT16_C( 24289),  INT16_C( 26013), -INT16_C( 20364), -INT16_C(  4984),  INT16_C( 14312), -INT16_C( 32632),  INT16_C( 13734),
         INT16_C( 32719), -INT16_C( 26900), -INT16_C( 14295),  INT16_C( 32163), -INT16_C( 24898), -INT16_C(   100), -INT16_C( 15655), -INT16_C( 29475) },
      { -INT16_C( 16855), -INT16_C( 14614),  INT16_C( 24100), -INT16_C( 21385),  INT16_C( 24394), -INT16_C( 11293), -INT16_C( 29985), -INT16_C( 20984),
        -INT16_C(  3063),  INT16_C( 12868), -INT16_C(  5956),  INT16_C( 31407),  INT16_C( 19590),  INT16_C( 24442),  INT16_C( 22286),  INT16_C( 14316) },
      { -INT16_C( 10731),  INT16_C( 14846),  INT16_C( 30005),  INT16_C( 32741), -INT16_C( 13868), -INT16_C( 19630),  INT16_C( 23123),  INT16_C( 23649),
        -INT16_C( 22962),  INT16_C(  2703),  INT16_C( 16014),  INT16_C(  5253), -INT16_C(   118), -INT16_C( 26508),  INT16_C( 24662),  INT16_C( 27600) },
      {  INT16_C( 19261),  INT16_C(  7081),  INT16_C(  9004), -INT16_C( 17021), -INT16_C( 20792), -INT16_C( 12806), -INT16_C(  4079),  INT16_C(  6867),
        -INT16_C( 12251),  INT16_C( 25737), -INT16_C( 23821),  INT16_C( 31725),  INT16_C(  8615), -INT16_C( 20487),  INT16_C( 15115), -INT16_C( 29475) } },
    { { -INT16_C( 12746),  INT16_C( 27557), -INT16_C( 30141),  INT16_C(  6123),  INT16_C( 15699), -INT16_C( 22838),  INT16_C( 11160), -INT16_C(  6653),
        -INT16_C( 27951),  INT16_C( 24561),  INT16_C( 30416),  INT16_C( 23412), -INT16_C(  6027), -INT16_C( 13325), -INT16_C( 15544),  INT16_C( 32310) },
      { -INT16_C(  9327), -INT16_C( 11030), -INT16_C( 10906), -INT16_C( 17941), -INT16_C( 19182), -INT16_C( 21920),  INT16_C( 25569), -INT16_C( 19823),
        -INT16_C( 32011), -INT16_C( 15086), -INT16_C( 30984),  INT16_C( 27936),  INT16_C(  5230), -INT16_C( 18888),  INT16_C( 28375),  INT16_C( 26932) },
      {  INT16_C(  7754), -INT16_C( 20419),  INT16_C( 10739),  INT16_C(  1641), -INT16_C( 13858), -INT16_C( 16464),  INT16_C( 16684),  INT16_C(  8562),
        -INT16_C( 31549), -INT16_C( 17433),  INT16_C(  1802),  INT16_C( 30760),  INT16_C( 24603), -INT16_C(  3282),  INT16_C( 25295),  INT16_C(  6492) },
      { -INT16_C(  7053), -INT16_C( 22701), -INT16_C( 11960), -INT16_C(  2677), -INT16_C( 11192), -INT16_C( 22838),  INT16_C( 15890),  INT16_C( 31104),
        -INT16_C( 19878),  INT16_C(  9407), -INT16_C( 16867),  INT16_C(  8283), -INT16_C( 29219), -INT16_C( 10013), -INT16_C(  8785), -INT16_C( 27833) } },
    { { -INT16_C( 26239),  INT16_C( 29897),  INT16_C( 12994), -INT16_C( 24198),  INT16_C( 11260),  INT16_C( 10336), -INT16_C( 11668),  INT16_C( 12362),
         INT16_C( 12630),  INT16_C( 24811),  INT16_C(  5176),  INT16_C( 21720),  INT16_C(  1652),  INT16_C( 17223), -INT16_C( 23703), -INT16_C(  5540) },
      {  INT16_C(  9532), -INT16_C(   162), -INT16_C(  9896),  INT16_C( 21664),  INT16_C(     4),  INT16_C( 28796), -INT16_C( 14637),  INT16_C( 10656),
        -INT16_C( 29449),  INT16_C( 12426),  INT16_C( 25248),  INT16_C(  5252), -INT16_C( 13463), -INT16_C( 11688), -INT16_C( 19346), -INT16_C( 21828) },
      {  INT16_C(  6874),  INT16_C( 12969),  INT16_C( 18931), -INT16_C(  2170),  INT16_C(   586),  INT16_C(  7528),  INT16_C(  2249), -INT16_C( 16314),
        -INT16_C( 12140),  INT16_C( 13552),  INT16_C( 29747), -INT16_C( 25527), -INT16_C( 24257), -INT16_C( 21138),  INT16_C( 10837),  INT16_C( 12120) },
      {  INT16_C( 20262), -INT16_C( 20678),  INT16_C(  1624), -INT16_C( 32123),  INT16_C(   266),  INT16_C( 31784),  INT16_C( 27113), -INT16_C( 32575),
         INT16_C( 29461),  INT16_C( 24811),  INT16_C(   647),  INT16_C( 16938), -INT16_C( 26926),  INT16_C( 18785),  INT16_C( 29979), -INT16_C( 17174) } },
    { {  INT16_C(   324),  INT16_C( 14433), -INT16_C(  6325), -INT16_C( 27345), -INT16_C( 26646), -INT16_C( 19534), -INT16_C(  1888),  INT16_C( 13427),
         INT16_C( 25801), -INT16_C(   919), -INT16_C( 19752),  INT16_C(  6296),  INT16_C(  1619), -INT16_C( 22331),  INT16_C(  7472),  INT16_C( 29912) },
      {  INT16_C( 14623),  INT16_C( 27308), -INT16_C(  9183),  INT16_C(  3071), -INT16_C( 20109),  INT16_C(  5054),  INT16_C( 12713),  INT16_C( 29256),
        -INT16_C( 20075),  INT16_C( 28270),  INT16_C(  1635), -INT16_C( 18810),  INT16_C( 19212),  INT16_C( 15454),  INT16_C( 13929), -INT16_C( 30543) },
      {  INT16_C( 23920), -INT16_C( 28174), -INT16_C(  3783), -INT16_C( 21092),  INT16_C( 23202),  INT16_C( 19392),  INT16_C(  2187),  INT16_C(  8638),
         INT16_C( 11449),  INT16_C(  7311),  INT16_C(  5427),  INT16_C( 16338),  INT16_C( 12640), -INT16_C( 13956),  INT16_C( 11623), -INT16_C( 10415) },
      {  INT16_C(   324),  INT16_C(  3608),  INT16_C(  4339), -INT16_C( 16391), -INT16_C(  6662), -INT16_C( 19534),  INT16_C( 13631), -INT16_C( 14048),
        -INT16_C( 13646), -INT16_C(  8995),  INT16_C( 30299), -INT16_C( 31194),  INT16_C(  1619), -INT16_C( 14870), -INT16_C( 11718), -INT16_C( 17812) } },
    { {  INT16_C( 17290), -INT16_C( 15256),  INT16_C(  1076), -INT16_C( 10639),  INT16_C( 12638), -INT16_C(  5598), -INT16_C(  8134), -INT16_C(  3317),
        -INT16_C( 26100),  INT16_C( 16144), -INT16_C(  7505),  INT16_C(  3967), -INT16_C(  1261),  INT16_C( 31705),  INT16_C( 10792), -INT16_C( 19886) },
      { -INT16_C( 17554), -INT16_C( 23946), -INT16_C(  6209),  INT16_C(  7801), -INT16_C( 25831),  INT16_C( 21256),  INT16_C(  4987), -INT16_C( 30906),
         INT16_C( 22189),  INT16_C( 23751),  INT16_C( 17977),  INT16_C( 19563),  INT16_C( 17473),  INT16_C( 27079),  INT16_C(  6767), -INT16_C(  8933) },
      { -INT16_C( 27947), -INT16_C( 27521), -INT16_C(  1927), -INT16_C( 27982), -INT16_C( 17773),  INT16_C(  3813),  INT16_C( 11469),  INT16_C( 31382),
         INT16_C( 23938), -INT16_C( 17450),  INT16_C( 17059), -INT16_C(  7160), -INT16_C( 12410), -INT16_C(  2739),  INT16_C( 26857), -INT16_C( 16686) },
      {  INT16_C( 29212),  INT16_C( 17645), -INT16_C(  8318),  INT16_C( 30108),  INT16_C(  9771),  INT16_C( 18257), -INT16_C( 25633),  INT16_C(  7116),
         INT16_C( 26243),  INT16_C(  7420),  INT16_C( 15445),  INT16_C( 27407),  INT16_C(  2028),  INT16_C( 20027),  INT16_C( 14229), -INT16_C(  4972) } },
    { {  INT16_C( 21242),  INT16_C( 29779),  INT16_C(  1354), -INT16_C(  8698), -INT16_C(  4928), -INT16_C( 29204), -INT16_C( 32232), -INT16_C( 26104),
        -INT16_C(  8481), -INT16_C( 32170),  INT16_C( 24096), -INT16_C( 22682), -INT16_C( 19667),  INT16_C(  6044),  INT16_C( 28444),  INT16_C(  5845) },
      {  INT16_C( 10433),  INT16_C(  2954), -INT16_C( 28370), -INT16_C(  4375), -INT16_C( 10627), -INT16_C( 27269), -INT16_C( 31912),  INT16_C( 14383),
        -INT16_C( 31390), -INT16_C( 32070),  INT16_C(  8675),  INT16_C(  4393), -INT16_C( 14636), -INT16_C(  4056), -INT16_C(   715), -INT16_C(  2553) },
      { -INT16_C( 28378),  INT16_C( 21505), -INT16_C(  5342), -INT16_C( 24766), -INT16_C( 16959),  INT16_C(  6452),  INT16_C( 25665), -INT16_C( 23727),
         INT16_C(  3305), -INT16_C( 13019),  INT16_C( 20269),  INT16_C(   478),  INT16_C(  1557),  INT16_C( 19186), -INT16_C(  1789),  INT16_C( 10560) },
      {  INT16_C(  1355),  INT16_C( 14889), -INT16_C( 32430),  INT16_C( 30593), -INT16_C(  2464), -INT16_C( 18210),  INT16_C( 16652), -INT16_C( 13052),
        -INT16_C( 20113), -INT16_C( 11246),  INT16_C(  3866),  INT16_C( 17574), -INT16_C( 23143),  INT16_C(  1511), -INT16_C( 21021),  INT16_C(  5845) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m256i a = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_shrdv_epi16(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_shrdv_epi16");
    easysimd_assert_m256i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m256i a = easysimd_test_x86_random_i16x16();
    easysimd__m256i b = easysimd_test_x86_random_i16x16();
    easysimd__m256i c = easysimd_test_x86_random_i16x16();
    easysimd__m256i r = easysimd_mm256_shrdv_epi16(a, b, c);

    easysimd_test_x86_write_i16x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_shrdv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int32_t a[8];
    int32_t b[8];
    int32_t c[8];
    int32_t r[8];
  } test_vec[8] = {
    { { -INT32_C(   849628323), -INT32_C(  1850022874),  INT32_C(   288993243),  INT32_C(  1781070744),  INT32_C(  1354812003),  INT32_C(   266816611), -INT32_C(   707984233),  INT32_C(  1250581996) },
      {  INT32_C(   907535888), -INT32_C(  1513565750),  INT32_C(   431358336),  INT32_C(  1602477820),  INT32_C(   196035752),  INT32_C(   656053904), -INT32_C(  2013468518),  INT32_C(  1439795013) },
      {  INT32_C(   931981421),  INT32_C(   970740921),  INT32_C(  1381143125),  INT32_C(   431085168), -INT32_C(  1440456422), -INT32_C(  1831780361),  INT32_C(  1813630503), -INT32_C(  1027478955) },
      {  INT32_C(   814115549), -INT32_C(   462887608), -INT32_C(  1341390711), -INT32_C(   553883096), -INT32_C(   338613740),  INT32_C(   892149791),  INT32_C(   900438537), -INT32_C(  1942345132) } },
    { {  INT32_C(    73497520),  INT32_C(   980957551),  INT32_C(   920189573), -INT32_C(   312433775), -INT32_C(  1617864722),  INT32_C(   129289623),  INT32_C(  1749947464),  INT32_C(   697197689) },
      {  INT32_C(  1311633375), -INT32_C(  1366776279),  INT32_C(   837050528), -INT32_C(   232897533),  INT32_C(   865185692), -INT32_C(   986036867), -INT32_C(   751990439), -INT32_C(   855852051) },
      { -INT32_C(   753259862),  INT32_C(  1887609552),  INT32_C(   111306243),  INT32_C(  1207484587), -INT32_C(   310736272),  INT32_C(   699577807),  INT32_C(   737992510),  INT32_C(  1157101722) },
      { -INT32_C(   138340258), -INT32_C(  1507247496),  INT32_C(   115023696), -INT32_C(  2139247596), -INT32_C(  1348690031), -INT32_C(  1963323543),  INT32_C(  1287005541),  INT32_C(  1060043594) } },
    { { -INT32_C(   233303774), -INT32_C(  1234986317), -INT32_C(  1413675776),  INT32_C(   905098693),  INT32_C(   253914431),  INT32_C(  1614337058),  INT32_C(  1300968627),  INT32_C(  1335001644) },
      {  INT32_C(  1178708627),  INT32_C(  1157473348),  INT32_C(  1878047401), -INT32_C(  1348148625),  INT32_C(  1908328271),  INT32_C(  1339160219),  INT32_C(  1453087786),  INT32_C(  1906650846) },
      {  INT32_C(   481880024),  INT32_C(   895595915), -INT32_C(   559656593), -INT32_C(  2087892941), -INT32_C(  1410053361),  INT32_C(  1811596865),  INT32_C(    29529634), -INT32_C(  1653446715) },
      {  INT32_C(  1101698034), -INT32_C(  2003383181),  INT32_C(  1968396154), -INT32_C(  1672616258), -INT32_C(  1902240188), -INT32_C(  1340315119), -INT32_C(  1822241492), -INT32_C(   226716655) } },
    { { -INT32_C(   625333682),  INT32_C(  1309613023), -INT32_C(  1624394900),  INT32_C(   186825467),  INT32_C(  1203115782), -INT32_C(     5000995),  INT32_C(   184579398),  INT32_C(   732525532) },
      {  INT32_C(  2097505181), -INT32_C(   355789698), -INT32_C(  1031145273), -INT32_C(  1177703245), -INT32_C(  1610579005),  INT32_C(  2057286451),  INT32_C(    92643368), -INT32_C(  1339019757) },
      {  INT32_C(   254621073),  INT32_C(   284817737), -INT32_C(  1529707535), -INT32_C(   228745169),  INT32_C(  1469210147),  INT32_C(   986788113), -INT32_C(   465611055),  INT32_C(   378892165) },
      { -INT32_C(  1311838883),  INT32_C(  1059522445), -INT32_C(    60567658),  INT32_C(  1499862597),  INT32_C(  1761002208), -INT32_C(   644218919), -INT32_C(   803994240), -INT32_C(  1721939042) } },
    { { -INT32_C(   316226908), -INT32_C(  1375920197), -INT32_C(   783167582), -INT32_C(  1815892113),  INT32_C(   518673677),  INT32_C(  1482210183), -INT32_C(  1774348527), -INT32_C(  1431449082) },
      {  INT32_C(  1352127380), -INT32_C(  1778543374), -INT32_C(   748269980),  INT32_C(   174467837),  INT32_C(   103370879),  INT32_C(   492798219),  INT32_C(   531864601),  INT32_C(    46817390) },
      {  INT32_C(   642933043),  INT32_C(  1522225142), -INT32_C(  1691541090), -INT32_C(   878275509), -INT32_C(   254685212),  INT32_C(  1762472016),  INT32_C(   982106316),  INT32_C(  1413305121) },
      { -INT32_C(    93151836), -INT32_C(   162280777),  INT32_C(  1301887379),  INT32_C(  1605531765), -INT32_C(   236018352), -INT32_C(  2129962920), -INT32_C(  1046912039),  INT32_C(  1431759107) } },
    { { -INT32_C(  1434808396),  INT32_C(  2097427935), -INT32_C(  1575472553), -INT32_C(  1435648314), -INT32_C(   560316531),  INT32_C(  1011328879), -INT32_C(  1988702104), -INT32_C(   656559325) },
      {  INT32_C(   578967619), -INT32_C(   459307123),  INT32_C(  2139600825),  INT32_C(    53081206), -INT32_C(  1545485261), -INT32_C(   740349589),  INT32_C(   492590585),  INT32_C(  1291139593) },
      {  INT32_C(   527333266), -INT32_C(  1224471042),  INT32_C(   976653252), -INT32_C(  1287757697), -INT32_C(  1890181340),  INT32_C(  1113797960), -INT32_C(  1822441590), -INT32_C(  1948297991) },
      { -INT32_C(  1777276258), -INT32_C(  1837228491), -INT32_C(  1709079771),  INT32_C(   106162413),  INT32_C(  1038722040),  INT32_C(  1799112615),  INT32_C(  2120375732),  INT32_C(  2057110764) } },
    { { -INT32_C(   894743093),  INT32_C(   528592730), -INT32_C(  1185302470),  INT32_C(  1013749528), -INT32_C(     3423561), -INT32_C(  2109657353), -INT32_C(   418012946), -INT32_C(  1066142220) },
      { -INT32_C(  1651892670),  INT32_C(   129764301), -INT32_C(   608168509),  INT32_C(  1679240621), -INT32_C(   412883985), -INT32_C(     9853679),  INT32_C(   988249669), -INT32_C(  1225106829) },
      {  INT32_C(  1163101304),  INT32_C(  1397493647), -INT32_C(   785511388),  INT32_C(   691357241),  INT32_C(   974166313), -INT32_C(  2093319874),  INT32_C(  1807557111), -INT32_C(   215894149) },
      { -INT32_C(  1977728310),  INT32_C(   395984643),  INT32_C(   999660419),  INT32_C(   194434718), -INT32_C(   134224415), -INT32_C(    39414714), -INT32_C(   822309938), -INT32_C(   548712840) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m256i a = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_shrdv_epi32(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_shrdv_epi32");
    easysimd_assert_m256i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m256i a = easysimd_test_x86_random_i32x8();
    easysimd__m256i b = easysimd_test_x86_random_i32x8();
    easysimd__m256i c = easysimd_test_x86_random_i32x8();
    easysimd__m256i r = easysimd_mm256_shrdv_epi32(a, b, c);

    easysimd_test_x86_write_i32x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_shrdv_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int64_t a[4];
    int64_t b[4];
    int64_t c[4];
    int64_t r[4];
  } test_vec[8] = {
    { { -INT64_C( 5653466369614858000),  INT64_C( 9219527748175810044), -INT64_C( 5502992194743519613),  INT64_C( 4295561358177024369) },
      { -INT64_C( 1145585617107412706), -INT64_C( 3062821224087618980), -INT64_C( 1020139532028539293), -INT64_C( 1910810715311840779) },
      {  INT64_C( 7740394795973934984),  INT64_C( 3857871646998799970),  INT64_C( 6154504656167544055),  INT64_C( 3728717346761948178) },
      {  INT64_C( 2211701562169457976), -INT64_C( 4616543011722193432), -INT64_C( 5802606334744672409), -INT64_C(  541189625204246462) } },
    { { -INT64_C( 2915770193417466608), -INT64_C( 3150243900102478784), -INT64_C( 1841772329310575942),  INT64_C( 2796592529204512241) },
      { -INT64_C( 2893335612645671541),  INT64_C( 3707362416211420354),  INT64_C( 7317714377779363796),  INT64_C( 6341016374298627523) },
      { -INT64_C( 3117283608866896818), -INT64_C( 5962512086730561645),  INT64_C( 1189199118112951974), -INT64_C( 6894473011921321681) },
      { -INT64_C(  707243105986512200),  INT64_C( 5519260887845413457), -INT64_C( 3270392886107454761), -INT64_C( 6802772987850895970) } },
    { {  INT64_C( 7787641677199812909),  INT64_C( 1328484291867936489), -INT64_C( 3052123716488149944), -INT64_C( 6620254655088718290) },
      { -INT64_C( 3310437197045061942), -INT64_C( 8504198790237616260),  INT64_C(  235245827484625096), -INT64_C(  185874417308134832) },
      { -INT64_C( 4610087035596681654),  INT64_C( 7277996894543452470),  INT64_C( 3432893965694868939),  INT64_C( 1682764941137160233) },
      { -INT64_C( 5576858419114024598), -INT64_C( 1436358412410687415),  INT64_C( 1808956755419497912),  INT64_C( 1865548015248478224) } },
    { { -INT64_C( 2399486589403465041), -INT64_C( 3752811308524413720), -INT64_C(  107506032218226829), -INT64_C( 8567053918161635273) },
      { -INT64_C( 7190506203930335825),  INT64_C( 6077342584041278348),  INT64_C(  693880702728848077),  INT64_C( 6918699670286761121) },
      {  INT64_C( 4530319625043804557), -INT64_C( 2617117987919232903),  INT64_C( 2215524166482679012), -INT64_C( 8994640676740543205) },
      {  INT64_C( 3278327622647913047),  INT64_C( 3136599661482460773),  INT64_C( 3038359838605713661),  INT64_C( 7043511281000037184) } },
    { {  INT64_C( 5336663105508533023), -INT64_C( 2338121390564779357),  INT64_C( 4990363501577178022), -INT64_C( 7522632641576576478) },
      { -INT64_C( 6612560777634619616), -INT64_C( 2869669061651407023),  INT64_C( 4133527202408678126), -INT64_C( 3808097312818827753) },
      {  INT64_C( 6336837381634494026),  INT64_C( 1720886506817865432),  INT64_C( 3594870973724089747),  INT64_C( 7525769096152036346) },
      { -INT64_C( 4030013681059991240),  INT64_C( 6259812027658861489),  INT64_C( 8673309081980978290), -INT64_C( 3910555062180805147) } },
    { { -INT64_C(   84543482782012042), -INT64_C( 2581994936282416918), -INT64_C( 2372999092612212282),  INT64_C( 3468885220852552348) },
      {  INT64_C( 7297660413677459234), -INT64_C(  280170722910253577), -INT64_C( 6287044820001316101),  INT64_C( 6533181786583942080) },
      { -INT64_C( 3656948362929613218),  INT64_C( 6154215458650109749), -INT64_C(  900450322454526515), -INT64_C( 3978059000403008711) },
      {  INT64_C( 2500443974407196825), -INT64_C( 1940574235203223839),  INT64_C( 1720085384914732082),  INT64_C( 6143785365814763544) } },
    { { -INT64_C( 8497482890049655441),  INT64_C( 1749471760060129432), -INT64_C( 5995855211532354140), -INT64_C( 4573712933768578988) },
      { -INT64_C( 6902867002872485803),  INT64_C( 3358518235582573368),  INT64_C( 5870107848952089431), -INT64_C( 3451562182883437816) },
      {  INT64_C( 7883462318233362110),  INT64_C( 3139725630278531546),  INT64_C( 7954602027520464663), -INT64_C( 4013868307239701249) },
      { -INT64_C( 9164723937780391594), -INT64_C( 1978542560811429124),  INT64_C(  799018783189690287), -INT64_C( 6903124365766875631) } },
    { {  INT64_C( 5738137283988473598),  INT64_C( 3813780453575594735),  INT64_C( 5670502862250632156),  INT64_C( 6337151098377828384) },
      {  INT64_C( 7322621505308426715),  INT64_C( 8291432130943668927),  INT64_C( 2780521992811796984),  INT64_C( 5732875017105989599) },
      {  INT64_C(  549507634481273796), -INT64_C( 2982802572485343088), -INT64_C( 7675906494216449971), -INT64_C( 3398145085428348653) },
      { -INT64_C( 5405973942784955281),  INT64_C( 5962542625333297843), -INT64_C( 3476086712273595833),  INT64_C(  863542131332687193) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m256i a = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_shrdv_epi64(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_shrdv_epi64");
    easysimd_assert_m256i_i64(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m256i a = easysimd_test_x86_random_i64x4();
    easysimd__m256i b = easysimd_test_x86_random_i64x4();
    easysimd__m256i c = easysimd_test_x86_random_i64x4();
    easysimd__m256i r = easysimd_mm256_shrdv_epi64(a, b, c);

    easysimd_test_x86_write_i64x4(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x4(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_shrdv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int16_t a[32];
    int16_t b[32];
    int16_t c[32];
    int16_t r[32];
  } test_vec[8] = {
    { {  INT16_C( 13428),  INT16_C( 10384), -INT16_C( 31309), -INT16_C( 31907),  INT16_C(  8934),  INT16_C( 12798),  INT16_C(  2715),  INT16_C( 16122),
         INT16_C( 19130),  INT16_C( 32511),  INT16_C( 19176), -INT16_C(  7422),  INT16_C( 19619),  INT16_C( 21122), -INT16_C( 23417), -INT16_C(   849),
         INT16_C( 16600), -INT16_C( 29660), -INT16_C( 32315), -INT16_C( 21745),  INT16_C(  3491),  INT16_C( 16093), -INT16_C( 10473), -INT16_C( 11908),
         INT16_C( 31522),  INT16_C(  2639),  INT16_C( 20933),  INT16_C( 26861),  INT16_C( 28573),  INT16_C(  9658),  INT16_C( 27156), -INT16_C(  5087) },
      {  INT16_C( 17834),  INT16_C( 28536), -INT16_C( 30778),  INT16_C( 26907), -INT16_C(  1899), -INT16_C( 21337),  INT16_C(  9167), -INT16_C(  3714),
        -INT16_C( 12897),  INT16_C( 25851), -INT16_C(  5857), -INT16_C( 17203), -INT16_C( 30888),  INT16_C( 27873),  INT16_C(   753), -INT16_C( 25767),
        -INT16_C( 11961),  INT16_C(  3339),  INT16_C(  9817), -INT16_C(  4490),  INT16_C(  7454), -INT16_C(  4710),  INT16_C(  6209), -INT16_C(  7969),
        -INT16_C(  9498),  INT16_C(  1348),  INT16_C(  4547),  INT16_C(  7361), -INT16_C( 23655), -INT16_C( 30072), -INT16_C(  7771), -INT16_C(  4826) },
      {  INT16_C( 12723),  INT16_C(  3322),  INT16_C( 29015),  INT16_C( 30202), -INT16_C( 27506), -INT16_C( 12446),  INT16_C( 16813), -INT16_C( 27729),
        -INT16_C(  3044), -INT16_C(  8296),  INT16_C( 22789), -INT16_C( 24837), -INT16_C( 31492), -INT16_C( 24023),  INT16_C( 20325),  INT16_C(  6287),
        -INT16_C( 30336), -INT16_C( 10460),  INT16_C(  7930), -INT16_C( 30388), -INT16_C( 20813),  INT16_C( 24664),  INT16_C(  2288),  INT16_C(  3315),
        -INT16_C( 29700),  INT16_C(   491), -INT16_C(  6172), -INT16_C(  7776), -INT16_C( 13973), -INT16_C( 12157),  INT16_C(  4632), -INT16_C( 26391) },
      {  INT16_C( 18062), -INT16_C(  8694), -INT16_C( 29429),  INT16_C( 18144), -INT16_C(  7596), -INT16_C( 13185),  INT16_C(  7800), -INT16_C(  7428),
        -INT16_C(  9740), -INT16_C(  1154), -INT16_C(  1449), -INT16_C( 26180),  INT16_C( 30084),  INT16_C( 28841), -INT16_C( 29404),  INT16_C( 14003),
         INT16_C( 16600), -INT16_C( 18238), -INT16_C( 27040), -INT16_C(  6294), -INT16_C( 15948), -INT16_C( 26050), -INT16_C( 10473), -INT16_C(  1489),
        -INT16_C( 20889), -INT16_C( 22399),  INT16_C( 13596),  INT16_C( 26861),  INT16_C( 29485),  INT16_C(  1207), -INT16_C( 23190), -INT16_C( 27786) } },
    { {  INT16_C(  3483), -INT16_C( 27025), -INT16_C( 17620), -INT16_C(  8417),  INT16_C( 30569),  INT16_C( 22847),  INT16_C( 12927),  INT16_C( 31589),
         INT16_C( 20925), -INT16_C( 24195),  INT16_C(  7480), -INT16_C( 23678),  INT16_C(  1510), -INT16_C(   397),  INT16_C( 23575), -INT16_C( 19562),
         INT16_C(  1386), -INT16_C( 27063),  INT16_C( 26816),  INT16_C( 10613), -INT16_C( 19233),  INT16_C( 24451), -INT16_C(  5914), -INT16_C( 23590),
         INT16_C( 22329),  INT16_C( 28996), -INT16_C( 14476),  INT16_C( 23060), -INT16_C( 30516), -INT16_C(  7080), -INT16_C(  4380),  INT16_C( 20119) },
      { -INT16_C(  7949), -INT16_C( 19484),  INT16_C( 22856),  INT16_C( 10205),  INT16_C( 24589), -INT16_C(  3194),  INT16_C( 24904), -INT16_C( 32106),
        -INT16_C(  9288),  INT16_C( 11763),  INT16_C(  2210),  INT16_C( 28295), -INT16_C(  8048),  INT16_C( 29778), -INT16_C(  5682), -INT16_C( 15677),
        -INT16_C( 22583),  INT16_C(  4469),  INT16_C( 20993),  INT16_C(  3641), -INT16_C( 16462), -INT16_C(  1278), -INT16_C( 26592), -INT16_C(  9859),
         INT16_C( 28787),  INT16_C(  5382), -INT16_C( 29320),  INT16_C(  2180), -INT16_C( 10643),  INT16_C( 15485),  INT16_C( 16576), -INT16_C( 30210) },
      {  INT16_C( 29671), -INT16_C(  5989), -INT16_C( 11066),  INT16_C( 30967), -INT16_C(  1645), -INT16_C( 19341), -INT16_C(  3951),  INT16_C(  1421),
        -INT16_C( 27807), -INT16_C(  9958), -INT16_C( 25056), -INT16_C( 28958),  INT16_C( 24437),  INT16_C( 13770), -INT16_C( 14177), -INT16_C( 31042),
         INT16_C( 22843),  INT16_C(   367),  INT16_C( 26157), -INT16_C( 16006), -INT16_C(  4769), -INT16_C(  3979),  INT16_C(   734),  INT16_C( 16373),
         INT16_C(  4245), -INT16_C( 19176), -INT16_C(  1362),  INT16_C(  9027),  INT16_C(  3417), -INT16_C(  1960),  INT16_C(  6101),  INT16_C(  4479) },
      { -INT16_C(  6629),  INT16_C( 31890),  INT16_C(  8940), -INT16_C( 17474), -INT16_C( 20755), -INT16_C( 13529),  INT16_C(  6463),  INT16_C(  5299),
         INT16_C( 10462),  INT16_C( 31976),  INT16_C(  7480), -INT16_C(  5920), -INT16_C( 32721),  INT16_C(  5311), -INT16_C( 11364),  INT16_C(  2830),
        -INT16_C(  1760),  INT16_C(  8939), -INT16_C( 28661), -INT16_C( 29110),  INT16_C( 32613),  INT16_C(  4860),  INT16_C( 24707), -INT16_C(  4834),
        -INT16_C( 25927),  INT16_C(  1649),  INT16_C( 13795), -INT16_C( 29886),  INT16_C( 14020),  INT16_C( 32228),  INT16_C(  1911),  INT16_C(  5116) } },
    { { -INT16_C(  4496), -INT16_C( 25070), -INT16_C( 29612), -INT16_C( 19617), -INT16_C( 11142),  INT16_C( 22691), -INT16_C( 26154),  INT16_C( 27543),
        -INT16_C( 20567),  INT16_C( 22304),  INT16_C( 25770),  INT16_C(   891), -INT16_C( 11407),  INT16_C( 18428),  INT16_C( 31722),  INT16_C( 23384),
         INT16_C( 27241), -INT16_C( 16903),  INT16_C( 22775),  INT16_C( 29040),  INT16_C(  4908),  INT16_C(   713),  INT16_C( 24748),  INT16_C( 21869),
        -INT16_C( 29425), -INT16_C( 18003),  INT16_C( 10481),  INT16_C( 25533), -INT16_C( 17925), -INT16_C(  6486),  INT16_C(   564), -INT16_C( 25279) },
      {  INT16_C( 14956),  INT16_C( 25434), -INT16_C( 13678), -INT16_C( 16684), -INT16_C( 25123), -INT16_C( 30016),  INT16_C( 11773),  INT16_C(  3551),
        -INT16_C( 29510), -INT16_C( 21306), -INT16_C( 31820), -INT16_C( 20465), -INT16_C( 18116),  INT16_C( 28822), -INT16_C( 10309),  INT16_C(  9997),
         INT16_C( 26385), -INT16_C( 23669),  INT16_C( 24369),  INT16_C(  3937),  INT16_C(  8701), -INT16_C(  1383),  INT16_C( 30798),  INT16_C(  2055),
        -INT16_C( 12795), -INT16_C( 17996), -INT16_C( 15535), -INT16_C( 29079), -INT16_C(   132),  INT16_C( 14334),  INT16_C(  3286), -INT16_C(  6305) },
      { -INT16_C(  5517), -INT16_C( 23158), -INT16_C(  5303),  INT16_C( 18100),  INT16_C( 19724),  INT16_C( 23105),  INT16_C( 18629), -INT16_C( 13725),
         INT16_C(  5910),  INT16_C( 26756), -INT16_C(  4645),  INT16_C( 22518), -INT16_C(  2835), -INT16_C( 15473), -INT16_C(  4608),  INT16_C( 29867),
         INT16_C( 13784),  INT16_C(  8473), -INT16_C( 13023),  INT16_C( 11624), -INT16_C( 22246), -INT16_C(  8312), -INT16_C(  5135),  INT16_C(  2218),
         INT16_C( 11778), -INT16_C(  8848),  INT16_C( 26139),  INT16_C(  2101), -INT16_C( 15270),  INT16_C( 23500),  INT16_C( 30642), -INT16_C( 30001) },
      { -INT16_C( 25138), -INT16_C( 10585),  INT16_C( 18758),  INT16_C( 19253), -INT16_C(  8739),  INT16_C( 11345), -INT16_C(  4914), -INT16_C(  4750),
        -INT16_C(  5442),  INT16_C( 25970),  INT16_C( 30348),  INT16_C( 15373), -INT16_C( 13850), -INT16_C(  7892),  INT16_C( 31722), -INT16_C(  7765),
         INT16_C(  4458), -INT16_C( 14882), -INT16_C( 21381),  INT16_C( 24945),  INT16_C( 32580), -INT16_C( 26366),  INT16_C( 12374),  INT16_C(   469),
         INT16_C( 25411), -INT16_C( 18003),  INT16_C( 27173),  INT16_C( 19229), -INT16_C(  8402),  INT16_C( 32750), -INT16_C( 32627), -INT16_C( 12609) } },
    { { -INT16_C(  5972), -INT16_C( 12885),  INT16_C(  5045), -INT16_C( 12293), -INT16_C( 31812), -INT16_C( 20818),  INT16_C( 22638),  INT16_C( 28854),
         INT16_C(  9862), -INT16_C( 23986), -INT16_C( 31860), -INT16_C(  6486),  INT16_C( 30279), -INT16_C(  1727),  INT16_C(  4333), -INT16_C( 25981),
         INT16_C( 12024), -INT16_C( 21145),  INT16_C( 25154), -INT16_C(   388),  INT16_C( 11237),  INT16_C( 21420),  INT16_C( 25219),  INT16_C(  2756),
         INT16_C(  4744),  INT16_C(  5292),  INT16_C( 22165), -INT16_C(  8965),  INT16_C( 15565), -INT16_C( 17707),  INT16_C( 22605),  INT16_C( 17748) },
      { -INT16_C( 17274), -INT16_C( 14093),  INT16_C( 28446),  INT16_C(  1223),  INT16_C( 29594),  INT16_C(  7767),  INT16_C(  7126),  INT16_C( 24104),
        -INT16_C( 11219), -INT16_C( 15757),  INT16_C( 28202), -INT16_C(  2146),  INT16_C( 29610), -INT16_C(  2126),  INT16_C(  1739),  INT16_C( 21053),
         INT16_C( 12482), -INT16_C(  7910), -INT16_C(  7777),  INT16_C( 15077),  INT16_C( 15445),  INT16_C( 11096), -INT16_C( 32680), -INT16_C( 31351),
        -INT16_C(   940),  INT16_C( 32328), -INT16_C(  6550),  INT16_C(  5494),  INT16_C( 10330),  INT16_C(  9484),  INT16_C( 18734), -INT16_C(  3721) },
      { -INT16_C( 28039),  INT16_C(  6610), -INT16_C( 18573), -INT16_C( 14253), -INT16_C( 21517),  INT16_C( 19443),  INT16_C( 32043),  INT16_C( 32721),
         INT16_C(  6521), -INT16_C(  6915),  INT16_C( 29695),  INT16_C( 23033),  INT16_C(  1435), -INT16_C( 13697), -INT16_C(  2481), -INT16_C( 14149),
        -INT16_C( 29304), -INT16_C(   799),  INT16_C( 13380),  INT16_C( 14276), -INT16_C( 18209),  INT16_C(  2691),  INT16_C( 21557), -INT16_C( 20855),
        -INT16_C( 30867),  INT16_C( 27794), -INT16_C( 29702), -INT16_C( 26938),  INT16_C( 17809), -INT16_C(  8096),  INT16_C(  6971), -INT16_C( 15192) },
      {  INT16_C( 17268), -INT16_C(  3222), -INT16_C( 15754), -INT16_C(  1537),  INT16_C( 20599), -INT16_C(  2603),  INT16_C( 31435),  INT16_C( 14427),
         INT16_C(  5779),  INT16_C(  5021), -INT16_C(  9131), -INT16_C( 12429),  INT16_C( 30030), -INT16_C(  4251),  INT16_C(  3478),  INT16_C( 18355),
        -INT16_C( 15826),  INT16_C( 22195), -INT16_C(  2524),  INT16_C( 24551),  INT16_C( 30890),  INT16_C(  2677), -INT16_C( 15596), -INT16_C( 15227),
        -INT16_C(  7520),  INT16_C(  1323), -INT16_C( 25963), -INT16_C(  9357),  INT16_C(  7782), -INT16_C( 17707),  INT16_C(  9675),  INT16_C( 30533) } },
    { { -INT16_C( 30040), -INT16_C(  4928), -INT16_C( 31554), -INT16_C( 25053), -INT16_C( 22980),  INT16_C( 29096),  INT16_C( 13050),  INT16_C( 26400),
        -INT16_C( 19783), -INT16_C( 19500), -INT16_C( 26050), -INT16_C( 12471), -INT16_C( 22049),  INT16_C(  6831),  INT16_C( 22468),  INT16_C( 27870),
        -INT16_C( 24863), -INT16_C( 24488),  INT16_C( 31779),  INT16_C( 24382), -INT16_C(  6622),  INT16_C(  7633), -INT16_C(  3816), -INT16_C( 11900),
         INT16_C( 22691), -INT16_C(  7803), -INT16_C( 12558), -INT16_C( 11856),  INT16_C( 24440),  INT16_C( 15596), -INT16_C( 13641), -INT16_C( 26455) },
      {  INT16_C(   361), -INT16_C( 29640),  INT16_C( 30333), -INT16_C( 24341), -INT16_C( 17315),  INT16_C( 30141),  INT16_C( 16813),  INT16_C( 20807),
        -INT16_C( 13158), -INT16_C( 29646), -INT16_C(  7270),  INT16_C(  4702),  INT16_C( 19010), -INT16_C(  1713), -INT16_C(  2028),  INT16_C( 32146),
        -INT16_C( 13575),  INT16_C( 30473), -INT16_C(  2751), -INT16_C( 25065), -INT16_C( 11087),  INT16_C( 24339),  INT16_C( 23061), -INT16_C( 20560),
        -INT16_C(  7642), -INT16_C( 16068), -INT16_C( 25915),  INT16_C(  2259),  INT16_C(  8932), -INT16_C(  2047), -INT16_C( 27878),  INT16_C(  5238) },
      {  INT16_C( 32606), -INT16_C( 24693), -INT16_C( 23948),  INT16_C(  9789),  INT16_C( 20598), -INT16_C( 29819),  INT16_C( 13739), -INT16_C( 11973),
         INT16_C( 30487), -INT16_C(  8814),  INT16_C( 26129), -INT16_C(  2587), -INT16_C(  6520), -INT16_C( 23571),  INT16_C( 25466), -INT16_C( 10057),
         INT16_C( 17123),  INT16_C( 22391), -INT16_C( 19228),  INT16_C( 23165),  INT16_C(   516), -INT16_C( 20507),  INT16_C(  8247),  INT16_C( 20353),
         INT16_C(  5015), -INT16_C( 22484),  INT16_C(  4473),  INT16_C(   669), -INT16_C( 29705),  INT16_C( 29093),  INT16_C( 23790), -INT16_C( 11959) },
      {  INT16_C(  1446), -INT16_C( 30947), -INT16_C( 10165),  INT16_C(  1884),  INT16_C( 30360), -INT16_C(  5235),  INT16_C( 13734),  INT16_C( 10476),
         INT16_C( 13669), -INT16_C( 21259),  INT16_C( 19743), -INT16_C(  2438),  INT16_C( 17065), -INT16_C( 13704),  INT16_C(  1301),  INT16_C(  9433),
         INT16_C( 13276),  INT16_C(  4928),  INT16_C(  6082), -INT16_C(  3910),  INT16_C(  7778), -INT16_C( 26386),  INT16_C( 11234),  INT16_C( 26818),
         INT16_C( 19633),  INT16_C(  5070),  INT16_C( 25319),  INT16_C( 18078), -INT16_C( 14146),  INT16_C(  2535),  INT16_C( 19563),  INT16_C( 15180) } },
    { { -INT16_C( 16226), -INT16_C( 32215), -INT16_C( 22924),  INT16_C( 31196), -INT16_C( 15959), -INT16_C(  8152), -INT16_C( 22046),  INT16_C( 31023),
         INT16_C( 23485),  INT16_C( 13858), -INT16_C( 16532),  INT16_C( 25656), -INT16_C(  8886),  INT16_C( 14805),  INT16_C(  7993), -INT16_C( 10486),
         INT16_C( 13279),  INT16_C( 21593),  INT16_C( 13786), -INT16_C( 31795), -INT16_C(  2569), -INT16_C(  9885), -INT16_C( 27745),  INT16_C( 23634),
         INT16_C( 29934),  INT16_C( 23442), -INT16_C( 13516),  INT16_C( 32447), -INT16_C( 27480), -INT16_C(  7497), -INT16_C( 15693), -INT16_C( 27719) },
      {  INT16_C(  5109), -INT16_C( 12313), -INT16_C( 19384),  INT16_C( 16210), -INT16_C( 18775),  INT16_C( 18456),  INT16_C( 27465),  INT16_C( 14244),
         INT16_C( 14303),  INT16_C(  5010),  INT16_C( 20738), -INT16_C( 21870),  INT16_C( 18918), -INT16_C( 26228),  INT16_C( 17931),  INT16_C(   300),
         INT16_C(  4953), -INT16_C( 24112),  INT16_C(  9159),  INT16_C( 29153), -INT16_C(  1575),  INT16_C(  8889),  INT16_C( 24164),  INT16_C( 17497),
        -INT16_C(  4971), -INT16_C( 26793), -INT16_C(  5827),  INT16_C(  9025), -INT16_C( 12749),  INT16_C( 16061), -INT16_C(  5868),  INT16_C( 27967) },
      {  INT16_C(  4349), -INT16_C( 15346), -INT16_C(  4301),  INT16_C(  3125), -INT16_C(  4119),  INT16_C( 19758), -INT16_C( 30899), -INT16_C(  7535),
        -INT16_C(  5773), -INT16_C( 20103), -INT16_C( 17710),  INT16_C(  1492), -INT16_C( 28280), -INT16_C( 25532), -INT16_C( 31877),  INT16_C( 30729),
         INT16_C(  6291), -INT16_C( 14788),  INT16_C( 29191), -INT16_C(  3886),  INT16_C(    97), -INT16_C( 20930), -INT16_C( 12408), -INT16_C(  1136),
         INT16_C(  2488), -INT16_C( 29780), -INT16_C( 32317),  INT16_C( 19600), -INT16_C( 11246), -INT16_C( 29208), -INT16_C(  3496), -INT16_C(  5371) },
      { -INT16_C( 24658),  INT16_C( 16286),  INT16_C(  5326), -INT16_C( 27698),  INT16_C( 21728),  INT16_C(  8291),  INT16_C( 23117),  INT16_C( 15511),
        -INT16_C(  5257), -INT16_C( 14053), -INT16_C( 20517),  INT16_C(  9795), -INT16_C(  6435), -INT16_C( 15459), -INT16_C( 16029), -INT16_C( 27029),
         INT16_C(  9851),  INT16_C(  7429), -INT16_C( 29077),  INT16_C( 24819), -INT16_C(  1285), -INT16_C( 29977),  INT16_C( 25747),  INT16_C( 23634),
        -INT16_C( 27276),  INT16_C( 30069), -INT16_C( 18074),  INT16_C( 32447), -INT16_C(  6870), -INT16_C( 16926),  INT16_C(  5314), -INT16_C(   867) } },
    { {  INT16_C( 16906),  INT16_C(  4530), -INT16_C( 31564),  INT16_C(  5378),  INT16_C( 16517),  INT16_C(  3523),  INT16_C( 21263), -INT16_C( 14328),
        -INT16_C( 19108),  INT16_C(  8019), -INT16_C(  7370),  INT16_C( 18539),  INT16_C( 21688),  INT16_C(  4310), -INT16_C(  9402),  INT16_C( 20731),
        -INT16_C( 21219), -INT16_C( 11935),  INT16_C( 25394), -INT16_C( 18458), -INT16_C( 22109), -INT16_C( 19516), -INT16_C( 13060),  INT16_C( 22651),
        -INT16_C( 12671), -INT16_C( 18568), -INT16_C(  7247),  INT16_C( 26880), -INT16_C( 10697),  INT16_C( 32121),  INT16_C( 30129), -INT16_C( 12339) },
      {  INT16_C( 12066),  INT16_C( 21664), -INT16_C( 30830),  INT16_C( 13835), -INT16_C( 12496),  INT16_C( 11753),  INT16_C( 25756),  INT16_C(  7557),
        -INT16_C(   718), -INT16_C(  7211), -INT16_C( 10783),  INT16_C(  6221), -INT16_C( 14677),  INT16_C( 23702),  INT16_C( 25403),  INT16_C( 24107),
        -INT16_C( 13166),  INT16_C(  9650), -INT16_C( 16813), -INT16_C( 31909),  INT16_C( 17549),  INT16_C( 10672),  INT16_C( 13992), -INT16_C(  9657),
         INT16_C(  7219),  INT16_C(  5309),  INT16_C(  2801), -INT16_C( 25555), -INT16_C( 15407),  INT16_C(  3320),  INT16_C(  9254), -INT16_C( 18070) },
      {  INT16_C(  7664),  INT16_C( 17374),  INT16_C( 14811),  INT16_C( 26822),  INT16_C( 30589),  INT16_C(  9618), -INT16_C(  9811), -INT16_C(  7937),
        -INT16_C( 17163), -INT16_C(  6411),  INT16_C(  8903), -INT16_C( 26494),  INT16_C( 31461),  INT16_C(  2980),  INT16_C(  3998), -INT16_C( 28988),
        -INT16_C( 24020),  INT16_C(  2001), -INT16_C( 26405),  INT16_C( 22639),  INT16_C(   271), -INT16_C( 17283),  INT16_C( 31962), -INT16_C( 12388),
        -INT16_C( 28359),  INT16_C(   181),  INT16_C( 14259), -INT16_C( 26472),  INT16_C( 15538),  INT16_C( 20644),  INT16_C( 26699),  INT16_C( 30687) },
      {  INT16_C( 16906),  INT16_C( 21120), -INT16_C(  3504),  INT16_C( 11348),  INT16_C( 31106),  INT16_C( 17264),  INT16_C(  9442),  INT16_C( 15115),
        -INT16_C( 27222), -INT16_C( 22278), -INT16_C( 15418),  INT16_C( 21018),  INT16_C( 23205),  INT16_C( 24845), -INT16_C( 29457), -INT16_C( 19185),
        -INT16_C( 14038),  INT16_C( 26800), -INT16_C( 13716),  INT16_C(  1719), -INT16_C( 30437),  INT16_C( 19845), -INT16_C( 21965), -INT16_C( 23435),
         INT16_C(  6631), -INT16_C(  4677),  INT16_C( 15478),  INT16_C( 11625),  INT16_C( 30093), -INT16_C( 30761), -INT16_C( 31538),  INT16_C( 29397) } },
    { { -INT16_C( 20469), -INT16_C(  6530), -INT16_C(  4536),  INT16_C( 22335), -INT16_C( 17169), -INT16_C( 13805), -INT16_C( 20423),  INT16_C( 29337),
         INT16_C( 20289), -INT16_C(  2702),  INT16_C(  2694),  INT16_C( 14477),  INT16_C( 12614), -INT16_C( 28023),  INT16_C( 26778), -INT16_C( 23287),
        -INT16_C( 30696),  INT16_C( 24971), -INT16_C( 13706),  INT16_C( 26040), -INT16_C( 13177), -INT16_C( 16337), -INT16_C( 13956), -INT16_C( 17102),
        -INT16_C( 23528), -INT16_C( 24910),  INT16_C( 16558), -INT16_C(  2857),  INT16_C( 24689),  INT16_C(  2950), -INT16_C( 28472), -INT16_C(  8016) },
      {  INT16_C( 15384), -INT16_C( 29119), -INT16_C(  1530), -INT16_C( 29197),  INT16_C(  9158),  INT16_C( 16973),  INT16_C( 32748),  INT16_C(  1279),
        -INT16_C( 19933), -INT16_C( 11870),  INT16_C( 31218),  INT16_C( 25542),  INT16_C( 19673), -INT16_C( 24209),  INT16_C(  8156), -INT16_C(  2942),
        -INT16_C( 15525),  INT16_C( 25218),  INT16_C( 30397), -INT16_C( 31761),  INT16_C( 15769), -INT16_C( 31291), -INT16_C( 14916), -INT16_C(  8055),
         INT16_C( 11127),  INT16_C( 27057),  INT16_C( 30629),  INT16_C( 32460),  INT16_C( 15300), -INT16_C( 24544), -INT16_C( 23973), -INT16_C( 18795) },
      {  INT16_C(  5989),  INT16_C(  8984),  INT16_C(  2189),  INT16_C(  9894),  INT16_C( 27717),  INT16_C(   427),  INT16_C( 13361), -INT16_C( 22303),
        -INT16_C( 27808),  INT16_C(  1297), -INT16_C(  8950), -INT16_C( 12669), -INT16_C( 23783),  INT16_C( 29807),  INT16_C(  1093), -INT16_C( 21718),
         INT16_C( 17179), -INT16_C( 22066),  INT16_C( 29771), -INT16_C( 28465),  INT16_C( 31712),  INT16_C(  4497),  INT16_C( 29615),  INT16_C(  4025),
        -INT16_C( 13818),  INT16_C(  4116), -INT16_C( 26456), -INT16_C( 15905),  INT16_C( 20027), -INT16_C( 32459),  INT16_C( 24402),  INT16_C( 27948) },
      { -INT16_C( 14976),  INT16_C( 16870), -INT16_C( 12233), -INT16_C( 12964),  INT16_C( 13799),  INT16_C( 18873),  INT16_C( 22556), -INT16_C( 18100),
         INT16_C( 20289),  INT16_C( 31417),  INT16_C( 31874), -INT16_C( 14575),  INT16_C( 27800),  INT16_C( 17119), -INT16_C(  7356),  INT16_C(  8361),
         INT16_C( 27505), -INT16_C( 30199), -INT16_C( 10311),  INT16_C(  2014), -INT16_C( 13177), -INT16_C(  8169), -INT16_C( 29831),  INT16_C( 17630),
        -INT16_C(  8560),  INT16_C(  6635), -INT16_C( 23232), -INT16_C(   615),  INT16_C( 30860),  INT16_C(    92), -INT16_C(  7118),  INT16_C( 26974) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_shrdv_epi16(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_shrdv_epi16");
    easysimd_assert_m512i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i16x32();
    easysimd__m512i b = easysimd_test_x86_random_i16x32();
    easysimd__m512i c = easysimd_test_x86_random_i16x32();
    easysimd__m512i r = easysimd_mm512_shrdv_epi16(a, b, c);

    easysimd_test_x86_write_i16x32(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x32(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_shrdv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int32_t a[16];
    int32_t b[16];
    int32_t c[16];
    int32_t r[16];
  } test_vec[8] = {
    { {  INT32_C(    43784751), -INT32_C(  2091638080), -INT32_C(    64717469), -INT32_C(  1433600306),  INT32_C(  1003234625),  INT32_C(  1497365829),  INT32_C(   981470131), -INT32_C(  1182798198),
        -INT32_C(   910419192), -INT32_C(  1588850626),  INT32_C(  1537044877), -INT32_C(  1341838993), -INT32_C(  1813196466), -INT32_C(  2115228722), -INT32_C(  1044681674),  INT32_C(  1668954971) },
      { -INT32_C(  1809041834), -INT32_C(   751470266),  INT32_C(  1496240874),  INT32_C(  1242117115), -INT32_C(   757205756),  INT32_C(  1465174561), -INT32_C(  1860694218), -INT32_C(  1577741494),
         INT32_C(   271917513), -INT32_C(  2065470566),  INT32_C(   970789437),  INT32_C(  1250158405), -INT32_C(    48471844),  INT32_C(  1632989226), -INT32_C(   890081920), -INT32_C(   898898176) },
      { -INT32_C(  1545953015),  INT32_C(  1227406604),  INT32_C(   360842703), -INT32_C(   916519444), -INT32_C(  1866040474),  INT32_C(  1827740652), -INT32_C(  1992891255), -INT32_C(   732716341),
         INT32_C(  1333275971), -INT32_C(  1164402453), -INT32_C(  1831920731), -INT32_C(  2040844768), -INT32_C(  1776868950), -INT32_C(   972945347), -INT32_C(  1202767636),  INT32_C(   495756250) },
      {  INT32_C(   721505805), -INT32_C(  1805109950), -INT32_C(  1512703928),  INT32_C(  1069197519),  INT32_C(   284110997), -INT32_C(  1575644161), -INT32_C(  1692581883),  INT32_C(  1767321597),
         INT32_C(   959939425),  INT32_C(  1934895490), -INT32_C(   354620532), -INT32_C(  1341838993),  INT32_C(   925170484),  INT32_C(   179011924), -INT32_C(   670295114), -INT32_C(  1694908392) } },
    { { -INT32_C(  1150548784),  INT32_C(  1249248676),  INT32_C(  1088177440),  INT32_C(   516372340), -INT32_C(  1783308712), -INT32_C(   748964122), -INT32_C(   913593362),  INT32_C(   518395726),
        -INT32_C(  1059433700),  INT32_C(  2013941848),  INT32_C(   163112597),  INT32_C(  1982299933),  INT32_C(  1141627741), -INT32_C(  2145949807),  INT32_C(  1615438354), -INT32_C(   713150535) },
      { -INT32_C(   627681150),  INT32_C(  1045602472), -INT32_C(  1538847865), -INT32_C(   400920694), -INT32_C(   601086390), -INT32_C(  1621343347), -INT32_C(  1627413019),  INT32_C(  1467252180),
         INT32_C(  2117143254),  INT32_C(   834438314),  INT32_C(   433456271), -INT32_C(  1123946381), -INT32_C(  1550242538),  INT32_C(  1430451568),  INT32_C(  1878278554), -INT32_C(  1782159169) },
      {  INT32_C(   471070578),  INT32_C(   172937339),  INT32_C(  1193551060),  INT32_C(   721691924), -INT32_C(  1009869229),  INT32_C(   773394835),  INT32_C(   295505234), -INT32_C(   408525963),
        -INT32_C(   704398758),  INT32_C(  1591759242), -INT32_C(  1968896907),  INT32_C(  2109057322), -INT32_C(   616529081), -INT32_C(   418817644), -INT32_C(   604461466),  INT32_C(  1673699081) },
      { -INT32_C(  1776242981), -INT32_C(   900459255),  INT32_C(  1891136525), -INT32_C(  1493655060), -INT32_C(  2067180874), -INT32_C(  2005812629), -INT32_C(   377916830), -INT32_C(  1544642313),
        -INT32_C(  1941785168),  INT32_C(   714998420), -INT32_C(  1339787187),  INT32_C(   484280799),  INT32_C(   747116470),  INT32_C(   794232833),  INT32_C(  1770071688),  INT32_C(  1609219863) } },
    { { -INT32_C(   482752935), -INT32_C(  1925113321),  INT32_C(  1209525790), -INT32_C(   674902897), -INT32_C(   458095025), -INT32_C(   959726753),  INT32_C(  1788986209), -INT32_C(  1144167326),
         INT32_C(  1100875562),  INT32_C(  1070522145),  INT32_C(  1435035077),  INT32_C(    19680689), -INT32_C(  1276780973), -INT32_C(    92688231), -INT32_C(   698082701), -INT32_C(  1466879618) },
      {  INT32_C(  1508519992), -INT32_C(   711346161),  INT32_C(  1328161182), -INT32_C(  1034922386), -INT32_C(   847956684),  INT32_C(  1506275045), -INT32_C(  2026951928), -INT32_C(  1792032676),
         INT32_C(    15604208),  INT32_C(  1893042130),  INT32_C(   398458792), -INT32_C(  1982263211),  INT32_C(   727076421),  INT32_C(  1149508924), -INT32_C(  1530154168),  INT32_C(  1681521523) },
      { -INT32_C(   429643756),  INT32_C(  1482045871), -INT32_C(  1922099656),  INT32_C(  1796622374), -INT32_C(   761893738), -INT32_C(   787080567),  INT32_C(  1098244813), -INT32_C(   240799779),
        -INT32_C(  2032662057),  INT32_C(  2061381186),  INT32_C(  1778863428),  INT32_C(   735452565),  INT32_C(   318598281),  INT32_C(  1424168071), -INT32_C(   745187082), -INT32_C(   557565433) },
      { -INT32_C(  1560048077),  INT32_C(  1881086594),  INT32_C(   706846280), -INT32_C(  1151396046), -INT32_C(   724249710),  INT32_C(  1927505373),  INT32_C(  1480807694), -INT32_C(  1451359515),
        -INT32_C(   600579965), -INT32_C(  1879853112), -INT32_C(  2057793956), -INT32_C(   930961399),  INT32_C(   584708847),  INT32_C(  2046096225),  INT32_C(   785195865), -INT32_C(   414113182) } },
    { { -INT32_C(  2056938429),  INT32_C(   268387275),  INT32_C(   645531281), -INT32_C(  1403891677),  INT32_C(  1136545724),  INT32_C(  1503175011),  INT32_C(    19672570), -INT32_C(  1411321496),
         INT32_C(  1479624077),  INT32_C(   426258568),  INT32_C(  1514201655), -INT32_C(   301493710),  INT32_C(  1160955361),  INT32_C(  1637796455),  INT32_C(  1600310263),  INT32_C(  1225474748) },
      {  INT32_C(   279067783), -INT32_C(  1557591444),  INT32_C(   519989740), -INT32_C(   586414597),  INT32_C(   824327882),  INT32_C(     9617416),  INT32_C(  1197471115), -INT32_C(  1080989129),
         INT32_C(   332346278),  INT32_C(   699856957),  INT32_C(  1564980322), -INT32_C(  2076552263), -INT32_C(  1699390318), -INT32_C(  1466284003),  INT32_C(  1961949757),  INT32_C(   187924836) },
      { -INT32_C(   249691468),  INT32_C(  1562039547),  INT32_C(  1119510921),  INT32_C(  1187444148),  INT32_C(  1860271185),  INT32_C(    18316228), -INT32_C(   629864587),  INT32_C(  1021684104),
        -INT32_C(  1506999381),  INT32_C(  1610827735),  INT32_C(  1554235048),  INT32_C(    77818291), -INT32_C(  1452047131),  INT32_C(  1974110975),  INT32_C(   424616081),  INT32_C(  1951741129) },
      {  INT32_C(   600340566),  INT32_C(  1696681345), -INT32_C(   166511357), -INT32_C(  1067468091),  INT32_C(   526721503), -INT32_C(  2053535210), -INT32_C(     5482487),  INT32_C(   934011121),
         INT32_C(  1959462440),  INT32_C(  1844476466),  INT32_C(  1650082018),  INT32_C(  1249328576), -INT32_C(  1842768337),  INT32_C(  1362399290),  INT32_C(  2099163057), -INT32_C(  1306229343) } },
    { {  INT32_C(   236683831),  INT32_C(  1903107785), -INT32_C(  1882385700),  INT32_C(  1637118075), -INT32_C(   200669196),  INT32_C(   577353105), -INT32_C(  1640253227),  INT32_C(   588419308),
        -INT32_C(   617534190),  INT32_C(   676110412),  INT32_C(   783817138),  INT32_C(  2123320458), -INT32_C(   462251693),  INT32_C(   587651918),  INT32_C(  2143371667), -INT32_C(   475867951) },
      {  INT32_C(  1304351745),  INT32_C(   662047348), -INT32_C(  1386926557), -INT32_C(   852695942), -INT32_C(   860774787),  INT32_C(   233813882), -INT32_C(   913460744), -INT32_C(  2035535995),
         INT32_C(  2027186691), -INT32_C(  1751168396), -INT32_C(   230296456),  INT32_C(  1438609880), -INT32_C(  1994297329),  INT32_C(   529994023),  INT32_C(  1206396098),  INT32_C(  1473090643) },
      {  INT32_C(  1926210046),  INT32_C(  1661562603),  INT32_C(   978669154), -INT32_C(   812706625), -INT32_C(  1420250748), -INT32_C(  2067075134),  INT32_C(  1741402643),  INT32_C(  1153341510),
         INT32_C(   632720698),  INT32_C(  1569308923), -INT32_C(   828908018),  INT32_C(  2006787827), -INT32_C(  1725696553), -INT32_C(   132256283), -INT32_C(   429922144), -INT32_C(  1154802303) },
      {  INT32_C(   922439684),  INT32_C(  1317940707), -INT32_C(   470596425), -INT32_C(  1705391884), -INT32_C(   549412737), -INT32_C(  2003145372), -INT32_C(  1237380153),  INT32_C(   344738371),
         INT32_C(   890929398), -INT32_C(   202813819), -INT32_C(   773801248), -INT32_C(   298119215),  INT32_C(  1121984456),  INT32_C(   957888218),  INT32_C(  2143371667), -INT32_C(   237933976) } },
    { { -INT32_C(  1511988822), -INT32_C(  1342019167),  INT32_C(   998152520), -INT32_C(  1749935168), -INT32_C(   181283568),  INT32_C(  1676562115), -INT32_C(  1203155657),  INT32_C(   359887979),
        -INT32_C(   138718378),  INT32_C(    94879165),  INT32_C(   390079831),  INT32_C(  1370419776), -INT32_C(  1958289464),  INT32_C(  1710109742), -INT32_C(   316852350),  INT32_C(    33722540) },
      { -INT32_C(  1594245661), -INT32_C(   760897157),  INT32_C(   132769222), -INT32_C(  1604806696), -INT32_C(  1523868041),  INT32_C(  1426725331), -INT32_C(    62773424), -INT32_C(  1694612297),
         INT32_C(  2101082114),  INT32_C(  1599070361), -INT32_C(  1637467962),  INT32_C(  1178517199),  INT32_C(   820734301), -INT32_C(   762972798), -INT32_C(   741357796),  INT32_C(   225365259) },
      {  INT32_C(  1586145733),  INT32_C(  1337907593), -INT32_C(   504552431),  INT32_C(  1076308963),  INT32_C(   376443796),  INT32_C(   636089608), -INT32_C(   940001092),  INT32_C(  1272276613),
        -INT32_C(  1716953329),  INT32_C(  1256744761),  INT32_C(  1865143948), -INT32_C(  1766894847),  INT32_C(  1856773990), -INT32_C(   795634412), -INT32_C(   745042867),  INT32_C(    35548402) },
      {  INT32_C(   489621261), -INT32_C(  1109917388), -INT32_C(   219996737),  INT32_C(   318129016), -INT32_C(  1176010925), -INT32_C(   748425650), -INT32_C(  1004374773), -INT32_C(  1196713053),
        -INT32_C(   268046474), -INT32_C(  1477423998), -INT32_C(  1939770366), -INT32_C(  1462273760),  INT32_C(  1982667647),  INT32_C(  1599612510),  INT32_C(   954689769), -INT32_C(  1287470976) } },
    { {  INT32_C(    94095308), -INT32_C(  1152416977),  INT32_C(  1529510745),  INT32_C(   888265166),  INT32_C(   211983864), -INT32_C(  2133051853), -INT32_C(  1269599294), -INT32_C(  1397329440),
         INT32_C(  1756451129),  INT32_C(   774045909),  INT32_C(  1233735035),  INT32_C(   511539750),  INT32_C(  1261051928),  INT32_C(   415958614),  INT32_C(  1506549625), -INT32_C(   922385520) },
      { -INT32_C(  1456359724),  INT32_C(   853038263), -INT32_C(   948149855), -INT32_C(   186254884),  INT32_C(  1866403609), -INT32_C(  1886975467), -INT32_C(  1159179223), -INT32_C(  1417417001),
         INT32_C(  1532343716), -INT32_C(  1416745719),  INT32_C(  1785858702),  INT32_C(   492722179),  INT32_C(  2106367335), -INT32_C(   787737432),  INT32_C(  1066136680), -INT32_C(  2014703646) },
      { -INT32_C(   840810556), -INT32_C(    75992980),  INT32_C(  2120608634), -INT32_C(  1432632253),  INT32_C(   153560929), -INT32_C(  1545915589),  INT32_C(   182609448),  INT32_C(   965856629),
         INT32_C(  2030531596),  INT32_C(  1601470436), -INT32_C(  1377969814), -INT32_C(    10979171), -INT32_C(   620200033), -INT32_C(   612441165), -INT32_C(  1075486390),  INT32_C(   989427502) },
      {  INT32_C(  1079622780),  INT32_C(  1266398456), -INT32_C(   552048554), -INT32_C(  2036450503), -INT32_C(  2041491716), -INT32_C(   253672784),  INT32_C(   699683699),  INT32_C(   527875429),
         INT32_C(  1514572565), -INT32_C(  1830670323), -INT32_C(  1550687661), -INT32_C(   353189864), -INT32_C(    82232626), -INT32_C(  2104163559),  INT32_C(   437678855),  INT32_C(  1066083350) } },
    { { -INT32_C(   810352405), -INT32_C(   366073985), -INT32_C(  1634268415),  INT32_C(   597553027),  INT32_C(   587114095), -INT32_C(   738362231),  INT32_C(   194241245),  INT32_C(  1145474137),
         INT32_C(   185923980),  INT32_C(   586498593), -INT32_C(   775910066), -INT32_C(   336306564), -INT32_C(  1928465916),  INT32_C(  1281428079),  INT32_C(  1180234989),  INT32_C(   210476672) },
      { -INT32_C(  1206411369),  INT32_C(   802819553),  INT32_C(   369204122), -INT32_C(    50137607),  INT32_C(  1468665832),  INT32_C(   128183066),  INT32_C(  1598946271),  INT32_C(   829151385),
         INT32_C(  1508475767),  INT32_C(   713606288),  INT32_C(  1480624479),  INT32_C(  1733640831),  INT32_C(  1824448338), -INT32_C(  1435278901), -INT32_C(   167067555),  INT32_C(   271021465) },
      { -INT32_C(  2006380040),  INT32_C(   884142805), -INT32_C(    91425925), -INT32_C(  2023628491), -INT32_C(  1947000896), -INT32_C(   566860159), -INT32_C(  1059831769), -INT32_C(  1362035531),
        -INT32_C(   499762675), -INT32_C(  1491670740),  INT32_C(   295871196),  INT32_C(  1134101379), -INT32_C(  1529902045),  INT32_C(   444728819), -INT32_C(    86354363),  INT32_C(  1604889170) },
      {  INT32_C(   396335055), -INT32_C(   798027951), -INT32_C(  1070369965),  INT32_C(   397396252),  INT32_C(   587114095),  INT32_C(  1778302532), -INT32_C(  1105778747),  INT32_C(  1589955106),
         INT32_C(   465066151),  INT32_C(  1224879956), -INT32_C(  2079812099), -INT32_C(    42038321),  INT32_C(  1369554496),  INT32_C(  1815701900), -INT32_C(   365770841), -INT32_C(   580500702) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_shrdv_epi32(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_shrdv_epi32");
    easysimd_assert_m512i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    easysimd__m512i b = easysimd_test_x86_random_i32x16();
    easysimd__m512i c = easysimd_test_x86_random_i32x16();
    easysimd__m512i r = easysimd_mm512_shrdv_epi32(a, b, c);

    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_shrdv_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    int64_t a[8];
    int64_t b[8];
    int64_t c[8];
    int64_t r[8];
  } test_vec[8] = {
    { { -INT64_C( 8030776458687706593), -INT64_C( 4885249650138446690), -INT64_C( 8088319418746057853), -INT64_C(  592088279426790598),
        -INT64_C( 5480712429425057532), -INT64_C(  852179298428168675), -INT64_C( 6150408083914036290),  INT64_C( 4411064970376625768) },
      { -INT64_C(  420366533376785311), -INT64_C( 7256820872677529116), -INT64_C( 6152947045843736958), -INT64_C( 5365438264873708779),
        -INT64_C( 7332328901996500890), -INT64_C( 4452026756958803521),  INT64_C( 6128361430408554783),  INT64_C( 9181763328779941732) },
      { -INT64_C( 6006391310900815787), -INT64_C( 1320257489550666581),  INT64_C( 1656863635333407337),  INT64_C( 2516169470784741459),
         INT64_C( 6659929609849384914), -INT64_C( 7051805557144439449),  INT64_C( 2386703078750909014), -INT64_C(  372259277981749787) },
      { -INT64_C( 1575401681836121942), -INT64_C(  312246676908177789), -INT64_C( 6811315159625637822),  INT64_C( 4783595731134650787),
        -INT64_C( 3883883004656527357), -INT64_C( 9135024819423127322), -INT64_C( 3196290564409410470), -INT64_C( 3621712432840721919) } },
    { {  INT64_C( 4338136140482216743), -INT64_C( 4129919124225557540),  INT64_C( 2375067418760312326),  INT64_C( 2521921207638655708),
        -INT64_C( 4846383507704202836), -INT64_C( 3899698624916017238),  INT64_C( 8993286720415707250), -INT64_C(  706643710456061676) },
      {  INT64_C(  420583375807982393), -INT64_C( 7858218261679201435),  INT64_C( 4020604107873095857),  INT64_C(  427973686856142255),
         INT64_C(  289063389305464994), -INT64_C( 3221446874474143336),  INT64_C( 5190944588967414703),  INT64_C( 7498268830247046973) },
      { -INT64_C( 4954409139059741029),  INT64_C( 4215016903568288649), -INT64_C( 3590752561574141622),  INT64_C( 4364805668270009956),
        -INT64_C( 1660785516507367403),  INT64_C( 8134645684706174751),  INT64_C( 7571535059137851571), -INT64_C( 1744540319387227155) },
      {  INT64_C( 3388227714124413627), -INT64_C( 5556500989209954115),  INT64_C( 3190867937954444285), -INT64_C( 3484549320149042529),
        -INT64_C(  340842119453277169),  INT64_C( 8095857160363374982),  INT64_C( 4472982920544776089), -INT64_C( 7048051973619207797) } },
    { {  INT64_C( 1541659293019750685), -INT64_C( 4822894459895154310), -INT64_C( 3458458971591777133), -INT64_C( 2902242606788471808),
         INT64_C( 7238614917364111466),  INT64_C( 7600412432691180466), -INT64_C( 7985442265910641542),  INT64_C( 2316852102663736726) },
      { -INT64_C( 1782312519583433740), -INT64_C( 2781220851530053593),  INT64_C(  197706944628615579),  INT64_C( 3659308007257416178),
         INT64_C( 7138017651264145652),  INT64_C( 7914453828188091293),  INT64_C( 7250610070576761906),  INT64_C( 6839232163453137273) },
      { -INT64_C( 1316011719255393507),  INT64_C( 1840211822589320778), -INT64_C(  891617643214789942), -INT64_C( 7056978430831973305),
         INT64_C( 8704530293202589582),  INT64_C( 4526712962627712466),  INT64_C( 2786631813332371519),  INT64_C( 8712188097113642695) },
      { -INT64_C(  289391869875939413),  INT64_C(  715866082508287998),  INT64_C( 7418554784567132313), -INT64_C( 1896171215351661272),
         INT64_C( 2581004396475809107),  INT64_C( 7847340237733080897), -INT64_C( 3945523932556027803), -INT64_C(  990705909478930661) } },
    { {  INT64_C( 7216494565804990080),  INT64_C( 1624655798571219672), -INT64_C( 1766400475498805896), -INT64_C( 4812916172352695085),
        -INT64_C( 8580323006970360587),  INT64_C( 8158376248617470283),  INT64_C( 6371542913088161893), -INT64_C( 6371948390836233320) },
      { -INT64_C( 2806276318366335529), -INT64_C( 6373098964107140316),  INT64_C( 3610084362452489532),  INT64_C( 5804465343091387956),
        -INT64_C(  360316737228981353),  INT64_C( 7760446729364175816), -INT64_C( 6069085968434077958), -INT64_C(   54572713748869771) },
      { -INT64_C( 4492018498521459495),  INT64_C( 6970022346888101919), -INT64_C( 6737743286507346084),  INT64_C(  571620899410677639),
         INT64_C( 6313589520662402019),  INT64_C( 4964761091518589472),  INT64_C( 1951913052858800710),  INT64_C( 6402703005196134310) },
      {  INT64_C( 1693049659994523991),  INT64_C( 4321140380781764526),  INT64_C( 1352579409332650501),  INT64_C( 7600504060423855785),
        -INT64_C( 4261857208681262539),  INT64_C(  727326703155175417), -INT64_C( 1629826898893267935), -INT64_C( 6937153979451291350) } },
    { {  INT64_C( 1268559278226379019), -INT64_C( 1915862043985494211), -INT64_C( 4753707629336231593),  INT64_C( 1577786037027016983),
         INT64_C( 3098462172374113021),  INT64_C( 7833651001408067378), -INT64_C( 7561439869124800454),  INT64_C(  760835716025655664) },
      {  INT64_C(  881008817582172194),  INT64_C( 8867469200958785679),  INT64_C( 3871932143450810276),  INT64_C(  690809856578281086),
         INT64_C( 1589298458300878631),  INT64_C( 2564740060590762971), -INT64_C( 4671637706155531216),  INT64_C( 4670762888922389217) },
      {  INT64_C( 1733411133672581745), -INT64_C( 4548974751121094853),  INT64_C(  661995234052679215), -INT64_C( 3596789103970911301),
        -INT64_C( 2025823065236678771),  INT64_C( 1219486905668605595),  INT64_C( 4599495199553528482), -INT64_C( 3002166705803450837) },
      { -INT64_C(  257540822829823795),  INT64_C( 7057853325037867516), -INT64_C( 4933049512579466226),  INT64_C( 3659171336795443138),
         INT64_C( 8735109707530728128), -INT64_C( 7548741689790758246),  INT64_C( 9030237374050998176),  INT64_C( 4843913299644994017) } },
    { { -INT64_C( 8427497210196714367), -INT64_C( 3995638284193125990), -INT64_C( 1798791416096027578), -INT64_C( 4094399580304630514),
        -INT64_C( 1414698374796357919), -INT64_C(   30412797449399131), -INT64_C( 7087308398784862464), -INT64_C( 4972781196750351377) },
      { -INT64_C( 8273418281674805776), -INT64_C( 8523646643514862083),  INT64_C( 4557617880451350035),  INT64_C( 4940573400414565373),
         INT64_C(  276043411944250462),  INT64_C( 3196550892731575626), -INT64_C( 8612274970744151572), -INT64_C( 4622401439650615488) },
      {  INT64_C( 6779002743337410315),  INT64_C( 2760017427452513288),  INT64_C( 7512528820409342766), -INT64_C( 7354987809775771699),
        -INT64_C( 2907146336452611019), -INT64_C( 7788336302185195383), -INT64_C(  580808038604255904), -INT64_C(  624571246219760594) },
      { -INT64_C( 4750908996120669149), -INT64_C(  159723150123485271), -INT64_C( 6538512981535253467), -INT64_C( 6922532431904720008),
        -INT64_C( 6512158623171152030), -INT64_C( 6521271660427496566),  INT64_C( 4381617525107249807), -INT64_C( 5078281937919742988) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_shrdv_epi64(a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_shrdv_epi64");
    easysimd_assert_m512i_i64(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i64x8();
    easysimd__m512i b = easysimd_test_x86_random_i64x8();
    easysimd__m512i c = easysimd_test_x86_random_i64x8();
    easysimd__m512i r = easysimd_mm512_shrdv_epi64(a, b, c);

    easysimd_test_x86_write_i64x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_shrdv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int16_t a[8];
    int16_t b[8];
    int16_t c[8];
    int16_t r[8];
  } test_vec[8] = {
    { UINT8_C( 98),
      {  INT16_C( 12994), -INT16_C(  2399),  INT16_C( 31344),  INT16_C( 11510),  INT16_C( 12978), -INT16_C( 11626),  INT16_C( 17805), -INT16_C( 18222) },
      { -INT16_C( 14916),  INT16_C( 18916),  INT16_C( 24148),  INT16_C( 25136), -INT16_C( 26283), -INT16_C(   757),  INT16_C( 27423), -INT16_C(  7841) },
      {  INT16_C(   413),  INT16_C(  3799), -INT16_C( 12933),  INT16_C( 11578), -INT16_C( 12032), -INT16_C( 29440), -INT16_C( 11754), -INT16_C( 11706) },
      {  INT16_C(     0), -INT16_C( 13843),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 11626),  INT16_C( 32022),  INT16_C(     0) } },
    { UINT8_C(151),
      {  INT16_C(  6954), -INT16_C( 30228),  INT16_C( 20044), -INT16_C(  6690), -INT16_C(  9382), -INT16_C( 15100), -INT16_C(  6853),  INT16_C( 15458) },
      {  INT16_C( 28860), -INT16_C( 30025), -INT16_C(  6997),  INT16_C( 31882),  INT16_C(  6116), -INT16_C( 18542),  INT16_C( 25949), -INT16_C( 30642) },
      {  INT16_C( 14976), -INT16_C( 13295), -INT16_C(  4215), -INT16_C(  7246), -INT16_C( 18742),  INT16_C(  1448),  INT16_C(  2716),  INT16_C( 22593) },
      {  INT16_C(  6954), -INT16_C( 15114),  INT16_C( 21927),  INT16_C(     0), -INT16_C(  1738),  INT16_C(     0),  INT16_C(     0),  INT16_C(  7729) } },
    { UINT8_C(123),
      { -INT16_C(  7432), -INT16_C(  8922), -INT16_C( 23956), -INT16_C( 31551),  INT16_C( 30772), -INT16_C( 26143),  INT16_C( 27079),  INT16_C(   282) },
      { -INT16_C(  6534),  INT16_C( 27018),  INT16_C( 28056),  INT16_C( 20276),  INT16_C( 14613),  INT16_C(  8427),  INT16_C( 17275),  INT16_C( 29595) },
      { -INT16_C( 16090), -INT16_C( 28080),  INT16_C(  4707), -INT16_C( 26858), -INT16_C(  1910),  INT16_C( 20785),  INT16_C( 19297), -INT16_C(  9133) },
      { -INT16_C(  5237), -INT16_C(  8922),  INT16_C(     0), -INT16_C( 11757),  INT16_C( 17758), -INT16_C( 13072), -INT16_C( 19229),  INT16_C(     0) } },
    { UINT8_C( 49),
      {  INT16_C( 17885),  INT16_C( 19402),  INT16_C(  6521), -INT16_C( 19616), -INT16_C( 32764),  INT16_C( 18222), -INT16_C( 24293), -INT16_C(  9107) },
      {  INT16_C(   242),  INT16_C(  1087), -INT16_C( 10474),  INT16_C(  3726), -INT16_C(  8184),  INT16_C( 21360),  INT16_C( 19507),  INT16_C(  4228) },
      {  INT16_C( 20113),  INT16_C(  2907), -INT16_C( 17305),  INT16_C( 27582), -INT16_C(  5060),  INT16_C( 22707),  INT16_C(  8333),  INT16_C( 32564) },
      {  INT16_C(  8942),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(   136),  INT16_C(  2277),  INT16_C(     0),  INT16_C(     0) } },
    { UINT8_C( 32),
      { -INT16_C( 31884),  INT16_C( 19255),  INT16_C( 17682), -INT16_C(  3501), -INT16_C( 22859),  INT16_C(   293),  INT16_C( 13610),  INT16_C( 31123) },
      { -INT16_C( 24943),  INT16_C( 19936),  INT16_C( 19548),  INT16_C( 18569), -INT16_C(  7681),  INT16_C(  8149),  INT16_C( 21782), -INT16_C( 30144) },
      {  INT16_C( 30680), -INT16_C(  5419),  INT16_C( 10428),  INT16_C( 29404),  INT16_C(   462), -INT16_C(  1933),  INT16_C(  1591), -INT16_C( 14223) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 24540),  INT16_C(     0),  INT16_C(     0) } },
    { UINT8_C(164),
      {  INT16_C(  5458), -INT16_C( 25088),  INT16_C( 18590), -INT16_C( 32611), -INT16_C( 17378),  INT16_C( 29590),  INT16_C(  8444),  INT16_C( 29515) },
      {  INT16_C( 14069),  INT16_C(  7472), -INT16_C( 24046),  INT16_C(  5355), -INT16_C(  7403),  INT16_C(  7243),  INT16_C(  4949), -INT16_C( 22592) },
      { -INT16_C( 16088), -INT16_C( 14779), -INT16_C(  7671),  INT16_C( 10054), -INT16_C(  9058), -INT16_C( 25702), -INT16_C(  6404), -INT16_C(  3826) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(  2340),  INT16_C(     0),  INT16_C(     0),  INT16_C(  4828),  INT16_C(     0), -INT16_C( 24831) } },
    { UINT8_C( 28),
      {  INT16_C(  3646), -INT16_C(  8146),  INT16_C( 17145), -INT16_C(  8714),  INT16_C(  4749), -INT16_C( 24526), -INT16_C(  9774), -INT16_C( 27704) },
      { -INT16_C( 28898),  INT16_C(   157), -INT16_C( 15147), -INT16_C( 19810),  INT16_C( 14687),  INT16_C( 17838), -INT16_C( 24504), -INT16_C( 31135) },
      { -INT16_C( 28754), -INT16_C( 22425),  INT16_C( 24018),  INT16_C( 24453), -INT16_C( 18577),  INT16_C( 16640), -INT16_C( 14192), -INT16_C( 20779) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C( 20670), -INT16_C(  2321),  INT16_C( 29374),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT8_C( 87),
      { -INT16_C( 20878),  INT16_C( 13869), -INT16_C(  8372), -INT16_C( 31083), -INT16_C(  9587),  INT16_C( 11726),  INT16_C( 21563), -INT16_C( 13348) },
      { -INT16_C( 31557),  INT16_C(  6301), -INT16_C(  1015), -INT16_C( 16249), -INT16_C( 13828), -INT16_C( 15024), -INT16_C(   354),  INT16_C(  4124) },
      {  INT16_C( 18860), -INT16_C(  1978), -INT16_C(  9176), -INT16_C( 18818),  INT16_C( 19638), -INT16_C(  3357), -INT16_C( 16479),  INT16_C( 23741) },
      {  INT16_C( 19386),  INT16_C( 29912),  INT16_C(  2527),  INT16_C(     0), -INT16_C(  3222),  INT16_C(     0),  INT16_C( 10781),  INT16_C(     0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m128i a  = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b  = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c  = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r  = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_maskz_shrdv_epi16(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_maskz_shrdv_epi16");
    easysimd_assert_m128i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128i a = easysimd_test_x86_random_i16x8();
    easysimd__m128i b = easysimd_test_x86_random_i16x8();
    easysimd__m128i c = easysimd_test_x86_random_i16x8();
    easysimd__m128i r = easysimd_mm_maskz_shrdv_epi16(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_shrdv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int32_t a[4];
    int32_t b[4];
    int32_t c[4];
    int32_t r[4];
  } test_vec[8] = {
    { UINT8_C(111),
      {  INT32_C(  1062051775), -INT32_C(  1143881157), -INT32_C(  1019547583), -INT32_C(  1014034256) },
      { -INT32_C(  1614004332), -INT32_C(  1864157059), -INT32_C(   438743373),  INT32_C(  1129667460) },
      {  INT32_C(   897753850), -INT32_C(  1494133916), -INT32_C(   211211453), -INT32_C(   793249733) },
      { -INT32_C(   217062129), -INT32_C(   608363485),  INT32_C(  2020040200),  INT32_C(  1789620376) } },
    { UINT8_C( 56),
      { -INT32_C(  1128960125), -INT32_C(  1603320494),  INT32_C(  2049201439),  INT32_C(  1282762666) },
      {  INT32_C(  1035053802), -INT32_C(   947824741), -INT32_C(  1207798592), -INT32_C(  1343172053) },
      { -INT32_C(  1804884670),  INT32_C(   171301611), -INT32_C(   645637841), -INT32_C(  1423509055) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1506102315) } },
    { UINT8_C(164),
      {  INT32_C(   775940311), -INT32_C(   554826135), -INT32_C(   620124663),  INT32_C(  1008580759) },
      { -INT32_C(    30952925),  INT32_C(  1076703719), -INT32_C(  1358886986),  INT32_C(    72592429) },
      { -INT32_C(    30239851), -INT32_C(  1562632039),  INT32_C(  1568597702), -INT32_C(  1030055010) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(   613669224),  INT32_C(           0) } },
    { UINT8_C( 77),
      { -INT32_C(   214646591), -INT32_C(   190220819),  INT32_C(   589387894),  INT32_C(  1069032876) },
      {  INT32_C(  2010691159),  INT32_C(  2034138003), -INT32_C(  1810392071), -INT32_C(   136128203) },
      { -INT32_C(  2014701927),  INT32_C(    41653131), -INT32_C(  1759142421),  INT32_C(   450289090) },
      { -INT32_C(   329569287),  INT32_C(           0),  INT32_C(  2133091371),  INT32_C(  1341000043) } },
    { UINT8_C(147),
      {  INT32_C(   707170735),  INT32_C(  1797496783), -INT32_C(  1868515401), -INT32_C(  1339385959) },
      {  INT32_C(   339456385), -INT32_C(   922731220),  INT32_C(  1066178402),  INT32_C(   500409966) },
      {  INT32_C(   122157367),  INT32_C(  1349675673), -INT32_C(  1142943199),  INT32_C(   728435370) },
      {  INT32_C(  2002977364), -INT32_C(  2145479115),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C(187),
      { -INT32_C(   454541146), -INT32_C(   683232960), -INT32_C(   481982915),  INT32_C(  1377526361) },
      {  INT32_C(   334176937), -INT32_C(  1506460780),  INT32_C(   642838556),  INT32_C(    31620187) },
      { -INT32_C(    52049220), -INT32_C(  1177342853),  INT32_C(   194779570),  INT32_C(   626898811) },
      {  INT32_C(  1051863710), -INT32_C(   962104678),  INT32_C(           0),  INT32_C(  1011845994) } },
    { UINT8_C(217),
      { -INT32_C(  2073216951),  INT32_C(  1570772077), -INT32_C(   524761244),  INT32_C(  1939651241) },
      { -INT32_C(   873555809), -INT32_C(  2055362708), -INT32_C(    83851196),  INT32_C(   802498022) },
      { -INT32_C(   877444514), -INT32_C(  1154919338), -INT32_C(   996417253),  INT32_C(   993474715) },
      {  INT32_C(   800744062),  INT32_C(           0),  INT32_C(           0), -INT32_C(    89867058) } },
    { UINT8_C(208),
      { -INT32_C(   851704283),  INT32_C(   202490244), -INT32_C(   403567422),  INT32_C(   608510433) },
      {  INT32_C(   695865813),  INT32_C(   457454906),  INT32_C(   162990289),  INT32_C(  1692004927) },
      {  INT32_C(  2083591928), -INT32_C(  1719057705),  INT32_C(   813792079),  INT32_C(  1918158493) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m128i a  = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b  = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c  = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r  = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_maskz_shrdv_epi32(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_maskz_shrdv_epi32");
    easysimd_assert_m128i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128i a = easysimd_test_x86_random_i32x4();
    easysimd__m128i b = easysimd_test_x86_random_i32x4();
    easysimd__m128i c = easysimd_test_x86_random_i32x4();
    easysimd__m128i r = easysimd_mm_maskz_shrdv_epi32(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm_maskz_shrdv_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int64_t a[2];
    int64_t b[2];
    int64_t c[2];
    int64_t r[2];
  } test_vec[8] = {
    { UINT8_C(180),
      {  INT64_C( 3743416236899332285), -INT64_C( 5469598934043250531) },
      {  INT64_C( 5248932098172091105),  INT64_C( 3486216513146045288) },
      {  INT64_C( 1685764055951094263), -INT64_C( 2761593907648142279) },
      {  INT64_C(                   0),  INT64_C(                   0) } },
    { UINT8_C( 82),
      {  INT64_C( 6753580412100002653), -INT64_C(  562105772300867916) },
      { -INT64_C( 5811742718422784747),  INT64_C( 6517977484903272521) },
      { -INT64_C(  920030378168961724),  INT64_C( 2272735659991894731) },
      {  INT64_C(                   0),  INT64_C(  666258279141702124) } },
    { UINT8_C(246),
      { -INT64_C( 3307459453322064557), -INT64_C( 3993503651602107036) },
      { -INT64_C( 5983997383925931534),  INT64_C( 2429199206221730899) },
      {  INT64_C( 7009248073369022796),  INT64_C( 8659669495201025230) },
      {  INT64_C(                   0),  INT64_C( 5858939371089654815) } },
    { UINT8_C(180),
      { -INT64_C( 4950170776204873113),  INT64_C( 3783774388059966710) },
      { -INT64_C( 8713742649587075734),  INT64_C(  889326393585661776) },
      { -INT64_C( 8279494534656286345), -INT64_C( 5307978917506473377) },
      {  INT64_C(                   0),  INT64_C(                   0) } },
   { UINT8_C(228),
      { -INT64_C( 7893759278955705864), -INT64_C( 6619622714170759912) },
      {  INT64_C( 5466777531548911390), -INT64_C( 8341299195726432183) },
      {  INT64_C( 8637405316310868873),  INT64_C( 1925659359294954719) },
      {  INT64_C(                   0),  INT64_C(                   0) } },
    { UINT8_C( 56),
      {  INT64_C(  749303855057662170),  INT64_C( 5281546170770182652) },
      {  INT64_C( 9044782914321378384), -INT64_C( 1218661210926593245) },
      { -INT64_C( 6102602142197112734),  INT64_C(  400929997069017860) },
      {  INT64_C(                   0),  INT64_C(                   0) } },
    { UINT8_C( 80),
      {  INT64_C( 8997893201921813301),  INT64_C( 8282543931062926364) },
      {  INT64_C( 7531933400121292366), -INT64_C( 7811174294643421723) },
      {  INT64_C( 1836111842016890062), -INT64_C( 2509179475256144407) },
      {  INT64_C(                   0),  INT64_C(                   0) } },
    { UINT8_C(208),
      { -INT64_C( 5547944469945032882), -INT64_C( 1167939854255699238) },
      {  INT64_C( 5910981404881897970),  INT64_C( 4546594862566327214) },
      {  INT64_C(  340122007886261534),  INT64_C( 6879472102102124965) },
      {  INT64_C(                   0),  INT64_C(                   0) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m128i a  = easysimd_mm_loadu_si128(test_vec[i].a);
    easysimd__m128i b  = easysimd_mm_loadu_si128(test_vec[i].b);
    easysimd__m128i c  = easysimd_mm_loadu_si128(test_vec[i].c);
    easysimd__m128i r  = easysimd_mm_loadu_si128(test_vec[i].r);
    easysimd__m128i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm_maskz_shrdv_epi64(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm_maskz_shrdv_epi64");
    easysimd_assert_m128i_i64(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m128i a = easysimd_test_x86_random_i64x2();
    easysimd__m128i b = easysimd_test_x86_random_i64x2();
    easysimd__m128i c = easysimd_test_x86_random_i64x2();
    easysimd__m128i r = easysimd_mm_maskz_shrdv_epi64(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x2(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x2(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x2(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x2(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_shrdv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask16 k;
    int16_t a[16];
    int16_t b[16];
    int16_t c[16];
    int16_t r[16];
  } test_vec[16] = {
    { UINT16_C(62685),
      {  INT16_C( 11252),  INT16_C(  8885), -INT16_C( 20518),  INT16_C(  8502), -INT16_C( 27159), -INT16_C( 22188),  INT16_C(  4789),  INT16_C( 30630),
         INT16_C( 10176), -INT16_C( 29787), -INT16_C( 31786),  INT16_C( 20096),  INT16_C(  7493),  INT16_C( 14659),  INT16_C(  8352), -INT16_C( 27347) },
      { -INT16_C(  7605),  INT16_C(  9655), -INT16_C(  4718),  INT16_C( 31558), -INT16_C( 25726),  INT16_C( 14117), -INT16_C( 13395),  INT16_C( 28078),
         INT16_C( 21490), -INT16_C( 14088),  INT16_C( 31191),  INT16_C(  7190),  INT16_C( 22934),  INT16_C( 13909), -INT16_C( 32135), -INT16_C( 15157) },
      { -INT16_C( 32155), -INT16_C(  2070),  INT16_C( 12399), -INT16_C(  3470), -INT16_C( 26677),  INT16_C( 30761), -INT16_C( 10142),  INT16_C( 21733),
        -INT16_C(  8661),  INT16_C(   540),  INT16_C( 12887), -INT16_C(  4833),  INT16_C( 29835),  INT16_C(  1059), -INT16_C(  4105),  INT16_C( 23753) },
      {  INT16_C( 22879),  INT16_C(     0), -INT16_C(  9435), -INT16_C( 30643),  INT16_C( 28754),  INT16_C(     0),  INT16_C( 17581),  INT16_C( 29629),
         INT16_C(     0),  INT16_C(     0), -INT16_C( 20729),  INT16_C(     0),  INT16_C( 12995), -INT16_C( 22744), -INT16_C(  3519),  INT16_C( 26058) } },
    { UINT16_C(45937),
      { -INT16_C(  7853), -INT16_C( 14877), -INT16_C( 20525), -INT16_C(   931), -INT16_C( 16601),  INT16_C(  3540),  INT16_C(    20),  INT16_C( 12523),
         INT16_C( 16898),  INT16_C(  8547), -INT16_C(  4561),  INT16_C( 21142), -INT16_C( 29197), -INT16_C( 17343), -INT16_C( 19479),  INT16_C( 15471) },
      {  INT16_C( 21140),  INT16_C( 26369),  INT16_C( 24065),  INT16_C( 10595),  INT16_C( 14366),  INT16_C( 12854),  INT16_C(  8504),  INT16_C( 14946),
        -INT16_C( 15005), -INT16_C( 28068), -INT16_C(  3404), -INT16_C( 22556),  INT16_C(  9855),  INT16_C( 26723), -INT16_C( 11559),  INT16_C( 28068) },
      { -INT16_C( 23260),  INT16_C(  9940),  INT16_C( 14084),  INT16_C(  8783), -INT16_C( 31377), -INT16_C( 22700), -INT16_C( 18778),  INT16_C(  2530),
         INT16_C( 15996),  INT16_C( 12443),  INT16_C( 32560), -INT16_C( 20521),  INT16_C( 15013),  INT16_C( 32279), -INT16_C( 17652),  INT16_C( 12523) },
      {  INT16_C( 19989),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 28733),  INT16_C( 24797), -INT16_C(  8192),  INT16_C(     0),
         INT16_C( 22068),  INT16_C( 19332),  INT16_C(     0),  INT16_C(     0), -INT16_C(   913), -INT16_C( 14472),  INT16_C(     0), -INT16_C( 19321) } },
    { UINT16_C(48992),
      {  INT16_C( 25686), -INT16_C( 23049),  INT16_C( 26246), -INT16_C(  9686), -INT16_C( 12274), -INT16_C(  3951),  INT16_C(  3545),  INT16_C( 29742),
         INT16_C( 24125),  INT16_C(  5364), -INT16_C( 26355),  INT16_C(  9294),  INT16_C( 23064),  INT16_C(   991),  INT16_C( 16266), -INT16_C(  7741) },
      { -INT16_C( 17756),  INT16_C( 10886), -INT16_C( 20192),  INT16_C( 11781), -INT16_C( 27007),  INT16_C( 23326),  INT16_C( 19619), -INT16_C(  7985),
        -INT16_C( 15446), -INT16_C( 18444),  INT16_C( 16989),  INT16_C( 30171), -INT16_C( 17764),  INT16_C(  9848),  INT16_C( 15354), -INT16_C( 25081) },
      { -INT16_C( 28939),  INT16_C(  5832), -INT16_C( 12993), -INT16_C( 16316),  INT16_C( 25443),  INT16_C(  1563), -INT16_C(  5201),  INT16_C( 23270),
        -INT16_C(  9554),  INT16_C(  2833), -INT16_C(  4836), -INT16_C( 18304), -INT16_C(  1625), -INT16_C( 24097), -INT16_C(  6604),  INT16_C( 10815) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 25566), -INT16_C( 26298),  INT16_C(     0),
         INT16_C(  3753),  INT16_C(  2682),  INT16_C(  9689),  INT16_C(  9294),  INT16_C( 14516),  INT16_C( 19696),  INT16_C(     0),  INT16_C( 15375) } },
    { UINT16_C( 2164),
      { -INT16_C( 19648), -INT16_C( 31531),  INT16_C( 14708), -INT16_C( 28697), -INT16_C( 26817),  INT16_C(  9850),  INT16_C( 10737),  INT16_C(   512),
         INT16_C(  7476), -INT16_C( 18961), -INT16_C( 26667), -INT16_C( 19282), -INT16_C(  7624),  INT16_C( 30875),  INT16_C(  3852),  INT16_C( 19584) },
      {  INT16_C( 21955),  INT16_C( 14289), -INT16_C( 18290), -INT16_C( 12602),  INT16_C( 16719),  INT16_C( 16628), -INT16_C(  2966), -INT16_C( 25021),
         INT16_C( 12817), -INT16_C(  6317),  INT16_C(   457),  INT16_C(   667),  INT16_C( 14052), -INT16_C(  3974), -INT16_C(  1466),  INT16_C(  2365) },
      {  INT16_C(  3663), -INT16_C(  8640),  INT16_C(  1734),  INT16_C(  5804), -INT16_C( 24505), -INT16_C( 20138), -INT16_C( 26220), -INT16_C( 22960),
        -INT16_C( 23604), -INT16_C( 27251),  INT16_C( 10405), -INT16_C( 30313),  INT16_C(  4447), -INT16_C( 23175), -INT16_C( 18933),  INT16_C( 23470) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C( 14565),  INT16_C(     0), -INT16_C( 24786), -INT16_C( 12135), -INT16_C( 23905),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 14185),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C(61124),
      { -INT16_C( 29895), -INT16_C(  6668),  INT16_C( 15521), -INT16_C(  2171),  INT16_C(  6637),  INT16_C( 15761),  INT16_C( 23999),  INT16_C( 19681),
        -INT16_C( 30990), -INT16_C( 30091), -INT16_C( 11249), -INT16_C( 30565), -INT16_C( 22663),  INT16_C( 10047),  INT16_C(   770),  INT16_C( 15125) },
      {  INT16_C(  2446),  INT16_C( 12064), -INT16_C( 23227),  INT16_C( 13095), -INT16_C( 18242),  INT16_C( 32368),  INT16_C( 20757),  INT16_C(  1994),
         INT16_C( 16343), -INT16_C(  6511),  INT16_C( 11539), -INT16_C( 29585), -INT16_C( 20780), -INT16_C( 10573), -INT16_C( 14159),  INT16_C( 16401) },
      {  INT16_C( 12754),  INT16_C(  5999), -INT16_C( 26922), -INT16_C( 27574), -INT16_C( 17586),  INT16_C( 25362), -INT16_C(  8948), -INT16_C(  7061),
        -INT16_C(   996),  INT16_C( 12490),  INT16_C( 14633), -INT16_C(   580),  INT16_C( 28903), -INT16_C( 26157), -INT16_C(  7112),  INT16_C(  2777) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(  5362),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  4437), -INT16_C(  1719),
         INT16_C(     0), -INT16_C( 23454), -INT16_C( 30230), -INT16_C( 14600),  INT16_C(     0),  INT16_C( 25831), -INT16_C( 20221),  INT16_C(  2205) } },
    { UINT16_C(18453),
      { -INT16_C(  5342),  INT16_C( 27871),  INT16_C( 11648), -INT16_C( 28121),  INT16_C( 13457), -INT16_C(   913), -INT16_C( 29672), -INT16_C(  7432),
         INT16_C(  8892),  INT16_C( 30748),  INT16_C(   799), -INT16_C(  3096),  INT16_C(  8604),  INT16_C( 30167), -INT16_C(  4821),  INT16_C( 19902) },
      { -INT16_C( 25128),  INT16_C( 22714), -INT16_C(  7734),  INT16_C( 23531),  INT16_C( 23061),  INT16_C( 11607),  INT16_C( 20710), -INT16_C( 24048),
         INT16_C( 11378), -INT16_C( 28389),  INT16_C(   815), -INT16_C( 13180),  INT16_C( 23588),  INT16_C( 20545), -INT16_C(   183),  INT16_C(  8605) },
      {  INT16_C( 22428),  INT16_C( 26490),  INT16_C( 25913),  INT16_C( 20162),  INT16_C(  6847), -INT16_C( 22916), -INT16_C( 29590), -INT16_C(  9144),
         INT16_C( 25528), -INT16_C(  6291), -INT16_C(  3481), -INT16_C( 29773), -INT16_C(  2738), -INT16_C( 26661),  INT16_C( 31220), -INT16_C( 28232) },
      { -INT16_C(  8818),  INT16_C(     0), -INT16_C(  6890),  INT16_C(     0), -INT16_C( 19414),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 24963),  INT16_C(     0),  INT16_C(     0), -INT16_C( 24878),  INT16_C(     0) } },
    { UINT16_C(13008),
      {  INT16_C(  2552), -INT16_C( 17769),  INT16_C( 22360), -INT16_C( 11052),  INT16_C( 16125),  INT16_C( 17760),  INT16_C(  6170), -INT16_C( 30551),
         INT16_C(  4351), -INT16_C( 19590), -INT16_C( 14181),  INT16_C( 30632), -INT16_C( 25505),  INT16_C(  6128), -INT16_C( 16339),  INT16_C(  9546) },
      { -INT16_C(  7734),  INT16_C(  8928), -INT16_C( 19400),  INT16_C( 13814),  INT16_C( 22259),  INT16_C(  3451),  INT16_C(  9326),  INT16_C( 28053),
         INT16_C(  3892), -INT16_C( 12512), -INT16_C( 14121),  INT16_C( 13894),  INT16_C( 13925), -INT16_C( 28082), -INT16_C( 26377), -INT16_C( 15944) },
      { -INT16_C( 26503), -INT16_C( 19741), -INT16_C(  9908),  INT16_C( 16359),  INT16_C( 25135), -INT16_C( 25267), -INT16_C(  7546), -INT16_C( 17910),
         INT16_C( 11250), -INT16_C( 13942), -INT16_C( 12045),  INT16_C( 22528),  INT16_C( 19975), -INT16_C(   277), -INT16_C( 23578),  INT16_C( 24511) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 21018),  INT16_C(     0), -INT16_C( 18336),  INT16_C( 25954),
         INT16_C(     0), -INT16_C( 14292),  INT16_C(     0),  INT16_C(     0), -INT16_C( 13512),  INT16_C( 18882),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C(41531),
      { -INT16_C( 30959), -INT16_C(  1669), -INT16_C( 21817),  INT16_C(  5211), -INT16_C(  7609),  INT16_C( 20982), -INT16_C(  5988),  INT16_C(  9852),
         INT16_C( 28850), -INT16_C( 19721), -INT16_C(   312), -INT16_C( 19712), -INT16_C(  6404), -INT16_C( 17578), -INT16_C( 28347),  INT16_C( 22365) },
      { -INT16_C( 10215), -INT16_C(  8112), -INT16_C( 21630), -INT16_C( 13836), -INT16_C(  5491),  INT16_C( 10778), -INT16_C( 26669), -INT16_C( 31408),
         INT16_C( 18183), -INT16_C( 12489),  INT16_C( 14149),  INT16_C( 16771), -INT16_C(  9955),  INT16_C( 25340),  INT16_C( 22891), -INT16_C( 31559) },
      {  INT16_C(  2353), -INT16_C( 19612),  INT16_C( 22709),  INT16_C( 17020), -INT16_C( 26814),  INT16_C(  5484), -INT16_C( 17106),  INT16_C( 13722),
        -INT16_C( 12028),  INT16_C( 18948), -INT16_C( 30968),  INT16_C(  9611), -INT16_C( 30623), -INT16_C( 13176),  INT16_C( 16865),  INT16_C(  4944) },
      { -INT16_C( 15480),  INT16_C(  3991),  INT16_C(     0), -INT16_C( 24767),  INT16_C( 30865), -INT16_C( 24155),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C( 31535),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(   837),  INT16_C(     0),  INT16_C( 22365) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask16 k = test_vec[i].k;
    easysimd__m256i a  = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b  = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c  = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r  = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_maskz_shrdv_epi16(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_maskz_shrdv_epi16");
    easysimd_assert_m256i_i16(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m256i a = easysimd_test_x86_random_i16x16();
    easysimd__m256i b = easysimd_test_x86_random_i16x16();
    easysimd__m256i c = easysimd_test_x86_random_i16x16();
    easysimd__m256i r = easysimd_mm256_maskz_shrdv_epi16(k, a, b, c);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_shrdv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int32_t a[8];
    int32_t b[8];
    int32_t c[8];
    int32_t r[8];
  } test_vec[8] = {
    { UINT8_C( 37),
      { -INT32_C(  1523125754),  INT32_C(  1638115174), -INT32_C(   644431684),  INT32_C(  1076161513), -INT32_C(  1382733304), -INT32_C(   441475899),  INT32_C(   472765531), -INT32_C(  1790841714) },
      {  INT32_C(  1144682462), -INT32_C(   626598626), -INT32_C(  2018296675),  INT32_C(   818403112), -INT32_C(   941794302),  INT32_C(  1420594424), -INT32_C(   277816992), -INT32_C(  1534807610) },
      {  INT32_C(  1189723688),  INT32_C(   958435228), -INT32_C(   205466677), -INT32_C(  1406957654), -INT32_C(   596442908), -INT32_C(   315613044), -INT32_C(  1076059911),  INT32_C(  2036621393) },
      { -INT32_C(   559597838),  INT32_C(           0), -INT32_C(  1816448296),  INT32_C(           0),  INT32_C(           0), -INT32_C(   812754183),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C( 30),
      { -INT32_C(   591741107), -INT32_C(  1297615649),  INT32_C(  1012767668), -INT32_C(  1088419394), -INT32_C(  1655964547), -INT32_C(   845793235),  INT32_C(  1948210708),  INT32_C(   127113402) },
      {  INT32_C(   937643352), -INT32_C(   152401343), -INT32_C(   466467035), -INT32_C(   844934576),  INT32_C(  2070605390),  INT32_C(   994640167),  INT32_C(   296773719),  INT32_C(  1477985024) },
      { -INT32_C(   762250352), -INT32_C(  1412924795),  INT32_C(   294648513), -INT32_C(  1696648628),  INT32_C(  1192642848), -INT32_C(  1585225910), -INT32_C(   944622649),  INT32_C(   102812278) },
      {  INT32_C(           0),  INT32_C(   227884966), -INT32_C(  1641099814),  INT32_C(   621539840), -INT32_C(  1655964547),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C(197),
      {  INT32_C(   709613744), -INT32_C(  1695811936), -INT32_C(  1209598843),  INT32_C(   634880475), -INT32_C(   160489577), -INT32_C(   709029470), -INT32_C(  1907653437),  INT32_C(  1414746532) },
      { -INT32_C(   897671638),  INT32_C(   426076564),  INT32_C(  1104169830),  INT32_C(  1667672268),  INT32_C(  1767495367), -INT32_C(  1438771481),  INT32_C(  1060669851),  INT32_C(    76844250) },
      { -INT32_C(  1076948438), -INT32_C(   489147268),  INT32_C(  1277405567),  INT32_C(   414157393),  INT32_C(  1199638880), -INT32_C(  1158562017),  INT32_C(   586820168), -INT32_C(   534278474) },
      { -INT32_C(  1970629898),  INT32_C(           0), -INT32_C(  2086627635),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1685173372),  INT32_C(  1379101009) } },
    { UINT8_C(160),
      {  INT32_C(   706519030),  INT32_C(   564788856), -INT32_C(  1401752286), -INT32_C(  1374909787), -INT32_C(   892513525),  INT32_C(  1846708292),  INT32_C(   270808194),  INT32_C(  1370490203) },
      {  INT32_C(   477875620), -INT32_C(   314759733), -INT32_C(  1080447206),  INT32_C(  1148036409),  INT32_C(  1024343032),  INT32_C(  1168842947), -INT32_C(  1336553387),  INT32_C(  2030175701) },
      { -INT32_C(  1634304558), -INT32_C(  1114909790), -INT32_C(  1132714621), -INT32_C(  1023284534), -INT32_C(   402649307), -INT32_C(  2060604624),  INT32_C(  1345684091),  INT32_C(  1523201927) },
      {  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(   549678610),  INT32_C(           0), -INT32_C(  1432133622) } },
    { UINT8_C(181),
      {  INT32_C(   861403232), -INT32_C(  1464462205),  INT32_C(  2071163793), -INT32_C(  2086652300), -INT32_C(   508327882),  INT32_C(   928856245), -INT32_C(  1514230418), -INT32_C(   681961353) },
      { -INT32_C(  1811172848),  INT32_C(  1463599558), -INT32_C(  1462587596),  INT32_C(   455897829), -INT32_C(  1342316550), -INT32_C(  2031724008),  INT32_C(  2133566727), -INT32_C(   833190211) },
      { -INT32_C(    27107016),  INT32_C(  1465294371),  INT32_C(   855648334), -INT32_C(  1789973349),  INT32_C(   591744011), -INT32_C(  1381422170), -INT32_C(  1909664304), -INT32_C(  1822653605) },
      {  INT32_C(   196218931),  INT32_C(           0), -INT32_C(  1127092787),  INT32_C(           0), -INT32_C(    10733967),  INT32_C(  1625126114),  INT32_C(           0), -INT32_C(   892282950) } },
    { UINT8_C(228),
      {  INT32_C(  1543999934),  INT32_C(   279601127), -INT32_C(  1951670689),  INT32_C(  2039889965), -INT32_C(  1323320699),  INT32_C(   948030563),  INT32_C(  2090012665),  INT32_C(   694167147) },
      { -INT32_C(  1618581320),  INT32_C(   649015495),  INT32_C(  1001478670),  INT32_C(   548685723),  INT32_C(  1708249857), -INT32_C(  1717742688), -INT32_C(   837471902),  INT32_C(   267875671) },
      { -INT32_C(  1532002851), -INT32_C(  1127588178),  INT32_C(  1425570745), -INT32_C(   998986557),  INT32_C(   539575936), -INT32_C(    71710823),  INT32_C(  1338625784),  INT32_C(   559923523) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(   659749051),  INT32_C(           0),  INT32_C(           0), -INT32_C(   827731940),  INT32_C(   355558012), -INT32_C(   450100019) } },
    { UINT8_C( 62),
      {  INT32_C(  1827456270),  INT32_C(   187017616),  INT32_C(  1305377185),  INT32_C(   885887982), -INT32_C(  2083656260),  INT32_C(  1954269350),  INT32_C(  1404619666),  INT32_C(   949082410) },
      {  INT32_C(   782532254), -INT32_C(   935671257),  INT32_C(   823461955),  INT32_C(  1483072411),  INT32_C(  2010854096), -INT32_C(  1913956357),  INT32_C(  1289790242),  INT32_C(   461664636) },
      {  INT32_C(   373893359),  INT32_C(   920552434),  INT32_C(   661124236), -INT32_C(  1484796457), -INT32_C(    98673665), -INT32_C(   729347406),  INT32_C(   706766765), -INT32_C(   934959911) },
      {  INT32_C(           0), -INT32_C(  1299594551), -INT32_C(  2076910361), -INT32_C(   876136855), -INT32_C(   273259103), -INT32_C(   704717538),  INT32_C(           0),  INT32_C(           0) } },
    { UINT8_C(204),
      {  INT32_C(   314564494), -INT32_C(  1314982467),  INT32_C(   696829276), -INT32_C(  1607913403),  INT32_C(  1481777998),  INT32_C(   302393003), -INT32_C(   353685434),  INT32_C(    62305397) },
      {  INT32_C(  1343583635), -INT32_C(   956124310), -INT32_C(  1091532167),  INT32_C(   157161914), -INT32_C(   396251075),  INT32_C(   486172630),  INT32_C(   201778839),  INT32_C(   756071578) },
      { -INT32_C(  1669520078),  INT32_C(  1382252505), -INT32_C(  1005562870), -INT32_C(  1429377427), -INT32_C(   191746274),  INT32_C(   772836758),  INT32_C(   221910643),  INT32_C(    70929106) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(  1639292367), -INT32_C(   841678519),  INT32_C(           0),  INT32_C(           0), -INT32_C(   590152355),  INT32_C(   791052525) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m256i a  = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b  = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c  = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r  = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_maskz_shrdv_epi32(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_maskz_shrdv_epi32");
    easysimd_assert_m256i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256i a = easysimd_test_x86_random_i32x8();
    easysimd__m256i b = easysimd_test_x86_random_i32x8();
    easysimd__m256i c = easysimd_test_x86_random_i32x8();
    easysimd__m256i r = easysimd_mm256_maskz_shrdv_epi32(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_maskz_shrdv_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int64_t a[4];
    int64_t b[4];
    int64_t c[4];
    int64_t r[4];
  } test_vec[8] = {
    { UINT8_C( 48),
      {  INT64_C( 9122629112936194767), -INT64_C( 8931073022507503848), -INT64_C( 3845771639359828707), -INT64_C( 4926301459088638327) },
      {  INT64_C(  178882755011662884),  INT64_C( 7647032236233578547),  INT64_C( 7647086746794380868),  INT64_C(  940547437772973926) },
      { -INT64_C( 5891124502514174382), -INT64_C( 2083645321429588131), -INT64_C( 6232884839121921227),  INT64_C( 3239786718261107967) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0) } },
     { UINT8_C( 11),
      {  INT64_C( 3473854748999088912), -INT64_C( 6085541433107240204),  INT64_C( 8624562813362264029),  INT64_C( 6818573318646324427) },
      { -INT64_C( 7702914989806779285),  INT64_C( 9179257030697472617),  INT64_C( 5279135201062085532), -INT64_C(  231515842299485923) },
      {  INT64_C( 8914874440763134850),  INT64_C( 6049064063679558097), -INT64_C( 2215380943573646470),  INT64_C( 2166537755353227139) },
      { -INT64_C( 3743222331177615676),  INT64_C( 7580919118751568604),  INT64_C(                   0), -INT64_C( 6065207362810291303) } },
    { UINT8_C(105),
      {  INT64_C( 7694108562539889142), -INT64_C( 5819930357878671062), -INT64_C( 7747787343314865004), -INT64_C( 7628728746380259679) },
      { -INT64_C( 4759369587579183728),  INT64_C( 2046528177043281035), -INT64_C( 3460861083263968786),  INT64_C(  671504155462281499) },
      { -INT64_C( 5001382424906376122), -INT64_C( 4810168967854221927), -INT64_C(  455116592324193871),  INT64_C( 2721025058330129986) },
      {  INT64_C( 4731906464717073671),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 1907182186595064920) } },
    { UINT8_C(226),
      { -INT64_C( 6092303121649696939),  INT64_C( 2649586435010303292), -INT64_C( 8451854260558977703), -INT64_C( 8604251115113254992) },
      { -INT64_C( 5849940130229213042), -INT64_C( 2494281146334819477),  INT64_C( 1083964943550604333), -INT64_C( 7841510196856392333) },
      { -INT64_C( 3376142371967692796), -INT64_C( 7119221858648463149), -INT64_C(  413159605139504171),  INT64_C( 7653811928176724383) },
      {  INT64_C(                   0),  INT64_C( 5290995744031531663),  INT64_C(                   0),  INT64_C(                   0) } },
    { UINT8_C(106),
      {  INT64_C( 8590110073833984323),  INT64_C( 8069059442035724296), -INT64_C( 1791631529222250690), -INT64_C( 8932740049765691553) },
      { -INT64_C( 6581370268763002470),  INT64_C(  258168375974803287),  INT64_C( 2167641815797261969),  INT64_C(  528825982228685970) },
      {  INT64_C(  319444058663184173),  INT64_C( 7522349308879545755), -INT64_C( 2844959646222498649),  INT64_C( 3676064321083490704) },
      {  INT64_C(                   0), -INT64_C( 4109839302016247310),  INT64_C(                   0), -INT64_C( 1976372114281685297) } },
    { UINT8_C(196),
      {  INT64_C( 1427200806624630672),  INT64_C( 8384796436037255877),  INT64_C( 1228015413011615799),  INT64_C( 3301238157422340328) },
      {  INT64_C(  510993914507613042),  INT64_C(  797277685173849516),  INT64_C(  370451980534043535),  INT64_C( 1193420496642851781) },
      {  INT64_C( 4827343777978133428),  INT64_C( 3393724690401730872),  INT64_C(  892949983341390402),  INT64_C(  889458002731366057) },
      {  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 4304682165174483955),  INT64_C(                   0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m256i a  = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__m256i b  = easysimd_mm256_loadu_si256(test_vec[i].b);
    easysimd__m256i c  = easysimd_mm256_loadu_si256(test_vec[i].c);
    easysimd__m256i r  = easysimd_mm256_loadu_si256(test_vec[i].r);
    easysimd__m256i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm256_maskz_shrdv_epi64(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm256_maskz_shrdv_epi64");
    easysimd_assert_m256i_i64(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m256i a = easysimd_test_x86_random_i64x4();
    easysimd__m256i b = easysimd_test_x86_random_i64x4();
    easysimd__m256i c = easysimd_test_x86_random_i64x4();
    easysimd__m256i r = easysimd_mm256_maskz_shrdv_epi64(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x4(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x4(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x4(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x4(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_shrdv_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask32 k;
    int16_t a[32];
    int16_t b[32];
    int16_t c[32];
    int16_t r[32];
  } test_vec[] = {
    { UINT32_C( 816759258),
      {  INT16_C(  7550), -INT16_C( 25630),  INT16_C(  6670), -INT16_C( 32422), -INT16_C(  9047),  INT16_C( 18961),  INT16_C( 32524),  INT16_C( 29896),
        -INT16_C( 13069), -INT16_C( 11113), -INT16_C( 10687),  INT16_C( 15150),  INT16_C( 21911),  INT16_C( 29099),  INT16_C( 23062), -INT16_C( 27231),
        -INT16_C( 31881), -INT16_C( 31440), -INT16_C( 30051),  INT16_C( 17926),  INT16_C(  6246),  INT16_C( 29328),  INT16_C( 22679), -INT16_C( 29977),
         INT16_C( 32293),  INT16_C( 26206), -INT16_C( 29356), -INT16_C(  5215),  INT16_C( 19938), -INT16_C(  1700), -INT16_C(   601),  INT16_C(  7822) },
      { -INT16_C( 16768),  INT16_C(  7587), -INT16_C( 22200), -INT16_C( 20637), -INT16_C(  3135),  INT16_C( 22817),  INT16_C(  2124),  INT16_C( 29155),
         INT16_C( 17030), -INT16_C(  9513),  INT16_C( 30927), -INT16_C( 20027),  INT16_C(  8645),  INT16_C( 27818),  INT16_C( 14366), -INT16_C( 24950),
         INT16_C( 11766),  INT16_C( 16315),  INT16_C(  7895), -INT16_C( 26386),  INT16_C(  3858),  INT16_C( 24305), -INT16_C( 10984), -INT16_C( 24881),
        -INT16_C( 23017), -INT16_C(  6535),  INT16_C( 15902), -INT16_C(  7017),  INT16_C( 16992),  INT16_C( 32336), -INT16_C(  9350),  INT16_C( 28957) },
      { -INT16_C( 10232), -INT16_C(  8272), -INT16_C( 24841),  INT16_C(  2424),  INT16_C( 27053), -INT16_C( 15001),  INT16_C( 13886),  INT16_C( 21860),
        -INT16_C(  8740), -INT16_C(  1477), -INT16_C( 11493),  INT16_C( 31710),  INT16_C( 12053), -INT16_C( 28678),  INT16_C(  5898),  INT16_C(  4608),
        -INT16_C( 20241), -INT16_C(  6414),  INT16_C( 27214), -INT16_C(   785),  INT16_C( 22227),  INT16_C(  4801),  INT16_C(  9612),  INT16_C( 26727),
        -INT16_C( 23806),  INT16_C(  7779),  INT16_C( 16758), -INT16_C( 29799), -INT16_C( 27792),  INT16_C( 31258),  INT16_C(  7082), -INT16_C( 25971) },
      {  INT16_C(     0), -INT16_C( 25630),  INT16_C(     0),  INT16_C( 25473), -INT16_C( 25074),  INT16_C(     0),  INT16_C(  8497),  INT16_C( 14156),
         INT16_C( 10348),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  1942), -INT16_C( 27231),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C( 444628939),
      {  INT16_C( 28905), -INT16_C( 17386), -INT16_C( 10298),  INT16_C( 21454),  INT16_C( 14077), -INT16_C(    69),  INT16_C(  7897),  INT16_C( 20253),
        -INT16_C( 18592), -INT16_C( 12070), -INT16_C(  2998), -INT16_C(  2741), -INT16_C( 10225), -INT16_C(  9329),  INT16_C(  3927),  INT16_C( 16629),
         INT16_C(  2943),  INT16_C( 18172), -INT16_C( 13342), -INT16_C(  8295),  INT16_C( 21505), -INT16_C(  9505), -INT16_C(   909), -INT16_C( 11479),
         INT16_C(   947), -INT16_C(   349), -INT16_C(  4361),  INT16_C(  2035), -INT16_C( 32058),  INT16_C(  7650), -INT16_C( 10351),  INT16_C(  4445) },
      {  INT16_C( 23266), -INT16_C( 15273), -INT16_C(  4059),  INT16_C(  9892), -INT16_C( 31932), -INT16_C( 18688),  INT16_C( 10623),  INT16_C( 13194),
         INT16_C( 11820),  INT16_C(  9009),  INT16_C(  9244), -INT16_C(  7382),  INT16_C(  3238),  INT16_C( 14080),  INT16_C( 24291), -INT16_C( 15032),
        -INT16_C( 24648), -INT16_C(  8822),  INT16_C( 11919), -INT16_C( 11261),  INT16_C(   945),  INT16_C( 12427),  INT16_C(  5676),  INT16_C( 22627),
        -INT16_C( 27580),  INT16_C( 24699), -INT16_C( 22856),  INT16_C( 24131),  INT16_C( 17586), -INT16_C( 26986), -INT16_C(  8542),  INT16_C( 23131) },
      { -INT16_C(  6786),  INT16_C(  3383),  INT16_C( 14867), -INT16_C( 15135),  INT16_C( 27965),  INT16_C( 27125),  INT16_C( 22659), -INT16_C( 14399),
         INT16_C( 15597), -INT16_C( 23257),  INT16_C( 27618), -INT16_C( 27388), -INT16_C( 25937),  INT16_C( 20779), -INT16_C( 31112), -INT16_C(  2389),
        -INT16_C(  7572),  INT16_C( 32516), -INT16_C(  6884),  INT16_C( 22852),  INT16_C( 14674), -INT16_C( 10814), -INT16_C( 31855),  INT16_C( 32412),
        -INT16_C( 15169), -INT16_C( 24028),  INT16_C( 10287), -INT16_C(  8649),  INT16_C( 25282),  INT16_C( 14895), -INT16_C(  9496),  INT16_C( 21553) },
      {  INT16_C( 27529), -INT16_C( 20616),  INT16_C(     0),  INT16_C( 10727),  INT16_C(     0),  INT16_C(     0), -INT16_C(  7205),  INT16_C( 10126),
         INT16_C( 29029),  INT16_C( 25505),  INT16_C( 15634), -INT16_C( 20652),  INT16_C(  6477), -INT16_C(  8165), -INT16_C(  7409),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(3637786044),
      {  INT16_C(  6170),  INT16_C( 27953), -INT16_C(  3247), -INT16_C(  7614), -INT16_C(  8330),  INT16_C( 13665), -INT16_C( 31325), -INT16_C( 11561),
         INT16_C(  3757),  INT16_C( 28592), -INT16_C(  8336),  INT16_C( 22953), -INT16_C(  9543),  INT16_C( 30125), -INT16_C( 32497),  INT16_C( 10829),
         INT16_C( 32409), -INT16_C(  5481), -INT16_C(  9871), -INT16_C(  6195),  INT16_C( 11960),  INT16_C( 23324), -INT16_C(  2893),  INT16_C( 24621),
        -INT16_C(  8958),  INT16_C( 29647),  INT16_C( 30908),  INT16_C( 30156),  INT16_C( 31059),  INT16_C( 25322),  INT16_C( 14331), -INT16_C( 27508) },
      {  INT16_C(  9141),  INT16_C(  9855),  INT16_C( 19709), -INT16_C( 19187),  INT16_C( 10874),  INT16_C( 11537),  INT16_C( 15902),  INT16_C(  8333),
         INT16_C( 23580), -INT16_C( 10093),  INT16_C( 24532),  INT16_C( 10062),  INT16_C( 14553), -INT16_C( 11126),  INT16_C(  5744),  INT16_C(  9576),
        -INT16_C(  6342),  INT16_C( 14156),  INT16_C( 22835), -INT16_C( 21012), -INT16_C(   637), -INT16_C( 24102),  INT16_C( 26428),  INT16_C( 22722),
         INT16_C( 21955), -INT16_C( 26576),  INT16_C( 32437), -INT16_C( 28993),  INT16_C( 18871),  INT16_C( 10082), -INT16_C( 13728), -INT16_C( 26036) },
      { -INT16_C( 26446), -INT16_C(  6703), -INT16_C( 16910),  INT16_C( 30099),  INT16_C( 28091), -INT16_C(  2281), -INT16_C(  9771), -INT16_C( 26545),
         INT16_C( 32558), -INT16_C(  7376), -INT16_C(  3842), -INT16_C( 19087), -INT16_C( 11463), -INT16_C( 26148),  INT16_C( 10398),  INT16_C( 20531),
         INT16_C(  1217), -INT16_C( 19659), -INT16_C( 14142),  INT16_C( 32040),  INT16_C( 16182),  INT16_C(  2932), -INT16_C( 15592),  INT16_C( 18339),
        -INT16_C( 11198),  INT16_C( 16426), -INT16_C( 25404), -INT16_C(   523), -INT16_C( 11921),  INT16_C(  3479), -INT16_C( 13574), -INT16_C( 17571) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C( 31956), -INT16_C( 17336),  INT16_C( 20315),  INT16_C(  8810),  INT16_C(     0),  INT16_C( 16667),
         INT16_C( 28784),  INT16_C(     0),  INT16_C( 32595),  INT16_C(     0),  INT16_C( 27885),  INT16_C( 18599),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(2439943119),
      { -INT16_C( 27045), -INT16_C( 28402), -INT16_C( 32042), -INT16_C(  4452),  INT16_C( 16453), -INT16_C( 30923),  INT16_C( 24596), -INT16_C( 10040),
        -INT16_C( 16900),  INT16_C( 27605),  INT16_C( 27791), -INT16_C( 30343), -INT16_C( 10697),  INT16_C(  1604), -INT16_C( 19863), -INT16_C( 14953),
        -INT16_C( 23224),  INT16_C(  7766), -INT16_C(  3289),  INT16_C( 27661),  INT16_C( 16947),  INT16_C( 18419), -INT16_C( 17502), -INT16_C( 25057),
        -INT16_C(  2951),  INT16_C(  2058), -INT16_C( 31903), -INT16_C( 26479), -INT16_C( 10919), -INT16_C( 15458),  INT16_C( 13703), -INT16_C( 12408) },
      { -INT16_C(  8486),  INT16_C(   494), -INT16_C(  1071),  INT16_C(  1133),  INT16_C( 24637), -INT16_C(  8117),  INT16_C( 27164), -INT16_C( 27266),
        -INT16_C( 30625), -INT16_C( 16227),  INT16_C( 11787),  INT16_C( 25944), -INT16_C(  2557), -INT16_C( 30168), -INT16_C( 20437),  INT16_C(  1369),
         INT16_C( 18318),  INT16_C( 24582),  INT16_C( 29506), -INT16_C( 32668), -INT16_C( 20269), -INT16_C(  4256), -INT16_C(  8678),  INT16_C( 31108),
         INT16_C(  8551),  INT16_C( 29241), -INT16_C( 28337),  INT16_C( 21207), -INT16_C(   121), -INT16_C( 19748),  INT16_C( 13999),  INT16_C( 16055) },
      { -INT16_C( 17027), -INT16_C( 16226),  INT16_C(   560),  INT16_C(  1088), -INT16_C( 24398), -INT16_C( 12813),  INT16_C( 30846), -INT16_C(  6842),
        -INT16_C( 32615), -INT16_C(  5800),  INT16_C( 12049), -INT16_C( 26309),  INT16_C(  6191), -INT16_C(  8629),  INT16_C(   846), -INT16_C( 13540),
        -INT16_C( 17728), -INT16_C(  3701), -INT16_C( 13379),  INT16_C( 28661), -INT16_C(  6037), -INT16_C(  5572), -INT16_C( 31904), -INT16_C(  1329),
         INT16_C(  9987),  INT16_C(  5347),  INT16_C(  7767), -INT16_C( 31059), -INT16_C(  1738), -INT16_C( 31644), -INT16_C( 32260), -INT16_C( 17328) },
      { -INT16_C(  2348),  INT16_C(  1978), -INT16_C( 32042), -INT16_C(  4452),  INT16_C(     0),  INT16_C(     0), -INT16_C( 22415), -INT16_C(  1181),
         INT16_C( 12254), -INT16_C( 25237),  INT16_C(     0),  INT16_C(     0), -INT16_C(  5113),  INT16_C(     0),  INT16_C(     0),  INT16_C( 21916),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(4172143419),
      { -INT16_C( 23897),  INT16_C(  4712), -INT16_C( 23413), -INT16_C(  5124), -INT16_C( 13273),  INT16_C( 10981), -INT16_C( 14093),  INT16_C( 19007),
        -INT16_C(  4889),  INT16_C(  7632),  INT16_C( 13797), -INT16_C(  7774), -INT16_C(  3402), -INT16_C(  3682),  INT16_C( 19405),  INT16_C( 29930),
         INT16_C( 21230),  INT16_C( 31111), -INT16_C( 31754),  INT16_C(  7780),  INT16_C( 19023),  INT16_C( 17224), -INT16_C( 30958), -INT16_C(  1651),
         INT16_C( 24180),  INT16_C( 22807), -INT16_C( 18029),  INT16_C( 18747), -INT16_C(  9813),  INT16_C( 30778),  INT16_C(  9252),  INT16_C(  4845) },
      {  INT16_C( 29814),  INT16_C( 28043), -INT16_C(  3849),  INT16_C( 18315), -INT16_C( 11462),  INT16_C( 19594),  INT16_C(  5979), -INT16_C( 12474),
         INT16_C( 23925),  INT16_C(  2088),  INT16_C( 25366), -INT16_C( 16047), -INT16_C( 29636),  INT16_C( 24889),  INT16_C(  9904),  INT16_C( 10099),
        -INT16_C(   102), -INT16_C( 28012),  INT16_C(  8175),  INT16_C( 10713),  INT16_C( 25586),  INT16_C( 19829), -INT16_C( 17542), -INT16_C(  4068),
         INT16_C( 17688),  INT16_C( 12024),  INT16_C( 19112), -INT16_C(  6673),  INT16_C( 10710), -INT16_C( 31162), -INT16_C( 18097), -INT16_C(  5459) },
      {  INT16_C( 16824), -INT16_C( 22660),  INT16_C( 21856),  INT16_C( 21456),  INT16_C( 18104),  INT16_C( 12960), -INT16_C( 17151),  INT16_C(  6690),
         INT16_C(  6914), -INT16_C( 21944),  INT16_C( 14437),  INT16_C( 15247), -INT16_C( 10911), -INT16_C( 20287),  INT16_C( 28559),  INT16_C( 18330),
         INT16_C(  5808),  INT16_C(  4591), -INT16_C( 16533),  INT16_C(  9060),  INT16_C(  1029),  INT16_C(  1878),  INT16_C( 30913), -INT16_C( 15583),
         INT16_C( 27027), -INT16_C(  1938), -INT16_C(   607),  INT16_C(   563), -INT16_C(  2605),  INT16_C( 25267),  INT16_C( 19812),  INT16_C(  5289) },
      {  INT16_C( 30370), -INT16_C( 10063),  INT16_C(     0), -INT16_C(  5124),  INT16_C( 15052),  INT16_C( 10981),  INT16_C(     0),  INT16_C(     0),
         INT16_C( 31545),  INT16_C( 10269),  INT16_C(     0), -INT16_C( 32093),  INT16_C( 31067),  INT16_C(     0),  INT16_C( 19808), -INT16_C(  8995),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(3475347556),
      { -INT16_C( 30376),  INT16_C( 24051),  INT16_C( 18830),  INT16_C( 20324), -INT16_C( 31295),  INT16_C( 21779), -INT16_C( 32273), -INT16_C( 28595),
        -INT16_C( 32386),  INT16_C( 20883),  INT16_C( 18038), -INT16_C(  9549),  INT16_C( 23955), -INT16_C(  2066),  INT16_C(  5365),  INT16_C( 19911),
        -INT16_C( 17763),  INT16_C( 11179),  INT16_C(  3843), -INT16_C( 15237), -INT16_C( 29035), -INT16_C( 31719),  INT16_C( 26383), -INT16_C( 29420),
        -INT16_C( 22552),  INT16_C( 24287), -INT16_C( 27923), -INT16_C( 32456),  INT16_C(  9967), -INT16_C(  6792),  INT16_C( 16186), -INT16_C( 10190) },
      { -INT16_C(  8711), -INT16_C(  1021),  INT16_C( 32493), -INT16_C( 32063), -INT16_C(  9716),  INT16_C(  6918),  INT16_C(  6721),  INT16_C( 10665),
        -INT16_C( 30526), -INT16_C( 20601), -INT16_C( 16614),  INT16_C(  2608), -INT16_C( 22042),  INT16_C(  8431),  INT16_C(  8680), -INT16_C(  7432),
        -INT16_C(   769), -INT16_C(  4898), -INT16_C( 24710), -INT16_C( 30866),  INT16_C( 29818), -INT16_C( 17502),  INT16_C( 19342),  INT16_C( 20709),
         INT16_C( 27859), -INT16_C(  4608),  INT16_C( 12332),  INT16_C(  4856), -INT16_C(  6183), -INT16_C( 15822),  INT16_C( 11016),  INT16_C(  1956) },
      { -INT16_C( 32217), -INT16_C( 24077),  INT16_C( 24866), -INT16_C( 25560), -INT16_C( 13355),  INT16_C( 25687),  INT16_C( 15382), -INT16_C(  5452),
        -INT16_C( 19287), -INT16_C( 10792), -INT16_C( 12059), -INT16_C( 16665),  INT16_C(  6583), -INT16_C( 16512),  INT16_C(  9284),  INT16_C( 27591),
        -INT16_C( 17753), -INT16_C( 14067),  INT16_C( 13596), -INT16_C(  3739), -INT16_C( 17408),  INT16_C(  5973),  INT16_C(  2809), -INT16_C( 24063),
        -INT16_C(  9794), -INT16_C( 23689),  INT16_C( 24233),  INT16_C( 24674), -INT16_C(  7561), -INT16_C( 17377), -INT16_C(  6649), -INT16_C( 20953) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C( 21091),  INT16_C(     0),  INT16_C(     0),  INT16_C(  3242),  INT16_C(  1543),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 25013), -INT16_C( 13125),  INT16_C(     0),  INT16_C(     0), -INT16_C(  3941),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(3178706081),
      { -INT16_C(  9110),  INT16_C( 27310),  INT16_C(  1176), -INT16_C( 28287), -INT16_C( 32242), -INT16_C( 13261), -INT16_C( 21925),  INT16_C(  1136),
        -INT16_C( 11768), -INT16_C( 32668), -INT16_C( 31564), -INT16_C( 17604),  INT16_C( 25450),  INT16_C(  2921), -INT16_C(  8040),  INT16_C(   712),
         INT16_C( 30652),  INT16_C( 21868), -INT16_C(  4485), -INT16_C( 30234),  INT16_C(  6768), -INT16_C( 13227), -INT16_C( 14908), -INT16_C( 12848),
         INT16_C( 13719),  INT16_C( 19533), -INT16_C( 30279),  INT16_C(  8967),  INT16_C( 29164), -INT16_C( 31697), -INT16_C(  2223),  INT16_C(  3718) },
      { -INT16_C(  3218), -INT16_C(  5789),  INT16_C( 18913),  INT16_C( 20850), -INT16_C( 14237),  INT16_C( 10269), -INT16_C(  4467),  INT16_C(  9717),
         INT16_C( 16931), -INT16_C(  9103),  INT16_C( 30923), -INT16_C( 18433),  INT16_C( 12009),  INT16_C( 15164), -INT16_C( 15834), -INT16_C( 27575),
        -INT16_C( 21323), -INT16_C( 27010), -INT16_C(  3851),  INT16_C( 23016),  INT16_C(  1464),  INT16_C( 18049),  INT16_C( 30451),  INT16_C(  5739),
        -INT16_C(  9032), -INT16_C( 31758), -INT16_C(  3500),  INT16_C( 15930),  INT16_C( 30240),  INT16_C( 18041), -INT16_C( 15815), -INT16_C(  4389) },
      {  INT16_C( 22894),  INT16_C( 25477),  INT16_C( 27977),  INT16_C(   700),  INT16_C( 15730),  INT16_C( 26184), -INT16_C( 19533),  INT16_C( 27516),
         INT16_C( 28559), -INT16_C(  7186),  INT16_C( 10593), -INT16_C( 32479), -INT16_C( 25953), -INT16_C( 10040), -INT16_C( 23716), -INT16_C( 13625),
         INT16_C( 19708),  INT16_C( 17710), -INT16_C(  5447),  INT16_C( 11079), -INT16_C( 28888), -INT16_C(  9327),  INT16_C(  3650), -INT16_C( 11961),
         INT16_C( 13693), -INT16_C(  8523), -INT16_C( 10658), -INT16_C(   417),  INT16_C( 10097), -INT16_C( 12842), -INT16_C( 25142), -INT16_C( 14696) },
      { -INT16_C( 12869),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  7628),  INT16_C(     0),  INT16_C( 24400),
         INT16_C(     0),  INT16_C(     0), -INT16_C( 15782),  INT16_C(     0),  INT16_C( 24018),  INT16_C( 15371),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(2718746345),
      {  INT16_C( 21424), -INT16_C( 10034),  INT16_C( 24547),  INT16_C(  9652), -INT16_C(  1171), -INT16_C(  5385), -INT16_C( 21456), -INT16_C( 28728),
         INT16_C( 10370), -INT16_C(  3187),  INT16_C( 25423),  INT16_C(  6849),  INT16_C( 22785), -INT16_C(  5408), -INT16_C(  5089), -INT16_C( 12403),
         INT16_C( 23360),  INT16_C(  9128),  INT16_C( 23738),  INT16_C( 10312),  INT16_C( 16215), -INT16_C( 30958), -INT16_C(  9237),  INT16_C( 28182),
        -INT16_C( 23805),  INT16_C( 21089),  INT16_C(  8711),  INT16_C(  2156),  INT16_C( 19835), -INT16_C( 25870),  INT16_C( 32569),  INT16_C( 31082) },
      {  INT16_C(  4826), -INT16_C( 27236), -INT16_C(  6802), -INT16_C( 14915), -INT16_C( 12508),  INT16_C(  4172),  INT16_C( 25514), -INT16_C( 21122),
        -INT16_C(  8442),  INT16_C(  3328),  INT16_C( 27650),  INT16_C( 32021),  INT16_C(  2233), -INT16_C(  3304), -INT16_C( 32121),  INT16_C( 25196),
         INT16_C(  2452),  INT16_C(   759), -INT16_C( 19218),  INT16_C(  4807),  INT16_C(  4995),  INT16_C( 11810), -INT16_C( 24458),  INT16_C( 32219),
        -INT16_C(  9344), -INT16_C( 32118), -INT16_C( 24504),  INT16_C(   511),  INT16_C(  6056),  INT16_C( 12276),  INT16_C( 24985),  INT16_C( 11665) },
      { -INT16_C( 30614),  INT16_C( 22575), -INT16_C(  2500), -INT16_C( 16278), -INT16_C( 29430), -INT16_C( 32530), -INT16_C( 14035), -INT16_C( 20995),
        -INT16_C( 30555), -INT16_C(  4817),  INT16_C( 12072), -INT16_C( 12050), -INT16_C(  7354), -INT16_C(  7937), -INT16_C( 28348), -INT16_C( 20979),
         INT16_C( 15641),  INT16_C( 22022),  INT16_C( 28723),  INT16_C( 15638),  INT16_C(  1277),  INT16_C( 11198), -INT16_C( 17459),  INT16_C( 29400),
         INT16_C(  2115),  INT16_C( 27487),  INT16_C( 20023),  INT16_C( 32059),  INT16_C( 15153),  INT16_C( 30045),  INT16_C( 27596), -INT16_C(  6877) },
      { -INT16_C( 18796),  INT16_C(     0),  INT16_C(     0),  INT16_C( 28489),  INT16_C(     0),  INT16_C( 16691),  INT16_C(  7509),  INT16_C( 27636),
         INT16_C(     0),  INT16_C(  6657),  INT16_C(   611),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 32449),  INT16_C(  4966),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask32 k = test_vec[i].k;
    easysimd__m512i a  = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b  = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c  = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r  = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_maskz_shrdv_epi16(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_maskz_shrdv_epi16");
    easysimd_assert_m512i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask32 k = easysimd_test_x86_random_mmask32();
    easysimd__m512i a = easysimd_test_x86_random_i16x32();
    easysimd__m512i b = easysimd_test_x86_random_i16x32();
    easysimd__m512i c = easysimd_test_x86_random_i16x32();
    easysimd__m512i r = easysimd_mm512_maskz_shrdv_epi16(k, a, b, c);

    easysimd_test_x86_write_mmask32(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x32(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_shrdv_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask16 k;
    int32_t a[16];
    int32_t b[16];
    int32_t c[16];
    int32_t r[16];
  } test_vec[8] = {
    { UINT16_C( 7986),
      {  INT32_C(  1093896526),  INT32_C(  1487537066), -INT32_C(  1655034070),  INT32_C(   780776364), -INT32_C(    67923565), -INT32_C(  1170502667), -INT32_C(   932406109),  INT32_C(   736600029),
        -INT32_C(   747889880),  INT32_C(  1210783262), -INT32_C(   219839162), -INT32_C(   870289608), -INT32_C(   171502592),  INT32_C(  1118765727),  INT32_C(  2081037215), -INT32_C(   475532870) },
      {  INT32_C(   733352972),  INT32_C(  1886642474), -INT32_C(  1620944537), -INT32_C(   932478008),  INT32_C(   918368919), -INT32_C(   730305483),  INT32_C(  1112572551), -INT32_C(  2144995469),
         INT32_C(   917232395),  INT32_C(   598089404),  INT32_C(  1069746551),  INT32_C(   587673228), -INT32_C(  1772501919), -INT32_C(  1200959184), -INT32_C(   956646829), -INT32_C(  1119477839) },
      { -INT32_C(  1225526790), -INT32_C(  2015717104),  INT32_C(   784833954),  INT32_C(   743558859), -INT32_C(  1010652525), -INT32_C(   830788485), -INT32_C(  1735035418), -INT32_C(  1906975852),
        -INT32_C(   582661939), -INT32_C(  2073813023), -INT32_C(  2018366532), -INT32_C(  1917582086),  INT32_C(   709916334), -INT32_C(  1980183389), -INT32_C(   702444223),  INT32_C(   912553577) },
      {  INT32_C(           0), -INT32_C(   517318486),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1504510082), -INT32_C(  1894938953),  INT32_C(           0),  INT32_C(           0),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(43454),
      {  INT32_C(  2009636883), -INT32_C(   693926876), -INT32_C(  1059414772),  INT32_C(  2050394410), -INT32_C(  1421420109), -INT32_C(  2076604317), -INT32_C(  1023696290), -INT32_C(   345196072),
         INT32_C(  2103587929), -INT32_C(   984349255), -INT32_C(   863687006),  INT32_C(  1783086007), -INT32_C(   132739691),  INT32_C(  1937526549), -INT32_C(   919177231), -INT32_C(  1967873487) },
      { -INT32_C(  1895295274), -INT32_C(  1101767652),  INT32_C(  1116461450),  INT32_C(   715969173),  INT32_C(  1965212255),  INT32_C(    48799249),  INT32_C(  1204493846), -INT32_C(  1747877952),
        -INT32_C(  1306076778), -INT32_C(  1066370251), -INT32_C(   385680556),  INT32_C(   756264653), -INT32_C(  2103298703), -INT32_C(   360346924),  INT32_C(  1764839593),  INT32_C(  1711276752) },
      {  INT32_C(   286795740), -INT32_C(   154040158),  INT32_C(  1373688708), -INT32_C(   209783934), -INT32_C(    42655703),  INT32_C(  1424489131),  INT32_C(   465377355), -INT32_C(   159269350),
        -INT32_C(  2029479451), -INT32_C(  1518479071),  INT32_C(   804740525),  INT32_C(  2049078609),  INT32_C(  1098356630), -INT32_C(   577413486), -INT32_C(  1862774154), -INT32_C(   175671024) },
      {  INT32_C(           0),  INT32_C(   900260105), -INT32_C(  1408390704),  INT32_C(  1586340426),  INT32_C(   802530156), -INT32_C(  1037007055),  INT32_C(           0), -INT32_C(   195039174),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(36626),
      { -INT32_C(    93834372), -INT32_C(   799599143),  INT32_C(  1715841092), -INT32_C(  1711351006), -INT32_C(  1309175780),  INT32_C(  1694788973), -INT32_C(  2049043202), -INT32_C(  2045448182),
        -INT32_C(    58688477), -INT32_C(   691218286), -INT32_C(  1556278656),  INT32_C(   171719661),  INT32_C(   951792843), -INT32_C(  1617051743), -INT32_C(   568034348), -INT32_C(  1906034581) },
      {  INT32_C(  1200350645),  INT32_C(  1025333181),  INT32_C(  1474321001),  INT32_C(  1616977301), -INT32_C(   224912303), -INT32_C(  1332595236),  INT32_C(   462337712), -INT32_C(  1532300561),
        -INT32_C(  1796524585), -INT32_C(   154007412), -INT32_C(   129125789),  INT32_C(   542748367), -INT32_C(  1508642358), -INT32_C(   682187481),  INT32_C(  1257497691), -INT32_C(  1360093737) },
      {  INT32_C(  1581504978),  INT32_C(  1163138530), -INT32_C(  1757568569),  INT32_C(   448239183), -INT32_C(  1346319736), -INT32_C(   880404625), -INT32_C(   770344453), -INT32_C(   394197994),
        -INT32_C(  1085815587), -INT32_C(  1610310695), -INT32_C(  1942535619),  INT32_C(  1621553112),  INT32_C(   688875449),  INT32_C(  2046072446),  INT32_C(   642517263), -INT32_C(   351351539) },
      {  INT32_C(           0),  INT32_C(  1947583862),  INT32_C(           0),  INT32_C(           0),  INT32_C(  1370617744),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(21905),
      { -INT32_C(  1343133014),  INT32_C(  1123102218),  INT32_C(  1630652858),  INT32_C(   969468458),  INT32_C(   131024403),  INT32_C(   185720767),  INT32_C(   332930565), -INT32_C(  1268160247),
        -INT32_C(   563914029),  INT32_C(  1109415048),  INT32_C(  1201885469),  INT32_C(  1333881659),  INT32_C(  1901482161),  INT32_C(   880568111), -INT32_C(  1891084922), -INT32_C(  1841057346) },
      { -INT32_C(  1821334005),  INT32_C(   416649466),  INT32_C(   476019169), -INT32_C(  1771314972),  INT32_C(  1611121201), -INT32_C(  1349156055), -INT32_C(  1757422120), -INT32_C(  1725332850),
         INT32_C(   590125353),  INT32_C(   171639081),  INT32_C(  1596365690), -INT32_C(  1393192325),  INT32_C(  2098068564),  INT32_C(  1479385727),  INT32_C(   233794687),  INT32_C(   396761326) },
      { -INT32_C(   633613647),  INT32_C(  1323595475), -INT32_C(  1918039535), -INT32_C(   264658276),  INT32_C(   493766302),  INT32_C(  1735760872), -INT32_C(   176921593),  INT32_C(   755833468),
        -INT32_C(  1073264404), -INT32_C(   804328514), -INT32_C(  1839350794), -INT32_C(    75262371), -INT32_C(   988220963), -INT32_C(  1825730932),  INT32_C(  1871225330), -INT32_C(  1466133060) },
      {  INT32_C(  1392891896),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  2145449788),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1835521813),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(42205),
      {  INT32_C(  1989123176), -INT32_C(   919501460), -INT32_C(  1688236520), -INT32_C(  1567867767),  INT32_C(   791681026),  INT32_C(   869278379),  INT32_C(   784960657), -INT32_C(  1647139275),
        -INT32_C(  1374396094), -INT32_C(     8960537),  INT32_C(  1570428884),  INT32_C(   369042963), -INT32_C(   381407426), -INT32_C(   484698798), -INT32_C(   703470175), -INT32_C(   831200372) },
      {  INT32_C(   746424389), -INT32_C(  1590954803), -INT32_C(   536885813),  INT32_C(   703921899), -INT32_C(  2146289362), -INT32_C(   278712754), -INT32_C(  1597606636), -INT32_C(  1653720488),
        -INT32_C(  1882592318), -INT32_C(  1422789408), -INT32_C(  1534447431),  INT32_C(  1556971310),  INT32_C(   115138488),  INT32_C(   586498062),  INT32_C(   230865845), -INT32_C(  1213517579) },
      { -INT32_C(    62426084),  INT32_C(   581400681), -INT32_C(   691588440),  INT32_C(  1764988081), -INT32_C(  2106650764),  INT32_C(    77882447),  INT32_C(   353527328), -INT32_C(  1295139434),
        -INT32_C(  1699867599),  INT32_C(   884823692),  INT32_C(   956990600), -INT32_C(  1935524584), -INT32_C(  1676799667), -INT32_C(  1784565131), -INT32_C(  1347701992), -INT32_C(  1587447696) },
      { -INT32_C(   942111657),  INT32_C(           0), -INT32_C(   879009906),  INT32_C(  2138427718),  INT32_C(   596828915),  INT32_C(           0),  INT32_C(   784960657), -INT32_C(  1192664457),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C( 4236),
      { -INT32_C(   110749636),  INT32_C(  1451093580), -INT32_C(   913009369),  INT32_C(   819650850),  INT32_C(   518213501), -INT32_C(  1865286683),  INT32_C(   201867690),  INT32_C(   521966819),
        -INT32_C(   132611412), -INT32_C(  1756457616),  INT32_C(  1281417770),  INT32_C(  1098726083),  INT32_C(  1851744393),  INT32_C(   117322075),  INT32_C(  1427244658),  INT32_C(  1182019226) },
      {  INT32_C(   540970160),  INT32_C(  1287097633),  INT32_C(   865605487), -INT32_C(   629926575), -INT32_C(   783690891),  INT32_C(  2010597124), -INT32_C(   389224114), -INT32_C(   953204457),
        -INT32_C(   270045747),  INT32_C(  1782292218),  INT32_C(   111006645),  INT32_C(  1591742953), -INT32_C(   382785052), -INT32_C(  1084225935),  INT32_C(   111619311),  INT32_C(  1003345517) },
      {  INT32_C(  1042986052),  INT32_C(   128476498),  INT32_C(   554517816),  INT32_C(   998305366), -INT32_C(  2010861801), -INT32_C(  1522039626),  INT32_C(   514650032),  INT32_C(   156858821),
        -INT32_C(  2142731474),  INT32_C(   545845480), -INT32_C(  1941793482), -INT32_C(  1681407357),  INT32_C(   656665457),  INT32_C(   550333295),  INT32_C(   524187994),  INT32_C(   539596786) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(  1743294519), -INT32_C(   799718205),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1191648089),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(28954),
      {  INT32_C(   694223521),  INT32_C(  1690212130), -INT32_C(   349814236),  INT32_C(    14129373), -INT32_C(  1939126593), -INT32_C(  1543125658),  INT32_C(   238811365), -INT32_C(  1182837480),
         INT32_C(  2061688919), -INT32_C(  1663131272), -INT32_C(  1064892957),  INT32_C(  1556111005),  INT32_C(   199830693), -INT32_C(   693047567), -INT32_C(     1774618), -INT32_C(  1732746431) },
      { -INT32_C(  1139631292),  INT32_C(   525922620), -INT32_C(  1814044682), -INT32_C(   470835394), -INT32_C(  1108420405), -INT32_C(  1382834489), -INT32_C(   877889398),  INT32_C(   526607835),
         INT32_C(  1021015552),  INT32_C(  1566258023),  INT32_C(  1374698003), -INT32_C(  1523261479),  INT32_C(  2137137848),  INT32_C(  1261237697),  INT32_C(  1226234221),  INT32_C(  1047034174) },
      {  INT32_C(  1450853615), -INT32_C(  1967925897), -INT32_C(   388259057),  INT32_C(   999100291), -INT32_C(   205852878),  INT32_C(  1379854053), -INT32_C(    40151873), -INT32_C(  1120205619),
        -INT32_C(  1089227448), -INT32_C(  1723152502), -INT32_C(   310237846),  INT32_C(  1730678581), -INT32_C(   463805697), -INT32_C(  2009687863), -INT32_C(  1182346516),  INT32_C(   511099350) },
      {  INT32_C(           0), -INT32_C(  1310558007),  INT32_C(           0), -INT32_C(  1071975653), -INT32_C(  1238179046),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(35447),
      {  INT32_C(   659620317),  INT32_C(   491633563), -INT32_C(   785612119),  INT32_C(  1135881193),  INT32_C(  1188789519), -INT32_C(  1961310459), -INT32_C(   145887616), -INT32_C(   377371636),
         INT32_C(  1611780805),  INT32_C(   914185869), -INT32_C(   922178848), -INT32_C(   452150059),  INT32_C(  1043064633),  INT32_C(   785007534),  INT32_C(  1025840945), -INT32_C(  1608079653) },
      {  INT32_C(   100743032),  INT32_C(  1966898837), -INT32_C(    29473752),  INT32_C(   971196928), -INT32_C(   545780175), -INT32_C(  2112994735),  INT32_C(   884945753),  INT32_C(  1389684186),
        -INT32_C(  1302801123),  INT32_C(  2083034452), -INT32_C(   629512487), -INT32_C(   502047311), -INT32_C(  1128101013),  INT32_C(   641650893), -INT32_C(   581239549),  INT32_C(     3157987) },
      {  INT32_C(  1488095236), -INT32_C(   136979939), -INT32_C(   221163711),  INT32_C(   416605357),  INT32_C(  1037407856),  INT32_C(  1784943462), -INT32_C(   196624879), -INT32_C(   218859539),
         INT32_C(   491431424), -INT32_C(  1038868607),  INT32_C(   481617263),  INT32_C(   976521418), -INT32_C(  2055796449),  INT32_C(   787471133), -INT32_C(  2027800678), -INT32_C(  1367796050) },
      { -INT32_C(  2106257379), -INT32_C(  1444678488),  INT32_C(  1754677588),  INT32_C(           0),  INT32_C(   238110427),  INT32_C(  1177314076), -INT32_C(  1716716634),  INT32_C(           0),
         INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask16 k = test_vec[i].k;
    easysimd__m512i a  = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b  = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c  = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r  = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_maskz_shrdv_epi32(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_maskz_shrdv_epi32");
    easysimd_assert_m512i_i32(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    easysimd__m512i b = easysimd_test_x86_random_i32x16();
    easysimd__m512i c = easysimd_test_x86_random_i32x16();
    easysimd__m512i r = easysimd_mm512_maskz_shrdv_epi32(k, a, b, c);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_maskz_shrdv_epi64(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    easysimd__mmask8 k;
    int64_t a[8];
    int64_t b[8];
    int64_t c[8];
    int64_t r[8];
  } test_vec[] = {
    { UINT8_C( 40),
      {  INT64_C( 4521808154528203827),  INT64_C( 4758706138107467423),  INT64_C(  824121410885255408), -INT64_C( 8476287596065578692),
        -INT64_C( 3801490895302067087), -INT64_C( 2413385222547334342),  INT64_C( 4037715647032532718),  INT64_C( 2079762164115996410) },
      {  INT64_C( 2107504183096475464), -INT64_C(   17207284423908617), -INT64_C(  130599969790087940), -INT64_C( 5599332877149888893),
        -INT64_C( 4995505996066035541), -INT64_C( 1975002259957806712),  INT64_C( 1986102384620573581), -INT64_C( 5131407520777510740) },
      { -INT64_C( 2487408294545068036),  INT64_C(  633052048404060669),  INT64_C( 6940939503751833248),  INT64_C( 3373265600996875531),
         INT64_C(  531820625395586863), -INT64_C( 8933533195485522302), -INT64_C( 2994875287856177060),  INT64_C( 6128482267102635949) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 3426874529104343356),
         INT64_C(                   0),  INT64_C( 4008339712790554318),  INT64_C(                   0),  INT64_C(                   0) } },
     { UINT8_C(137),
      {  INT64_C( 1787498492514834373),  INT64_C( 7008295470962083518),  INT64_C( 8996619531125406587), -INT64_C( 4486638577308602645),
        -INT64_C( 2929562861849239336), -INT64_C(  676801654195878751),  INT64_C(  146636469356375487),  INT64_C( 1558793293598686435) },
      { -INT64_C( 6304285180402733678),  INT64_C(  514674006404809906),  INT64_C( 1676635610046218027), -INT64_C(   78083554118567529),
        -INT64_C( 6902842925778386812), -INT64_C( 4665461396005316624),  INT64_C(  467606276776514354), -INT64_C( 8131032475463093313) },
      { -INT64_C( 1255289340198923771), -INT64_C( 8666218339449216409), -INT64_C( 4489972268798198725),  INT64_C( 6230752422221548510),
         INT64_C( 5463673273106142438), -INT64_C( 7125537512507377088),  INT64_C( 6017362662252808894),  INT64_C( 7361613531306552450) },
      { -INT64_C( 8014591204356840258),  INT64_C(                   0),  INT64_C(                   0),  INT64_C( 6330344047058683888),
         INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 4221987695027716296) } },
    { UINT8_C(104),
      { -INT64_C( 4468140285076472625), -INT64_C( 4078258715990137275),  INT64_C( 5977801603924069957),  INT64_C( 2054917194766677585),
         INT64_C( 3160285474268506884), -INT64_C( 9073982232538505219),  INT64_C( 8395424539098855756), -INT64_C(  582629069199152511) },
      {  INT64_C( 1590311739416740609),  INT64_C( 8199492675546736651),  INT64_C( 7765371146775650092),  INT64_C( 7815754622944499085),
         INT64_C( 9211660540421769382), -INT64_C( 2926335165178890292), -INT64_C( 5456414242588130063),  INT64_C( 5195090885334040385) },
      { -INT64_C( 7266595589808755917),  INT64_C( 8185274184034479637), -INT64_C( 1382725297001152525), -INT64_C( 2090882233792920815),
        -INT64_C(  754720307955498468), -INT64_C(  679959971727338593),  INT64_C( 9197440530614639627),  INT64_C(  753277536060980451) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 6141064626610729356),
         INT64_C(                   0), -INT64_C( 2049578077416752520), -INT64_C( 7048537688073964873),  INT64_C(                   0) } },
    { UINT8_C(144),
      { -INT64_C(  401473322221451486),  INT64_C( 8043825392662572581), -INT64_C( 5540232605140654324), -INT64_C( 6375383457880534096),
        -INT64_C( 8360071352511514659),  INT64_C( 6521152122571515517), -INT64_C( 2292327604014347087),  INT64_C( 4991216986644435224) },
      {  INT64_C( 8216325993246615060), -INT64_C( 6282799693306843610), -INT64_C( 3233770645210351857),  INT64_C( 7445775448001279400),
         INT64_C(   72875469910940315), -INT64_C( 7515023952554064619), -INT64_C( 2698793953480221700),  INT64_C( 5522607974031949034) },
      { -INT64_C( 9028628265214114344),  INT64_C( 7747112131019876708),  INT64_C( 4047802916019591456),  INT64_C( 3217849783875344043),
        -INT64_C( 4139210057686547297), -INT64_C( 8964919308200042821),  INT64_C( 1375007910636468622),  INT64_C( 4870668991962515992) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0),
         INT64_C( 2432846734451678924),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 1586135385520642147) } },
    { UINT8_C( 40),
      {  INT64_C( 4521808154528203827),  INT64_C( 4758706138107467423),  INT64_C(  824121410885255408), -INT64_C( 8476287596065578692),
        -INT64_C( 3801490895302067087), -INT64_C( 2413385222547334342),  INT64_C( 4037715647032532718),  INT64_C( 2079762164115996410) },
      {  INT64_C( 2107504183096475464), -INT64_C(   17207284423908617), -INT64_C(  130599969790087940), -INT64_C( 5599332877149888893),
        -INT64_C( 4995505996066035541), -INT64_C( 1975002259957806712),  INT64_C( 1986102384620573581), -INT64_C( 5131407520777510740) },
      { -INT64_C( 2487408294545068036),  INT64_C(  633052048404060669),  INT64_C( 6940939503751833248),  INT64_C( 3373265600996875531),
         INT64_C(  531820625395586863), -INT64_C( 8933533195485522302), -INT64_C( 2994875287856177060),  INT64_C( 6128482267102635949) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 3426874529104343356),
         INT64_C(                   0),  INT64_C( 4008339712790554318),  INT64_C(                   0),  INT64_C(                   0) } },
    { UINT8_C(137),
      {  INT64_C( 1787498492514834373),  INT64_C( 7008295470962083518),  INT64_C( 8996619531125406587), -INT64_C( 4486638577308602645),
        -INT64_C( 2929562861849239336), -INT64_C(  676801654195878751),  INT64_C(  146636469356375487),  INT64_C( 1558793293598686435) },
      { -INT64_C( 6304285180402733678),  INT64_C(  514674006404809906),  INT64_C( 1676635610046218027), -INT64_C(   78083554118567529),
        -INT64_C( 6902842925778386812), -INT64_C( 4665461396005316624),  INT64_C(  467606276776514354), -INT64_C( 8131032475463093313) },
      { -INT64_C( 1255289340198923771), -INT64_C( 8666218339449216409), -INT64_C( 4489972268798198725),  INT64_C( 6230752422221548510),
         INT64_C( 5463673273106142438), -INT64_C( 7125537512507377088),  INT64_C( 6017362662252808894),  INT64_C( 7361613531306552450) },
      { -INT64_C( 8014591204356840258),  INT64_C(                   0),  INT64_C(                   0),  INT64_C( 6330344047058683888),
         INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 4221987695027716296) } },
    { UINT8_C(104),
      { -INT64_C( 4468140285076472625), -INT64_C( 4078258715990137275),  INT64_C( 5977801603924069957),  INT64_C( 2054917194766677585),
         INT64_C( 3160285474268506884), -INT64_C( 9073982232538505219),  INT64_C( 8395424539098855756), -INT64_C(  582629069199152511) },
      {  INT64_C( 1590311739416740609),  INT64_C( 8199492675546736651),  INT64_C( 7765371146775650092),  INT64_C( 7815754622944499085),
         INT64_C( 9211660540421769382), -INT64_C( 2926335165178890292), -INT64_C( 5456414242588130063),  INT64_C( 5195090885334040385) },
      { -INT64_C( 7266595589808755917),  INT64_C( 8185274184034479637), -INT64_C( 1382725297001152525), -INT64_C( 2090882233792920815),
        -INT64_C(  754720307955498468), -INT64_C(  679959971727338593),  INT64_C( 9197440530614639627),  INT64_C(  753277536060980451) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 6141064626610729356),
         INT64_C(                   0), -INT64_C( 2049578077416752520), -INT64_C( 7048537688073964873),  INT64_C(                   0) } },
    { UINT8_C(144),
      { -INT64_C(  401473322221451486),  INT64_C( 8043825392662572581), -INT64_C( 5540232605140654324), -INT64_C( 6375383457880534096),
        -INT64_C( 8360071352511514659),  INT64_C( 6521152122571515517), -INT64_C( 2292327604014347087),  INT64_C( 4991216986644435224) },
      {  INT64_C( 8216325993246615060), -INT64_C( 6282799693306843610), -INT64_C( 3233770645210351857),  INT64_C( 7445775448001279400),
         INT64_C(   72875469910940315), -INT64_C( 7515023952554064619), -INT64_C( 2698793953480221700),  INT64_C( 5522607974031949034) },
      { -INT64_C( 9028628265214114344),  INT64_C( 7747112131019876708),  INT64_C( 4047802916019591456),  INT64_C( 3217849783875344043),
        -INT64_C( 4139210057686547297), -INT64_C( 8964919308200042821),  INT64_C( 1375007910636468622),  INT64_C( 4870668991962515992) },
      {  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0),  INT64_C(                   0),
         INT64_C( 2432846734451678924),  INT64_C(                   0),  INT64_C(                   0), -INT64_C( 1586135385520642147) } },
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])); i++) {
    easysimd__mmask8 k = test_vec[i].k;
    easysimd__m512i a  = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i b  = easysimd_mm512_loadu_si512(test_vec[i].b);
    easysimd__m512i c  = easysimd_mm512_loadu_si512(test_vec[i].c);
    easysimd__m512i r  = easysimd_mm512_loadu_si512(test_vec[i].r);
    easysimd__m512i ret;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      ret = easysimd_mm512_maskz_shrdv_epi64(k, a, b, c);
    } EASYSIMD_TEST_PERF_END("_mm512_maskz_shrdv_epi68");
    easysimd_assert_m512i_i64(r, ==, ret);
   }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask8 k = easysimd_test_x86_random_mmask8();
    easysimd__m512i a = easysimd_test_x86_random_i64x8();
    easysimd__m512i b = easysimd_test_x86_random_i64x8();
    easysimd__m512i c = easysimd_test_x86_random_i64x8();
    easysimd__m512i r = easysimd_mm512_maskz_shrdv_epi64(k, a, b, c);

    easysimd_test_x86_write_mmask8(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i64x8(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x8(2, b, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x8(2, c, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i64x8(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

EASYSIMD_TEST_FUNC_LIST_BEGIN
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_shrdv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_shrdv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_shrdv_epi64)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_shrdv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_shrdv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_shrdv_epi64)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_shrdv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_shrdv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_shrdv_epi64)

  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_shrdv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_shrdv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm_maskz_shrdv_epi64)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_shrdv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_shrdv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_maskz_shrdv_epi64)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_shrdv_epi16)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_shrdv_epi32)
  EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_maskz_shrdv_epi64)
EASYSIMD_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
