/* SPDX-License-Identifier: MIT
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use, copy,
 * modify, merge, publish, distribute, sublicense, and/or sell copies
 * of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
 * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
 * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 * Copyright:
 *   2020      Evan Nemerson <evan@nemerson.com>
 */

#define EASYSIMD_TEST_X86_AVX512_INSN storeu

#include <test/x86/avx512/test-avx512.h>
#include <easysimd/x86/avx512/storeu.h>

static int
test_easysimd_mm512_storeu_ps (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float32 a[16];
    const easysimd_float32 r[16];
  } test_vec[] = {
    { { EASYSIMD_FLOAT32_C(   397.85), EASYSIMD_FLOAT32_C(   280.50), EASYSIMD_FLOAT32_C(  -482.10), EASYSIMD_FLOAT32_C(  -764.38),
        EASYSIMD_FLOAT32_C(   375.26), EASYSIMD_FLOAT32_C(  -613.57), EASYSIMD_FLOAT32_C(    56.03), EASYSIMD_FLOAT32_C(   417.16),
        EASYSIMD_FLOAT32_C(  -424.36), EASYSIMD_FLOAT32_C(    64.48), EASYSIMD_FLOAT32_C(     0.84), EASYSIMD_FLOAT32_C(   101.24),
        EASYSIMD_FLOAT32_C(  -965.83), EASYSIMD_FLOAT32_C(   916.49), EASYSIMD_FLOAT32_C(   799.09), EASYSIMD_FLOAT32_C(   628.08) },
      { EASYSIMD_FLOAT32_C(   397.85), EASYSIMD_FLOAT32_C(   280.50), EASYSIMD_FLOAT32_C(  -482.10), EASYSIMD_FLOAT32_C(  -764.38),
        EASYSIMD_FLOAT32_C(   375.26), EASYSIMD_FLOAT32_C(  -613.57), EASYSIMD_FLOAT32_C(    56.03), EASYSIMD_FLOAT32_C(   417.16),
        EASYSIMD_FLOAT32_C(  -424.36), EASYSIMD_FLOAT32_C(    64.48), EASYSIMD_FLOAT32_C(     0.84), EASYSIMD_FLOAT32_C(   101.24),
        EASYSIMD_FLOAT32_C(  -965.83), EASYSIMD_FLOAT32_C(   916.49), EASYSIMD_FLOAT32_C(   799.09), EASYSIMD_FLOAT32_C(   628.08) } },
    { { EASYSIMD_FLOAT32_C(  -588.70), EASYSIMD_FLOAT32_C(   688.61), EASYSIMD_FLOAT32_C(   202.01), EASYSIMD_FLOAT32_C(  -610.64),
        EASYSIMD_FLOAT32_C(   838.07), EASYSIMD_FLOAT32_C(  -733.40), EASYSIMD_FLOAT32_C(  -127.00), EASYSIMD_FLOAT32_C(   993.35),
        EASYSIMD_FLOAT32_C(  -249.66), EASYSIMD_FLOAT32_C(   -45.23), EASYSIMD_FLOAT32_C(   849.71), EASYSIMD_FLOAT32_C(   -85.52),
        EASYSIMD_FLOAT32_C(   193.59), EASYSIMD_FLOAT32_C(  -257.46), EASYSIMD_FLOAT32_C(   827.23), EASYSIMD_FLOAT32_C(  -408.56) },
      { EASYSIMD_FLOAT32_C(  -588.70), EASYSIMD_FLOAT32_C(   688.61), EASYSIMD_FLOAT32_C(   202.01), EASYSIMD_FLOAT32_C(  -610.64),
        EASYSIMD_FLOAT32_C(   838.07), EASYSIMD_FLOAT32_C(  -733.40), EASYSIMD_FLOAT32_C(  -127.00), EASYSIMD_FLOAT32_C(   993.35),
        EASYSIMD_FLOAT32_C(  -249.66), EASYSIMD_FLOAT32_C(   -45.23), EASYSIMD_FLOAT32_C(   849.71), EASYSIMD_FLOAT32_C(   -85.52),
        EASYSIMD_FLOAT32_C(   193.59), EASYSIMD_FLOAT32_C(  -257.46), EASYSIMD_FLOAT32_C(   827.23), EASYSIMD_FLOAT32_C(  -408.56) } },
    { { EASYSIMD_FLOAT32_C(  -976.96), EASYSIMD_FLOAT32_C(  -654.87), EASYSIMD_FLOAT32_C(  -172.94), EASYSIMD_FLOAT32_C(   398.29),
        EASYSIMD_FLOAT32_C(  -268.45), EASYSIMD_FLOAT32_C(   883.09), EASYSIMD_FLOAT32_C(  -184.55), EASYSIMD_FLOAT32_C(   307.20),
        EASYSIMD_FLOAT32_C(   -52.43), EASYSIMD_FLOAT32_C(   816.29), EASYSIMD_FLOAT32_C(  -591.56), EASYSIMD_FLOAT32_C(   -18.26),
        EASYSIMD_FLOAT32_C(   732.78), EASYSIMD_FLOAT32_C(  -792.48), EASYSIMD_FLOAT32_C(  -390.18), EASYSIMD_FLOAT32_C(  -855.92) },
      { EASYSIMD_FLOAT32_C(  -976.96), EASYSIMD_FLOAT32_C(  -654.87), EASYSIMD_FLOAT32_C(  -172.94), EASYSIMD_FLOAT32_C(   398.29),
        EASYSIMD_FLOAT32_C(  -268.45), EASYSIMD_FLOAT32_C(   883.09), EASYSIMD_FLOAT32_C(  -184.55), EASYSIMD_FLOAT32_C(   307.20),
        EASYSIMD_FLOAT32_C(   -52.43), EASYSIMD_FLOAT32_C(   816.29), EASYSIMD_FLOAT32_C(  -591.56), EASYSIMD_FLOAT32_C(   -18.26),
        EASYSIMD_FLOAT32_C(   732.78), EASYSIMD_FLOAT32_C(  -792.48), EASYSIMD_FLOAT32_C(  -390.18), EASYSIMD_FLOAT32_C(  -855.92) } },
    { { EASYSIMD_FLOAT32_C(   896.13), EASYSIMD_FLOAT32_C(   811.83), EASYSIMD_FLOAT32_C(  -466.56), EASYSIMD_FLOAT32_C(   734.20),
        EASYSIMD_FLOAT32_C(  -921.57), EASYSIMD_FLOAT32_C(   406.44), EASYSIMD_FLOAT32_C(   727.55), EASYSIMD_FLOAT32_C(  -171.23),
        EASYSIMD_FLOAT32_C(  -638.79), EASYSIMD_FLOAT32_C(   577.26), EASYSIMD_FLOAT32_C(   743.25), EASYSIMD_FLOAT32_C(   554.80),
        EASYSIMD_FLOAT32_C(  -680.21), EASYSIMD_FLOAT32_C(   570.48), EASYSIMD_FLOAT32_C(  -853.75), EASYSIMD_FLOAT32_C(  -657.17) },
      { EASYSIMD_FLOAT32_C(   896.13), EASYSIMD_FLOAT32_C(   811.83), EASYSIMD_FLOAT32_C(  -466.56), EASYSIMD_FLOAT32_C(   734.20),
        EASYSIMD_FLOAT32_C(  -921.57), EASYSIMD_FLOAT32_C(   406.44), EASYSIMD_FLOAT32_C(   727.55), EASYSIMD_FLOAT32_C(  -171.23),
        EASYSIMD_FLOAT32_C(  -638.79), EASYSIMD_FLOAT32_C(   577.26), EASYSIMD_FLOAT32_C(   743.25), EASYSIMD_FLOAT32_C(   554.80),
        EASYSIMD_FLOAT32_C(  -680.21), EASYSIMD_FLOAT32_C(   570.48), EASYSIMD_FLOAT32_C(  -853.75), EASYSIMD_FLOAT32_C(  -657.17) } },
    { { EASYSIMD_FLOAT32_C(   915.61), EASYSIMD_FLOAT32_C(   -26.70), EASYSIMD_FLOAT32_C(   741.12), EASYSIMD_FLOAT32_C(  -352.84),
        EASYSIMD_FLOAT32_C(  -143.61), EASYSIMD_FLOAT32_C(  -443.43), EASYSIMD_FLOAT32_C(   954.36), EASYSIMD_FLOAT32_C(   803.96),
        EASYSIMD_FLOAT32_C(  -627.14), EASYSIMD_FLOAT32_C(  -637.21), EASYSIMD_FLOAT32_C(  -214.30), EASYSIMD_FLOAT32_C(  -894.36),
        EASYSIMD_FLOAT32_C(  -429.68), EASYSIMD_FLOAT32_C(   395.52), EASYSIMD_FLOAT32_C(  -750.28), EASYSIMD_FLOAT32_C(  -533.55) },
      { EASYSIMD_FLOAT32_C(   915.61), EASYSIMD_FLOAT32_C(   -26.70), EASYSIMD_FLOAT32_C(   741.12), EASYSIMD_FLOAT32_C(  -352.84),
        EASYSIMD_FLOAT32_C(  -143.61), EASYSIMD_FLOAT32_C(  -443.43), EASYSIMD_FLOAT32_C(   954.36), EASYSIMD_FLOAT32_C(   803.96),
        EASYSIMD_FLOAT32_C(  -627.14), EASYSIMD_FLOAT32_C(  -637.21), EASYSIMD_FLOAT32_C(  -214.30), EASYSIMD_FLOAT32_C(  -894.36),
        EASYSIMD_FLOAT32_C(  -429.68), EASYSIMD_FLOAT32_C(   395.52), EASYSIMD_FLOAT32_C(  -750.28), EASYSIMD_FLOAT32_C(  -533.55) } },
    { { EASYSIMD_FLOAT32_C(   207.35), EASYSIMD_FLOAT32_C(  -216.84), EASYSIMD_FLOAT32_C(  -799.36), EASYSIMD_FLOAT32_C(   285.78),
        EASYSIMD_FLOAT32_C(  -810.40), EASYSIMD_FLOAT32_C(   928.19), EASYSIMD_FLOAT32_C(  -885.45), EASYSIMD_FLOAT32_C(  -449.19),
        EASYSIMD_FLOAT32_C(   505.45), EASYSIMD_FLOAT32_C(   857.81), EASYSIMD_FLOAT32_C(  -894.39), EASYSIMD_FLOAT32_C(   825.24),
        EASYSIMD_FLOAT32_C(   428.29), EASYSIMD_FLOAT32_C(  -748.14), EASYSIMD_FLOAT32_C(  -831.93), EASYSIMD_FLOAT32_C(   343.89) },
      { EASYSIMD_FLOAT32_C(   207.35), EASYSIMD_FLOAT32_C(  -216.84), EASYSIMD_FLOAT32_C(  -799.36), EASYSIMD_FLOAT32_C(   285.78),
        EASYSIMD_FLOAT32_C(  -810.40), EASYSIMD_FLOAT32_C(   928.19), EASYSIMD_FLOAT32_C(  -885.45), EASYSIMD_FLOAT32_C(  -449.19),
        EASYSIMD_FLOAT32_C(   505.45), EASYSIMD_FLOAT32_C(   857.81), EASYSIMD_FLOAT32_C(  -894.39), EASYSIMD_FLOAT32_C(   825.24),
        EASYSIMD_FLOAT32_C(   428.29), EASYSIMD_FLOAT32_C(  -748.14), EASYSIMD_FLOAT32_C(  -831.93), EASYSIMD_FLOAT32_C(   343.89) } },
    { { EASYSIMD_FLOAT32_C(   225.16), EASYSIMD_FLOAT32_C(   909.19), EASYSIMD_FLOAT32_C(   991.05), EASYSIMD_FLOAT32_C(  -918.45),
        EASYSIMD_FLOAT32_C(  -534.23), EASYSIMD_FLOAT32_C(   945.41), EASYSIMD_FLOAT32_C(   885.51), EASYSIMD_FLOAT32_C(  -161.37),
        EASYSIMD_FLOAT32_C(  -691.80), EASYSIMD_FLOAT32_C(  -328.80), EASYSIMD_FLOAT32_C(   -55.73), EASYSIMD_FLOAT32_C(  -121.48),
        EASYSIMD_FLOAT32_C(  -933.28), EASYSIMD_FLOAT32_C(   193.99), EASYSIMD_FLOAT32_C(   344.96), EASYSIMD_FLOAT32_C(   274.08) },
      { EASYSIMD_FLOAT32_C(   225.16), EASYSIMD_FLOAT32_C(   909.19), EASYSIMD_FLOAT32_C(   991.05), EASYSIMD_FLOAT32_C(  -918.45),
        EASYSIMD_FLOAT32_C(  -534.23), EASYSIMD_FLOAT32_C(   945.41), EASYSIMD_FLOAT32_C(   885.51), EASYSIMD_FLOAT32_C(  -161.37),
        EASYSIMD_FLOAT32_C(  -691.80), EASYSIMD_FLOAT32_C(  -328.80), EASYSIMD_FLOAT32_C(   -55.73), EASYSIMD_FLOAT32_C(  -121.48),
        EASYSIMD_FLOAT32_C(  -933.28), EASYSIMD_FLOAT32_C(   193.99), EASYSIMD_FLOAT32_C(   344.96), EASYSIMD_FLOAT32_C(   274.08) } },
    { { EASYSIMD_FLOAT32_C(   977.14), EASYSIMD_FLOAT32_C(   545.61), EASYSIMD_FLOAT32_C(  -440.14), EASYSIMD_FLOAT32_C(  -833.26),
        EASYSIMD_FLOAT32_C(   473.80), EASYSIMD_FLOAT32_C(  -325.59), EASYSIMD_FLOAT32_C(  -282.45), EASYSIMD_FLOAT32_C(   -20.75),
        EASYSIMD_FLOAT32_C(  -467.78), EASYSIMD_FLOAT32_C(  -176.84), EASYSIMD_FLOAT32_C(  -195.51), EASYSIMD_FLOAT32_C(   960.51),
        EASYSIMD_FLOAT32_C(    75.02), EASYSIMD_FLOAT32_C(   -27.44), EASYSIMD_FLOAT32_C(   304.40), EASYSIMD_FLOAT32_C(  -699.82) },
      { EASYSIMD_FLOAT32_C(   977.14), EASYSIMD_FLOAT32_C(   545.61), EASYSIMD_FLOAT32_C(  -440.14), EASYSIMD_FLOAT32_C(  -833.26),
        EASYSIMD_FLOAT32_C(   473.80), EASYSIMD_FLOAT32_C(  -325.59), EASYSIMD_FLOAT32_C(  -282.45), EASYSIMD_FLOAT32_C(   -20.75),
        EASYSIMD_FLOAT32_C(  -467.78), EASYSIMD_FLOAT32_C(  -176.84), EASYSIMD_FLOAT32_C(  -195.51), EASYSIMD_FLOAT32_C(   960.51),
        EASYSIMD_FLOAT32_C(    75.02), EASYSIMD_FLOAT32_C(   -27.44), EASYSIMD_FLOAT32_C(   304.40), EASYSIMD_FLOAT32_C(  -699.82) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512 a = easysimd_mm512_loadu_ps(test_vec[i].a);
    easysimd_float32 r[sizeof(easysimd__m512) / sizeof(easysimd_float32)];
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm512_storeu_ps(r, a);
    } EASYSIMD_TEST_PERF_END("easysimd_mm512_storeu_ps");
    easysimd_assert_equal_vf32(sizeof(r) / sizeof(r[0]), r, test_vec[i].r, 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512 a = easysimd_test_x86_random_f32x16(EASYSIMD_FLOAT32_C(-1000.0), EASYSIMD_FLOAT32_C(1000.0));
    easysimd_float32 r[sizeof(easysimd__m512) / sizeof(easysimd_float32)];
    easysimd_mm512_storeu_ps(r, a);

    easysimd_test_x86_write_f32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_codegen_write_vf32(2, sizeof(r) / sizeof(r[0]), r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_storeu_pd (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const easysimd_float64 a[8];
    const easysimd_float64 r[8];
  } test_vec[] = {
    { { EASYSIMD_FLOAT64_C(   -69.14), EASYSIMD_FLOAT64_C(   856.01), EASYSIMD_FLOAT64_C(  -929.34), EASYSIMD_FLOAT64_C(  -119.75),
        EASYSIMD_FLOAT64_C(   982.67), EASYSIMD_FLOAT64_C(  -192.35), EASYSIMD_FLOAT64_C(   296.51), EASYSIMD_FLOAT64_C(   905.63) },
      { EASYSIMD_FLOAT64_C(   -69.14), EASYSIMD_FLOAT64_C(   856.01), EASYSIMD_FLOAT64_C(  -929.34), EASYSIMD_FLOAT64_C(  -119.75),
        EASYSIMD_FLOAT64_C(   982.67), EASYSIMD_FLOAT64_C(  -192.35), EASYSIMD_FLOAT64_C(   296.51), EASYSIMD_FLOAT64_C(   905.63) } },
    { { EASYSIMD_FLOAT64_C(    53.25), EASYSIMD_FLOAT64_C(    12.57), EASYSIMD_FLOAT64_C(   803.96), EASYSIMD_FLOAT64_C(   166.71),
        EASYSIMD_FLOAT64_C(   152.01), EASYSIMD_FLOAT64_C(  -117.78), EASYSIMD_FLOAT64_C(   723.82), EASYSIMD_FLOAT64_C(   250.54) },
      { EASYSIMD_FLOAT64_C(    53.25), EASYSIMD_FLOAT64_C(    12.57), EASYSIMD_FLOAT64_C(   803.96), EASYSIMD_FLOAT64_C(   166.71),
        EASYSIMD_FLOAT64_C(   152.01), EASYSIMD_FLOAT64_C(  -117.78), EASYSIMD_FLOAT64_C(   723.82), EASYSIMD_FLOAT64_C(   250.54) } },
    { { EASYSIMD_FLOAT64_C(   210.83), EASYSIMD_FLOAT64_C(   290.01), EASYSIMD_FLOAT64_C(    80.37), EASYSIMD_FLOAT64_C(  -407.81),
        EASYSIMD_FLOAT64_C(   -26.82), EASYSIMD_FLOAT64_C(  -856.31), EASYSIMD_FLOAT64_C(   704.42), EASYSIMD_FLOAT64_C(  -495.93) },
      { EASYSIMD_FLOAT64_C(   210.83), EASYSIMD_FLOAT64_C(   290.01), EASYSIMD_FLOAT64_C(    80.37), EASYSIMD_FLOAT64_C(  -407.81),
        EASYSIMD_FLOAT64_C(   -26.82), EASYSIMD_FLOAT64_C(  -856.31), EASYSIMD_FLOAT64_C(   704.42), EASYSIMD_FLOAT64_C(  -495.93) } },
    { { EASYSIMD_FLOAT64_C(   217.11), EASYSIMD_FLOAT64_C(   447.34), EASYSIMD_FLOAT64_C(  -924.95), EASYSIMD_FLOAT64_C(   285.08),
        EASYSIMD_FLOAT64_C(   132.52), EASYSIMD_FLOAT64_C(   -69.99), EASYSIMD_FLOAT64_C(  -872.50), EASYSIMD_FLOAT64_C(  -936.63) },
      { EASYSIMD_FLOAT64_C(   217.11), EASYSIMD_FLOAT64_C(   447.34), EASYSIMD_FLOAT64_C(  -924.95), EASYSIMD_FLOAT64_C(   285.08),
        EASYSIMD_FLOAT64_C(   132.52), EASYSIMD_FLOAT64_C(   -69.99), EASYSIMD_FLOAT64_C(  -872.50), EASYSIMD_FLOAT64_C(  -936.63) } },
    { { EASYSIMD_FLOAT64_C(  -213.99), EASYSIMD_FLOAT64_C(  -801.84), EASYSIMD_FLOAT64_C(   -56.38), EASYSIMD_FLOAT64_C(  -231.32),
        EASYSIMD_FLOAT64_C(     5.81), EASYSIMD_FLOAT64_C(  -759.87), EASYSIMD_FLOAT64_C(  -325.69), EASYSIMD_FLOAT64_C(  -940.94) },
      { EASYSIMD_FLOAT64_C(  -213.99), EASYSIMD_FLOAT64_C(  -801.84), EASYSIMD_FLOAT64_C(   -56.38), EASYSIMD_FLOAT64_C(  -231.32),
        EASYSIMD_FLOAT64_C(     5.81), EASYSIMD_FLOAT64_C(  -759.87), EASYSIMD_FLOAT64_C(  -325.69), EASYSIMD_FLOAT64_C(  -940.94) } },
    { { EASYSIMD_FLOAT64_C(   252.70), EASYSIMD_FLOAT64_C(  -521.72), EASYSIMD_FLOAT64_C(   225.76), EASYSIMD_FLOAT64_C(  -595.29),
        EASYSIMD_FLOAT64_C(   360.49), EASYSIMD_FLOAT64_C(   -50.42), EASYSIMD_FLOAT64_C(   655.26), EASYSIMD_FLOAT64_C(  -428.67) },
      { EASYSIMD_FLOAT64_C(   252.70), EASYSIMD_FLOAT64_C(  -521.72), EASYSIMD_FLOAT64_C(   225.76), EASYSIMD_FLOAT64_C(  -595.29),
        EASYSIMD_FLOAT64_C(   360.49), EASYSIMD_FLOAT64_C(   -50.42), EASYSIMD_FLOAT64_C(   655.26), EASYSIMD_FLOAT64_C(  -428.67) } },
    { { EASYSIMD_FLOAT64_C(  -760.41), EASYSIMD_FLOAT64_C(  -264.37), EASYSIMD_FLOAT64_C(   163.51), EASYSIMD_FLOAT64_C(   212.77),
        EASYSIMD_FLOAT64_C(  -120.68), EASYSIMD_FLOAT64_C(  -132.07), EASYSIMD_FLOAT64_C(   716.85), EASYSIMD_FLOAT64_C(  -903.57) },
      { EASYSIMD_FLOAT64_C(  -760.41), EASYSIMD_FLOAT64_C(  -264.37), EASYSIMD_FLOAT64_C(   163.51), EASYSIMD_FLOAT64_C(   212.77),
        EASYSIMD_FLOAT64_C(  -120.68), EASYSIMD_FLOAT64_C(  -132.07), EASYSIMD_FLOAT64_C(   716.85), EASYSIMD_FLOAT64_C(  -903.57) } },
    { { EASYSIMD_FLOAT64_C(  -684.72), EASYSIMD_FLOAT64_C(   791.89), EASYSIMD_FLOAT64_C(   381.50), EASYSIMD_FLOAT64_C(   447.79),
        EASYSIMD_FLOAT64_C(  -278.10), EASYSIMD_FLOAT64_C(   509.00), EASYSIMD_FLOAT64_C(   511.16), EASYSIMD_FLOAT64_C(   507.91) },
      { EASYSIMD_FLOAT64_C(  -684.72), EASYSIMD_FLOAT64_C(   791.89), EASYSIMD_FLOAT64_C(   381.50), EASYSIMD_FLOAT64_C(   447.79),
        EASYSIMD_FLOAT64_C(  -278.10), EASYSIMD_FLOAT64_C(   509.00), EASYSIMD_FLOAT64_C(   511.16), EASYSIMD_FLOAT64_C(   507.91) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512d a = easysimd_mm512_loadu_pd(test_vec[i].a);
    easysimd_float64 r[sizeof(easysimd__m512d) / sizeof(easysimd_float64)];
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm512_storeu_pd(r, a);
    } EASYSIMD_TEST_PERF_END("easysimd_mm512_storeu_pd");
    easysimd_assert_equal_vf64(sizeof(r) / sizeof(r[0]), r, test_vec[i].r, 1);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512d a = easysimd_test_x86_random_f64x8(EASYSIMD_FLOAT64_C(-1000.0), EASYSIMD_FLOAT64_C(1000.0));
    easysimd_float64 r[sizeof(easysimd__m512d) / sizeof(easysimd_float64)];
    easysimd_mm512_storeu_pd(r, a);

    easysimd_test_x86_write_f64x8(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_codegen_write_vf64(2, sizeof(r) / sizeof(r[0]), r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_storeu_si512 (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int32_t a[16];
    const int32_t r[16];
  } test_vec[] = {
    { {  INT32_C(   953140385),  INT32_C(   603411701), -INT32_C(    24287193),  INT32_C(   735616453),  INT32_C(  1706544629),  INT32_C(  1131092172), -INT32_C(   994419274),  INT32_C(   757153676),
        -INT32_C(   110694140),  INT32_C(  1830640965), -INT32_C(  1972655419),  INT32_C(  1035289416), -INT32_C(   576558063),  INT32_C(   992021892), -INT32_C(   134227093),  INT32_C(   505684250) },
      {  INT32_C(   953140385),  INT32_C(   603411701), -INT32_C(    24287193),  INT32_C(   735616453),  INT32_C(  1706544629),  INT32_C(  1131092172), -INT32_C(   994419274),  INT32_C(   757153676),
        -INT32_C(   110694140),  INT32_C(  1830640965), -INT32_C(  1972655419),  INT32_C(  1035289416), -INT32_C(   576558063),  INT32_C(   992021892), -INT32_C(   134227093),  INT32_C(   505684250) } },
    { {  INT32_C(  1461226002), -INT32_C(  1396427289),  INT32_C(   657862879), -INT32_C(  2073760909), -INT32_C(   597555624),  INT32_C(  2132247316),  INT32_C(  2021005150),  INT32_C(  1251449400),
         INT32_C(   211922725), -INT32_C(  1011259676),  INT32_C(   166457238),  INT32_C(   864964571),  INT32_C(  1779429462), -INT32_C(   773249165),  INT32_C(  1984519998),  INT32_C(   515956985) },
      {  INT32_C(  1461226002), -INT32_C(  1396427289),  INT32_C(   657862879), -INT32_C(  2073760909), -INT32_C(   597555624),  INT32_C(  2132247316),  INT32_C(  2021005150),  INT32_C(  1251449400),
         INT32_C(   211922725), -INT32_C(  1011259676),  INT32_C(   166457238),  INT32_C(   864964571),  INT32_C(  1779429462), -INT32_C(   773249165),  INT32_C(  1984519998),  INT32_C(   515956985) } },
    { {  INT32_C(  1932222863),  INT32_C(  1563944135), -INT32_C(  1368972589), -INT32_C(   941492879),  INT32_C(  1479668197),  INT32_C(  1445534232),  INT32_C(  1942778489), -INT32_C(   493777837),
        -INT32_C(  1252606739),  INT32_C(  1947372960),  INT32_C(   539130287),  INT32_C(  1407714414),  INT32_C(   229317109), -INT32_C(  1385966540), -INT32_C(  1709166777), -INT32_C(  1468222789) },
      {  INT32_C(  1932222863),  INT32_C(  1563944135), -INT32_C(  1368972589), -INT32_C(   941492879),  INT32_C(  1479668197),  INT32_C(  1445534232),  INT32_C(  1942778489), -INT32_C(   493777837),
        -INT32_C(  1252606739),  INT32_C(  1947372960),  INT32_C(   539130287),  INT32_C(  1407714414),  INT32_C(   229317109), -INT32_C(  1385966540), -INT32_C(  1709166777), -INT32_C(  1468222789) } },
    { {  INT32_C(   257806958),  INT32_C(   243495007),  INT32_C(  1479517673), -INT32_C(  1632954455),  INT32_C(  1688950576),  INT32_C(  1913785899), -INT32_C(   133418435),  INT32_C(  1403095524),
        -INT32_C(  1151140261),  INT32_C(  1489626478),  INT32_C(   884013194),  INT32_C(  1087527695), -INT32_C(   559645006), -INT32_C(   900680052), -INT32_C(   842899991),  INT32_C(  1092641766) },
      {  INT32_C(   257806958),  INT32_C(   243495007),  INT32_C(  1479517673), -INT32_C(  1632954455),  INT32_C(  1688950576),  INT32_C(  1913785899), -INT32_C(   133418435),  INT32_C(  1403095524),
        -INT32_C(  1151140261),  INT32_C(  1489626478),  INT32_C(   884013194),  INT32_C(  1087527695), -INT32_C(   559645006), -INT32_C(   900680052), -INT32_C(   842899991),  INT32_C(  1092641766) } },
    { { -INT32_C(   788757918), -INT32_C(   232208793), -INT32_C(   836314946), -INT32_C(   435226572),  INT32_C(    63222390),  INT32_C(  1389172073),  INT32_C(  1478463346),  INT32_C(  1436106995),
         INT32_C(   707106498),  INT32_C(   438062684),  INT32_C(  1525170726), -INT32_C(  1321077190),  INT32_C(   313787817), -INT32_C(  1939570406),  INT32_C(    65307408), -INT32_C(  2041020733) },
      { -INT32_C(   788757918), -INT32_C(   232208793), -INT32_C(   836314946), -INT32_C(   435226572),  INT32_C(    63222390),  INT32_C(  1389172073),  INT32_C(  1478463346),  INT32_C(  1436106995),
         INT32_C(   707106498),  INT32_C(   438062684),  INT32_C(  1525170726), -INT32_C(  1321077190),  INT32_C(   313787817), -INT32_C(  1939570406),  INT32_C(    65307408), -INT32_C(  2041020733) } },
    { {  INT32_C(  1890614804), -INT32_C(   225784628),  INT32_C(  1213035278),  INT32_C(   318344809), -INT32_C(  1373327981),  INT32_C(  1060800558), -INT32_C(   817750260), -INT32_C(  1319789667),
        -INT32_C(   450820839), -INT32_C(   539513903), -INT32_C(  2010635234),  INT32_C(  1184506290), -INT32_C(    34291761),  INT32_C(  1396452935), -INT32_C(   366772403),  INT32_C(   865826842) },
      {  INT32_C(  1890614804), -INT32_C(   225784628),  INT32_C(  1213035278),  INT32_C(   318344809), -INT32_C(  1373327981),  INT32_C(  1060800558), -INT32_C(   817750260), -INT32_C(  1319789667),
        -INT32_C(   450820839), -INT32_C(   539513903), -INT32_C(  2010635234),  INT32_C(  1184506290), -INT32_C(    34291761),  INT32_C(  1396452935), -INT32_C(   366772403),  INT32_C(   865826842) } },
    { {  INT32_C(  1327021182), -INT32_C(  2043678872), -INT32_C(   972138732),  INT32_C(  1192012152), -INT32_C(  1354432408),  INT32_C(  2080604463),  INT32_C(   442967552),  INT32_C(   474808990),
         INT32_C(   661415359),  INT32_C(  1772985173),  INT32_C(  1781513458), -INT32_C(   843957147),  INT32_C(  1803351868),  INT32_C(  2045280120),  INT32_C(  1150504869),  INT32_C(   274784593) },
      {  INT32_C(  1327021182), -INT32_C(  2043678872), -INT32_C(   972138732),  INT32_C(  1192012152), -INT32_C(  1354432408),  INT32_C(  2080604463),  INT32_C(   442967552),  INT32_C(   474808990),
         INT32_C(   661415359),  INT32_C(  1772985173),  INT32_C(  1781513458), -INT32_C(   843957147),  INT32_C(  1803351868),  INT32_C(  2045280120),  INT32_C(  1150504869),  INT32_C(   274784593) } },
    { { -INT32_C(  1690842042),  INT32_C(  1493493095),  INT32_C(   113521825), -INT32_C(  1395427728), -INT32_C(   451391635),  INT32_C(  1952317647), -INT32_C(  1598492081),  INT32_C(   431036883),
         INT32_C(  1303767269),  INT32_C(  1856420301),  INT32_C(  1567910637),  INT32_C(  1292519392),  INT32_C(  1714627223),  INT32_C(  1910149410),  INT32_C(  1443992451), -INT32_C(  1854881108) },
      { -INT32_C(  1690842042),  INT32_C(  1493493095),  INT32_C(   113521825), -INT32_C(  1395427728), -INT32_C(   451391635),  INT32_C(  1952317647), -INT32_C(  1598492081),  INT32_C(   431036883),
         INT32_C(  1303767269),  INT32_C(  1856420301),  INT32_C(  1567910637),  INT32_C(  1292519392),  INT32_C(  1714627223),  INT32_C(  1910149410),  INT32_C(  1443992451), -INT32_C(  1854881108) } }

  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    int32_t r[sizeof(easysimd__m512i) / sizeof(int32_t)];
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm512_storeu_si512(r, a);
    } EASYSIMD_TEST_PERF_END("easysimd_mm512_storeu_si512");
    easysimd_assert_equal_vi32(sizeof(r) / sizeof(r[0]), r, test_vec[i].r);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    int32_t r[sizeof(easysimd__m512i) / sizeof(int32_t)];
    easysimd_mm512_storeu_si512(r, a);

    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_codegen_write_vi32(2, sizeof(r) / sizeof(r[0]), r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_stream_si512 (EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int32_t a[16];
    const int32_t r[16];
  } test_vec[] = {
    { {  INT32_C(   953140385),  INT32_C(   603411701), -INT32_C(    24287193),  INT32_C(   735616453),  INT32_C(  1706544629),  INT32_C(  1131092172), -INT32_C(   994419274),  INT32_C(   757153676),
        -INT32_C(   110694140),  INT32_C(  1830640965), -INT32_C(  1972655419),  INT32_C(  1035289416), -INT32_C(   576558063),  INT32_C(   992021892), -INT32_C(   134227093),  INT32_C(   505684250) },
      {  INT32_C(   953140385),  INT32_C(   603411701), -INT32_C(    24287193),  INT32_C(   735616453),  INT32_C(  1706544629),  INT32_C(  1131092172), -INT32_C(   994419274),  INT32_C(   757153676),
        -INT32_C(   110694140),  INT32_C(  1830640965), -INT32_C(  1972655419),  INT32_C(  1035289416), -INT32_C(   576558063),  INT32_C(   992021892), -INT32_C(   134227093),  INT32_C(   505684250) } },
    { {  INT32_C(  1461226002), -INT32_C(  1396427289),  INT32_C(   657862879), -INT32_C(  2073760909), -INT32_C(   597555624),  INT32_C(  2132247316),  INT32_C(  2021005150),  INT32_C(  1251449400),
         INT32_C(   211922725), -INT32_C(  1011259676),  INT32_C(   166457238),  INT32_C(   864964571),  INT32_C(  1779429462), -INT32_C(   773249165),  INT32_C(  1984519998),  INT32_C(   515956985) },
      {  INT32_C(  1461226002), -INT32_C(  1396427289),  INT32_C(   657862879), -INT32_C(  2073760909), -INT32_C(   597555624),  INT32_C(  2132247316),  INT32_C(  2021005150),  INT32_C(  1251449400),
         INT32_C(   211922725), -INT32_C(  1011259676),  INT32_C(   166457238),  INT32_C(   864964571),  INT32_C(  1779429462), -INT32_C(   773249165),  INT32_C(  1984519998),  INT32_C(   515956985) } },
    { {  INT32_C(  1932222863),  INT32_C(  1563944135), -INT32_C(  1368972589), -INT32_C(   941492879),  INT32_C(  1479668197),  INT32_C(  1445534232),  INT32_C(  1942778489), -INT32_C(   493777837),
        -INT32_C(  1252606739),  INT32_C(  1947372960),  INT32_C(   539130287),  INT32_C(  1407714414),  INT32_C(   229317109), -INT32_C(  1385966540), -INT32_C(  1709166777), -INT32_C(  1468222789) },
      {  INT32_C(  1932222863),  INT32_C(  1563944135), -INT32_C(  1368972589), -INT32_C(   941492879),  INT32_C(  1479668197),  INT32_C(  1445534232),  INT32_C(  1942778489), -INT32_C(   493777837),
        -INT32_C(  1252606739),  INT32_C(  1947372960),  INT32_C(   539130287),  INT32_C(  1407714414),  INT32_C(   229317109), -INT32_C(  1385966540), -INT32_C(  1709166777), -INT32_C(  1468222789) } },
    { {  INT32_C(   257806958),  INT32_C(   243495007),  INT32_C(  1479517673), -INT32_C(  1632954455),  INT32_C(  1688950576),  INT32_C(  1913785899), -INT32_C(   133418435),  INT32_C(  1403095524),
        -INT32_C(  1151140261),  INT32_C(  1489626478),  INT32_C(   884013194),  INT32_C(  1087527695), -INT32_C(   559645006), -INT32_C(   900680052), -INT32_C(   842899991),  INT32_C(  1092641766) },
      {  INT32_C(   257806958),  INT32_C(   243495007),  INT32_C(  1479517673), -INT32_C(  1632954455),  INT32_C(  1688950576),  INT32_C(  1913785899), -INT32_C(   133418435),  INT32_C(  1403095524),
        -INT32_C(  1151140261),  INT32_C(  1489626478),  INT32_C(   884013194),  INT32_C(  1087527695), -INT32_C(   559645006), -INT32_C(   900680052), -INT32_C(   842899991),  INT32_C(  1092641766) } },
    { { -INT32_C(   788757918), -INT32_C(   232208793), -INT32_C(   836314946), -INT32_C(   435226572),  INT32_C(    63222390),  INT32_C(  1389172073),  INT32_C(  1478463346),  INT32_C(  1436106995),
         INT32_C(   707106498),  INT32_C(   438062684),  INT32_C(  1525170726), -INT32_C(  1321077190),  INT32_C(   313787817), -INT32_C(  1939570406),  INT32_C(    65307408), -INT32_C(  2041020733) },
      { -INT32_C(   788757918), -INT32_C(   232208793), -INT32_C(   836314946), -INT32_C(   435226572),  INT32_C(    63222390),  INT32_C(  1389172073),  INT32_C(  1478463346),  INT32_C(  1436106995),
         INT32_C(   707106498),  INT32_C(   438062684),  INT32_C(  1525170726), -INT32_C(  1321077190),  INT32_C(   313787817), -INT32_C(  1939570406),  INT32_C(    65307408), -INT32_C(  2041020733) } },
    { {  INT32_C(  1890614804), -INT32_C(   225784628),  INT32_C(  1213035278),  INT32_C(   318344809), -INT32_C(  1373327981),  INT32_C(  1060800558), -INT32_C(   817750260), -INT32_C(  1319789667),
        -INT32_C(   450820839), -INT32_C(   539513903), -INT32_C(  2010635234),  INT32_C(  1184506290), -INT32_C(    34291761),  INT32_C(  1396452935), -INT32_C(   366772403),  INT32_C(   865826842) },
      {  INT32_C(  1890614804), -INT32_C(   225784628),  INT32_C(  1213035278),  INT32_C(   318344809), -INT32_C(  1373327981),  INT32_C(  1060800558), -INT32_C(   817750260), -INT32_C(  1319789667),
        -INT32_C(   450820839), -INT32_C(   539513903), -INT32_C(  2010635234),  INT32_C(  1184506290), -INT32_C(    34291761),  INT32_C(  1396452935), -INT32_C(   366772403),  INT32_C(   865826842) } },
    { {  INT32_C(  1327021182), -INT32_C(  2043678872), -INT32_C(   972138732),  INT32_C(  1192012152), -INT32_C(  1354432408),  INT32_C(  2080604463),  INT32_C(   442967552),  INT32_C(   474808990),
         INT32_C(   661415359),  INT32_C(  1772985173),  INT32_C(  1781513458), -INT32_C(   843957147),  INT32_C(  1803351868),  INT32_C(  2045280120),  INT32_C(  1150504869),  INT32_C(   274784593) },
      {  INT32_C(  1327021182), -INT32_C(  2043678872), -INT32_C(   972138732),  INT32_C(  1192012152), -INT32_C(  1354432408),  INT32_C(  2080604463),  INT32_C(   442967552),  INT32_C(   474808990),
         INT32_C(   661415359),  INT32_C(  1772985173),  INT32_C(  1781513458), -INT32_C(   843957147),  INT32_C(  1803351868),  INT32_C(  2045280120),  INT32_C(  1150504869),  INT32_C(   274784593) } },
    { { -INT32_C(  1690842042),  INT32_C(  1493493095),  INT32_C(   113521825), -INT32_C(  1395427728), -INT32_C(   451391635),  INT32_C(  1952317647), -INT32_C(  1598492081),  INT32_C(   431036883),
         INT32_C(  1303767269),  INT32_C(  1856420301),  INT32_C(  1567910637),  INT32_C(  1292519392),  INT32_C(  1714627223),  INT32_C(  1910149410),  INT32_C(  1443992451), -INT32_C(  1854881108) },
      { -INT32_C(  1690842042),  INT32_C(  1493493095),  INT32_C(   113521825), -INT32_C(  1395427728), -INT32_C(   451391635),  INT32_C(  1952317647), -INT32_C(  1598492081),  INT32_C(   431036883),
         INT32_C(  1303767269),  INT32_C(  1856420301),  INT32_C(  1567910637),  INT32_C(  1292519392),  INT32_C(  1714627223),  INT32_C(  1910149410),  INT32_C(  1443992451), -INT32_C(  1854881108) } }

  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    EASYSIMD_ALIGN_LIKE_64(easysimd__m512i) int32_t r[sizeof(easysimd__m512i) / sizeof(int32_t)];
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm512_stream_si512(r, a);
    } EASYSIMD_TEST_PERF_END("_mm512_stream_si512");
    easysimd_assert_equal_vi32(sizeof(r) / sizeof(r[0]), r, test_vec[i].r);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    int32_t r[sizeof(easysimd__m512i) / sizeof(int32_t)];
    easysimd_mm512_storeu_si512(r, a);

    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_codegen_write_vi32(2, sizeof(r) / sizeof(r[0]), r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm512_stream_load_si512(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  const struct {
    EASYSIMD_ALIGN_LIKE_64(easysimd__m512i) const int32_t a[16];
    const int32_t r[16];
  } test_vec[] = {
    { {  INT32_C(   683100271), -INT32_C(  1458076484), -INT32_C(  1972004504), -INT32_C(  1142701052),  INT32_C(   236872193),  INT32_C(  1114744587), -INT32_C(  1727431607), -INT32_C(  1057265328),
         INT32_C(  1843966641), -INT32_C(  1642594506), -INT32_C(  1658221415),  INT32_C(  1381567569),  INT32_C(  2036365166),  INT32_C(  1740427806), -INT32_C(  1644051122), -INT32_C(   547423186) },
      {  INT32_C(   683100271), -INT32_C(  1458076484), -INT32_C(  1972004504), -INT32_C(  1142701052),  INT32_C(   236872193),  INT32_C(  1114744587), -INT32_C(  1727431607), -INT32_C(  1057265328),
         INT32_C(  1843966641), -INT32_C(  1642594506), -INT32_C(  1658221415),  INT32_C(  1381567569),  INT32_C(  2036365166),  INT32_C(  1740427806), -INT32_C(  1644051122), -INT32_C(   547423186) } },
    { { -INT32_C(   464697426), -INT32_C(   545037242),  INT32_C(  1098755312),  INT32_C(   647288504),  INT32_C(  1822487629),  INT32_C(   349396166),  INT32_C(  1353962529),  INT32_C(  2117013968),
        -INT32_C(  1620870056), -INT32_C(   780212512),  INT32_C(  1242758034),  INT32_C(   527476433),  INT32_C(  1636503707), -INT32_C(  1904845204),  INT32_C(    64891187), -INT32_C(  1820193478) },
      { -INT32_C(   464697426), -INT32_C(   545037242),  INT32_C(  1098755312),  INT32_C(   647288504),  INT32_C(  1822487629),  INT32_C(   349396166),  INT32_C(  1353962529),  INT32_C(  2117013968),
        -INT32_C(  1620870056), -INT32_C(   780212512),  INT32_C(  1242758034),  INT32_C(   527476433),  INT32_C(  1636503707), -INT32_C(  1904845204),  INT32_C(    64891187), -INT32_C(  1820193478) } },
    { {  INT32_C(  1781720458),  INT32_C(  1564192971),  INT32_C(  2108116652), -INT32_C(  1885595660), -INT32_C(  1796135128), -INT32_C(  1188927610), -INT32_C(   893648752), -INT32_C(  1738719730),
        -INT32_C(   301822173), -INT32_C(   330613184), -INT32_C(  2140540276),  INT32_C(   839910922), -INT32_C(  1278869203), -INT32_C(   127080088), -INT32_C(   138270231), -INT32_C(  1953554329) },
      {  INT32_C(  1781720458),  INT32_C(  1564192971),  INT32_C(  2108116652), -INT32_C(  1885595660), -INT32_C(  1796135128), -INT32_C(  1188927610), -INT32_C(   893648752), -INT32_C(  1738719730),
        -INT32_C(   301822173), -INT32_C(   330613184), -INT32_C(  2140540276),  INT32_C(   839910922), -INT32_C(  1278869203), -INT32_C(   127080088), -INT32_C(   138270231), -INT32_C(  1953554329) } },
    { { -INT32_C(   277245265),  INT32_C(  1557906896), -INT32_C(  1042528841),  INT32_C(  2029251659),  INT32_C(  1428994797), -INT32_C(  1941071709),  INT32_C(   696520897), -INT32_C(   541846736),
         INT32_C(  1976511909), -INT32_C(  1429099790),  INT32_C(   980135663), -INT32_C(  2001510502), -INT32_C(  1126310119),  INT32_C(   961031031),  INT32_C(  1801636923), -INT32_C(  2058742048) },
      { -INT32_C(   277245265),  INT32_C(  1557906896), -INT32_C(  1042528841),  INT32_C(  2029251659),  INT32_C(  1428994797), -INT32_C(  1941071709),  INT32_C(   696520897), -INT32_C(   541846736),
         INT32_C(  1976511909), -INT32_C(  1429099790),  INT32_C(   980135663), -INT32_C(  2001510502), -INT32_C(  1126310119),  INT32_C(   961031031),  INT32_C(  1801636923), -INT32_C(  2058742048) } },
    { {  INT32_C(   922425667), -INT32_C(  1277113148),  INT32_C(   367938426), -INT32_C(  1013079638), -INT32_C(   142640512), -INT32_C(   533673819),  INT32_C(  1951109780), -INT32_C(   319121752),
         INT32_C(  1931670959),  INT32_C(  1009189569), -INT32_C(   128903859),  INT32_C(   918286006),  INT32_C(   237845352), -INT32_C(  1745986045), -INT32_C(  1727251728),  INT32_C(  2139424464) },
      {  INT32_C(   922425667), -INT32_C(  1277113148),  INT32_C(   367938426), -INT32_C(  1013079638), -INT32_C(   142640512), -INT32_C(   533673819),  INT32_C(  1951109780), -INT32_C(   319121752),
         INT32_C(  1931670959),  INT32_C(  1009189569), -INT32_C(   128903859),  INT32_C(   918286006),  INT32_C(   237845352), -INT32_C(  1745986045), -INT32_C(  1727251728),  INT32_C(  2139424464) } },
    { { -INT32_C(  1124882437), -INT32_C(   151512407), -INT32_C(   437368529), -INT32_C(  1608799689), -INT32_C(   391231259), -INT32_C(  1753244506), -INT32_C(  1506767914), -INT32_C(  1943620207),
         INT32_C(    88676700),  INT32_C(  1660633395), -INT32_C(  1035474293),  INT32_C(  2036490900),  INT32_C(  1365315754), -INT32_C(  2081890131), -INT32_C(    47572884),  INT32_C(   696930509) },
      { -INT32_C(  1124882437), -INT32_C(   151512407), -INT32_C(   437368529), -INT32_C(  1608799689), -INT32_C(   391231259), -INT32_C(  1753244506), -INT32_C(  1506767914), -INT32_C(  1943620207),
         INT32_C(    88676700),  INT32_C(  1660633395), -INT32_C(  1035474293),  INT32_C(  2036490900),  INT32_C(  1365315754), -INT32_C(  2081890131), -INT32_C(    47572884),  INT32_C(   696930509) } },
    { { -INT32_C(  1674652823), -INT32_C(  1610733292), -INT32_C(  1486732013),  INT32_C(  1361101991), -INT32_C(  2103279147), -INT32_C(   838497694),  INT32_C(  1875586978), -INT32_C(   392669825),
         INT32_C(  1032111656),  INT32_C(    64783088),  INT32_C(  1856716487), -INT32_C(   658453757), -INT32_C(  1353031091), -INT32_C(  1887608851),  INT32_C(   251611279), -INT32_C(   956852322) },
      { -INT32_C(  1674652823), -INT32_C(  1610733292), -INT32_C(  1486732013),  INT32_C(  1361101991), -INT32_C(  2103279147), -INT32_C(   838497694),  INT32_C(  1875586978), -INT32_C(   392669825),
         INT32_C(  1032111656),  INT32_C(    64783088),  INT32_C(  1856716487), -INT32_C(   658453757), -INT32_C(  1353031091), -INT32_C(  1887608851),  INT32_C(   251611279), -INT32_C(   956852322) } },
    { {  INT32_C(  1308851038), -INT32_C(   984489730),  INT32_C(   557120542),  INT32_C(   368702664),  INT32_C(  1136939862),  INT32_C(  1121141171),  INT32_C(   659608201), -INT32_C(   940685463),
        -INT32_C(  1055526461), -INT32_C(   259627055),  INT32_C(   722582115),  INT32_C(    88083374),  INT32_C(   289932382), -INT32_C(   816637115),  INT32_C(  1475781869), -INT32_C(  1373707029) },
      {  INT32_C(  1308851038), -INT32_C(   984489730),  INT32_C(   557120542),  INT32_C(   368702664),  INT32_C(  1136939862),  INT32_C(  1121141171),  INT32_C(   659608201), -INT32_C(   940685463),
        -INT32_C(  1055526461), -INT32_C(   259627055),  INT32_C(   722582115),  INT32_C(    88083374),  INT32_C(   289932382), -INT32_C(   816637115),  INT32_C(  1475781869), -INT32_C(  1373707029) } }
  };

  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__m512i r;
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      r = easysimd_mm512_stream_load_si512((void*)&a);
    } EASYSIMD_TEST_PERF_END("easysimd_mm512_stream_load_si512");
    easysimd_test_x86_assert_equal_i32x16(r, easysimd_mm512_loadu_epi32(test_vec[i].r));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    easysimd__m512i r = a;

    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x16(2, r, EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_mask_storeu_epi8(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    const int8_t a[32];
    easysimd__mmask32 k;
    const int8_t r1[32];
    const int8_t r2[32];
  } test_vec[] = {
    { { -INT8_C(  17), -INT8_C(  40), -INT8_C(  24), -INT8_C(   3),  INT8_C(  94),  INT8_C( 112), -INT8_C(  66),  INT8_C(  51),
         INT8_C( 123), -INT8_C(  21),  INT8_C(  90),  INT8_C(   4), -INT8_C(  28),  INT8_C(  86), -INT8_C( 121),  INT8_C( 105),
        -INT8_C(  14), -INT8_C( 124),  INT8_C( 123), -INT8_C(  50), -INT8_C( 101), -INT8_C(   7), -INT8_C(  63), -INT8_C(  68),
        -INT8_C(  30), -INT8_C(  14),  INT8_C(  21),  INT8_C(  71), -INT8_C( 124), -INT8_C(  97), -INT8_C( 103),  INT8_C( 115) },
      UINT32_C(1384813157),
      {  INT8_C( 109),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),
         INT8_C(  85), -INT8_C( 126),  INT8_C(  65),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),
         INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),
         INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0) },
      { -INT8_C(  17),  INT8_C(   0), -INT8_C(  24),  INT8_C(   0),  INT8_C(   0),  INT8_C( 112), -INT8_C(  66),  INT8_C(   0),
         INT8_C(  85), -INT8_C(  21),  INT8_C(  65),  INT8_C(   0), -INT8_C(  28),  INT8_C(   0),  INT8_C(   0),  INT8_C( 105),
         INT8_C(   0), -INT8_C( 124),  INT8_C(   0), -INT8_C(  50),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0), -INT8_C(  68),
         INT8_C(   0), -INT8_C(  14),  INT8_C(   0),  INT8_C(   0), -INT8_C( 124),  INT8_C(   0), -INT8_C( 103),  INT8_C(   0) } },
    { { -INT8_C(  57), -INT8_C(  31),      INT8_MIN, -INT8_C(  30),  INT8_C(  70), -INT8_C(  15), -INT8_C(  31),  INT8_C(   1),
        -INT8_C(  22),  INT8_C(  74), -INT8_C(  82),  INT8_C( 103),  INT8_C(  46),  INT8_C(  41),      INT8_MAX,  INT8_C(  11),
         INT8_C( 101),  INT8_C(  83), -INT8_C(  54), -INT8_C( 108),  INT8_C(  61), -INT8_C(  48),  INT8_C(  72), -INT8_C(  58),
         INT8_C( 112),  INT8_C( 111), -INT8_C(  57), -INT8_C( 110),  INT8_C(   7), -INT8_C(  98), -INT8_C(  91), -INT8_C(  50) },
      UINT32_C( 332896289),
      { -INT8_C(  17),  INT8_C(   0), -INT8_C(  24),  INT8_C(   0),  INT8_C(   0),  INT8_C( 112), -INT8_C(  66),  INT8_C(   0),
         INT8_C(  85), -INT8_C(  21),  INT8_C(  65),  INT8_C(   0), -INT8_C(  28),  INT8_C(   0),  INT8_C(   0),  INT8_C( 105),
         INT8_C(   0), -INT8_C( 124),  INT8_C(   0), -INT8_C(  50),  INT8_C(   0),  INT8_C(   0),  INT8_C(   0), -INT8_C(  68),
         INT8_C(   0), -INT8_C(  14),  INT8_C(   0),  INT8_C(   0), -INT8_C( 124),  INT8_C(   0), -INT8_C( 103),  INT8_C(   0) },
      { -INT8_C(  57),  INT8_C(   0), -INT8_C(  24),  INT8_C(   0),  INT8_C(   0), -INT8_C(  15), -INT8_C(  66),  INT8_C(   0),
         INT8_C(  85), -INT8_C(  21),  INT8_C(  65),  INT8_C( 103),  INT8_C(  46),  INT8_C(   0),  INT8_C(   0),  INT8_C(  11),
         INT8_C( 101),  INT8_C(  83), -INT8_C(  54), -INT8_C(  50),  INT8_C(  61),  INT8_C(   0),  INT8_C(  72), -INT8_C(  58),
         INT8_C( 112),  INT8_C( 111),  INT8_C(   0),  INT8_C(   0),  INT8_C(   7),  INT8_C(   0), -INT8_C( 103),  INT8_C(   0) } },
    { {  INT8_C( 104), -INT8_C(  79), -INT8_C( 108),  INT8_C(  68),  INT8_C(  38), -INT8_C(   4),  INT8_C(  79), -INT8_C(  60),
        -INT8_C(  28),  INT8_C( 100), -INT8_C(  57),  INT8_C(  32),  INT8_C(  68),  INT8_C(  95), -INT8_C( 104), -INT8_C(  12),
         INT8_C(  63), -INT8_C(  41),  INT8_C(  20), -INT8_C( 114), -INT8_C(  36), -INT8_C(  57), -INT8_C(  28),      INT8_MIN,
         INT8_C(  30),  INT8_C(   9), -INT8_C(  92), -INT8_C( 101), -INT8_C(  34), -INT8_C( 114),  INT8_C(  46),  INT8_C(  70) },
      UINT32_C(2481640828),
      { -INT8_C(  57),  INT8_C(   0), -INT8_C(  24),  INT8_C(   0),  INT8_C(   0), -INT8_C(  15), -INT8_C(  66),  INT8_C(   0),
         INT8_C(  85), -INT8_C(  21),  INT8_C(  65),  INT8_C( 103),  INT8_C(  46),  INT8_C(   0),  INT8_C(   0),  INT8_C(  11),
         INT8_C( 101),  INT8_C(  83), -INT8_C(  54), -INT8_C(  50),  INT8_C(  61),  INT8_C(   0),  INT8_C(  72), -INT8_C(  58),
         INT8_C( 112),  INT8_C( 111),  INT8_C(   0),  INT8_C(   0),  INT8_C(   7),  INT8_C(   0), -INT8_C( 103),  INT8_C(   0) },
      { -INT8_C(  57),  INT8_C(   0), -INT8_C( 108),  INT8_C(  68),  INT8_C(  38), -INT8_C(   4),  INT8_C(  79),  INT8_C(   0),
        -INT8_C(  28), -INT8_C(  21), -INT8_C(  57),  INT8_C( 103),  INT8_C(  68),  INT8_C(   0), -INT8_C( 104), -INT8_C(  12),
         INT8_C( 101), -INT8_C(  41), -INT8_C(  54), -INT8_C( 114),  INT8_C(  61), -INT8_C(  57), -INT8_C(  28),      INT8_MIN,
         INT8_C(  30),  INT8_C(   9),  INT8_C(   0),  INT8_C(   0), -INT8_C(  34),  INT8_C(   0), -INT8_C( 103),  INT8_C(  70) } },
    { { -INT8_C( 106), -INT8_C( 111),  INT8_C(  93), -INT8_C(  44), -INT8_C( 126),  INT8_C(  32),  INT8_C(  87), -INT8_C(  46),
         INT8_C( 123), -INT8_C(  51),  INT8_C(  98), -INT8_C(  82),  INT8_C(  88), -INT8_C( 127), -INT8_C(  67), -INT8_C(  86),
        -INT8_C( 124),  INT8_C(  76),  INT8_C(  27), -INT8_C( 112),      INT8_MIN,  INT8_C(  38),  INT8_C( 122),  INT8_C(  67),
         INT8_C(  96), -INT8_C(  85),  INT8_C(  69),  INT8_C(  91),  INT8_C( 103), -INT8_C(  84),  INT8_C(  21), -INT8_C(   3) },
      UINT32_C(3127360763),
      { -INT8_C(  57),  INT8_C(   0), -INT8_C( 108),  INT8_C(  68),  INT8_C(  38), -INT8_C(   4),  INT8_C(  79),  INT8_C(   0),
        -INT8_C(  28), -INT8_C(  21), -INT8_C(  57),  INT8_C( 103),  INT8_C(  68),  INT8_C(   0), -INT8_C( 104), -INT8_C(  12),
         INT8_C( 101), -INT8_C(  41), -INT8_C(  54), -INT8_C( 114),  INT8_C(  61), -INT8_C(  57), -INT8_C(  28),      INT8_MIN,
         INT8_C(  30),  INT8_C(   9),  INT8_C(   0),  INT8_C(   0), -INT8_C(  34),  INT8_C(   0), -INT8_C( 103),  INT8_C(  70) },
      { -INT8_C( 106), -INT8_C( 111), -INT8_C( 108), -INT8_C(  44), -INT8_C( 126),  INT8_C(  32),  INT8_C(  87), -INT8_C(  46),
        -INT8_C(  28), -INT8_C(  21),  INT8_C(  98), -INT8_C(  82),  INT8_C(  88), -INT8_C( 127), -INT8_C( 104), -INT8_C(  86),
        -INT8_C( 124),  INT8_C(  76),  INT8_C(  27), -INT8_C( 114),  INT8_C(  61),  INT8_C(  38),  INT8_C( 122),      INT8_MIN,
         INT8_C(  30), -INT8_C(  85),  INT8_C(   0),  INT8_C(  91),  INT8_C( 103), -INT8_C(  84), -INT8_C( 103), -INT8_C(   3) } },
    { {  INT8_C(  15),  INT8_C(   9),  INT8_C(  31),  INT8_C(   6), -INT8_C(   2), -INT8_C(  37),  INT8_C(  85),  INT8_C( 115),
         INT8_C(  84),  INT8_C(  78),  INT8_C( 109),  INT8_C(  25),  INT8_C(  99), -INT8_C(  10),  INT8_C(  95), -INT8_C(  98),
        -INT8_C(   6), -INT8_C(  24),  INT8_C(  57), -INT8_C(  86), -INT8_C(  74),  INT8_C(  47), -INT8_C(  63),  INT8_C(  49),
         INT8_C(  59), -INT8_C(  43), -INT8_C(  23), -INT8_C(  70), -INT8_C(  68),  INT8_C(  96), -INT8_C(  53), -INT8_C(  53) },
      UINT32_C( 293070462),
      { -INT8_C( 106), -INT8_C( 111), -INT8_C( 108), -INT8_C(  44), -INT8_C( 126),  INT8_C(  32),  INT8_C(  87), -INT8_C(  46),
        -INT8_C(  28), -INT8_C(  21),  INT8_C(  98), -INT8_C(  82),  INT8_C(  88), -INT8_C( 127), -INT8_C( 104), -INT8_C(  86),
        -INT8_C( 124),  INT8_C(  76),  INT8_C(  27), -INT8_C( 114),  INT8_C(  61),  INT8_C(  38),  INT8_C( 122),      INT8_MIN,
         INT8_C(  30), -INT8_C(  85),  INT8_C(   0),  INT8_C(  91),  INT8_C( 103), -INT8_C(  84), -INT8_C( 103), -INT8_C(   3) },
      { -INT8_C( 106),  INT8_C(   9),  INT8_C(  31),  INT8_C(   6), -INT8_C(   2), -INT8_C(  37),  INT8_C(  85), -INT8_C(  46),
        -INT8_C(  28),  INT8_C(  78),  INT8_C( 109), -INT8_C(  82),  INT8_C(  88), -INT8_C(  10),  INT8_C(  95), -INT8_C(  98),
        -INT8_C(   6), -INT8_C(  24),  INT8_C(  57), -INT8_C( 114), -INT8_C(  74),  INT8_C(  47), -INT8_C(  63),      INT8_MIN,
         INT8_C(  59), -INT8_C(  85),  INT8_C(   0),  INT8_C(  91), -INT8_C(  68), -INT8_C(  84), -INT8_C( 103), -INT8_C(   3) } },
    { { -INT8_C(   7),  INT8_C(  89),  INT8_C( 103),  INT8_C( 110), -INT8_C(  95), -INT8_C( 103),  INT8_C(  70), -INT8_C(  32),
         INT8_C(  43), -INT8_C(  68),  INT8_C(  26), -INT8_C(  90),  INT8_C( 107), -INT8_C(   3), -INT8_C(  41),  INT8_C(  74),
        -INT8_C(  94),  INT8_C(  57),  INT8_C( 100),  INT8_C(  28), -INT8_C( 124),  INT8_C(  56),  INT8_C(  82),  INT8_C(  47),
        -INT8_C(  41),  INT8_C(  83),  INT8_C(  69),  INT8_C(  96),  INT8_C(  38), -INT8_C(  62), -INT8_C(  82),  INT8_C(  32) },
      UINT32_C(1316869001),
      { -INT8_C( 106),  INT8_C(   9),  INT8_C(  31),  INT8_C(   6), -INT8_C(   2), -INT8_C(  37),  INT8_C(  85), -INT8_C(  46),
        -INT8_C(  28),  INT8_C(  78),  INT8_C( 109), -INT8_C(  82),  INT8_C(  88), -INT8_C(  10),  INT8_C(  95), -INT8_C(  98),
        -INT8_C(   6), -INT8_C(  24),  INT8_C(  57), -INT8_C( 114), -INT8_C(  74),  INT8_C(  47), -INT8_C(  63),      INT8_MIN,
         INT8_C(  59), -INT8_C(  85),  INT8_C(   0),  INT8_C(  91), -INT8_C(  68), -INT8_C(  84), -INT8_C( 103), -INT8_C(   3) },
      { -INT8_C(   7),  INT8_C(   9),  INT8_C(  31),  INT8_C( 110), -INT8_C(   2), -INT8_C(  37),  INT8_C(  85), -INT8_C(  32),
         INT8_C(  43), -INT8_C(  68),  INT8_C( 109), -INT8_C(  82),  INT8_C( 107), -INT8_C(  10), -INT8_C(  41),  INT8_C(  74),
        -INT8_C(  94), -INT8_C(  24),  INT8_C( 100),  INT8_C(  28), -INT8_C( 124),  INT8_C(  56),  INT8_C(  82),      INT8_MIN,
         INT8_C(  59),  INT8_C(  83),  INT8_C(  69),  INT8_C(  96), -INT8_C(  68), -INT8_C(  84), -INT8_C(  82), -INT8_C(   3) } },
    { { -INT8_C(  62), -INT8_C(  63),  INT8_C( 101),  INT8_C(  84),  INT8_C( 120), -INT8_C(  27),  INT8_C(  81),  INT8_C(  45),
         INT8_C(  60), -INT8_C( 104), -INT8_C( 124), -INT8_C(  52),  INT8_C(  67), -INT8_C(   9), -INT8_C(  32),  INT8_C(  38),
        -INT8_C(  68),  INT8_C(  36), -INT8_C(  32), -INT8_C(  43), -INT8_C(  84), -INT8_C(   6),  INT8_C(  20), -INT8_C(   9),
        -INT8_C(  62),  INT8_C( 115),  INT8_C(  94), -INT8_C(  97),  INT8_C(  96), -INT8_C( 127),  INT8_C(  42),  INT8_C(  35) },
      UINT32_C(2334387677),
      { -INT8_C(   7),  INT8_C(   9),  INT8_C(  31),  INT8_C( 110), -INT8_C(   2), -INT8_C(  37),  INT8_C(  85), -INT8_C(  32),
         INT8_C(  43), -INT8_C(  68),  INT8_C( 109), -INT8_C(  82),  INT8_C( 107), -INT8_C(  10), -INT8_C(  41),  INT8_C(  74),
        -INT8_C(  94), -INT8_C(  24),  INT8_C( 100),  INT8_C(  28), -INT8_C( 124),  INT8_C(  56),  INT8_C(  82),      INT8_MIN,
         INT8_C(  59),  INT8_C(  83),  INT8_C(  69),  INT8_C(  96), -INT8_C(  68), -INT8_C(  84), -INT8_C(  82), -INT8_C(   3) },
      { -INT8_C(  62),  INT8_C(   9),  INT8_C( 101),  INT8_C(  84),  INT8_C( 120), -INT8_C(  37),  INT8_C(  81),  INT8_C(  45),
         INT8_C(  60), -INT8_C(  68), -INT8_C( 124), -INT8_C(  52),  INT8_C( 107), -INT8_C(   9), -INT8_C(  32),  INT8_C(  38),
        -INT8_C(  68),  INT8_C(  36),  INT8_C( 100),  INT8_C(  28), -INT8_C( 124), -INT8_C(   6),  INT8_C(  82),      INT8_MIN,
        -INT8_C(  62),  INT8_C( 115),  INT8_C(  69), -INT8_C(  97), -INT8_C(  68), -INT8_C(  84), -INT8_C(  82),  INT8_C(  35) } },
    { {  INT8_C(  63), -INT8_C(  20), -INT8_C(  26), -INT8_C(  97),  INT8_C(  89),  INT8_C( 100),  INT8_C(  66), -INT8_C(  66),
        -INT8_C(  61),  INT8_C(  11), -INT8_C(  33),  INT8_C(  70), -INT8_C(  76), -INT8_C(  43),  INT8_C( 118),  INT8_C(  87),
        -INT8_C(  33), -INT8_C(  99), -INT8_C(  68),  INT8_C(  92),  INT8_C(  34), -INT8_C(  64),  INT8_C(  57),  INT8_C(  40),
        -INT8_C(  17),  INT8_C(  58),  INT8_C( 113), -INT8_C(  83), -INT8_C(  79),  INT8_C( 117), -INT8_C(  31), -INT8_C(  15) },
      UINT32_C( 872708030),
      { -INT8_C(  62),  INT8_C(   9),  INT8_C( 101),  INT8_C(  84),  INT8_C( 120), -INT8_C(  37),  INT8_C(  81),  INT8_C(  45),
         INT8_C(  60), -INT8_C(  68), -INT8_C( 124), -INT8_C(  52),  INT8_C( 107), -INT8_C(   9), -INT8_C(  32),  INT8_C(  38),
        -INT8_C(  68),  INT8_C(  36),  INT8_C( 100),  INT8_C(  28), -INT8_C( 124), -INT8_C(   6),  INT8_C(  82),      INT8_MIN,
        -INT8_C(  62),  INT8_C( 115),  INT8_C(  69), -INT8_C(  97), -INT8_C(  68), -INT8_C(  84), -INT8_C(  82),  INT8_C(  35) },
      { -INT8_C(  62), -INT8_C(  20), -INT8_C(  26), -INT8_C(  97),  INT8_C(  89),  INT8_C( 100),  INT8_C(  81), -INT8_C(  66),
        -INT8_C(  61),  INT8_C(  11), -INT8_C(  33), -INT8_C(  52), -INT8_C(  76), -INT8_C(  43),  INT8_C( 118),  INT8_C(  38),
        -INT8_C(  68),  INT8_C(  36), -INT8_C(  68),  INT8_C(  28), -INT8_C( 124), -INT8_C(   6),  INT8_C(  82),      INT8_MIN,
        -INT8_C(  62),  INT8_C( 115),  INT8_C( 113), -INT8_C(  97), -INT8_C(  79),  INT8_C( 117), -INT8_C(  82),  INT8_C(  35) } }
  };
  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256i a = easysimd_mm256_loadu_epi8(test_vec[i].a);
    easysimd__mmask32 k = test_vec[i].k;
    easysimd__m256i r1 = easysimd_mm256_loadu_epi8(test_vec[i].r1);
    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm256_mask_storeu_epi8((void*)&r1, k, a);
    } EASYSIMD_TEST_PERF_END("easysimd_mm256_mask_storeu_epi8");
    easysimd_assert_equal_vi8(sizeof(r1), (const int8_t*)&r1, test_vec[i].r2);
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask32 k = easysimd_test_x86_random_mmask32();
    easysimd__m256i a = easysimd_test_x86_random_i8x32();
    easysimd__m256i r1 = easysimd_test_x86_random_i8x32();
    easysimd__m256i r2;
    easysimd_memcpy(&r1, &r2, sizeof(r1));
    easysimd_mm256_mask_storeu_epi8((void*)&r2.i8[0], k, a);

    easysimd_test_x86_write_i8x32(2, a, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_mmask32(2, k, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_codegen_write_vi8(2, sizeof(r1), (int8_t*)&r1.i8[0], EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_codegen_write_vi8(2, sizeof(r2), (int8_t*)&r2.i8[0], EASYSIMD_TEST_VEC_POS_LAST);
  }
  return 1;
#endif
}

static int
test_easysimd_mm256_mask_storeu_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    easysimd__mmask16 k;
    const int16_t a[16];
    const int16_t mem_addr[16];
  } test_vec[] = {
    { UINT16_C(26009),
      { -INT16_C( 14877), -INT16_C( 32041),  INT16_C( 24268), -INT16_C( 32064),  INT16_C( 27653), -INT16_C( 20531), -INT16_C(   285), -INT16_C( 11885),
        -INT16_C( 27780),  INT16_C(  3476),  INT16_C( 29992), -INT16_C( 28876), -INT16_C(  8260), -INT16_C(  3244), -INT16_C(  4608), -INT16_C(  7080) },
      { -INT16_C( 14877),  INT16_C(     0),  INT16_C(     0), -INT16_C( 32064),  INT16_C( 27653),  INT16_C(     0),  INT16_C(     0), -INT16_C( 11885),
        -INT16_C( 27780),  INT16_C(     0),  INT16_C( 29992),  INT16_C(     0),  INT16_C(     0), -INT16_C(  3244), -INT16_C(  4608),  INT16_C(     0) } },
    { UINT16_C(12211),
      { -INT16_C( 32666),  INT16_C( 10126), -INT16_C( 27902), -INT16_C( 12397),  INT16_C( 30275), -INT16_C( 10547),  INT16_C( 18759), -INT16_C(  9367),
        -INT16_C( 28073), -INT16_C( 29872),  INT16_C(  3105),  INT16_C( 30058),  INT16_C( 27392),  INT16_C( 22627),  INT16_C(  5967), -INT16_C( 19064) },
      { -INT16_C( 32666),  INT16_C( 10126),  INT16_C(     0),  INT16_C(     0),  INT16_C( 30275), -INT16_C( 10547),  INT16_C(     0), -INT16_C(  9367),
        -INT16_C( 28073), -INT16_C( 29872),  INT16_C(  3105),  INT16_C( 30058),  INT16_C(     0),  INT16_C( 22627),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C( 5783),
      { -INT16_C( 26148),  INT16_C( 28585), -INT16_C(  5016),  INT16_C( 13798),  INT16_C( 11714),  INT16_C( 11390), -INT16_C( 10999),  INT16_C( 22974),
        -INT16_C(  8352), -INT16_C( 13466),  INT16_C( 26196), -INT16_C( 18378), -INT16_C( 31298),  INT16_C( 18127),  INT16_C( 26170),  INT16_C(  5980) },
      { -INT16_C( 26148),  INT16_C( 28585), -INT16_C(  5016),  INT16_C(     0),  INT16_C( 11714),  INT16_C(     0),  INT16_C(     0),  INT16_C( 22974),
         INT16_C(     0), -INT16_C( 13466),  INT16_C( 26196),  INT16_C(     0), -INT16_C( 31298),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C( 1791),
      {  INT16_C( 26502),  INT16_C( 27890), -INT16_C( 19044),  INT16_C(  6810), -INT16_C( 23583), -INT16_C( 24592),  INT16_C( 20732),  INT16_C( 25214),
        -INT16_C( 11749),  INT16_C( 20936), -INT16_C( 30838),  INT16_C( 22998),  INT16_C(  4557),  INT16_C( 10943), -INT16_C( 16856), -INT16_C( 20944) },
      {  INT16_C( 26502),  INT16_C( 27890), -INT16_C( 19044),  INT16_C(  6810), -INT16_C( 23583), -INT16_C( 24592),  INT16_C( 20732),  INT16_C( 25214),
         INT16_C(     0),  INT16_C( 20936), -INT16_C( 30838),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C( 8741),
      { -INT16_C( 16101), -INT16_C( 18985), -INT16_C( 18212), -INT16_C( 13224),  INT16_C( 21591), -INT16_C( 10980),  INT16_C( 14519),  INT16_C( 32680),
         INT16_C( 12937),  INT16_C( 24582), -INT16_C( 11124),  INT16_C( 19313), -INT16_C( 26114),  INT16_C( 11786),  INT16_C( 12103),  INT16_C( 25168) },
      { -INT16_C( 16101),  INT16_C(     0), -INT16_C( 18212),  INT16_C(     0),  INT16_C(     0), -INT16_C( 10980),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C( 24582),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 11786),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C(10481),
      { -INT16_C( 13033),  INT16_C( 28640),  INT16_C( 14489), -INT16_C( 19004),  INT16_C( 31501), -INT16_C( 18963),  INT16_C( 30714),  INT16_C(   488),
         INT16_C( 29911),  INT16_C( 18645), -INT16_C( 11329), -INT16_C( 13855),  INT16_C( 10241),  INT16_C( 20985), -INT16_C(  5493), -INT16_C( 23943) },
      { -INT16_C( 13033),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 31501), -INT16_C( 18963),  INT16_C( 30714),  INT16_C(   488),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 13855),  INT16_C(     0),  INT16_C( 20985),  INT16_C(     0),  INT16_C(     0) } },
    { UINT16_C(23223),
      {  INT16_C( 20498), -INT16_C( 10606), -INT16_C( 24827), -INT16_C(  3247),  INT16_C( 19285),  INT16_C( 15722),  INT16_C( 16716),  INT16_C(  8625),
         INT16_C( 28809),  INT16_C( 27380), -INT16_C(  2758),  INT16_C( 13202),  INT16_C(  7495), -INT16_C( 16355), -INT16_C( 11072), -INT16_C( 11750) },
      {  INT16_C( 20498), -INT16_C( 10606), -INT16_C( 24827),  INT16_C(     0),  INT16_C( 19285),  INT16_C( 15722),  INT16_C(     0),  INT16_C(  8625),
         INT16_C(     0),  INT16_C( 27380),  INT16_C(     0),  INT16_C( 13202),  INT16_C(  7495),  INT16_C(     0), -INT16_C( 11072),  INT16_C(     0) } },
    { UINT16_C(44068),
      {  INT16_C( 10664), -INT16_C(  1716), -INT16_C( 24292), -INT16_C( 31164), -INT16_C( 28194), -INT16_C( 28729),  INT16_C( 20658), -INT16_C( 22529),
         INT16_C( 14778),  INT16_C( 19868), -INT16_C(  7316), -INT16_C( 30358),  INT16_C( 10916), -INT16_C( 16803), -INT16_C( 32260), -INT16_C( 23445) },
      {  INT16_C(     0),  INT16_C(     0), -INT16_C( 24292),  INT16_C(     0),  INT16_C(     0), -INT16_C( 28729),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0), -INT16_C(  7316), -INT16_C( 30358),  INT16_C(     0), -INT16_C( 16803),  INT16_C(     0), -INT16_C( 23445) } }
  };
  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m256i a = easysimd_mm256_loadu_si256(test_vec[i].a);
    easysimd__mmask16 k = test_vec[i].k;
    easysimd__m256i r = easysimd_mm256_setzero_si256();

    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm256_mask_storeu_epi16((void*)&r, k, a);
    } EASYSIMD_TEST_PERF_END("_mm256_mask_storeu_epi16");
    easysimd_assert_m256i_i16(r, ==, easysimd_mm256_loadu_si256(test_vec[i].mem_addr));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m256i a = easysimd_test_x86_random_i16x16();
    easysimd__m256i mem_addr = easysimd_mm256_setzero_si256();
    easysimd_mm256_mask_storeu_epi16((void*)&mem_addr, k, a);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x16(2, mem_addr, EASYSIMD_TEST_VEC_POS_LAST);

  }
  return 1;
#endif
}

static int
test_easysimd_mm512_mask_storeu_epi16(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    easysimd__mmask32 k;
    const int16_t a[32];
    const int16_t mem_addr[32];
  } test_vec[] = {
    { UINT32_C(3215211138),
      { -INT16_C( 28417),  INT16_C( 17786),  INT16_C( 27273), -INT16_C( 11856),  INT16_C(  2900), -INT16_C( 17252),  INT16_C( 31100), -INT16_C( 14662),
         INT16_C( 14125),  INT16_C(  9361), -INT16_C(  3218), -INT16_C(  9303), -INT16_C( 28911), -INT16_C( 27761),  INT16_C( 13257), -INT16_C( 14253),
        -INT16_C( 12860),  INT16_C( 19725), -INT16_C( 16840), -INT16_C( 29666), -INT16_C( 17719),  INT16_C( 17992),  INT16_C(   563),  INT16_C( 24588),
        -INT16_C( 25287), -INT16_C( 22651),  INT16_C( 11920), -INT16_C( 24190),  INT16_C(  4541), -INT16_C( 31180), -INT16_C( 30907),  INT16_C(  2383) },
      {  INT16_C(     0),  INT16_C( 17786),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 14662),
         INT16_C(     0),  INT16_C(  9361),  INT16_C(     0), -INT16_C(  9303), -INT16_C( 28911), -INT16_C( 27761),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0), -INT16_C( 16840),  INT16_C(     0),  INT16_C(     0),  INT16_C( 17992),  INT16_C(     0),  INT16_C( 24588),
        -INT16_C( 25287), -INT16_C( 22651),  INT16_C( 11920), -INT16_C( 24190),  INT16_C(  4541), -INT16_C( 31180),  INT16_C(     0),  INT16_C(  2383) } },
    { UINT32_C(2371247189),
      {  INT16_C( 29722), -INT16_C(  7143),  INT16_C( 24878),  INT16_C( 25130),  INT16_C( 13924), -INT16_C( 25150),  INT16_C( 18387),  INT16_C( 25413),
        -INT16_C( 14474),  INT16_C( 13060),  INT16_C( 14553),  INT16_C(  7866),  INT16_C(  2496),  INT16_C(  5415),  INT16_C( 32101), -INT16_C( 32606),
        -INT16_C( 17423),  INT16_C(  8036), -INT16_C( 29156), -INT16_C( 32639),  INT16_C( 17604), -INT16_C( 26850),  INT16_C( 25483),  INT16_C(   506),
        -INT16_C(   470),  INT16_C(   821), -INT16_C(  4298), -INT16_C(  2527),  INT16_C( 18680),  INT16_C( 23819), -INT16_C( 21051), -INT16_C( 18723) },
      {  INT16_C( 29722),  INT16_C(     0),  INT16_C( 24878),  INT16_C(     0),  INT16_C( 13924),  INT16_C(     0),  INT16_C( 18387),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C( 14553),  INT16_C(  7866),  INT16_C(  2496),  INT16_C(     0),  INT16_C( 32101),  INT16_C(     0),
         INT16_C(     0),  INT16_C(  8036), -INT16_C( 29156),  INT16_C(     0),  INT16_C( 17604),  INT16_C(     0),  INT16_C( 25483),  INT16_C(     0),
        -INT16_C(   470),  INT16_C(     0), -INT16_C(  4298), -INT16_C(  2527),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 18723) } },
    { UINT32_C(2245411176),
      {  INT16_C( 22479), -INT16_C( 27899),  INT16_C(  9115),  INT16_C( 10026),  INT16_C(  9350), -INT16_C( 20184),  INT16_C( 23842),  INT16_C( 22964),
        -INT16_C( 10676),  INT16_C( 17487),  INT16_C( 23326), -INT16_C(  7006),  INT16_C( 32520),  INT16_C( 29082),  INT16_C( 28865), -INT16_C( 28426),
        -INT16_C(  1080),  INT16_C( 25380),  INT16_C( 19999), -INT16_C( 23158), -INT16_C( 19597), -INT16_C( 27306),  INT16_C(  2832),  INT16_C( 24046),
         INT16_C( 16097), -INT16_C(    95),  INT16_C( 17305), -INT16_C( 24093),  INT16_C( 32451), -INT16_C( 31726),  INT16_C(  2286), -INT16_C( 18924) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 10026),  INT16_C(     0), -INT16_C( 20184),  INT16_C( 23842),  INT16_C(     0),
        -INT16_C( 10676),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 28865),  INT16_C(     0),
         INT16_C(     0),  INT16_C( 25380),  INT16_C( 19999),  INT16_C(     0), -INT16_C( 19597),  INT16_C(     0),  INT16_C(  2832),  INT16_C( 24046),
         INT16_C( 16097),  INT16_C(     0),  INT16_C( 17305),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 18924) } },
    { UINT32_C( 588920836),
      { -INT16_C( 23417), -INT16_C(  1336),  INT16_C(  8023),  INT16_C( 26767),  INT16_C( 32298),  INT16_C(  3013),  INT16_C( 26300),  INT16_C( 21770),
        -INT16_C(  4438),  INT16_C( 28150),  INT16_C(  2412),  INT16_C( 23281),  INT16_C(  1297),  INT16_C(  5393),  INT16_C( 11070), -INT16_C( 15048),
         INT16_C(   463),  INT16_C( 10175),  INT16_C( 20000),  INT16_C( 19087),  INT16_C( 21708), -INT16_C( 30635),  INT16_C( 24506),  INT16_C( 25821),
        -INT16_C( 11187), -INT16_C( 17967), -INT16_C( 15651), -INT16_C(  4588),  INT16_C(  9672),  INT16_C(  1540),  INT16_C( 15440),  INT16_C(  8139) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(  8023),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 23281),  INT16_C(  1297),  INT16_C(  5393),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0),  INT16_C( 10175),  INT16_C(     0),  INT16_C( 19087),  INT16_C( 21708),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
        -INT16_C( 11187), -INT16_C( 17967),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  1540),  INT16_C(     0),  INT16_C(     0) } },
    { UINT32_C(1564903997),
      { -INT16_C( 10792), -INT16_C( 23129), -INT16_C(   983), -INT16_C(  7123),  INT16_C(  2908), -INT16_C( 22200),  INT16_C(  6879), -INT16_C( 17309),
         INT16_C( 30684), -INT16_C( 23382), -INT16_C( 20836), -INT16_C(  4950),  INT16_C( 30187),  INT16_C( 10251),  INT16_C( 21247), -INT16_C( 10106),
         INT16_C( 11559),  INT16_C( 20861), -INT16_C( 21974), -INT16_C( 31179),  INT16_C( 32181), -INT16_C( 27601), -INT16_C( 28009),  INT16_C( 29776),
        -INT16_C(  1271), -INT16_C( 23272), -INT16_C( 15447), -INT16_C( 27503), -INT16_C( 25288),  INT16_C( 14525),  INT16_C( 17391),  INT16_C(  5648) },
      { -INT16_C( 10792),  INT16_C(     0), -INT16_C(   983), -INT16_C(  7123),  INT16_C(  2908), -INT16_C( 22200),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0), -INT16_C( 23382),  INT16_C(     0), -INT16_C(  4950),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 10106),
         INT16_C(     0),  INT16_C( 20861), -INT16_C( 21974),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 28009),  INT16_C(     0),
        -INT16_C(  1271),  INT16_C(     0), -INT16_C( 15447), -INT16_C( 27503), -INT16_C( 25288),  INT16_C(     0),  INT16_C( 17391),  INT16_C(     0) } },
    { UINT32_C(2590477680),
      { -INT16_C( 25545), -INT16_C(  4832),  INT16_C( 20506), -INT16_C( 20095), -INT16_C( 11550), -INT16_C(  5083),  INT16_C( 16077),  INT16_C( 30353),
         INT16_C(  8961),  INT16_C( 14603), -INT16_C( 14144), -INT16_C( 20623), -INT16_C( 32501),  INT16_C( 31685),  INT16_C( 11534),  INT16_C( 17942),
         INT16_C( 14025), -INT16_C(  7373), -INT16_C( 19322),  INT16_C( 27029), -INT16_C( 17786),  INT16_C( 21333), -INT16_C(  6408), -INT16_C(  1590),
        -INT16_C( 10999), -INT16_C( 14029), -INT16_C( 23395), -INT16_C( 22408),  INT16_C( 15910),  INT16_C( 13347),  INT16_C( 14699),  INT16_C( 13434) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 11550), -INT16_C(  5083),  INT16_C( 16077),  INT16_C(     0),
         INT16_C(  8961),  INT16_C(     0), -INT16_C( 14144), -INT16_C( 20623),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C( 17942),
         INT16_C( 14025), -INT16_C(  7373), -INT16_C( 19322),  INT16_C(     0),  INT16_C(     0),  INT16_C( 21333), -INT16_C(  6408),  INT16_C(     0),
         INT16_C(     0), -INT16_C( 14029),  INT16_C(     0), -INT16_C( 22408),  INT16_C( 15910),  INT16_C(     0),  INT16_C(     0),  INT16_C( 13434) } },
    { UINT32_C(4128812400),
      { -INT16_C( 21150), -INT16_C(  6049), -INT16_C( 19353),  INT16_C( 24636),  INT16_C(  1691), -INT16_C( 23463), -INT16_C( 29477),  INT16_C( 30830),
        -INT16_C(  6607),  INT16_C( 22304),  INT16_C( 17188), -INT16_C( 28789),  INT16_C(  1661), -INT16_C(  4668), -INT16_C(  9037),  INT16_C(  5603),
         INT16_C( 17289), -INT16_C(  3842),  INT16_C( 15095), -INT16_C( 28080), -INT16_C( 21952),  INT16_C(  6967), -INT16_C( 23242),  INT16_C( 26515),
        -INT16_C( 19573), -INT16_C( 20290),  INT16_C( 19190),  INT16_C( 29503),  INT16_C(   848),  INT16_C(   864),  INT16_C( 17631),  INT16_C( 26649) },
      {  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(  1691), -INT16_C( 23463), -INT16_C( 29477),  INT16_C(     0),
        -INT16_C(  6607),  INT16_C(     0),  INT16_C( 17188), -INT16_C( 28789),  INT16_C(     0), -INT16_C(  4668),  INT16_C(     0),  INT16_C(  5603),
         INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C( 28080), -INT16_C( 21952),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(     0), -INT16_C( 20290),  INT16_C( 19190),  INT16_C(     0),  INT16_C(   848),  INT16_C(   864),  INT16_C( 17631),  INT16_C( 26649) } },
    { UINT32_C(2119767943),
      { -INT16_C( 22191), -INT16_C( 28399),  INT16_C( 18515), -INT16_C( 30036),  INT16_C( 16365),  INT16_C( 30961), -INT16_C( 20238), -INT16_C(  6104),
         INT16_C( 26874),  INT16_C( 19036), -INT16_C( 17301),  INT16_C( 19277),  INT16_C( 26112), -INT16_C( 30797),  INT16_C(  3197), -INT16_C( 12794),
         INT16_C(  6070),  INT16_C(  2399),  INT16_C(  2911),  INT16_C( 19603), -INT16_C( 31414),  INT16_C( 15556), -INT16_C(  4811),  INT16_C( 12069),
        -INT16_C( 32427), -INT16_C( 16263), -INT16_C( 14787),  INT16_C( 15883), -INT16_C( 16595), -INT16_C( 21819), -INT16_C( 13365), -INT16_C( 32391) },
      { -INT16_C( 22191), -INT16_C( 28399),  INT16_C( 18515),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0), -INT16_C(  6104),
         INT16_C( 26874),  INT16_C( 19036), -INT16_C( 17301),  INT16_C(     0),  INT16_C( 26112),  INT16_C(     0),  INT16_C(     0),  INT16_C(     0),
         INT16_C(  6070),  INT16_C(     0),  INT16_C(     0),  INT16_C( 19603), -INT16_C( 31414),  INT16_C(     0), -INT16_C(  4811),  INT16_C(     0),
         INT16_C(     0), -INT16_C( 16263), -INT16_C( 14787),  INT16_C( 15883), -INT16_C( 16595), -INT16_C( 21819), -INT16_C( 13365),  INT16_C(     0) } }
  };
  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__mmask32 k = test_vec[i].k;
    easysimd__m512i r;
    easysimd_memset(&r, 0, sizeof(r));

    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm512_mask_storeu_epi16((void*)&r, k, a);
    } EASYSIMD_TEST_PERF_END("_mm512_mask_storeu_epi16");
    easysimd_assert_m512i_i16(r, ==, easysimd_mm512_loadu_si512(test_vec[i].mem_addr));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask32 k = easysimd_test_x86_random_mmask32();
    easysimd__m512i a = easysimd_test_x86_random_i16x32();
    easysimd__m512i mem_addr;
    easysimd_memset(&mem_addr, 0, sizeof(mem_addr));
    easysimd_mm512_mask_storeu_epi16((void*)&mem_addr, k, a);

    easysimd_test_x86_write_mmask32(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i16x32(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i16x32(2, mem_addr, EASYSIMD_TEST_VEC_POS_LAST);

  }
  return 1;
#endif
}

static int
test_easysimd_mm512_mask_storeu_epi32(EASYSIMD_MUNIT_TEST_ARGS) {
#if 1
  static const struct {
    easysimd__mmask16 k;
    const int32_t a[16];
    const int32_t mem_addr[16];
  } test_vec[] = {
    { UINT16_C(19709),
      { -INT32_C(  1721062490), -INT32_C(   902010920),  INT32_C(   810879840), -INT32_C(   455945222),  INT32_C(  1740860520), -INT32_C(  2136570130),  INT32_C(   735037173),  INT32_C(    24628315),
         INT32_C(  1352393335), -INT32_C(  1457858743), -INT32_C(   572887070), -INT32_C(  1413370814),  INT32_C(   101876760),  INT32_C(     8894475), -INT32_C(   634694018), -INT32_C(  1696882142) },
      { -INT32_C(  1721062490),  INT32_C(           0),  INT32_C(   810879840), -INT32_C(   455945222),  INT32_C(  1740860520), -INT32_C(  2136570130),  INT32_C(   735037173),  INT32_C(    24628315),
         INT32_C(           0),  INT32_C(           0), -INT32_C(   572887070), -INT32_C(  1413370814),  INT32_C(           0),  INT32_C(           0), -INT32_C(   634694018),  INT32_C(           0) } },
    { UINT16_C(30340),
      {  INT32_C(    72273642),  INT32_C(  1366503543), -INT32_C(   805456371),  INT32_C(  1934824801), -INT32_C(  1557438948), -INT32_C(  1980126626),  INT32_C(  1596726148), -INT32_C(  1613320011),
        -INT32_C(   157080450),  INT32_C(  1648826196),  INT32_C(   774981069),  INT32_C(  1990296666),  INT32_C(  1092209891), -INT32_C(    87354762), -INT32_C(   480577746),  INT32_C(   646131879) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(   805456371),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1613320011),
         INT32_C(           0),  INT32_C(  1648826196),  INT32_C(   774981069),  INT32_C(           0),  INT32_C(  1092209891), -INT32_C(    87354762), -INT32_C(   480577746),  INT32_C(           0) } },
    { UINT16_C( 9812),
      {  INT32_C(  1664985116),  INT32_C(  1000868362), -INT32_C(   641727688), -INT32_C(  1817795719), -INT32_C(  1348133660),  INT32_C(  1906758423),  INT32_C(   983649975), -INT32_C(  1872693900),
        -INT32_C(  1460429155), -INT32_C(   505176920),  INT32_C(   414884767),  INT32_C(   732651590), -INT32_C(  1797631619), -INT32_C(   620396252),  INT32_C(  1125492431),  INT32_C(   953382555) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(   641727688),  INT32_C(           0), -INT32_C(  1348133660),  INT32_C(           0),  INT32_C(   983649975),  INT32_C(           0),
         INT32_C(           0), -INT32_C(   505176920),  INT32_C(   414884767),  INT32_C(           0),  INT32_C(           0), -INT32_C(   620396252),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(50708),
      { -INT32_C(  1000162080),  INT32_C(  1483145629), -INT32_C(   977752550), -INT32_C(  1290390055), -INT32_C(   835437623),  INT32_C(   745800470),  INT32_C(   430051142),  INT32_C(   685815368),
         INT32_C(   283918962),  INT32_C(  1583895620), -INT32_C(   618455038),  INT32_C(   529414742), -INT32_C(  1947286667),  INT32_C(   230122182), -INT32_C(  1171891854), -INT32_C(  2099116529) },
      {  INT32_C(           0),  INT32_C(           0), -INT32_C(   977752550),  INT32_C(           0), -INT32_C(   835437623),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0),
         INT32_C(           0),  INT32_C(  1583895620), -INT32_C(   618455038),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0), -INT32_C(  1171891854), -INT32_C(  2099116529) } },
    { UINT16_C(53065),
      { -INT32_C(    98333294),  INT32_C(   236594667), -INT32_C(  1907855360),  INT32_C(  2119286160),  INT32_C(    14686281),  INT32_C(  1264210469), -INT32_C(   279811828),  INT32_C(  2109643755),
         INT32_C(   326623528),  INT32_C(   102863366), -INT32_C(  1835767294),  INT32_C(  1880155687),  INT32_C(   594670078),  INT32_C(  1349438275),  INT32_C(   541048884), -INT32_C(  2086797989) },
      { -INT32_C(    98333294),  INT32_C(           0),  INT32_C(           0),  INT32_C(  2119286160),  INT32_C(           0),  INT32_C(           0), -INT32_C(   279811828),  INT32_C(           0),
         INT32_C(   326623528),  INT32_C(   102863366), -INT32_C(  1835767294),  INT32_C(  1880155687),  INT32_C(           0),  INT32_C(           0),  INT32_C(   541048884), -INT32_C(  2086797989) } },
    { UINT16_C( 5598),
      { -INT32_C(  1196956522),  INT32_C(  2116200938),  INT32_C(  1281640764),  INT32_C(   725443258), -INT32_C(   185171579),  INT32_C(   280242897), -INT32_C(   401797046),  INT32_C(   721283987),
        -INT32_C(  1176329009), -INT32_C(  1992883123),  INT32_C(   131505229), -INT32_C(  2077092866),  INT32_C(  1702373524), -INT32_C(  1653265325), -INT32_C(   796556740),  INT32_C(  1023050349) },
      {  INT32_C(           0),  INT32_C(  2116200938),  INT32_C(  1281640764),  INT32_C(   725443258), -INT32_C(   185171579),  INT32_C(           0), -INT32_C(   401797046),  INT32_C(   721283987),
        -INT32_C(  1176329009),  INT32_C(           0),  INT32_C(   131505229),  INT32_C(           0),  INT32_C(  1702373524),  INT32_C(           0),  INT32_C(           0),  INT32_C(           0) } },
    { UINT16_C(56358),
      {  INT32_C(   769684725), -INT32_C(   741790211),  INT32_C(  1743243061), -INT32_C(  1013941429),  INT32_C(  1458627553),  INT32_C(   114896000), -INT32_C(   158841092),  INT32_C(  2027073411),
         INT32_C(   547729955),  INT32_C(   368340704), -INT32_C(  2122523850),  INT32_C(   927272022),  INT32_C(  1888368111),  INT32_C(  1584818017),  INT32_C(   810876589), -INT32_C(   794220627) },
      {  INT32_C(           0), -INT32_C(   741790211),  INT32_C(  1743243061),  INT32_C(           0),  INT32_C(           0),  INT32_C(   114896000),  INT32_C(           0),  INT32_C(           0),
         INT32_C(           0),  INT32_C(           0), -INT32_C(  2122523850),  INT32_C(   927272022),  INT32_C(  1888368111),  INT32_C(           0),  INT32_C(   810876589), -INT32_C(   794220627) } },
    { UINT16_C(20185),
      { -INT32_C(   440550927),  INT32_C(  1270936526), -INT32_C(  1185474956), -INT32_C(   588363954),  INT32_C(   759386295),  INT32_C(    36434094), -INT32_C(   903227103), -INT32_C(  1709702231),
        -INT32_C(  1954556484),  INT32_C(  1037451208), -INT32_C(  1527370410),  INT32_C(   729867636), -INT32_C(   480722123), -INT32_C(   723155789),  INT32_C(   111021917), -INT32_C(   828262638) },
      { -INT32_C(   440550927),  INT32_C(           0),  INT32_C(           0), -INT32_C(   588363954),  INT32_C(   759386295),  INT32_C(           0), -INT32_C(   903227103), -INT32_C(  1709702231),
         INT32_C(           0),  INT32_C(  1037451208), -INT32_C(  1527370410),  INT32_C(   729867636),  INT32_C(           0),  INT32_C(           0),  INT32_C(   111021917),  INT32_C(           0) } }
  };
  for (size_t i = 0 ; i < (sizeof(test_vec) / sizeof(test_vec[0])) ; i++) {
    easysimd__m512i a = easysimd_mm512_loadu_si512(test_vec[i].a);
    easysimd__mmask16 k = test_vec[i].k;
    easysimd__m512i r;
    easysimd_memset(&r, 0, sizeof(r));

    EASYSIMD_TEST_PERF_WITH_LOOP_START(100000) {
      easysimd_mm512_mask_storeu_epi32((void*)&r, k, a);
    } EASYSIMD_TEST_PERF_END("_mm512_mask_storeu_epi32");
    easysimd_assert_m512i_i32(r, ==, easysimd_mm512_loadu_si512(test_vec[i].mem_addr));
  }

  return 0;
#else
  fputc('\n', stdout);
  for (int i = 0 ; i < 8 ; i++) {
    easysimd__mmask16 k = easysimd_test_x86_random_mmask16();
    easysimd__m512i a = easysimd_test_x86_random_i32x16();
    easysimd__m512i mem_addr;
    easysimd_memset(&mem_addr, 0, sizeof(mem_addr));
    easysimd_mm512_mask_storeu_epi32((void*)&mem_addr, k, a);

    easysimd_test_x86_write_mmask16(2, k, EASYSIMD_TEST_VEC_POS_FIRST);
    easysimd_test_x86_write_i32x16(2, a, EASYSIMD_TEST_VEC_POS_MIDDLE);
    easysimd_test_x86_write_i32x16(2, mem_addr, EASYSIMD_TEST_VEC_POS_LAST);

  }
  return 1;
#endif
}


EASYSIMD_TEST_FUNC_LIST_BEGIN
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_storeu_ps)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_storeu_pd)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_storeu_si512)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_stream_si512)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_stream_load_si512)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_mask_storeu_epi8)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm256_mask_storeu_epi16)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_mask_storeu_epi16)
EASYSIMD_TEST_FUNC_LIST_ENTRY(mm512_mask_storeu_epi32)
EASYSIMD_TEST_FUNC_LIST_END

#include <test/x86/avx512/test-avx512-footer.h>
